/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/var Cc=function(t,e){return Cc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(s[n]=i[n])},Cc(t,e)};export function __extends(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Cc(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}export var __assign=function(){return __assign=Object.assign||function(e){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},__assign.apply(this,arguments)};export function __rest(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(s[i[n]]=t[i[n]]);return s}export function __decorate(t,e,s,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,s):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,s,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,s,r):o(e,s))||r);return n>3&&r&&Object.defineProperty(e,s,r),r}export function __param(t,e){return function(s,i){e(s,i,t)}}export function __esDecorate(t,e,s,i,n,r){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=i.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?i.static?t:t.prototype:null,h=e||(l?Object.getOwnPropertyDescriptor(l,i.name):{}),u,f=!1,p=s.length-1;p>=0;p--){var g={};for(var m in i)g[m]=m==="access"?{}:i[m];for(var m in i.access)g.access[m]=i.access[m];g.addInitializer=function(b){if(f)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(b||null))};var w=(0,s[p])(a==="accessor"?{get:h.get,set:h.set}:h[c],g);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=o(w.get))&&(h.get=u),(u=o(w.set))&&(h.set=u),(u=o(w.init))&&n.unshift(u)}else(u=o(w))&&(a==="field"?n.unshift(u):h[c]=u)}l&&Object.defineProperty(l,i.name,h),f=!0}export function __runInitializers(t,e,s){for(var i=arguments.length>2,n=0;n<e.length;n++)s=i?e[n].call(t,s):e[n].call(t);return i?s:void 0}export function __propKey(t){return typeof t=="symbol"?t:"".concat(t)}export function __setFunctionName(t,e,s){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:s?"".concat(s," ",e):e})}export function __metadata(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}export function __awaiter(t,e,s,i){function n(r){return r instanceof s?r:new s(function(o){o(r)})}return new(s||(s=Promise))(function(r,o){function a(h){try{l(i.next(h))}catch(u){o(u)}}function c(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){h.done?r(h.value):n(h.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}export function __generator(t,e){var s={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(i=1,n&&(r=l[0]&2?n.return:l[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,l[1])).done)return r;switch(n=0,r&&(l=[l[0]&2,r.value]),l[0]){case 0:case 1:r=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,n=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(l[0]===6||l[0]===2)){s=0;continue}if(l[0]===3&&(!r||l[1]>r[0]&&l[1]<r[3])){s.label=l[1];break}if(l[0]===6&&s.label<r[1]){s.label=r[1],r=l;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(l);break}r[2]&&s.ops.pop(),s.trys.pop();continue}l=e.call(t,s)}catch(h){l=[6,h],n=0}finally{i=r=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}export var __createBinding=Object.create?function(t,e,s,i){i===void 0&&(i=s);var n=Object.getOwnPropertyDescriptor(e,s);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,n)}:function(t,e,s,i){i===void 0&&(i=s),t[i]=e[s]};export function __exportStar(t,e){for(var s in t)s!=="default"&&!Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(e,t,s)}export function __values(t){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&t[e],i=0;if(s)return s.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}export function __read(t,e){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var i=s.call(t),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}return r}export function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}export function __spreadArrays(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<s;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,n++)i[n]=r[o];return i}export function __spreadArray(t,e,s){if(s||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}export function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}export function __asyncGenerator(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=s.apply(t,e||[]),n,r=[];return n={},a("next"),a("throw"),a("return",o),n[Symbol.asyncIterator]=function(){return this},n;function o(p){return function(g){return Promise.resolve(g).then(p,u)}}function a(p,g){i[p]&&(n[p]=function(m){return new Promise(function(w,b){r.push([p,m,w,b])>1||c(p,m)})},g&&(n[p]=g(n[p])))}function c(p,g){try{l(i[p](g))}catch(m){f(r[0][3],m)}}function l(p){p.value instanceof __await?Promise.resolve(p.value.v).then(h,u):f(r[0][2],p)}function h(p){c("next",p)}function u(p){c("throw",p)}function f(p,g){p(g),r.shift(),r.length&&c(r[0][0],r[0][1])}}export function __asyncDelegator(t){var e,s;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,r){e[n]=t[n]?function(o){return(s=!s)?{value:__await(t[n](o)),done:!1}:r?r(o):o}:r}}export function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],s;return e?e.call(t):(t=typeof __values=="function"?__values(t):t[Symbol.iterator](),s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s);function i(r){s[r]=t[r]&&function(o){return new Promise(function(a,c){o=t[r](o),n(a,c,o.done,o.value)})}}function n(r,o,a,c){Promise.resolve(c).then(function(l){r({value:l,done:a})},o)}}export function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var bv=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};export function __importStar(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var s in t)s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)&&__createBinding(e,t,s);return bv(e,t),e}export function __importDefault(t){return t&&t.__esModule?t:{default:t}}export function __classPrivateFieldGet(t,e,s,i){if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(t):i?i.value:e.get(t)}export function __classPrivateFieldSet(t,e,s,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(t,s):n?n.value=s:e.set(t,s),s}export function __classPrivateFieldIn(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}export function __addDisposableResource(t,e,s){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,n;if(s){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=e[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose],s&&(n=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");n&&(i=function(){try{n.call(this)}catch(r){return Promise.reject(r)}}),t.stack.push({value:e,dispose:i,async:s})}else s&&t.stack.push({async:!0});return e}var Sv=typeof SuppressedError=="function"?SuppressedError:function(t,e,s){var i=new Error(s);return i.name="SuppressedError",i.error=t,i.suppressed=e,i};export function __disposeResources(t){function e(i){t.error=t.hasError?new Sv(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}function s(){for(;t.stack.length;){var i=t.stack.pop();try{var n=i.dispose&&i.dispose.call(i.value);if(i.async)return Promise.resolve(n).then(s,function(r){return e(r),s()})}catch(r){e(r)}}if(t.hasError)throw t.error}return s()}export default{__extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources};var Ev=Object.create,gd=Object.defineProperty,$v=Object.getOwnPropertyDescriptor,md=Object.getOwnPropertyNames,xv=Object.getPrototypeOf,kv=Object.prototype.hasOwnProperty,Pv=(t,e)=>function(){return e||(0,t[md(t)[0]])((e={exports:{}}).exports,e),e.exports},Rv=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of md(e))!kv.call(t,n)&&n!==s&&gd(t,n,{get:()=>e[n],enumerable:!(i=$v(e,n))||i.enumerable});return t},Cv=(t,e,s)=>(s=t!=null?Ev(xv(t)):{},Rv(e||!t||!t.__esModule?gd(s,"default",{value:t,enumerable:!0}):s,t)),Dv=Pv({"node_modules/minimist/index.js"(t,e){"use strict";function s(r,o){var a=r;o.slice(0,-1).forEach(function(l){a=a[l]||{}});var c=o[o.length-1];return c in a}function i(r){return typeof r=="number"||/^0x[0-9a-f]+$/i.test(r)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(r)}function n(r,o){return o==="constructor"&&typeof r[o]=="function"||o==="__proto__"}e.exports=function(r,o){o||(o={});var a={bools:{},strings:{},unknownFn:null};typeof o.unknown=="function"&&(a.unknownFn=o.unknown),typeof o.boolean=="boolean"&&o.boolean?a.allBools=!0:[].concat(o.boolean).filter(Boolean).forEach(function(P){a.bools[P]=!0});var c={};function l(P){return c[P].some(function(z){return a.bools[z]})}Object.keys(o.alias||{}).forEach(function(P){c[P]=[].concat(o.alias[P]),c[P].forEach(function(z){c[z]=[P].concat(c[P].filter(function(B){return z!==B}))})}),[].concat(o.string).filter(Boolean).forEach(function(P){a.strings[P]=!0,c[P]&&[].concat(c[P]).forEach(function(z){a.strings[z]=!0})});var h=o.default||{},u={_:[]};function f(P,z){return a.allBools&&/^--[^=]+$/.test(z)||a.strings[P]||a.bools[P]||c[P]}function p(P,z,B){for(var j=P,O=0;O<z.length-1;O++){var D=z[O];if(n(j,D))return;j[D]===void 0&&(j[D]={}),(j[D]===Object.prototype||j[D]===Number.prototype||j[D]===String.prototype)&&(j[D]={}),j[D]===Array.prototype&&(j[D]=[]),j=j[D]}var M=z[z.length-1];n(j,M)||((j===Object.prototype||j===Number.prototype||j===String.prototype)&&(j={}),j===Array.prototype&&(j=[]),j[M]===void 0||a.bools[M]||typeof j[M]=="boolean"?j[M]=B:Array.isArray(j[M])?j[M].push(B):j[M]=[j[M],B])}function g(P,z,B){if(!(B&&a.unknownFn&&!f(P,B)&&a.unknownFn(B)===!1)){var j=!a.strings[P]&&i(z)?Number(z):z;p(u,P.split("."),j),(c[P]||[]).forEach(function(O){p(u,O.split("."),j)})}}Object.keys(a.bools).forEach(function(P){g(P,h[P]===void 0?!1:h[P])});var m=[];r.indexOf("--")!==-1&&(m=r.slice(r.indexOf("--")+1),r=r.slice(0,r.indexOf("--")));for(var w=0;w<r.length;w++){var b=r[w],S,$;if(/^--.+=/.test(b)){var U=b.match(/^--([^=]+)=([\s\S]*)$/);S=U[1];var q=U[2];a.bools[S]&&(q=q!=="false"),g(S,q,b)}else if(/^--no-.+/.test(b))S=b.match(/^--no-(.+)/)[1],g(S,!1,b);else if(/^--.+/.test(b))S=b.match(/^--(.+)/)[1],$=r[w+1],$!==void 0&&!/^(-|--)[^-]/.test($)&&!a.bools[S]&&!a.allBools&&(!c[S]||!l(S))?(g(S,$,b),w+=1):/^(true|false)$/.test($)?(g(S,$==="true",b),w+=1):g(S,a.strings[S]?"":!0,b);else if(/^-[^-]+/.test(b)){for(var me=b.slice(1,-1).split(""),N=!1,E=0;E<me.length;E++){if($=b.slice(E+2),$==="-"){g(me[E],$,b);continue}if(/[A-Za-z]/.test(me[E])&&$[0]==="="){g(me[E],$.slice(1),b),N=!0;break}if(/[A-Za-z]/.test(me[E])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test($)){g(me[E],$,b),N=!0;break}if(me[E+1]&&me[E+1].match(/\W/)){g(me[E],b.slice(E+2),b),N=!0;break}else g(me[E],a.strings[me[E]]?"":!0,b)}S=b.slice(-1)[0],!N&&S!=="-"&&(r[w+1]&&!/^(-|--)[^-]/.test(r[w+1])&&!a.bools[S]&&(!c[S]||!l(S))?(g(S,r[w+1],b),w+=1):r[w+1]&&/^(true|false)$/.test(r[w+1])?(g(S,r[w+1]==="true",b),w+=1):g(S,a.strings[S]?"":!0,b))}else if((!a.unknownFn||a.unknownFn(b)!==!1)&&u._.push(a.strings._||!i(b)?b:Number(b)),o.stopEarly){u._.push.apply(u._,r.slice(w+1));break}}return Object.keys(h).forEach(function(P){s(u,P.split("."))||(p(u,P.split("."),h[P]),(c[P]||[]).forEach(function(z){p(u,z.split("."),h[P])}))}),o["--"]?u["--"]=m.slice():m.forEach(function(P){u._.push(P)}),u}}});import{hostname as Iv,release as Ov}from"os";function Lv(t,e,s=0,i=t.length){let n=s,r=i;for(;n<r;){const o=Math.floor((n+r)/2);e(t[o])?n=o+1:r=o}return n-1}var oS=class _w{static{this.assertInvariants=!1}constructor(e){this.e=e,this.c=0}findLastMonotonous(e){if(_w.assertInvariants){if(this.d){for(const i of this.e)if(this.d(i)&&!e(i))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this.d=e}const s=Lv(this.e,e,this.c);return this.c=s+1,s===-1?void 0:this.e[s]}},Av=class{constructor(){this.b=[],this.a=function(t){setTimeout(()=>{throw t.stack?Ei.isErrorNoTelemetry(t)?new Ei(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.b.push(t),()=>{this.d(t)}}c(t){this.b.forEach(e=>{e(t)})}d(t){this.b.splice(this.b.indexOf(t),1)}setUnexpectedErrorHandler(t){this.a=t}getUnexpectedErrorHandler(){return this.a}onUnexpectedError(t){this.a(t),this.c(t)}onUnexpectedExternalError(t){this.a(t)}},wd=new Av;function Nv(t){wd.setUnexpectedErrorHandler(t)}function it(t){Ts(t)||wd.onUnexpectedError(t)}var lo="Canceled";function Ts(t){return t instanceof Ve?!0:t instanceof Error&&t.name===lo&&t.message===lo}var Ve=class extends Error{constructor(){super(lo),this.name=this.message}},aS=class gc extends Error{static{this.a="PendingMigrationError"}static is(e){return e instanceof gc||e instanceof Error&&e.name===gc.a}constructor(e){super(e),this.name=gc.a}};function ho(){const t=new Error(lo);return t.name=t.message,t}function jv(t){return t?new Error(`Illegal argument: ${t}`):new Error("Illegal argument")}function Dc(t){return t?new Error(`Illegal state: ${t}`):new Error("Illegal state")}function se(t){return t?t.message?t.message:t.stack?t.stack.split(`
`)[0]:String(t):"Error"}var Ei=class td extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof td)return e;const s=new td;return s.message=e.message,s.stack=e.stack,s}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},Ic=class Vw extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,Vw.prototype)}};function Tt(t,e,s=(i,n)=>i===n){if(t===e)return!0;if(!t||!e||t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(!s(t[i],e[i]))return!1;return!0}function sn(t){return t.filter(e=>!!e)}function Hn(t){return Array.isArray(t)&&t.length>0}function Rt(t,e=s=>s){const s=new Set;return t.filter(i=>{const n=e(i);return s.has(n)?!1:(s.add(n),!0)})}function vd(t,e){return t.push(e),()=>Tv(t,e)}function Tv(t,e){const s=t.indexOf(e);if(s>-1)return t.splice(s,1),e}function yd(t,e){let s;if(typeof e=="number"){let i=e;s=()=>{const n=Math.sin(i++)*179426549;return n-Math.floor(n)}}else s=Math.random;for(let i=t.length-1;i>0;i-=1){const n=Math.floor(s()*(i+1)),r=t[i];t[i]=t[n],t[n]=r}}function Mv(t){return t[Math.floor(Math.random()*t.length)]}var Oc;(function(t){function e(r){return r<0}t.isLessThan=e;function s(r){return r<=0}t.isLessThanOrEqual=s;function i(r){return r>0}t.isGreaterThan=i;function n(r){return r===0}t.isNeitherLessOrGreaterThan=n,t.greaterThan=1,t.lessThan=-1,t.neitherLessOrGreaterThan=0})(Oc||(Oc={}));function Fv(t,e){return(s,i)=>e(t(s),t(i))}var Uv=(t,e)=>t-e,cS=class mc{static{this.empty=new mc(e=>{})}constructor(e){this.iterate=e}forEach(e){this.iterate(s=>(e(s),!0))}toArray(){const e=[];return this.iterate(s=>(e.push(s),!0)),e}filter(e){return new mc(s=>this.iterate(i=>e(i)?s(i):!0))}map(e){return new mc(s=>this.iterate(i=>s(e(i))))}some(e){let s=!1;return this.iterate(i=>(s=e(i),!s)),s}findFirst(e){let s;return this.iterate(i=>e(i)?(s=i,!1):!0),s}findLast(e){let s;return this.iterate(i=>(e(i)&&(s=i),!0)),s}findLastMaxBy(e){let s,i=!0;return this.iterate(n=>((i||Oc.isGreaterThan(e(n,s)))&&(i=!1,s=n),!0)),s}};function Lc(t,e){if(!t)throw new Error(e?`Assertion failed (${e})`:"Assertion Failed")}function Bv(t,e="Unreachable"){throw new Error(e)}function Ac(t,e="unexpected state"){if(!t)throw typeof e=="string"?new Ic(`Assertion Failed: ${e}`):e}function $e(t){return typeof t=="string"}function Be(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}function zv(t){const e=Object.getPrototypeOf(Uint8Array);return typeof t=="object"&&t instanceof e}function Nc(t){return typeof t=="number"&&!isNaN(t)}function _v(t){return!!t&&typeof t[Symbol.iterator]=="function"}function Kt(t){return t===!0||t===!1}function rt(t){return typeof t>"u"}function bd(t){return!St(t)}function St(t){return rt(t)||t===null}function Vv(t,e){if(!t)throw new Error(e?`Unexpected type, expected '${e}'`:"Unexpected type")}function ls(t){return Ac(t!=null,"Argument is `undefined` or `null`."),t}var qv=Object.prototype.hasOwnProperty;function Sd(t){if(!Be(t))return!1;for(const e in t)if(qv.call(t,e))return!1;return!0}function jc(t){return typeof t=="function"}function Wv(){return globalThis._VSCODE_NLS_MESSAGES}function Ed(){return globalThis._VSCODE_NLS_LANGUAGE}var Hv=Ed()==="pseudo"||typeof document<"u"&&document.location&&typeof document.location.hash=="string"&&document.location.hash.indexOf("pseudo=true")>=0;function uo(t,e){let s;return e.length===0?s=t:s=t.replace(/\{(\d+)\}/g,(i,n)=>{const r=n[0],o=e[r];let a=i;return typeof o=="string"?a=o:(typeof o=="number"||typeof o=="boolean"||o===void 0||o===null)&&(a=String(o)),a}),Hv&&(s="\uFF3B"+s.replace(/[aouei]/g,"$&$&")+"\uFF3D"),s}function v(t,e,...s){return uo(typeof t=="number"?$d(t,e):e,s)}function $d(t,e){const s=Wv()?.[t];if(typeof s!="string"){if(typeof e=="string")return e;throw new Error(`!!! NLS MISSING: ${t} !!!`)}return s}function xd(t,e,...s){let i;typeof t=="number"?i=$d(t,e):i=e;const n=uo(i,s);return{value:n,original:e===i?n:uo(e,s)}}function Tc(t,e){return e&&(t.stack||t.stacktrace)?v(110,null,Pd(t),kd(t.stack)||kd(t.stacktrace)):Pd(t)}function kd(t){return Array.isArray(t)?t.join(`
`):t}function Pd(t){return t.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof t.code=="string"&&typeof t.errno=="number"&&typeof t.syscall=="string"?v(111,null,t.message):t.message||v(112,null)}function Qt(t=null,e=!1){if(!t)return v(113,null);if(Array.isArray(t)){const s=sn(t),i=Qt(s[0],e);return s.length>1?v(114,null,i,s.length):i}if($e(t))return t;if(t.detail){const s=t.detail;if(s.error)return Tc(s.error,e);if(s.exception)return Tc(s.exception,e)}return t.stack?Tc(t,e):t.message?t.message:v(115,null)}var Rd;function Gv(t,e){const s=Object.create(null);for(const i of t){const n=e(i);let r=s[n];r||(r=s[n]=[]),r.push(i)}return s}var lS=class{static{Rd=Symbol.toStringTag}constructor(t,e){this.b=e,this.a=new Map,this[Rd]="SetWithKey";for(const s of t)this.add(s)}get size(){return this.a.size}add(t){const e=this.b(t);return this.a.set(e,t),this}delete(t){return this.a.delete(this.b(t))}has(t){return this.a.has(this.b(t))}*entries(){for(const t of this.a.values())yield[t,t]}keys(){return this.values()}*values(){for(const t of this.a.values())yield t}clear(){this.a.clear()}forEach(t,e){this.a.forEach(s=>t.call(e,s,s,this))}[Symbol.iterator](){return this.values()}},Cd,Dd,Id,Jv=class{constructor(t,e){this.uri=t,this.value=e}};function Kv(t){return Array.isArray(t)}var lt=class Xr{static{this.c=e=>e.toString()}constructor(e,s){if(this[Cd]="ResourceMap",e instanceof Xr)this.d=new Map(e.d),this.e=s??Xr.c;else if(Kv(e)){this.d=new Map,this.e=s??Xr.c;for(const[i,n]of e)this.set(i,n)}else this.d=new Map,this.e=e??Xr.c}set(e,s){return this.d.set(this.e(e),new Jv(e,s)),this}get(e){return this.d.get(this.e(e))?.value}has(e){return this.d.has(this.e(e))}get size(){return this.d.size}clear(){this.d.clear()}delete(e){return this.d.delete(this.e(e))}forEach(e,s){typeof s<"u"&&(e=e.bind(s));for(const[i,n]of this.d)e(n.value,n.uri,this)}*values(){for(const e of this.d.values())yield e.value}*keys(){for(const e of this.d.values())yield e.uri}*entries(){for(const e of this.d.values())yield[e.uri,e.value]}*[(Cd=Symbol.toStringTag,Symbol.iterator)](){for(const[,e]of this.d)yield[e.uri,e.value]}},Mc=class{constructor(t,e){this[Dd]="ResourceSet",!t||typeof t=="function"?this.c=new lt(t):(this.c=new lt(e),t.forEach(this.add,this))}get size(){return this.c.size}add(t){return this.c.set(t,t),this}clear(){this.c.clear()}delete(t){return this.c.delete(t)}forEach(t,e){this.c.forEach((s,i)=>t.call(e,i,i,this))}has(t){return this.c.has(t)}entries(){return this.c.entries()}keys(){return this.c.keys()}values(){return this.c.keys()}[(Dd=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}},Od;(function(t){t[t.None=0]="None",t[t.AsOld=1]="AsOld",t[t.AsNew=2]="AsNew"})(Od||(Od={}));var Qv=class{constructor(){this[Id]="LinkedMap",this.c=new Map,this.d=void 0,this.e=void 0,this.f=0,this.g=0}clear(){this.c.clear(),this.d=void 0,this.e=void 0,this.f=0,this.g++}isEmpty(){return!this.d&&!this.e}get size(){return this.f}get first(){return this.d?.value}get last(){return this.e?.value}has(t){return this.c.has(t)}get(t,e=0){const s=this.c.get(t);if(s)return e!==0&&this.n(s,e),s.value}set(t,e,s=0){let i=this.c.get(t);if(i)i.value=e,s!==0&&this.n(i,s);else{switch(i={key:t,value:e,next:void 0,previous:void 0},s){case 0:this.l(i);break;case 1:this.k(i);break;case 2:this.l(i);break;default:this.l(i);break}this.c.set(t,i),this.f++}return this}delete(t){return!!this.remove(t)}remove(t){const e=this.c.get(t);if(e)return this.c.delete(t),this.m(e),this.f--,e.value}shift(){if(!this.d&&!this.e)return;if(!this.d||!this.e)throw new Error("Invalid list");const t=this.d;return this.c.delete(t.key),this.m(t),this.f--,t.value}forEach(t,e){const s=this.g;let i=this.d;for(;i;){if(e?t.bind(e)(i.value,i.key,this):t(i.value,i.key,this),this.g!==s)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:s.key,done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}values(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:s.value,done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}entries(){const t=this,e=this.g;let s=this.d;const i={[Symbol.iterator](){return i},next(){if(t.g!==e)throw new Error("LinkedMap got modified during iteration.");if(s){const n={value:[s.key,s.value],done:!1};return s=s.next,n}else return{value:void 0,done:!0}}};return i}[(Id=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}h(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this.d,s=this.size;for(;e&&s>t;)this.c.delete(e.key),e=e.next,s--;this.d=e,this.f=s,e&&(e.previous=void 0),this.g++}j(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this.e,s=this.size;for(;e&&s>t;)this.c.delete(e.key),e=e.previous,s--;this.e=e,this.f=s,e&&(e.next=void 0),this.g++}k(t){if(!this.d&&!this.e)this.e=t;else if(this.d)t.next=this.d,this.d.previous=t;else throw new Error("Invalid list");this.d=t,this.g++}l(t){if(!this.d&&!this.e)this.d=t;else if(this.e)t.previous=this.e,this.e.next=t;else throw new Error("Invalid list");this.e=t,this.g++}m(t){if(t===this.d&&t===this.e)this.d=void 0,this.e=void 0;else if(t===this.d){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this.d=t.next}else if(t===this.e){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this.e=t.previous}else{const e=t.next,s=t.previous;if(!e||!s)throw new Error("Invalid list");e.previous=s,s.next=e}t.next=void 0,t.previous=void 0,this.g++}n(t,e){if(!this.d||!this.e)throw new Error("Invalid list");if(!(e!==1&&e!==2)){if(e===1){if(t===this.d)return;const s=t.next,i=t.previous;t===this.e?(i.next=void 0,this.e=i):(s.previous=i,i.next=s),t.previous=void 0,t.next=this.d,this.d.previous=t,this.d=t,this.g++}else if(e===2){if(t===this.e)return;const s=t.next,i=t.previous;t===this.d?(s.previous=void 0,this.d=s):(s.previous=i,i.next=s),t.next=void 0,t.previous=this.e,this.e.next=t,this.e=t,this.g++}}}toJSON(){const t=[];return this.forEach((e,s)=>{t.push([s,e])}),t}fromJSON(t){this.clear();for(const[e,s]of t)this.set(e,s)}},Xv=class extends Qv{constructor(t,e=1){super(),this.o=t,this.p=Math.min(Math.max(0,e),1)}get limit(){return this.o}set limit(t){this.o=t,this.q()}get ratio(){return this.p}set ratio(t){this.p=Math.min(Math.max(0,t),1),this.q()}get(t,e=2){return super.get(t,e)}peek(t){return super.get(t,0)}set(t,e){return super.set(t,e,2),this}q(){this.size>this.o&&this.r(Math.round(this.o*this.p))}},fo=class extends Xv{constructor(t,e=1){super(t,e)}r(t){this.h(t)}set(t,e){return super.set(t,e),this.q(),this}},Zv=class{constructor(){this.c=new Map}add(t,e){let s=this.c.get(t);s||(s=new Set,this.c.set(t,s)),s.add(e)}delete(t,e){const s=this.c.get(t);s&&(s.delete(e),s.size===0&&this.c.delete(t))}forEach(t,e){const s=this.c.get(t);s&&s.forEach(e)}get(t){const e=this.c.get(t);return e||new Set}};function Fc(t,e){const s=this;let i=!1,n;return function(){if(i)return n;if(i=!0,e)try{n=t.apply(s,arguments)}finally{e()}else n=t.apply(s,arguments);return n}}var nn;(function(t){function e(N){return!!N&&typeof N=="object"&&typeof N[Symbol.iterator]=="function"}t.is=e;const s=Object.freeze([]);function i(){return s}t.empty=i;function*n(N){yield N}t.single=n;function r(N){return e(N)?N:n(N)}t.wrap=r;function o(N){return N||s}t.from=o;function*a(N){for(let E=N.length-1;E>=0;E--)yield N[E]}t.reverse=a;function c(N){return!N||N[Symbol.iterator]().next().done===!0}t.isEmpty=c;function l(N){return N[Symbol.iterator]().next().value}t.first=l;function h(N,E){let P=0;for(const z of N)if(E(z,P++))return!0;return!1}t.some=h;function u(N,E){let P=0;for(const z of N)if(!E(z,P++))return!1;return!0}t.every=u;function f(N,E){for(const P of N)if(E(P))return P}t.find=f;function*p(N,E){for(const P of N)E(P)&&(yield P)}t.filter=p;function*g(N,E){let P=0;for(const z of N)yield E(z,P++)}t.map=g;function*m(N,E){let P=0;for(const z of N)yield*E(z,P++)}t.flatMap=m;function*w(...N){for(const E of N)_v(E)?yield*E:yield E}t.concat=w;function b(N,E,P){let z=P;for(const B of N)z=E(z,B);return z}t.reduce=b;function S(N){let E=0;for(const P of N)E++;return E}t.length=S;function*$(N,E,P=N.length){for(E<-N.length&&(E=0),E<0&&(E+=N.length),P<0?P+=N.length:P>N.length&&(P=N.length);E<P;E++)yield N[E]}t.slice=$;function U(N,E=Number.POSITIVE_INFINITY){const P=[];if(E===0)return[P,N];const z=N[Symbol.iterator]();for(let B=0;B<E;B++){const j=z.next();if(j.done)return[P,t.empty()];P.push(j.value)}return[P,{[Symbol.iterator](){return z}}]}t.consume=U;async function q(N){const E=[];for await(const P of N)E.push(P);return E}t.asyncToArray=q;async function me(N){let E=[];for await(const P of N)E=E.concat(P);return E}t.asyncToArrayFlat=me})(nn||(nn={}));var Yv=!1,rn=null,hS=class qw{constructor(){this.b=new Map}static{this.a=0}c(e){let s=this.b.get(e);return s||(s={parent:null,source:null,isSingleton:!1,value:e,idx:qw.a++},this.b.set(e,s)),s}trackDisposable(e){const s=this.c(e);s.source||(s.source=new Error().stack)}setParent(e,s){const i=this.c(e);i.parent=s}markAsDisposed(e){this.b.delete(e)}markAsSingleton(e){this.c(e).isSingleton=!0}f(e,s){const i=s.get(e);if(i)return i;const n=e.parent?this.f(this.c(e.parent),s):e;return s.set(e,n),n}getTrackedDisposables(){const e=new Map;return[...this.b.entries()].filter(([,i])=>i.source!==null&&!this.f(i,e).isSingleton).flatMap(([i])=>i)}computeLeakingDisposables(e=10,s){let i;if(s)i=s;else{const c=new Map,l=[...this.b.values()].filter(u=>u.source!==null&&!this.f(u,c).isSingleton);if(l.length===0)return;const h=new Set(l.map(u=>u.value));if(i=l.filter(u=>!(u.parent&&h.has(u.parent))),i.length===0)throw new Error("There are cyclic diposable chains!")}if(!i)return;function n(c){function l(u,f){for(;u.length>0&&f.some(p=>typeof p=="string"?p===u[0]:u[0].match(p));)u.shift()}const h=c.source.split(`
`).map(u=>u.trim().replace("at ","")).filter(u=>u!=="");return l(h,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),h.reverse()}const r=new Zv;for(const c of i){const l=n(c);for(let h=0;h<=l.length;h++)r.add(l.slice(0,h).join(`
`),c)}i.sort(Fv(c=>c.idx,Uv));let o="",a=0;for(const c of i.slice(0,e)){a++;const l=n(c),h=[];for(let u=0;u<l.length;u++){let f=l[u];f=`(shared with ${r.get(l.slice(0,u+1).join(`
`)).size}/${i.length} leaks) at ${f}`;const g=r.get(l.slice(0,u).join(`
`)),m=Gv([...g].map(w=>n(w)[u]),w=>w);delete m[l[u]];for(const[w,b]of Object.entries(m))h.unshift(`    - stacktraces of ${b.length} other leaks continue with ${w}`);h.unshift(f)}o+=`


==================== Leaking disposable ${a}/${i.length}: ${c.value.constructor.name} ====================
${h.join(`
`)}
============================================================

`}return i.length>e&&(o+=`


... and ${i.length-e} more leaking disposables

`),{leaks:i,details:o}}};function ey(t){rn=t}if(Yv){const t="__is_disposable_tracked__";ey(new class{trackDisposable(e){const s=new Error("Potentially leaked disposable").stack;setTimeout(()=>{e[t]||console.log(s)},3e3)}setParent(e,s){if(e&&e!==T.None)try{e[t]=!0}catch{}}markAsDisposed(e){if(e&&e!==T.None)try{e[t]=!0}catch{}}markAsSingleton(e){}})}function Gn(t){return rn?.trackDisposable(t),t}function Jn(t){rn?.markAsDisposed(t)}function $i(t,e){rn?.setParent(t,e)}function ty(t,e){if(rn)for(const s of t)rn.setParent(s,e)}function Uc(t){return typeof t=="object"&&t!==null&&typeof t.dispose=="function"&&t.dispose.length===0}function Xt(t){if(nn.is(t)){const e=[];for(const s of t)if(s)try{s.dispose()}catch(i){e.push(i)}if(e.length===1)throw e[0];if(e.length>1)throw new AggregateError(e,"Encountered errors while disposing of store");return Array.isArray(t)?[]:t}else if(t)return t.dispose(),t}function Bc(...t){const e=de(()=>Xt(t));return ty(t,e),e}function de(t){const e=Gn({dispose:Fc(()=>{Jn(e),t()})});return e}var De=class Ww{static{this.DISABLE_DISPOSED_WARNING=!1}constructor(){this.f=new Set,this.g=!1,Gn(this)}dispose(){this.g||(Jn(this),this.g=!0,this.clear())}get isDisposed(){return this.g}clear(){if(this.f.size!==0)try{Xt(this.f)}finally{this.f.clear()}}add(e){if(!e||e===T.None)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return $i(e,this),this.g?Ww.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this.f.add(e),e}delete(e){if(e){if(e===this)throw new Error("Cannot dispose a disposable on itself!");this.f.delete(e),e.dispose()}}deleteAndLeak(e){e&&this.f.has(e)&&(this.f.delete(e),$i(e,null))}assertNotDisposed(){this.g&&it(new Ic("Object disposed"))}},T=class{static{this.None=Object.freeze({dispose(){}})}constructor(){this.q=new De,Gn(this),$i(this.q,this)}dispose(){Jn(this),this.q.dispose()}B(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this.q.add(t)}},hs=class{constructor(){this.b=!1,Gn(this)}get value(){return this.b?void 0:this.a}set value(t){this.b||t===this.a||(this.a?.dispose(),t&&$i(t,this),this.a=t)}clear(){this.value=void 0}dispose(){this.b=!0,Jn(this),this.a?.dispose(),this.a=void 0}clearAndLeak(){const t=this.a;return this.a=void 0,t&&$i(t,null),t}},po=class{constructor(){this.a=new Map,this.b=!1,Gn(this)}dispose(){Jn(this),this.b=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this.a.size)try{Xt(this.a.values())}finally{this.a.clear()}}has(t){return this.a.has(t)}get size(){return this.a.size}get(t){return this.a.get(t)}set(t,e,s=!1){this.b&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),s||this.a.get(t)?.dispose(),this.a.set(t,e),$i(e,this)}deleteAndDispose(t){this.a.get(t)?.dispose(),this.a.delete(t)}deleteAndLeak(t){const e=this.a.get(t);return e&&$i(e,null),this.a.delete(t),e}keys(){return this.a.keys()}values(){return this.a.values()}[Symbol.iterator](){return this.a[Symbol.iterator]()}};function sy(t,e){return t.then(s=>(e.isDisposed?s.dispose():e.add(s),s))}var on="en",Kn=!1,Qn=!1,Xn=!1,Ld=!1,Ad=!1,zc=!1,iy=!1,Nd=!1,ny=!1,ry=!1,go=void 0,mo=on,jd=on,Td=void 0,Ms=void 0,Fs=globalThis,Mt=void 0;typeof Fs.vscode<"u"&&typeof Fs.vscode.process<"u"?Mt=Fs.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Mt=process);var Md=typeof Mt?.versions?.electron=="string",oy=Md&&Mt?.type==="renderer";if(typeof Mt=="object"){Kn=Mt.platform==="win32",Qn=Mt.platform==="darwin",Xn=Mt.platform==="linux",Ld=Xn&&!!Mt.env.SNAP&&!!Mt.env.SNAP_REVISION,iy=Md,ny=!!Mt.env.CI||!!Mt.env.BUILD_ARTIFACTSTAGINGDIRECTORY||!!Mt.env.GITHUB_WORKSPACE,go=on,mo=on;const t=Mt.env.VSCODE_NLS_CONFIG;if(t)try{const e=JSON.parse(t);go=e.userLocale,jd=e.osLocale,mo=e.resolvedLanguage||on,Td=e.languagePack?.translationsConfigFile}catch{}Ad=!0}else typeof navigator=="object"&&!oy?(Ms=navigator.userAgent,Kn=Ms.indexOf("Windows")>=0,Qn=Ms.indexOf("Macintosh")>=0,Nd=(Ms.indexOf("Macintosh")>=0||Ms.indexOf("iPad")>=0||Ms.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Xn=Ms.indexOf("Linux")>=0,ry=Ms?.indexOf("Mobi")>=0,zc=!0,mo=Ed()||on,go=navigator.language.toLowerCase(),jd=go):console.error("Unable to resolve platform.");var Fd;(function(t){t[t.Web=0]="Web",t[t.Mac=1]="Mac",t[t.Linux=2]="Linux",t[t.Windows=3]="Windows"})(Fd||(Fd={}));function Ud(t){switch(t){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var wo=0;Qn?wo=1:Kn?wo=3:Xn&&(wo=2);var Ae=Kn,vs=Qn,wt=Xn,ay=Ld,cy=Ad,ot=zc,ly=zc&&typeof Fs.importScripts=="function",hy=ly?Fs.origin:void 0,Zn=wo,ys=Ms,bs=mo,Bd;(function(t){function e(){return bs}t.value=e;function s(){return bs.length===2?bs==="en":bs.length>=3?bs[0]==="e"&&bs[1]==="n"&&bs[2]==="-":!1}t.isDefaultVariant=s;function i(){return bs==="en"}t.isDefault=i})(Bd||(Bd={}));var zd=Td,uy=typeof Fs.postMessage=="function"&&!Fs.importScripts,fy=(()=>{if(uy){const t=[];Fs.addEventListener("message",s=>{if(s.data&&s.data.vscodeScheduleAsyncWork)for(let i=0,n=t.length;i<n;i++){const r=t[i];if(r.id===s.data.vscodeScheduleAsyncWork){t.splice(i,1),r.callback();return}}});let e=0;return s=>{const i=++e;t.push({id:i,callback:s}),Fs.postMessage({vscodeScheduleAsyncWork:i},"*")}}return t=>setTimeout(t)})(),_d;(function(t){t[t.Windows=1]="Windows",t[t.Macintosh=2]="Macintosh",t[t.Linux=3]="Linux"})(_d||(_d={}));var an=Qn||Nd?2:Kn?1:3,_c=!!(ys&&ys.indexOf("Chrome")>=0),Vd=!!(ys&&ys.indexOf("Firefox")>=0),qd=!!(!_c&&ys&&ys.indexOf("Safari")>=0),Wd=!!(ys&&ys.indexOf("Edg/")>=0),dy=!!(ys&&ys.indexOf("Android")>=0),ze=class wc{static{this.Undefined=new wc(void 0)}constructor(e){this.element=e,this.next=wc.Undefined,this.prev=wc.Undefined}},Hd=class{constructor(){this.a=ze.Undefined,this.b=ze.Undefined,this.c=0}get size(){return this.c}isEmpty(){return this.a===ze.Undefined}clear(){let t=this.a;for(;t!==ze.Undefined;){const e=t.next;t.prev=ze.Undefined,t.next=ze.Undefined,t=e}this.a=ze.Undefined,this.b=ze.Undefined,this.c=0}unshift(t){return this.d(t,!1)}push(t){return this.d(t,!0)}d(t,e){const s=new ze(t);if(this.a===ze.Undefined)this.a=s,this.b=s;else if(e){const n=this.b;this.b=s,s.prev=n,n.next=s}else{const n=this.a;this.a=s,s.next=n,n.prev=s}this.c+=1;let i=!1;return()=>{i||(i=!0,this.e(s))}}shift(){if(this.a!==ze.Undefined){const t=this.a.element;return this.e(this.a),t}}pop(){if(this.b!==ze.Undefined){const t=this.b.element;return this.e(this.b),t}}e(t){if(t.prev!==ze.Undefined&&t.next!==ze.Undefined){const e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===ze.Undefined&&t.next===ze.Undefined?(this.a=ze.Undefined,this.b=ze.Undefined):t.next===ze.Undefined?(this.b=this.b.prev,this.b.next=ze.Undefined):t.prev===ze.Undefined&&(this.a=this.a.next,this.a.prev=ze.Undefined);this.c-=1}*[Symbol.iterator](){let t=this.a;for(;t!==ze.Undefined;)yield t.element,t=t.next}},py=globalThis.performance.now.bind(globalThis.performance),cn=class Hw{static create(e){return new Hw(e)}constructor(e){this.c=e===!1?Date.now:py,this.a=this.c(),this.b=-1}stop(){this.b=this.c()}reset(){this.a=this.c(),this.b=-1}elapsed(){return this.b!==-1?this.b-this.a:this.c()-this.a}},Gd=!1,gy=!1,L;(function(t){t.None=()=>T.None;function e(O){if(gy){const{onDidAddListener:D}=O,M=Vc.create();let F=0;O.onDidAddListener=()=>{++F===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),M.print()),D?.()}}}function s(O,D){return p(O,()=>{},0,void 0,!0,void 0,D)}t.defer=s;function i(O){return(D,M=null,F)=>{let V=!1,ee;return ee=O(we=>{if(!V)return ee?ee.dispose():V=!0,D.call(M,we)},null,F),V&&ee.dispose(),ee}}t.once=i;function n(O,D){return t.once(t.filter(O,D))}t.onceIf=n;function r(O,D,M){return u((F,V=null,ee)=>O(we=>F.call(V,D(we)),null,ee),M)}t.map=r;function o(O,D,M){return u((F,V=null,ee)=>O(we=>{D(we),F.call(V,we)},null,ee),M)}t.forEach=o;function a(O,D,M){return u((F,V=null,ee)=>O(we=>D(we)&&F.call(V,we),null,ee),M)}t.filter=a;function c(O){return O}t.signal=c;function l(...O){return(D,M=null,F)=>{const V=Bc(...O.map(ee=>ee(we=>D.call(M,we))));return f(V,F)}}t.any=l;function h(O,D,M,F){let V=M;return r(O,ee=>(V=D(V,ee),V),F)}t.reduce=h;function u(O,D){let M;const F={onWillAddFirstListener(){M=O(V.fire,V)},onDidRemoveLastListener(){M?.dispose()}};D||e(F);const V=new R(F);return D?.add(V),V.event}function f(O,D){return D instanceof Array?D.push(O):D&&D.add(O),O}function p(O,D,M=100,F=!1,V=!1,ee,we){let Ge,Je,ts,vi=0,Ks;const en={leakWarningThreshold:ee,onWillAddFirstListener(){Ge=O(yi=>{vi++,Je=D(Je,yi),F&&!ts&&(Qs.fire(Je),Je=void 0),Ks=()=>{const no=Je;Je=void 0,ts=void 0,(!F||vi>1)&&Qs.fire(no),vi=0},typeof M=="number"?(ts&&clearTimeout(ts),ts=setTimeout(Ks,M)):ts===void 0&&(ts=null,queueMicrotask(Ks))})},onWillRemoveListener(){V&&vi>0&&Ks?.()},onDidRemoveLastListener(){Ks=void 0,Ge.dispose()}};we||e(en);const Qs=new R(en);return we?.add(Qs),Qs.event}t.debounce=p;function g(O,D=0,M){return t.debounce(O,(F,V)=>F?(F.push(V),F):[V],D,void 0,!0,void 0,M)}t.accumulate=g;function m(O,D=(F,V)=>F===V,M){let F=!0,V;return a(O,ee=>{const we=F||!D(ee,V);return F=!1,V=ee,we},M)}t.latch=m;function w(O,D,M){return[t.filter(O,D,M),t.filter(O,F=>!D(F),M)]}t.split=w;function b(O,D=!1,M=[],F){let V=M.slice(),ee=O(Je=>{V?V.push(Je):Ge.fire(Je)});F&&F.add(ee);const we=()=>{V?.forEach(Je=>Ge.fire(Je)),V=null},Ge=new R({onWillAddFirstListener(){ee||(ee=O(Je=>Ge.fire(Je)),F&&F.add(ee))},onDidAddFirstListener(){V&&(D?setTimeout(we):we())},onDidRemoveLastListener(){ee&&ee.dispose(),ee=null}});return F&&F.add(Ge),Ge.event}t.buffer=b;function S(O,D){return(F,V,ee)=>{const we=D(new U);return O(function(Ge){const Je=we.evaluate(Ge);Je!==$&&F.call(V,Je)},void 0,ee)}}t.chain=S;const $=Symbol("HaltChainable");class U{constructor(){this.f=[]}map(D){return this.f.push(D),this}forEach(D){return this.f.push(M=>(D(M),M)),this}filter(D){return this.f.push(M=>D(M)?M:$),this}reduce(D,M){let F=M;return this.f.push(V=>(F=D(F,V),F)),this}latch(D=(M,F)=>M===F){let M=!0,F;return this.f.push(V=>{const ee=M||!D(V,F);return M=!1,F=V,ee?V:$}),this}evaluate(D){for(const M of this.f)if(D=M(D),D===$)break;return D}}function q(O,D,M=F=>F){const F=(...Ge)=>we.fire(M(...Ge)),V=()=>O.on(D,F),ee=()=>O.removeListener(D,F),we=new R({onWillAddFirstListener:V,onDidRemoveLastListener:ee});return we.event}t.fromNodeEventEmitter=q;function me(O,D,M=F=>F){const F=(...Ge)=>we.fire(M(...Ge)),V=()=>O.addEventListener(D,F),ee=()=>O.removeEventListener(D,F),we=new R({onWillAddFirstListener:V,onDidRemoveLastListener:ee});return we.event}t.fromDOMEventEmitter=me;function N(O,D){let M;const F=new Promise((V,ee)=>{const we=i(O)(V,null,D);M=()=>we.dispose()});return F.cancel=M,F}t.toPromise=N;function E(O,D){return O(M=>D.fire(M))}t.forward=E;function P(O,D,M){return D(M),O(F=>D(F))}t.runAndSubscribe=P;class z{constructor(D,M){this._observable=D,this.f=0,this.g=!1;const F={onWillAddFirstListener:()=>{D.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{D.removeObserver(this)}};M||e(F),this.emitter=new R(F),M&&M.add(this.emitter)}beginUpdate(D){this.f++}handlePossibleChange(D){}handleChange(D,M){this.g=!0}endUpdate(D){this.f--,this.f===0&&(this._observable.reportChanges(),this.g&&(this.g=!1,this.emitter.fire(this._observable.get())))}}function B(O,D){return new z(O,D).emitter.event}t.fromObservable=B;function j(O){return(D,M,F)=>{let V=0,ee=!1;const we={beginUpdate(){V++},endUpdate(){V--,V===0&&(O.reportChanges(),ee&&(ee=!1,D.call(M)))},handlePossibleChange(){},handleChange(){ee=!0}};O.addObserver(we),O.reportChanges();const Ge={dispose(){O.removeObserver(we)}};return F instanceof De?F.add(Ge):Array.isArray(F)&&F.push(Ge),Ge}}t.fromObservableLight=j})(L||(L={}));var my=class sd{static{this.all=new Set}static{this.f=0}constructor(e){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${e}_${sd.f++}`,sd.all.add(this)}start(e){this.g=new cn,this.listenerCount=e}stop(){if(this.g){const e=this.g.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this.g=void 0}}},Jd=-1,wy=class Gw{static{this.f=1}constructor(e,s,i=(Gw.f++).toString(16).padStart(3,"0")){this.j=e,this.threshold=s,this.name=i,this.h=0}dispose(){this.g?.clear()}check(e,s){const i=this.threshold;if(i<=0||s<i)return;this.g||(this.g=new Map);const n=this.g.get(e.value)||0;if(this.g.set(e.value,n+1),this.h-=1,this.h<=0){this.h=i*.5;const[r,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${s} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(r);const c=new vy(a,r);this.j(c)}return()=>{const r=this.g.get(e.value)||0;this.g.set(e.value,r-1)}}getMostFrequentStack(){if(!this.g)return;let e,s=0;for(const[i,n]of this.g)(!e||s<n)&&(e=[i,n],s=n);return e}},Vc=class Jw{static create(){const e=new Error;return new Jw(e.stack??"")}constructor(e){this.value=e}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},vy=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},yy=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},by=0,vo=class{constructor(t){this.value=t,this.id=by++}},Sy=2,Ey=(t,e)=>{if(t instanceof vo)e(t);else for(let s=0;s<t.length;s++){const i=t[s];i&&e(i)}},R=class{constructor(t){this.A=0,this.g=t,this.j=Jd>0||this.g?.leakWarningThreshold?new wy(t?.onListenerError??it,this.g?.leakWarningThreshold??Jd):void 0,this.m=this.g?._profName?new my(this.g._profName):void 0,this.z=this.g?.deliveryQueue}dispose(){if(!this.q){if(this.q=!0,this.z?.current===this&&this.z.reset(),this.w){if(Gd){const t=this.w;queueMicrotask(()=>{Ey(t,e=>e.stack?.print())})}this.w=void 0,this.A=0}this.g?.onDidRemoveLastListener?.(),this.j?.dispose()}}get event(){return this.u??=(t,e,s)=>{if(this.j&&this.A>this.j.threshold**2){const a=`[${this.j.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this.A} vs ${this.j.threshold})`;console.warn(a);const c=this.j.getMostFrequentStack()??["UNKNOWN stack",-1],l=new yy(`${a}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this.g?.onListenerError||it)(l),T.None}if(this.q)return T.None;e&&(t=t.bind(e));const i=new vo(t);let n,r;this.j&&this.A>=Math.ceil(this.j.threshold*.2)&&(i.stack=Vc.create(),n=this.j.check(i.stack,this.A+1)),Gd&&(i.stack=r??Vc.create()),this.w?this.w instanceof vo?(this.z??=new $y,this.w=[this.w,i]):this.w.push(i):(this.g?.onWillAddFirstListener?.(this),this.w=i,this.g?.onDidAddFirstListener?.(this)),this.g?.onDidAddListener?.(this),this.A++;const o=de(()=>{n?.(),this.B(i)});return s instanceof De?s.add(o):Array.isArray(s)&&s.push(o),o},this.u}B(t){if(this.g?.onWillRemoveListener?.(this),!this.w)return;if(this.A===1){this.w=void 0,this.g?.onDidRemoveLastListener?.(this),this.A=0;return}const e=this.w,s=e.indexOf(t);if(s===-1)throw console.log("disposed?",this.q),console.log("size?",this.A),console.log("arr?",JSON.stringify(this.w)),new Error("Attempted to dispose unknown listener");this.A--,e[s]=void 0;const i=this.z.current===this;if(this.A*Sy<=e.length){let n=0;for(let r=0;r<e.length;r++)e[r]?e[n++]=e[r]:i&&n<this.z.end&&(this.z.end--,n<this.z.i&&this.z.i--);e.length=n}}C(t,e){if(!t)return;const s=this.g?.onListenerError||it;if(!s){t.value(e);return}try{t.value(e)}catch(i){s(i)}}D(t){const e=t.current.w;for(;t.i<t.end;)this.C(e[t.i++],t.value);t.reset()}fire(t){if(this.z?.current&&(this.D(this.z),this.m?.stop()),this.m?.start(this.A),this.w)if(this.w instanceof vo)this.C(this.w,t);else{const e=this.z;e.enqueue(this,t,this.w.length),this.D(e)}this.m?.stop()}hasListeners(){return this.A>0}},$y=class{constructor(){this.i=-1,this.end=0}enqueue(t,e,s){this.i=0,this.end=s,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},qc=class extends R{get isPaused(){return this.f!==0}constructor(t){super(t),this.f=0,this.h=new Hd,this.s=t?.merge}pause(){this.f++}resume(){if(this.f!==0&&--this.f===0)if(this.s){if(this.h.size>0){const t=Array.from(this.h);this.h.clear(),super.fire(this.s(t))}}else for(;!this.f&&this.h.size!==0;)super.fire(this.h.shift())}fire(t){this.A&&(this.f!==0?this.h.push(t):super.fire(t))}},xy=class{constructor(){this.g=!1,this.h=[],this.f=new R({onWillAddFirstListener:()=>this.j(),onDidRemoveLastListener:()=>this.k()})}get event(){return this.f.event}add(t){const e={event:t,listener:null};return this.h.push(e),this.g&&this.m(e),de(Fc(()=>{this.g&&this.o(e);const i=this.h.indexOf(e);this.h.splice(i,1)}))}j(){this.g=!0,this.h.forEach(t=>this.m(t))}k(){this.g=!1,this.h.forEach(t=>this.o(t))}m(t){t.listener=t.event(e=>this.f.fire(e))}o(t){t.listener?.dispose(),t.listener=null}dispose(){this.f.dispose();for(const t of this.h)t.listener?.dispose();this.h=[]}},Kd=class{constructor(){this.f=!1,this.g=L.None,this.h=T.None,this.j=new R({onDidAddFirstListener:()=>{this.f=!0,this.h=this.g(this.j.fire,this.j)},onDidRemoveLastListener:()=>{this.f=!1,this.h.dispose()}}),this.event=this.j.event}set input(t){this.g=t,this.f&&(this.h.dispose(),this.h=t(this.j.fire,this.j))}dispose(){this.h.dispose(),this.j.dispose()}},Qd=Object.freeze(function(t,e){const s=setTimeout(t.bind(e),0);return{dispose(){clearTimeout(s)}}}),Q;(function(t){function e(s){return s===t.None||s===t.Cancelled||s instanceof yo?!0:!s||typeof s!="object"?!1:typeof s.isCancellationRequested=="boolean"&&typeof s.onCancellationRequested=="function"}t.isCancellationToken=e,t.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:L.None}),t.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Qd})})(Q||(Q={}));var yo=class{constructor(){this.a=!1,this.b=null}cancel(){this.a||(this.a=!0,this.b&&(this.b.fire(void 0),this.dispose()))}get isCancellationRequested(){return this.a}get onCancellationRequested(){return this.a?Qd:(this.b||(this.b=new R),this.b.event)}dispose(){this.b&&(this.b.dispose(),this.b=null)}},Ss=class{constructor(t){this.f=void 0,this.g=void 0,this.g=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this.f||(this.f=new yo),this.f}cancel(){this.f?this.f instanceof yo&&this.f.cancel():this.f=Q.Cancelled}dispose(t=!1){t&&this.cancel(),this.g?.dispose(),this.f?this.f instanceof yo&&this.f.dispose():this.f=Q.None}};function ky(t){return t}var Py=class{constructor(t,e){this.a=void 0,this.b=void 0,typeof t=="function"?(this.c=t,this.d=ky):(this.c=e,this.d=t.getCacheKey)}get(t){const e=this.d(t);return this.b!==e&&(this.b=e,this.a=this.c(t)),this.a}},Xs;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Running=1]="Running",t[t.Completed=2]="Completed"})(Xs||(Xs={}));var xi=class{constructor(t){this.d=t,this.a=Xs.Uninitialized}get hasValue(){return this.a===Xs.Completed}get value(){if(this.a===Xs.Uninitialized){this.a=Xs.Running;try{this.b=this.d()}catch(t){this.c=t}finally{this.a=Xs.Completed}}else if(this.a===Xs.Running)throw new Error("Cannot read the value of a lazy that is being initialized");if(this.c)throw this.c;return this.b}get rawValue(){return this.b}};function Ry(t){return!t||typeof t!="string"?!0:t.trim().length===0}var Cy=/{([^}]+)}/g;function Zs(t,e){return Object.keys(e).length===0?t:t.replace(Cy,(s,i)=>e[i]??s)}function ki(t){return t.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function Dy(t,e=" "){const s=Xd(t,e);return bo(s,e)}function Xd(t,e){if(!t||!e)return t;const s=e.length;if(s===0||t.length===0)return t;let i=0;for(;t.indexOf(e,i)===i;)i=i+s;return t.substring(i)}function bo(t,e){if(!t||!e)return t;const s=e.length,i=t.length;if(s===0||i===0)return t;let n=i,r=-1;for(;r=t.lastIndexOf(e,n-1),!(r===-1||r+s!==n);){if(r===0)return"";n=r}return t.substring(0,n)}function So(t,e){return t<e?-1:t>e?1:0}function Wc(t,e,s=0,i=t.length,n=0,r=e.length){for(;s<i&&n<r;s++,n++){const c=t.charCodeAt(s),l=e.charCodeAt(n);if(c<l)return-1;if(c>l)return 1}const o=i-s,a=r-n;return o<a?-1:o>a?1:0}function Eo(t,e){return Yn(t,e,0,t.length,0,e.length)}function Yn(t,e,s=0,i=t.length,n=0,r=e.length){for(;s<i&&n<r;s++,n++){let c=t.charCodeAt(s),l=e.charCodeAt(n);if(c===l)continue;if(c>=128||l>=128)return Wc(t.toLowerCase(),e.toLowerCase(),s,i,n,r);Zd(c)&&(c-=32),Zd(l)&&(l-=32);const h=c-l;if(h!==0)return h}const o=i-s,a=r-n;return o<a?-1:o>a?1:0}function Zd(t){return t>=97&&t<=122}function Yd(t){return t>=65&&t<=90}function Pi(t,e){return t.length===e.length&&Yn(t,e)===0}function Hc(t,e){const s=e.length;return e.length>t.length?!1:Yn(t,e,0,s)===0}function Iy(t){return 55296<=t&&t<=56319}function e1(t){return 56320<=t&&t<=57343}function Oy(t,e){return(t-55296<<10)+(e-56320)+65536}var Ly=/(?:\x1b\[|\x9b)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/,Ay=/(?:\x1b\]|\x9d).*?(?:\x1b\\|\x07|\x9c)/,Ny=/\x1b(?:[ #%\(\)\*\+\-\.\/]?[a-zA-Z0-9\|}~@])/,uS=new RegExp("(?:"+[Ly.source,Ay.source,Ny.source].join("|")+")","g"),fS="\uFEFF";function Gc(t){return t.charAt(0).toUpperCase()+t.slice(1)}var t1;(function(t){t[t.Other=0]="Other",t[t.Prepend=1]="Prepend",t[t.CR=2]="CR",t[t.LF=3]="LF",t[t.Control=4]="Control",t[t.Extend=5]="Extend",t[t.Regional_Indicator=6]="Regional_Indicator",t[t.SpacingMark=7]="SpacingMark",t[t.L=8]="L",t[t.V=9]="V",t[t.T=10]="T",t[t.LV=11]="LV",t[t.LVT=12]="LVT",t[t.ZWJ=13]="ZWJ",t[t.Extended_Pictographic=14]="Extended_Pictographic"})(t1||(t1={}));var dS=class Zr{static{this.c=null}static getInstance(){return Zr.c||(Zr.c=new Zr),Zr.c}constructor(){this.d=jy()}getGraphemeBreakType(e){if(e<32)return e===10?3:e===13?2:4;if(e<127)return 0;const s=this.d,i=s.length/3;let n=1;for(;n<=i;)if(e<s[3*n])n=2*n;else if(e>s[3*n+1])n=2*n+1;else return s[3*n+2];return 0}};function jy(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}var s1;(function(t){t[t.zwj=8205]="zwj",t[t.emojiVariantSelector=65039]="emojiVariantSelector",t[t.enclosingKeyCap=8419]="enclosingKeyCap",t[t.space=32]="space"})(s1||(s1={}));var pS=class Yr{static{this.c=new xi(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,1523,96,8242,96,1370,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,118002,50,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,118003,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,118004,52,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,118005,53,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,118006,54,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,118007,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,118008,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,118009,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,117974,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,117975,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71913,67,71922,67,65315,67,8557,67,8450,67,8493,67,117976,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,117977,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,117978,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,117979,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,117980,71,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,117981,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,117983,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,117984,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,118001,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,117982,108,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,117985,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,117986,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,117987,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,118000,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,117988,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,117989,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,117990,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,117991,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,117992,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,117993,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,117994,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,117995,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71910,87,71919,87,117996,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,117997,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,117998,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,71909,90,66293,90,65338,90,8484,90,8488,90,117999,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65283,35,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"cs":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"es":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"fr":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"it":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ja":[8211,45,8218,44,65281,33,8216,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65292,44,65297,49,65307,59],"ko":[8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"pt-BR":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"ru":[65374,126,8218,44,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,8218,44,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41,65292,44,65297,49,65307,59,65311,63],"zh-hans":[160,32,65374,126,8218,44,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65297,49],"zh-hant":[8211,45,65374,126,8218,44,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89]}'))}static{this.d=new Py({getCacheKey:JSON.stringify},e=>{function s(h){const u=new Map;for(let f=0;f<h.length;f+=2)u.set(h[f],h[f+1]);return u}function i(h,u){const f=new Map(h);for(const[p,g]of u)f.set(p,g);return f}function n(h,u){if(!h)return u;const f=new Map;for(const[p,g]of h)u.has(p)&&f.set(p,g);return f}const r=this.c.value;let o=e.filter(h=>!h.startsWith("_")&&h in r);o.length===0&&(o=["_default"]);let a;for(const h of o){const u=s(r[h]);a=n(a,u)}const c=s(r._common),l=i(c,a);return new Yr(l)})}static getInstance(e){return Yr.d.get(Array.from(e))}static{this.e=new xi(()=>Object.keys(Yr.c.value).filter(e=>!e.startsWith("_")))}static getLocales(){return Yr.e.value}constructor(e){this.f=e}isAmbiguous(e){return this.f.has(e)}containsAmbiguousCharacter(e){for(let s=0;s<e.length;s++){const i=e.codePointAt(s);if(typeof i=="number"&&this.isAmbiguous(i))return!0}return!1}getPrimaryConfusable(e){return this.f.get(e)}getConfusableCodePoints(){return new Set(this.f.keys())}},gS=class eo{static c(){return JSON.parse('{"_common":[11,12,13,127,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999],"cs":[173,8203,12288],"de":[173,8203,12288],"es":[8203,12288],"fr":[173,8203,12288],"it":[160,173,12288],"ja":[173],"ko":[173,12288],"pl":[173,8203,12288],"pt-BR":[173,8203,12288],"qps-ploc":[160,173,8203,12288],"ru":[173,12288],"tr":[160,173,8203,12288],"zh-hans":[160,173,8203,12288],"zh-hant":[173,12288]}')}static{this.d=void 0}static e(){return this.d||(this.d=new Set([...Object.values(eo.c())].flat())),this.d}static isInvisibleCharacter(e){return eo.e().has(e)}static containsInvisibleCharacter(e){for(let s=0;s<e.length;s++){const i=e.codePointAt(s);if(typeof i=="number"&&(eo.isInvisibleCharacter(i)||i===32))return!0}return!1}static get codePoints(){return eo.e()}},Ri,Jc=globalThis.vscode;if(typeof Jc<"u"&&typeof Jc.process<"u"){const t=Jc.process;Ri={get platform(){return t.platform},get arch(){return t.arch},get env(){return t.env},cwd(){return t.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?Ri={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Ri={get platform(){return Ae?"win32":vs?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var $o=Ri.cwd,Ne=Ri.env,i1=Ri.platform,n1=Ri.arch,Ty=65,My=97,Fy=90,Uy=122,Ci=46,ht=47,Ft=92,Us=58,By=63,r1=class extends Error{constructor(t,e,s){let i;typeof e=="string"&&e.indexOf("not ")===0?(i="must not be",e=e.replace(/^not /,"")):i="must be";const n=t.indexOf(".")!==-1?"property":"argument";let r=`The "${t}" ${n} ${i} of type ${e}`;r+=`. Received type ${typeof s}`,super(r),this.code="ERR_INVALID_ARG_TYPE"}};function zy(t,e){if(t===null||typeof t!="object")throw new r1(e,"Object",t)}function qe(t,e){if(typeof t!="string")throw new r1(e,"string",t)}var Ut=i1==="win32";function re(t){return t===ht||t===Ft}function Kc(t){return t===ht}function Bs(t){return t>=Ty&&t<=Fy||t>=My&&t<=Uy}function xo(t,e,s,i){let n="",r=0,o=-1,a=0,c=0;for(let l=0;l<=t.length;++l){if(l<t.length)c=t.charCodeAt(l);else{if(i(c))break;c=ht}if(i(c)){if(!(o===l-1||a===1))if(a===2){if(n.length<2||r!==2||n.charCodeAt(n.length-1)!==Ci||n.charCodeAt(n.length-2)!==Ci){if(n.length>2){const h=n.lastIndexOf(s);h===-1?(n="",r=0):(n=n.slice(0,h),r=n.length-1-n.lastIndexOf(s)),o=l,a=0;continue}else if(n.length!==0){n="",r=0,o=l,a=0;continue}}e&&(n+=n.length>0?`${s}..`:"..",r=2)}else n.length>0?n+=`${s}${t.slice(o+1,l)}`:n=t.slice(o+1,l),r=l-o-1;o=l,a=0}else c===Ci&&a!==-1?++a:a=-1}return n}function _y(t){return t?`${t[0]==="."?"":"."}${t}`:""}function o1(t,e){zy(e,"pathObject");const s=e.dir||e.root,i=e.base||`${e.name||""}${_y(e.ext)}`;return s?s===e.root?`${s}${i}`:`${s}${t}${i}`:i}var Xe={resolve(...t){let e="",s="",i=!1;for(let n=t.length-1;n>=-1;n--){let r;if(n>=0){if(r=t[n],qe(r,`paths[${n}]`),r.length===0)continue}else e.length===0?r=$o():(r=Ne[`=${e}`]||$o(),(r===void 0||r.slice(0,2).toLowerCase()!==e.toLowerCase()&&r.charCodeAt(2)===Ft)&&(r=`${e}\\`));const o=r.length;let a=0,c="",l=!1;const h=r.charCodeAt(0);if(o===1)re(h)&&(a=1,l=!0);else if(re(h))if(l=!0,re(r.charCodeAt(1))){let u=2,f=u;for(;u<o&&!re(r.charCodeAt(u));)u++;if(u<o&&u!==f){const p=r.slice(f,u);for(f=u;u<o&&re(r.charCodeAt(u));)u++;if(u<o&&u!==f){for(f=u;u<o&&!re(r.charCodeAt(u));)u++;(u===o||u!==f)&&(c=`\\\\${p}\\${r.slice(f,u)}`,a=u)}}}else a=1;else Bs(h)&&r.charCodeAt(1)===Us&&(c=r.slice(0,2),a=2,o>2&&re(r.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(i){if(e.length>0)break}else if(s=`${r.slice(a)}\\${s}`,i=l,l&&e.length>0)break}return s=xo(s,!i,"\\",re),i?`${e}\\${s}`:`${e}${s}`||"."},normalize(t){qe(t,"path");const e=t.length;if(e===0)return".";let s=0,i,n=!1;const r=t.charCodeAt(0);if(e===1)return Kc(r)?"\\":t;if(re(r))if(n=!0,re(t.charCodeAt(1))){let a=2,c=a;for(;a<e&&!re(t.charCodeAt(a));)a++;if(a<e&&a!==c){const l=t.slice(c,a);for(c=a;a<e&&re(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!re(t.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${t.slice(c)}\\`;a!==c&&(i=`\\\\${l}\\${t.slice(c,a)}`,s=a)}}}else s=1;else Bs(r)&&t.charCodeAt(1)===Us&&(i=t.slice(0,2),s=2,e>2&&re(t.charCodeAt(2))&&(n=!0,s=3));let o=s<e?xo(t.slice(s),!n,"\\",re):"";if(o.length===0&&!n&&(o="."),o.length>0&&re(t.charCodeAt(e-1))&&(o+="\\"),!n&&i===void 0&&t.includes(":")){if(o.length>=2&&Bs(o.charCodeAt(0))&&o.charCodeAt(1)===Us)return`.\\${o}`;let a=t.indexOf(":");do if(a===e-1||re(t.charCodeAt(a+1)))return`.\\${o}`;while((a=t.indexOf(":",a+1))!==-1)}return i===void 0?n?`\\${o}`:o:n?`${i}\\${o}`:`${i}${o}`},isAbsolute(t){qe(t,"path");const e=t.length;if(e===0)return!1;const s=t.charCodeAt(0);return re(s)||e>2&&Bs(s)&&t.charCodeAt(1)===Us&&re(t.charCodeAt(2))},join(...t){if(t.length===0)return".";let e,s;for(let r=0;r<t.length;++r){const o=t[r];qe(o,"path"),o.length>0&&(e===void 0?e=s=o:e+=`\\${o}`)}if(e===void 0)return".";let i=!0,n=0;if(typeof s=="string"&&re(s.charCodeAt(0))){++n;const r=s.length;r>1&&re(s.charCodeAt(1))&&(++n,r>2&&(re(s.charCodeAt(2))?++n:i=!1))}if(i){for(;n<e.length&&re(e.charCodeAt(n));)n++;n>=2&&(e=`\\${e.slice(n)}`)}return Xe.normalize(e)},relative(t,e){if(qe(t,"from"),qe(e,"to"),t===e)return"";const s=Xe.resolve(t),i=Xe.resolve(e);if(s===i||(t=s.toLowerCase(),e=i.toLowerCase(),t===e))return"";if(s.length!==t.length||i.length!==e.length){const g=s.split("\\"),m=i.split("\\");g[g.length-1]===""&&g.pop(),m[m.length-1]===""&&m.pop();const w=g.length,b=m.length,S=w<b?w:b;let $;for($=0;$<S&&g[$].toLowerCase()===m[$].toLowerCase();$++);return $===0?i:$===S?b>S?m.slice($).join("\\"):w>S?"..\\".repeat(w-1-$)+"..":"":"..\\".repeat(w-$)+m.slice($).join("\\")}let n=0;for(;n<t.length&&t.charCodeAt(n)===Ft;)n++;let r=t.length;for(;r-1>n&&t.charCodeAt(r-1)===Ft;)r--;const o=r-n;let a=0;for(;a<e.length&&e.charCodeAt(a)===Ft;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===Ft;)c--;const l=c-a,h=o<l?o:l;let u=-1,f=0;for(;f<h;f++){const g=t.charCodeAt(n+f);if(g!==e.charCodeAt(a+f))break;g===Ft&&(u=f)}if(f!==h){if(u===-1)return i}else{if(l>h){if(e.charCodeAt(a+f)===Ft)return i.slice(a+f+1);if(f===2)return i.slice(a+f)}o>h&&(t.charCodeAt(n+f)===Ft?u=f:f===2&&(u=3)),u===-1&&(u=0)}let p="";for(f=n+u+1;f<=r;++f)(f===r||t.charCodeAt(f)===Ft)&&(p+=p.length===0?"..":"\\..");return a+=u,p.length>0?`${p}${i.slice(a,c)}`:(i.charCodeAt(a)===Ft&&++a,i.slice(a,c))},toNamespacedPath(t){if(typeof t!="string"||t.length===0)return t;const e=Xe.resolve(t);if(e.length<=2)return t;if(e.charCodeAt(0)===Ft){if(e.charCodeAt(1)===Ft){const s=e.charCodeAt(2);if(s!==By&&s!==Ci)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Bs(e.charCodeAt(0))&&e.charCodeAt(1)===Us&&e.charCodeAt(2)===Ft)return`\\\\?\\${e}`;return e},dirname(t){qe(t,"path");const e=t.length;if(e===0)return".";let s=-1,i=0;const n=t.charCodeAt(0);if(e===1)return re(n)?t:".";if(re(n)){if(s=i=1,re(t.charCodeAt(1))){let a=2,c=a;for(;a<e&&!re(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&re(t.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!re(t.charCodeAt(a));)a++;if(a===e)return t;a!==c&&(s=i=a+1)}}}}else Bs(n)&&t.charCodeAt(1)===Us&&(s=e>2&&re(t.charCodeAt(2))?3:2,i=s);let r=-1,o=!0;for(let a=e-1;a>=i;--a)if(re(t.charCodeAt(a))){if(!o){r=a;break}}else o=!1;if(r===-1){if(s===-1)return".";r=s}return t.slice(0,r)},basename(t,e){e!==void 0&&qe(e,"suffix"),qe(t,"path");let s=0,i=-1,n=!0,r;if(t.length>=2&&Bs(t.charCodeAt(0))&&t.charCodeAt(1)===Us&&(s=2),e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=s;--r){const c=t.charCodeAt(r);if(re(c)){if(!n){s=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(c===e.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return s===i?i=a:i===-1&&(i=t.length),t.slice(s,i)}for(r=t.length-1;r>=s;--r)if(re(t.charCodeAt(r))){if(!n){s=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":t.slice(s,i)},extname(t){qe(t,"path");let e=0,s=-1,i=0,n=-1,r=!0,o=0;t.length>=2&&t.charCodeAt(1)===Us&&Bs(t.charCodeAt(0))&&(e=i=2);for(let a=t.length-1;a>=e;--a){const c=t.charCodeAt(a);if(re(c)){if(!r){i=a+1;break}continue}n===-1&&(r=!1,n=a+1),c===Ci?s===-1?s=a:o!==1&&(o=1):s!==-1&&(o=-1)}return s===-1||n===-1||o===0||o===1&&s===n-1&&s===i+1?"":t.slice(s,n)},format:o1.bind(null,"\\"),parse(t){qe(t,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const s=t.length;let i=0,n=t.charCodeAt(0);if(s===1)return re(n)?(e.root=e.dir=t,e):(e.base=e.name=t,e);if(re(n)){if(i=1,re(t.charCodeAt(1))){let u=2,f=u;for(;u<s&&!re(t.charCodeAt(u));)u++;if(u<s&&u!==f){for(f=u;u<s&&re(t.charCodeAt(u));)u++;if(u<s&&u!==f){for(f=u;u<s&&!re(t.charCodeAt(u));)u++;u===s?i=u:u!==f&&(i=u+1)}}}}else if(Bs(n)&&t.charCodeAt(1)===Us){if(s<=2)return e.root=e.dir=t,e;if(i=2,re(t.charCodeAt(2))){if(s===3)return e.root=e.dir=t,e;i=3}}i>0&&(e.root=t.slice(0,i));let r=-1,o=i,a=-1,c=!0,l=t.length-1,h=0;for(;l>=i;--l){if(n=t.charCodeAt(l),re(n)){if(!c){o=l+1;break}continue}a===-1&&(c=!1,a=l+1),n===Ci?r===-1?r=l:h!==1&&(h=1):r!==-1&&(h=-1)}return a!==-1&&(r===-1||h===0||h===1&&r===a-1&&r===o+1?e.base=e.name=t.slice(o,a):(e.name=t.slice(o,r),e.base=t.slice(o,a),e.ext=t.slice(r,a))),o>0&&o!==i?e.dir=t.slice(0,o-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Vy=(()=>{if(Ut){const t=/\\/g;return()=>{const e=$o().replace(t,"/");return e.slice(e.indexOf("/"))}}return()=>$o()})(),ye={resolve(...t){let e="",s=!1;for(let i=t.length-1;i>=0&&!s;i--){const n=t[i];qe(n,`paths[${i}]`),n.length!==0&&(e=`${n}/${e}`,s=n.charCodeAt(0)===ht)}if(!s){const i=Vy();e=`${i}/${e}`,s=i.charCodeAt(0)===ht}return e=xo(e,!s,"/",Kc),s?`/${e}`:e.length>0?e:"."},normalize(t){if(qe(t,"path"),t.length===0)return".";const e=t.charCodeAt(0)===ht,s=t.charCodeAt(t.length-1)===ht;return t=xo(t,!e,"/",Kc),t.length===0?e?"/":s?"./":".":(s&&(t+="/"),e?`/${t}`:t)},isAbsolute(t){return qe(t,"path"),t.length>0&&t.charCodeAt(0)===ht},join(...t){if(t.length===0)return".";const e=[];for(let s=0;s<t.length;++s){const i=t[s];qe(i,"path"),i.length>0&&e.push(i)}return e.length===0?".":ye.normalize(e.join("/"))},relative(t,e){if(qe(t,"from"),qe(e,"to"),t===e||(t=ye.resolve(t),e=ye.resolve(e),t===e))return"";const s=1,i=t.length,n=i-s,r=1,o=e.length-r,a=n<o?n:o;let c=-1,l=0;for(;l<a;l++){const u=t.charCodeAt(s+l);if(u!==e.charCodeAt(r+l))break;u===ht&&(c=l)}if(l===a)if(o>a){if(e.charCodeAt(r+l)===ht)return e.slice(r+l+1);if(l===0)return e.slice(r+l)}else n>a&&(t.charCodeAt(s+l)===ht?c=l:l===0&&(c=0));let h="";for(l=s+c+1;l<=i;++l)(l===i||t.charCodeAt(l)===ht)&&(h+=h.length===0?"..":"/..");return`${h}${e.slice(r+c)}`},toNamespacedPath(t){return t},dirname(t){if(qe(t,"path"),t.length===0)return".";const e=t.charCodeAt(0)===ht;let s=-1,i=!0;for(let n=t.length-1;n>=1;--n)if(t.charCodeAt(n)===ht){if(!i){s=n;break}}else i=!1;return s===-1?e?"/":".":e&&s===1?"//":t.slice(0,s)},basename(t,e){e!==void 0&&qe(e,"suffix"),qe(t,"path");let s=0,i=-1,n=!0,r;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const c=t.charCodeAt(r);if(c===ht){if(!n){s=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(c===e.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return s===i?i=a:i===-1&&(i=t.length),t.slice(s,i)}for(r=t.length-1;r>=0;--r)if(t.charCodeAt(r)===ht){if(!n){s=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":t.slice(s,i)},extname(t){qe(t,"path");let e=-1,s=0,i=-1,n=!0,r=0;for(let o=t.length-1;o>=0;--o){const a=t[o];if(a==="/"){if(!n){s=o+1;break}continue}i===-1&&(n=!1,i=o+1),a==="."?e===-1?e=o:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||i===-1||r===0||r===1&&e===i-1&&e===s+1?"":t.slice(e,i)},format:o1.bind(null,"/"),parse(t){qe(t,"path");const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const s=t.charCodeAt(0)===ht;let i;s?(e.root="/",i=1):i=0;let n=-1,r=0,o=-1,a=!0,c=t.length-1,l=0;for(;c>=i;--c){const h=t.charCodeAt(c);if(h===ht){if(!a){r=c+1;break}continue}o===-1&&(a=!1,o=c+1),h===Ci?n===-1?n=c:l!==1&&(l=1):n!==-1&&(l=-1)}if(o!==-1){const h=r===0&&s?1:r;n===-1||l===0||l===1&&n===o-1&&n===r+1?e.base=e.name=t.slice(h,o):(e.name=t.slice(h,n),e.base=t.slice(h,o),e.ext=t.slice(n,o))}return r>0?e.dir=t.slice(0,r-1):s&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};ye.win32=Xe.win32=Xe,ye.posix=Xe.posix=ye;var Ys=Ut?Xe.normalize:ye.normalize,a1=Ut?Xe.isAbsolute:ye.isAbsolute,J=Ut?Xe.join:ye.join,Di=Ut?Xe.resolve:ye.resolve,c1=Ut?Xe.relative:ye.relative,Zt=Ut?Xe.dirname:ye.dirname,Ct=Ut?Xe.basename:ye.basename,qy=Ut?Xe.extname:ye.extname,mS=Ut?Xe.format:ye.format,wS=Ut?Xe.parse:ye.parse,vS=Ut?Xe.toNamespacedPath:ye.toNamespacedPath,Dt=Ut?Xe.sep:ye.sep,yS=Ut?Xe.delimiter:ye.delimiter,Wy=/^\w[\w\d+.-]*$/,Hy=/^\//,Gy=/^\/\//;function Jy(t,e){if(!t.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${t.authority}", path: "${t.path}", query: "${t.query}", fragment: "${t.fragment}"}`);if(t.scheme&&!Wy.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path){if(t.authority){if(!Hy.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(Gy.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function Ky(t,e){return!t&&!e?"file":t}function Qy(t,e){switch(t){case"https":case"http":case"file":e?e[0]!==us&&(e=us+e):e=us;break}return e}var Le="",us="/",Xy=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,k=class vc{static isUri(e){return e instanceof vc?!0:!e||typeof e!="object"?!1:typeof e.authority=="string"&&typeof e.fragment=="string"&&typeof e.path=="string"&&typeof e.query=="string"&&typeof e.scheme=="string"&&typeof e.fsPath=="string"&&typeof e.with=="function"&&typeof e.toString=="function"}constructor(e,s,i,n,r,o=!1){typeof e=="object"?(this.scheme=e.scheme||Le,this.authority=e.authority||Le,this.path=e.path||Le,this.query=e.query||Le,this.fragment=e.fragment||Le):(this.scheme=Ky(e,o),this.authority=s||Le,this.path=Qy(this.scheme,i||Le),this.query=n||Le,this.fragment=r||Le,Jy(this,o))}get fsPath(){return ko(this,!1)}with(e){if(!e)return this;let{scheme:s,authority:i,path:n,query:r,fragment:o}=e;return s===void 0?s=this.scheme:s===null&&(s=Le),i===void 0?i=this.authority:i===null&&(i=Le),n===void 0?n=this.path:n===null&&(n=Le),r===void 0?r=this.query:r===null&&(r=Le),o===void 0?o=this.fragment:o===null&&(o=Le),s===this.scheme&&i===this.authority&&n===this.path&&r===this.query&&o===this.fragment?this:new ln(s,i,n,r,o)}static parse(e,s=!1){const i=Xy.exec(e);return i?new ln(i[2]||Le,Po(i[4]||Le),Po(i[5]||Le),Po(i[7]||Le),Po(i[9]||Le),s):new ln(Le,Le,Le,Le,Le)}static file(e){let s=Le;if(Ae&&(e=e.replace(/\\/g,us)),e[0]===us&&e[1]===us){const i=e.indexOf(us,2);i===-1?(s=e.substring(2),e=us):(s=e.substring(2,i),e=e.substring(i)||us)}return new ln("file",s,e,Le,Le)}static from(e,s){return new ln(e.scheme,e.authority,e.path,e.query,e.fragment,s)}static joinPath(e,...s){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let i;return Ae&&e.scheme==="file"?i=vc.file(Xe.join(ko(e,!0),...s)).path:i=ye.join(e.path,...s),e.with({path:i})}toString(e=!1){return Qc(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof vc)return e;{const s=new ln(e);return s._formatted=e.external??null,s._fsPath=e._sep===l1?e.fsPath??null:null,s}}else return e}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}},l1=Ae?1:void 0,ln=class extends k{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=ko(this,!1)),this._fsPath}toString(t=!1){return t?Qc(this,!0):(this._formatted||(this._formatted=Qc(this,!1)),this._formatted)}toJSON(){const t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=l1),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}},h1={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function u1(t,e,s){let i,n=-1;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);if(o>=97&&o<=122||o>=65&&o<=90||o>=48&&o<=57||o===45||o===46||o===95||o===126||e&&o===47||s&&o===91||s&&o===93||s&&o===58)n!==-1&&(i+=encodeURIComponent(t.substring(n,r)),n=-1),i!==void 0&&(i+=t.charAt(r));else{i===void 0&&(i=t.substr(0,r));const a=h1[o];a!==void 0?(n!==-1&&(i+=encodeURIComponent(t.substring(n,r)),n=-1),i+=a):n===-1&&(n=r)}}return n!==-1&&(i+=encodeURIComponent(t.substring(n))),i!==void 0?i:t}function Zy(t){let e;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);i===35||i===63?(e===void 0&&(e=t.substr(0,s)),e+=h1[i]):e!==void 0&&(e+=t[s])}return e!==void 0?e:t}function ko(t,e){let s;return t.authority&&t.path.length>1&&t.scheme==="file"?s=`//${t.authority}${t.path}`:t.path.charCodeAt(0)===47&&(t.path.charCodeAt(1)>=65&&t.path.charCodeAt(1)<=90||t.path.charCodeAt(1)>=97&&t.path.charCodeAt(1)<=122)&&t.path.charCodeAt(2)===58?e?s=t.path.substr(1):s=t.path[1].toLowerCase()+t.path.substr(2):s=t.path,Ae&&(s=s.replace(/\//g,"\\")),s}function Qc(t,e){const s=e?Zy:u1;let i="",{scheme:n,authority:r,path:o,query:a,fragment:c}=t;if(n&&(i+=n,i+=":"),(r||n==="file")&&(i+=us,i+=us),r){let l=r.indexOf("@");if(l!==-1){const h=r.substr(0,l);r=r.substr(l+1),l=h.lastIndexOf(":"),l===-1?i+=s(h,!1,!1):(i+=s(h.substr(0,l),!1,!1),i+=":",i+=s(h.substr(l+1),!1,!0)),i+="@"}r=r.toLowerCase(),l=r.lastIndexOf(":"),l===-1?i+=s(r,!1,!0):(i+=s(r.substr(0,l),!1,!0),i+=r.substr(l))}if(o){if(o.length>=3&&o.charCodeAt(0)===47&&o.charCodeAt(2)===58){const l=o.charCodeAt(1);l>=65&&l<=90&&(o=`/${String.fromCharCode(l+32)}:${o.substr(3)}`)}else if(o.length>=2&&o.charCodeAt(1)===58){const l=o.charCodeAt(0);l>=65&&l<=90&&(o=`${String.fromCharCode(l+32)}:${o.substr(2)}`)}i+=s(o,!0,!1)}return a&&(i+="?",i+=s(a,!1,!1)),c&&(i+="#",i+=e?c:u1(c,!1,!1)),i}function f1(t){try{return decodeURIComponent(t)}catch{return t.length>3?t.substr(0,3)+f1(t.substr(3)):t}}var d1=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Po(t){return t.match(d1)?t.replace(d1,e=>f1(e)):t}var oe;(function(t){t.inMemory="inmemory",t.vscode="vscode",t.internal="private",t.walkThrough="walkThrough",t.walkThroughSnippet="walkThroughSnippet",t.http="http",t.https="https",t.file="file",t.mailto="mailto",t.untitled="untitled",t.data="data",t.command="command",t.vscodeRemote="vscode-remote",t.vscodeRemoteResource="vscode-remote-resource",t.vscodeManagedRemoteResource="vscode-managed-remote-resource",t.vscodeUserData="vscode-userdata",t.vscodeCustomEditor="vscode-custom-editor",t.vscodeNotebookCell="vscode-notebook-cell",t.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",t.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",t.vscodeNotebookCellOutput="vscode-notebook-cell-output",t.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",t.vscodeNotebookMetadata="vscode-notebook-metadata",t.vscodeInteractiveInput="vscode-interactive-input",t.vscodeSettings="vscode-settings",t.vscodeWorkspaceTrust="vscode-workspace-trust",t.vscodeTerminal="vscode-terminal",t.vscodeChatCodeBlock="vscode-chat-code-block",t.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",t.vscodeChatEditor="vscode-chat-editor",t.vscodeChatInput="chatSessionInput",t.vscodeChatSession="vscode-chat-session",t.webviewPanel="webview-panel",t.vscodeWebview="vscode-webview",t.extension="extension",t.vscodeFileResource="vscode-file",t.tmp="tmp",t.vsls="vsls",t.vscodeSourceControl="vscode-scm",t.commentsInput="comment",t.codeSetting="code-setting",t.outputChannel="output",t.accessibleView="accessible-view",t.chatEditingSnapshotScheme="chat-editing-snapshot-text-model",t.chatEditingModel="chat-editing-text-model"})(oe||(oe={}));var Yy="tkn",e4=class{constructor(){this.a=Object.create(null),this.b=Object.create(null),this.c=Object.create(null),this.d="http",this.e=null,this.f="/"}setPreferredWebSchema(t){this.d=t}setDelegate(t){this.e=t}setServerRootPath(t,e){this.f=ye.join(e??"/",t4(t))}getServerRootPath(){return this.f}get g(){return ye.join(this.f,oe.vscodeRemoteResource)}set(t,e,s){this.a[t]=e,this.b[t]=s}setConnectionToken(t,e){this.c[t]=e}getPreferredWebSchema(){return this.d}rewrite(t){if(this.e)try{return this.e(t)}catch(o){return it(o),t}const e=t.authority;let s=this.a[e];s&&s.indexOf(":")!==-1&&s.indexOf("[")===-1&&(s=`[${s}]`);const i=this.b[e],n=this.c[e];let r=`path=${encodeURIComponent(t.path)}`;return typeof n=="string"&&(r+=`&${Yy}=${encodeURIComponent(n)}`),k.from({scheme:ot?this.d:oe.vscodeRemoteResource,authority:`${s}:${i}`,path:this.g,query:r})}},p1=new e4;function t4(t){return`${t.quality??"oss"}-${t.commit??"dev"}`}var s4="vs/../../node_modules",i4="vs/../../node_modules.asar",g1="vscode-app",n4=class yc{static{this.a=g1}asBrowserUri(e){const s=this.b(e);return this.uriToBrowserUri(s)}uriToBrowserUri(e){return e.scheme===oe.vscodeRemote?p1.rewrite(e):e.scheme===oe.file&&(cy||hy===`${oe.vscodeFileResource}://${yc.a}`)?e.with({scheme:oe.vscodeFileResource,authority:e.authority||yc.a,query:null,fragment:null}):e}asFileUri(e){const s=this.b(e);return this.uriToFileUri(s)}uriToFileUri(e){return e.scheme===oe.vscodeFileResource?e.with({scheme:oe.file,authority:e.authority!==yc.a?e.authority:null,query:null,fragment:null}):e}b(e){if(k.isUri(e))return e;if(globalThis._VSCODE_FILE_ROOT){const s=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(s))return k.joinPath(k.parse(s,!0),e);const i=J(s,e);return k.file(i)}throw new Error("Cannot determine URI for module id!")}},ei=new n4,bS=Object.freeze({"Cache-Control":"no-cache, no-store"}),SS=Object.freeze({"Document-Policy":"include-js-call-stacks-in-crash-reports"}),m1;(function(t){const e=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);t.CoopAndCoep=Object.freeze(e.get("3"));const s="vscode-coi";function i(r){let o;typeof r=="string"?o=new URL(r).searchParams:r instanceof URL?o=r.searchParams:k.isUri(r)&&(o=new URL(r.toString(!0)).searchParams);const a=o?.get(s);if(a)return e.get(a)}t.getHeadersFromQuery=i;function n(r,o,a){if(!globalThis.crossOriginIsolated)return;const c=o&&a?"3":a?"2":"1";r instanceof URLSearchParams?r.set(s,c):r[s]=c}t.addSearchParam=n})(m1||(m1={}));function ti(t){return t===47||t===92}function w1(t){return t.replace(/[\\/]/g,ye.sep)}function r4(t){return t.indexOf("/")===-1&&(t=w1(t)),/^[a-zA-Z]:(\/|$)/.test(t)&&(t="/"+t),t}function v1(t,e=ye.sep){if(!t)return"";const s=t.length,i=t.charCodeAt(0);if(ti(i)){if(ti(t.charCodeAt(1))&&!ti(t.charCodeAt(2))){let r=3;const o=r;for(;r<s&&!ti(t.charCodeAt(r));r++);if(o!==r&&!ti(t.charCodeAt(r+1))){for(r+=1;r<s;r++)if(ti(t.charCodeAt(r)))return t.slice(0,r+1).replace(/[\\/]/g,e)}}return e}else if(y1(i)&&t.charCodeAt(1)===58)return ti(t.charCodeAt(2))?t.slice(0,2)+e:t.slice(0,2);let n=t.indexOf("://");if(n!==-1){for(n+=3;n<s;n++)if(ti(t.charCodeAt(n)))return t.slice(0,n+1)}return""}function Ro(t,e,s){const i=t===e;return!s||i?i:!t||!e?!1:Pi(t,e)}function er(t,e,s,i=Dt){if(t===e)return!0;if(!t||!e||e.length>t.length)return!1;if(s){if(!Hc(t,e))return!1;if(e.length===t.length)return!0;let r=e.length;return e.charAt(e.length-1)===i&&r--,t.charAt(r)===i}return e.charAt(e.length-1)!==i&&(e+=i),t.indexOf(e)===0}function y1(t){return t>=65&&t<=90||t>=97&&t<=122}function o4(t){return Ae?(t=bo(t,Dt),t.endsWith(":")&&(t+=Dt)):(t=bo(t,Dt),t||(t=Dt)),t}function b1(t){const e=Ys(t);return Ae?t.length>3?!1:a4(e)&&(t.length===2||e.charCodeAt(2)===92):e===ye.sep}function a4(t,e=Ae){return e?y1(t.charCodeAt(0))&&t.charCodeAt(1)===58:!1}var c4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l4="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function h4(t,e,s=8){let i="";for(let r=0;r<s;r++){let o;r===0&&Ae&&!e&&(s===3||s===4)?o=l4:o=c4,i+=o.charAt(Math.floor(Math.random()*o.length))}let n;return e?n=`${e}-${i}`:n=i,t?J(t,n):n}function zs(t){return ko(t,!0)}var Co=class{constructor(t){this.a=t}compare(t,e,s=!1){return t===e?0:So(this.getComparisonKey(t,s),this.getComparisonKey(e,s))}isEqual(t,e,s=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,s)===this.getComparisonKey(e,s)}getComparisonKey(t,e=!1){return t.with({path:this.a(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this.a(t)}isEqualOrParent(t,e,s=!1){if(t.scheme===e.scheme){if(t.scheme===oe.file)return er(zs(t),zs(e),this.a(t))&&t.query===e.query&&(s||t.fragment===e.fragment);if($1(t.authority,e.authority))return er(t.path,e.path,this.a(t),"/")&&t.query===e.query&&(s||t.fragment===e.fragment)}return!1}joinPath(t,...e){return k.joinPath(t,...e)}basenameOrAuthority(t){return tr(t)||t.authority}basename(t){return ye.basename(t.path)}extname(t){return ye.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===oe.file?e=k.file(Zt(zs(t))).path:(e=ye.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==47&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===oe.file?e=k.file(Ys(zs(t))).path:e=ye.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!$1(t.authority,e.authority))return;if(t.scheme===oe.file){const n=c1(zs(t),zs(e));return Ae?w1(n):n}let s=t.path||"/";const i=e.path||"/";if(this.a(t)){let n=0;for(const r=Math.min(s.length,i.length);n<r&&!(s.charCodeAt(n)!==i.charCodeAt(n)&&s.charAt(n).toLowerCase()!==i.charAt(n).toLowerCase());n++);s=i.substr(0,n)+s.substr(n)}return ye.relative(s,i)}resolvePath(t,e){if(t.scheme===oe.file){const s=k.file(Di(zs(t),e));return t.with({authority:s.authority,path:s.path})}return e=r4(e),t.with({path:ye.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&Pi(t,e)}hasTrailingPathSeparator(t,e=Dt){if(t.scheme===oe.file){const s=zs(t);return s.length>v1(s).length&&s[s.length-1]===e}else{const s=t.path;return s.length>1&&s.charCodeAt(s.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=Dt){return x1(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=Dt){let s=!1;if(t.scheme===oe.file){const i=zs(t);s=i!==void 0&&i.length===v1(i).length&&i[i.length-1]===e}else{e="/";const i=t.path;s=i.length===1&&i.charCodeAt(i.length-1)===47}return!s&&!x1(t,e)?t.with({path:t.path+"/"}):t}},ve=new Co(()=>!1),Xc=new Co(t=>t.scheme===oe.file?!wt:!0),u4=new Co(t=>!0),_s=ve.isEqual.bind(ve),S1=ve.isEqualOrParent.bind(ve),ES=ve.getComparisonKey.bind(ve),$S=ve.basenameOrAuthority.bind(ve),tr=ve.basename.bind(ve),xS=ve.extname.bind(ve),E1=ve.dirname.bind(ve),_=ve.joinPath.bind(ve),f4=ve.normalizePath.bind(ve),d4=ve.relativePath.bind(ve),kS=ve.resolvePath.bind(ve),p4=ve.isAbsolutePath.bind(ve),$1=ve.isEqualAuthority.bind(ve),x1=ve.hasTrailingPathSeparator.bind(ve),PS=ve.removeTrailingPathSeparator.bind(ve),RS=ve.addTrailingPathSeparator.bind(ve),k1;(function(t){t.META_DATA_LABEL="label",t.META_DATA_DESCRIPTION="description",t.META_DATA_SIZE="size",t.META_DATA_MIME="mime";function e(s){const i=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(o=>{const[a,c]=o.split(":");a&&c&&i.set(a,c)});const r=s.path.substring(0,s.path.indexOf(";"));return r&&i.set(t.META_DATA_MIME,r),i}t.parseMetaData=e})(k1||(k1={}));var g4=Symbol("MicrotaskDelay");function Zc(t){return!!t&&typeof t.then=="function"}function vt(t){const e=new Ss,s=t(e.token);let i=!1;const n=new Promise((r,o)=>{const a=e.token.onCancellationRequested(()=>{i=!0,a.dispose(),o(new Ve)});Promise.resolve(s).then(c=>{a.dispose(),e.dispose(),i?Uc(c)&&c.dispose():r(c)},c=>{a.dispose(),e.dispose(),o(c)})});return new class{cancel(){e.cancel(),e.dispose()}then(r,o){return n.then(r,o)}catch(r){return this.then(void 0,r)}finally(r){return n.finally(r)}}}function m4(){let t,e;return{promise:new Promise((i,n)=>{t=i,e=n}),resolve:t,reject:e}}var w4=class{constructor(){this.f=!1,this.a=null,this.b=null,this.d=null}queue(t){if(this.f)return Promise.reject(new Error("Throttler is disposed"));if(this.a){if(this.d=t,!this.b){const e=()=>{if(this.b=null,this.f)return;const s=this.queue(this.d);return this.d=null,s};this.b=new Promise(s=>{this.a.then(e,e).then(s)})}return new Promise((e,s)=>{this.b.then(e,s)})}return this.a=t(),new Promise((e,s)=>{this.a.then(i=>{this.a=null,e(i)},i=>{this.a=null,s(i)})})}dispose(){this.f=!0}},v4=class{constructor(){this.a=Promise.resolve(null)}queue(t){return this.a=this.a.then(()=>t(),()=>t())}},y4=(t,e)=>{let s=!0;const i=setTimeout(()=>{s=!1,e()},t);return{isTriggered:()=>s,dispose:()=>{clearTimeout(i),s=!1}}},b4=t=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,t())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},Yc=class{constructor(t){this.defaultDelay=t,this.a=null,this.b=null,this.d=null,this.f=null,this.g=null}trigger(t,e=this.defaultDelay){this.g=t,this.h(),this.b||(this.b=new Promise((i,n)=>{this.d=i,this.f=n}).then(()=>{if(this.b=null,this.d=null,this.g){const i=this.g;return this.g=null,i()}}));const s=()=>{this.a=null,this.d?.(null)};return this.a=e===g4?b4(s):y4(e,s),this.b}isTriggered(){return!!this.a?.isTriggered()}cancel(){this.h(),this.b&&(this.f?.(new Ve),this.b=null)}h(){this.a?.dispose(),this.a=null}dispose(){this.cancel()}},Ii=class{constructor(t){this.a=new Yc(t),this.b=new w4}trigger(t,e){return this.a.trigger(()=>this.b.queue(t),e)}isTriggered(){return this.a.isTriggered()}cancel(){this.a.cancel()}dispose(){this.a.dispose(),this.b.dispose()}},sr=class{constructor(){this.a=!1,this.b=new Promise((t,e)=>{this.d=t})}isOpen(){return this.a}open(){this.a=!0,this.d(!0)}wait(){return this.b}};function Oi(t,e){return e?new Promise((s,i)=>{const n=setTimeout(()=>{r.dispose(),s()},t),r=e.onCancellationRequested(()=>{clearTimeout(n),r.dispose(),i(new Ve)})}):vt(s=>Oi(t,s))}function hn(t,e=0,s){const i=setTimeout(()=>{t(),s&&n.dispose()},e),n=de(()=>{clearTimeout(i),s?.delete(n)});return s?.add(n),n}var P1=class{constructor(t){this.a=0,this.b=!1,this.f=t,this.g=[],this.d=0,this.h=new R}whenIdle(){return this.size>0?L.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this.h.event}get size(){return this.a}queue(t){if(this.b)throw new Error("Object has been disposed");return this.a++,new Promise((e,s)=>{this.g.push({factory:t,c:e,e:s}),this.j()})}j(){for(;this.g.length&&this.d<this.f;){const t=this.g.shift();this.d++;const e=t.factory();e.then(t.c,t.e),e.then(()=>this.k(),()=>this.k())}}k(){this.b||(this.d--,--this.a===0&&this.h.fire(),this.g.length>0&&this.j())}clear(){if(this.b)throw new Error("Object has been disposed");this.g.length=0,this.a=this.d}dispose(){this.b=!0,this.g.length=0,this.a=0,this.h.dispose()}},un=class extends P1{constructor(){super(1)}},R1=class{constructor(){this.a=new Map,this.b=new Set,this.d=void 0,this.f=0}async whenDrained(){if(this.g())return;const t=new ir;return this.b.add(t),t.p}g(){for(const[,t]of this.a)if(t.size>0)return!1;return!0}queueSize(t,e=ve){const s=e.getComparisonKey(t);return this.a.get(s)?.size??0}queueFor(t,e,s=ve){const i=s.getComparisonKey(t);let n=this.a.get(i);if(!n){n=new un;const r=this.f++,o=L.once(n.onDrained)(()=>{n?.dispose(),this.a.delete(i),this.h(),this.d?.deleteAndDispose(r),this.d?.size===0&&(this.d.dispose(),this.d=void 0)});this.d||(this.d=new po),this.d.set(r,o),this.a.set(i,n)}return n.queue(e)}h(){this.g()&&this.j()}j(){for(const t of this.b)t.complete();this.b.clear()}dispose(){for(const[,t]of this.a)t.dispose();this.a.clear(),this.j(),this.d?.dispose()}},fs=class{constructor(t,e){this.b=void 0,this.a=t,this.d=e,this.f=this.g.bind(this)}dispose(){this.cancel(),this.a=null}cancel(){this.isScheduled()&&(clearTimeout(this.b),this.b=void 0)}schedule(t=this.d){this.cancel(),this.b=setTimeout(this.f,t)}get delay(){return this.d}set delay(t){this.d=t}isScheduled(){return this.b!==void 0}flush(){this.isScheduled()&&(this.cancel(),this.h())}g(){this.b=void 0,this.a&&this.h()}h(){this.a?.()}},S4=class extends fs{constructor(t,e){super(t,e),this.j=[]}work(t){this.j.push(t),this.isScheduled()||this.schedule()}h(){const t=this.j;this.j=[],this.a?.(t)}dispose(){this.j=[],super.dispose()}},C1=class extends T{constructor(t,e){super(),this.h=t,this.j=e,this.a=[],this.b=this.B(new hs),this.f=!1,this.g=0}get pending(){return this.a.length}work(t){if(this.f)return!1;if(typeof this.h.maxBufferedWork=="number"){if(this.b.value){if(this.pending+t.length>this.h.maxBufferedWork)return!1}else if(this.pending+t.length-this.h.maxWorkChunkSize>this.h.maxBufferedWork)return!1}for(const s of t)this.a.push(s);const e=Date.now()-this.g;return!this.b.value&&(!this.h.waitThrottleDelayBetweenWorkUnits||e>=this.h.throttleDelay)?this.m():!this.b.value&&this.h.waitThrottleDelayBetweenWorkUnits&&this.r(Math.max(this.h.throttleDelay-e,0)),!0}m(){this.g=Date.now(),this.j(this.a.splice(0,this.h.maxWorkChunkSize)),this.a.length>0&&this.r()}r(t=this.h.throttleDelay){this.b.value=new fs(()=>{this.b.clear(),this.m()},t),this.b.value.schedule()}dispose(){super.dispose(),this.a.length=0,this.f=!0}},D1,Do;(function(){const t=globalThis;typeof t.requestIdleCallback!="function"||typeof t.cancelIdleCallback!="function"?Do=(e,s,i)=>{fy(()=>{if(n)return;const r=Date.now()+15;s(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let n=!1;return{dispose(){n||(n=!0)}}}:Do=(e,s,i)=>{const n=e.requestIdleCallback(s,typeof i=="number"?{timeout:i}:void 0);let r=!1;return{dispose(){r||(r=!0,e.cancelIdleCallback(n))}}},D1=(e,s)=>Do(globalThis,e,s)})();var E4=class{constructor(t,e){this.l=!1,this.g=()=>{try{this.m=e()}catch(s){this.o=s}finally{this.l=!0}},this.j=Do(t,()=>this.g())}dispose(){this.j.dispose()}get value(){if(this.l||(this.j.dispose(),this.g()),this.o)throw this.o;return this.m}get isInitialized(){return this.l}},$4=class extends E4{constructor(t){super(globalThis,t)}};async function x4(t,e,s){let i;for(let n=0;n<s;n++)try{return await t()}catch(r){i=r,await Oi(e)}throw i}var I1;(function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected"})(I1||(I1={}));var ir=class{get isRejected(){return this.d?.outcome===1}get isResolved(){return this.d?.outcome===0}get isSettled(){return!!this.d}get value(){return this.d?.outcome===0?this.d?.value:void 0}constructor(){this.p=new Promise((t,e)=>{this.a=t,this.b=e})}complete(t){return new Promise(e=>{this.a(t),this.d={outcome:0,value:t},e()})}error(t){return new Promise(e=>{this.b(t),this.d={outcome:1,value:t},e()})}settleWith(t){return t.then(e=>this.complete(e),e=>this.error(e))}cancel(){return this.error(new Ve)}},Ze;(function(t){async function e(i){let n;const r=await Promise.all(i.map(o=>o.then(a=>a,a=>{n||(n=a)})));if(typeof n<"u")throw n;return r}t.settled=e;function s(i){return new Promise(async(n,r)=>{try{await i(n,r)}catch(o){r(o)}})}t.withAsyncBody=s})(Ze||(Ze={}));var O1;(function(t){t[t.Initial=0]="Initial",t[t.DoneOK=1]="DoneOK",t[t.DoneError=2]="DoneError"})(O1||(O1={}));var CS=class es{static fromArray(e){return new es(s=>{s.emitMany(e)})}static fromPromise(e){return new es(async s=>{s.emitMany(await e)})}static fromPromisesResolveOrder(e){return new es(async s=>{await Promise.all(e.map(async i=>s.emitOne(await i)))})}static merge(e){return new es(async s=>{await Promise.all(e.map(async i=>{for await(const n of i)s.emitOne(n)}))})}static{this.EMPTY=es.fromArray([])}constructor(e,s){this.a=0,this.b=[],this.d=null,this.f=s,this.g=new R,queueMicrotask(async()=>{const i={emitOne:n=>this.h(n),emitMany:n=>this.j(n),reject:n=>this.l(n)};try{await Promise.resolve(e(i)),this.k()}catch(n){this.l(n)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{do{if(this.a===2)throw this.d;if(e<this.b.length)return{done:!1,value:this.b[e++]};if(this.a===1)return{done:!0,value:void 0};await L.toPromise(this.g.event)}while(!0)},return:async()=>(this.f?.(),{done:!0,value:void 0})}}static map(e,s){return new es(async i=>{for await(const n of e)i.emitOne(s(n))})}map(e){return es.map(this,e)}static filter(e,s){return new es(async i=>{for await(const n of e)s(n)&&i.emitOne(n)})}filter(e){return es.filter(this,e)}static coalesce(e){return es.filter(e,s=>!!s)}coalesce(){return es.coalesce(this)}static async toPromise(e){const s=[];for await(const i of e)s.push(i);return s}toPromise(){return es.toPromise(this)}h(e){this.a===0&&(this.b.push(e),this.g.fire())}j(e){this.a===0&&(this.b=this.b.concat(e),this.g.fire())}k(){this.a===0&&(this.a=1,this.g.fire())}l(e){this.a===0&&(this.a=2,this.d=e,this.g.fire())}},k4=class{constructor(){this.a=[],this.b=[]}get hasFinalValue(){return!!this.d}produce(t){if(this.f(),this.a.length>0){const e=this.a.shift();this.g(e,t)}else this.b.push(t)}produceFinal(t){this.f(),this.d=t;for(const e of this.a)this.g(e,t);this.a.length=0}f(){if(this.d)throw new Ic("ProducerConsumer: cannot produce after final value has been set")}g(t,e){e.ok?t.complete(e.value):t.error(e.error)}consume(){if(this.b.length>0||this.d){const t=this.b.length>0?this.b.shift():this.d;return t.ok?Promise.resolve(t.value):Promise.reject(t.error)}else{const t=new ir;return this.a.push(t),t.p}}},DS=class os{constructor(e,s){this.b=s,this.a=new k4,this.g={next:()=>this.a.consume(),return:()=>(this.b?.(),Promise.resolve({done:!0,value:void 0})),throw:async i=>(this.f(i),{done:!0,value:void 0})},queueMicrotask(async()=>{const i=e({emitOne:n=>this.a.produce({ok:!0,value:{done:!1,value:n}}),emitMany:n=>{for(const r of n)this.a.produce({ok:!0,value:{done:!1,value:r}})},reject:n=>this.f(n)});if(!this.a.hasFinalValue)try{await i,this.d()}catch(n){this.f(n)}})}static fromArray(e){return new os(s=>{s.emitMany(e)})}static fromPromise(e){return new os(async s=>{s.emitMany(await e)})}static fromPromisesResolveOrder(e){return new os(async s=>{await Promise.all(e.map(async i=>s.emitOne(await i)))})}static merge(e){return new os(async s=>{await Promise.all(e.map(async i=>{for await(const n of i)s.emitOne(n)}))})}static{this.EMPTY=os.fromArray([])}static map(e,s){return new os(async i=>{for await(const n of e)i.emitOne(s(n))})}map(e){return os.map(this,e)}static coalesce(e){return os.filter(e,s=>!!s)}coalesce(){return os.coalesce(this)}static filter(e,s){return new os(async i=>{for await(const n of e)s(n)&&i.emitOne(n)})}filter(e){return os.filter(this,e)}d(){this.a.hasFinalValue||this.a.produceFinal({ok:!0,value:{done:!0,value:void 0}})}f(e){this.a.hasFinalValue||this.a.produceFinal({ok:!1,error:e})}[Symbol.asyncIterator](){return this.g}},IS=Symbol("AsyncReaderEndOfStream");function Io(t){const e=t;return e?[e.on,e.pause,e.resume,e.destroy].every(s=>typeof s=="function"):!1}function el(t){const e=t;return e?Io(e.stream)&&Array.isArray(e.buffer)&&typeof e.ended=="boolean":!1}function nr(t,e){return new P4(t,e)}var P4=class{constructor(t,e){this.e=t,this.f=e,this.a={flowing:!1,ended:!1,destroyed:!1},this.b={data:[],error:[]},this.c={data:[],error:[],end:[]},this.d=[]}pause(){this.a.destroyed||(this.a.flowing=!1)}resume(){this.a.destroyed||this.a.flowing||(this.a.flowing=!0,this.j(),this.k(),this.l())}write(t){if(!this.a.destroyed){if(this.a.flowing)this.g(t);else if(this.b.data.push(t),typeof this.f?.highWaterMark=="number"&&this.b.data.length>this.f.highWaterMark)return new Promise(e=>this.d.push(e))}}error(t){this.a.destroyed||(this.a.flowing?this.h(t):this.b.error.push(t))}end(t){this.a.destroyed||(typeof t<"u"&&this.write(t),this.a.flowing?(this.i(),this.destroy()):this.a.ended=!0)}g(t){this.c.data.slice(0).forEach(e=>e(t))}h(t){this.c.error.length===0?it(t):this.c.error.slice(0).forEach(e=>e(t))}i(){this.c.end.slice(0).forEach(t=>t())}on(t,e){if(!this.a.destroyed)switch(t){case"data":this.c.data.push(e),this.resume();break;case"end":this.c.end.push(e),this.a.flowing&&this.l()&&this.destroy();break;case"error":this.c.error.push(e),this.a.flowing&&this.k();break}}removeListener(t,e){if(this.a.destroyed)return;let s;switch(t){case"data":s=this.c.data;break;case"end":s=this.c.end;break;case"error":s=this.c.error;break}if(s){const i=s.indexOf(e);i>=0&&s.splice(i,1)}}j(){if(this.b.data.length===0)return;if(typeof this.e=="function"){const e=this.e(this.b.data);this.g(e)}else for(const e of this.b.data)this.g(e);this.b.data.length=0;const t=[...this.d];this.d.length=0,t.forEach(e=>e())}k(){if(this.c.error.length>0){for(const t of this.b.error)this.h(t);this.b.error.length=0}}l(){return this.a.ended?(this.i(),this.c.end.length>0):!1}destroy(){this.a.destroyed||(this.a.destroyed=!0,this.a.ended=!0,this.b.data.length=0,this.b.error.length=0,this.c.data.length=0,this.c.error.length=0,this.c.end.length=0,this.d.length=0)}};function R4(t,e){const s=[];let i;for(;(i=t.read())!==null;)s.push(i);return e(s)}function C4(t,e,s){const i=[];let n;for(;(n=t.read())!==null&&i.length<s;)i.push(n);return n===null&&i.length>0?e(i):{read:()=>{if(i.length>0)return i.shift();if(typeof n<"u"){const r=n;return n=void 0,r}return t.read()}}}function L1(t,e){return new Promise((s,i)=>{const n=[];Oo(t,{onData:r=>{e&&n.push(r)},onError:r=>{e?i(r):s(void 0)},onEnd:()=>{s(e?e(n):void 0)}})})}function Oo(t,e,s){t.on("error",i=>{s?.isCancellationRequested||e.onError(i)}),t.on("end",()=>{s?.isCancellationRequested||e.onEnd()}),t.on("data",i=>{s?.isCancellationRequested||e.onData(i)})}function D4(t,e){return new Promise((s,i)=>{const n=new De,r=[],o=l=>{if(r.push(l),r.length>e)return n.dispose(),t.pause(),s({stream:t,buffer:r,ended:!1})},a=l=>(n.dispose(),i(l)),c=()=>(n.dispose(),s({stream:t,buffer:r,ended:!0}));n.add(de(()=>t.removeListener("error",a))),t.on("error",a),n.add(de(()=>t.removeListener("end",c))),t.on("end",c),n.add(de(()=>t.removeListener("data",o))),t.on("data",o)})}function I4(t){let e=!1;return{read:()=>e?null:(e=!0,t)}}function A1(t,e,s){const i=nr(s);return Oo(t,{onData:n=>i.write(e.data(n)),onError:n=>i.error(e.error?e.error(n):n),onEnd:()=>i.end()}),i}var rr=typeof Buffer<"u",O4=new xi(()=>new Uint8Array(256)),tl,sl,A=class as{static alloc(e){return rr?new as(Buffer.allocUnsafe(e)):new as(new Uint8Array(e))}static wrap(e){return rr&&!Buffer.isBuffer(e)&&(e=Buffer.from(e.buffer,e.byteOffset,e.byteLength)),new as(e)}static fromString(e,s){return!(s?.dontUseNodeBuffer||!1)&&rr?new as(Buffer.from(e)):(tl||(tl=new TextEncoder),new as(tl.encode(e)))}static fromByteArray(e){const s=as.alloc(e.length);for(let i=0,n=e.length;i<n;i++)s.buffer[i]=e[i];return s}static concat(e,s){if(typeof s>"u"){s=0;for(let r=0,o=e.length;r<o;r++)s+=e[r].byteLength}const i=as.alloc(s);let n=0;for(let r=0,o=e.length;r<o;r++){const a=e[r];i.set(a,n),n+=a.byteLength}return i}static isNativeBuffer(e){return rr&&Buffer.isBuffer(e)}constructor(e){this.buffer=e,this.byteLength=this.buffer.byteLength}clone(){const e=as.alloc(this.byteLength);return e.set(this),e}toString(){return rr?this.buffer.toString():(sl||(sl=new TextDecoder),sl.decode(this.buffer))}slice(e,s){return new as(this.buffer.subarray(e,s))}set(e,s){if(e instanceof as)this.buffer.set(e.buffer,s);else if(e instanceof Uint8Array)this.buffer.set(e,s);else if(e instanceof ArrayBuffer)this.buffer.set(new Uint8Array(e),s);else if(ArrayBuffer.isView(e))this.buffer.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s);else throw new Error("Unknown argument 'array'")}readUInt32BE(e){return L4(this.buffer,e)}writeUInt32BE(e,s){A4(this.buffer,e,s)}readUInt32LE(e){return N4(this.buffer,e)}writeUInt32LE(e,s){j4(this.buffer,e,s)}readUInt8(e){return T4(this.buffer,e)}writeUInt8(e,s){M4(this.buffer,e,s)}indexOf(e,s=0){return N1(this.buffer,e instanceof as?e.buffer:e,s)}equals(e){return this===e?!0:this.byteLength!==e.byteLength?!1:this.buffer.every((s,i)=>s===e.buffer[i])}};function N1(t,e,s=0){const i=e.byteLength,n=t.byteLength;if(i===0)return 0;if(i===1)return t.indexOf(e[0]);if(i>n-s)return-1;const r=O4.value;r.fill(e.length);for(let l=0;l<e.length;l++)r[e[l]]=e.length-l-1;let o=s+e.length-1,a=o,c=-1;for(;o<n;)if(t[o]===e[a]){if(a===0){c=o;break}o--,a--}else o+=Math.max(e.length-a,r[t[o]]),a=e.length-1;return c}function L4(t,e){return t[e]*2**24+t[e+1]*2**16+t[e+2]*2**8+t[e+3]}function A4(t,e,s){t[s+3]=e,e=e>>>8,t[s+2]=e,e=e>>>8,t[s+1]=e,e=e>>>8,t[s]=e}function N4(t,e){return t[e+0]<<0>>>0|t[e+1]<<8>>>0|t[e+2]<<16>>>0|t[e+3]<<24>>>0}function j4(t,e,s){t[s+0]=e&255,e=e>>>8,t[s+1]=e&255,e=e>>>8,t[s+2]=e&255,e=e>>>8,t[s+3]=e&255}function T4(t,e){return t[e]}function M4(t,e,s){t[s]=e}function F4(t){return R4(t,e=>A.concat(e))}function U4(t){return I4(t)}function Li(t){return L1(t,e=>A.concat(e))}async function B4(t){return t.ended?A.concat(t.buffer):A.concat([...t.buffer,await Li(t.stream)])}function z4(t){return A1(t,{data:e=>typeof e=="string"?A.fromString(e):A.wrap(e)},e=>A.concat(e))}function _4(t){return nr(e=>A.concat(e),t)}var V4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function W4({buffer:t},e=!0,s=!1){const i=s?q4:V4;let n="";const r=t.byteLength%3;let o=0;for(;o<t.byteLength-r;o+=3){const a=t[o+0],c=t[o+1],l=t[o+2];n+=i[a>>>2],n+=i[(a<<4|c>>>4)&63],n+=i[(c<<2|l>>>6)&63],n+=i[l&63]}if(r===1){const a=t[o+0];n+=i[a>>>2],n+=i[a<<4&63],e&&(n+="==")}else if(r===2){const a=t[o+0],c=t[o+1];n+=i[a>>>2],n+=i[(a<<4|c>>>4)&63],n+=i[c<<2&63],e&&(n+="=")}return n}var j1="0123456789abcdef";function H4({buffer:t}){let e="";for(let s=0;s<t.length;s++){const i=t[s];e+=j1[i>>>4],e+=j1[i&15]}return e}function xe(t,e,s){let i=null,n=null;if(typeof s.value=="function"?(i="value",n=s.value,n.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof s.get=="function"&&(i="get",n=s.get),!n)throw new Error("not supported");const r=`$memoize$${e}`;s[i]=function(...o){return this.hasOwnProperty(r)||Object.defineProperty(this,r,{configurable:!1,enumerable:!1,writable:!1,value:n.apply(this,o)}),this[r]}}function G4(t){return JSON.stringify(t,K4)}function J4(t){let e=JSON.parse(t);return e=fn(e),e}function K4(t,e){return e instanceof RegExp?{$mid:2,source:e.source,flags:e.flags}:e}function fn(t,e=0){if(!t||e>200)return t;if(typeof t=="object"){switch(t.$mid){case 1:return k.revive(t);case 2:return new RegExp(t.source,t.flags);case 17:return new Date(t.source)}if(t instanceof A||t instanceof Uint8Array)return t;if(Array.isArray(t))for(let s=0;s<t.length;++s)t[s]=fn(t[s],e+1);else for(const s in t)Object.hasOwnProperty.call(t,s)&&(t[s]=fn(t[s],e+1))}return t}var T1;(function(t){t[t.Promise=100]="Promise",t[t.PromiseCancel=101]="PromiseCancel",t[t.EventListen=102]="EventListen",t[t.EventDispose=103]="EventDispose"})(T1||(T1={}));function dn(t){switch(t){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}var M1;(function(t){t[t.Initialize=200]="Initialize",t[t.PromiseSuccess=201]="PromiseSuccess",t[t.PromiseError=202]="PromiseError",t[t.PromiseErrorObj=203]="PromiseErrorObj",t[t.EventFire=204]="EventFire"})(M1||(M1={}));function Lo(t){switch(t){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}var Ai;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Idle=1]="Idle"})(Ai||(Ai={}));function pn(t){let e=0;for(let s=0;;s+=7){const i=t.read(1);if(e|=(i.buffer[0]&127)<<s,!(i.buffer[0]&128))return e}}var Q4=si(0);function gn(t,e){if(e===0){t.write(Q4);return}let s=0;for(let n=e;n!==0;n=n>>>7)s++;const i=A.alloc(s);for(let n=0;e!==0;n++)i.buffer[n]=e&127,e=e>>>7,e>0&&(i.buffer[n]|=128);t.write(i)}var il=class{constructor(t){this.b=t,this.a=0}read(t){const e=this.b.slice(this.a,this.a+t);return this.a+=e.byteLength,e}},F1=class{constructor(){this.a=[]}get buffer(){return A.concat(this.a)}write(t){this.a.push(t)}},Et;(function(t){t[t.Undefined=0]="Undefined",t[t.String=1]="String",t[t.Buffer=2]="Buffer",t[t.VSBuffer=3]="VSBuffer",t[t.Array=4]="Array",t[t.Object=5]="Object",t[t.Int=6]="Int"})(Et||(Et={}));function si(t){const e=A.alloc(1);return e.writeUInt8(t,0),e}var Ni={Undefined:si(Et.Undefined),String:si(Et.String),Buffer:si(Et.Buffer),VSBuffer:si(Et.VSBuffer),Array:si(Et.Array),Object:si(Et.Object),Uint:si(Et.Int)};function or(t,e){if(typeof e>"u")t.write(Ni.Undefined);else if(typeof e=="string"){const s=A.fromString(e);t.write(Ni.String),gn(t,s.byteLength),t.write(s)}else if(A.isNativeBuffer(e)){const s=A.wrap(e);t.write(Ni.Buffer),gn(t,s.byteLength),t.write(s)}else if(e instanceof A)t.write(Ni.VSBuffer),gn(t,e.byteLength),t.write(e);else if(Array.isArray(e)){t.write(Ni.Array),gn(t,e.length);for(const s of e)or(t,s)}else if(typeof e=="number"&&(e|0)===e)t.write(Ni.Uint),gn(t,e);else{const s=A.fromString(JSON.stringify(e));t.write(Ni.Object),gn(t,s.byteLength),t.write(s)}}function mn(t){switch(t.read(1).readUInt8(0)){case Et.Undefined:return;case Et.String:return t.read(pn(t)).toString();case Et.Buffer:return t.read(pn(t)).buffer;case Et.VSBuffer:return t.read(pn(t));case Et.Array:{const s=pn(t),i=[];for(let n=0;n<s;n++)i.push(mn(t));return i}case Et.Object:return JSON.parse(t.read(pn(t)).toString());case Et.Int:return pn(t)}}var X4=class{constructor(t,e,s=null,i=1e3){this.h=t,this.j=e,this.k=s,this.l=i,this.b=new Map,this.d=new Map,this.g=new Map,this.f=this.h.onMessage(n=>this.q(n)),this.m({type:200})}registerChannel(t,e){this.b.set(t,e),setTimeout(()=>this.w(t),0)}m(t){switch(t.type){case 200:{const e=this.o([t.type]);this.k?.logOutgoing(e,0,1,Lo(t.type));return}case 201:case 202:case 204:case 203:{const e=this.o([t.type,t.id],t.data);this.k?.logOutgoing(e,t.id,1,Lo(t.type),t.data);return}}}o(t,e=void 0){const s=new F1;return or(s,t),or(s,e),this.p(s.buffer)}p(t){try{return this.h.send(t),t.byteLength}catch{return 0}}q(t){const e=new il(t),s=mn(e),i=mn(e),n=s[0];switch(n){case 100:return this.k?.logIncoming(t.byteLength,s[1],1,`${dn(n)}: ${s[2]}.${s[3]}`,i),this.s({type:n,id:s[1],channelName:s[2],name:s[3],arg:i});case 102:return this.k?.logIncoming(t.byteLength,s[1],1,`${dn(n)}: ${s[2]}.${s[3]}`,i),this.t({type:n,id:s[1],channelName:s[2],name:s[3],arg:i});case 101:return this.k?.logIncoming(t.byteLength,s[1],1,`${dn(n)}`),this.u({type:n,id:s[1]});case 103:return this.k?.logIncoming(t.byteLength,s[1],1,`${dn(n)}`),this.u({type:n,id:s[1]})}}s(t){const e=this.b.get(t.channelName);if(!e){this.v(t);return}const s=new Ss;let i;try{i=e.call(this.j,t.name,t.arg,s.token)}catch(o){i=Promise.reject(o)}const n=t.id;i.then(o=>{this.m({id:n,data:o,type:201})},o=>{o instanceof Error?this.m({id:n,data:{message:o.message,name:o.name,stack:o.stack?o.stack.split(`
`):void 0},type:202}):this.m({id:n,data:o,type:203})}).finally(()=>{r.dispose(),this.d.delete(t.id)});const r=de(()=>s.cancel());this.d.set(t.id,r)}t(t){const e=this.b.get(t.channelName);if(!e){this.v(t);return}const s=t.id,n=e.listen(this.j,t.name,t.arg)(r=>this.m({id:s,data:r,type:204}));this.d.set(t.id,n)}u(t){const e=this.d.get(t.id);e&&(e.dispose(),this.d.delete(t.id))}v(t){let e=this.g.get(t.channelName);e||(e=[],this.g.set(t.channelName,e));const s=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.m({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.l}ms`,stack:void 0},type:202})},this.l);e.push({request:t,timeoutTimer:s})}w(t){const e=this.g.get(t);if(e){for(const s of e)switch(clearTimeout(s.timeoutTimer),s.request.type){case 100:this.s(s.request);break;case 102:this.t(s.request);break}this.g.delete(t)}}dispose(){this.f&&(this.f.dispose(),this.f=null),Xt(this.d.values()),this.d.clear()}},U1;(function(t){t[t.LocalSide=0]="LocalSide",t[t.OtherSide=1]="OtherSide"})(U1||(U1={}));var nl=class{constructor(t,e=null){this.l=t,this.a=!1,this.b=Ai.Uninitialized,this.d=new Set,this.f=new Map,this.g=0,this.k=new R,this.onDidInitialize=this.k.event,this.h=this.l.onMessage(s=>this.s(s)),this.j=e}getChannel(t){const e=this;return{call(s,i,n){return e.a?Promise.reject(new Ve):e.m(t,s,i,n)},listen(s,i){return e.a?L.None:e.o(t,s,i)}}}m(t,e,s,i=Q.None){const n=this.g++,o={id:n,type:100,channelName:t,name:e,arg:s};if(i.isCancellationRequested)return Promise.reject(new Ve);let a,c;return new Promise((h,u)=>{if(i.isCancellationRequested)return u(new Ve);const f=()=>{const m=w=>{switch(w.type){case 201:this.f.delete(n),h(w.data);break;case 202:{this.f.delete(n);const b=new Error(w.data.message);b.stack=Array.isArray(w.data.stack)?w.data.stack.join(`
`):w.data.stack,b.name=w.data.name,u(b);break}case 203:this.f.delete(n),u(w.data);break}};this.f.set(n,m),this.p(o)};let p=null;this.b===Ai.Idle?f():(p=vt(m=>this.u()),p.then(()=>{p=null,f()}));const g=()=>{p?(p.cancel(),p=null):this.p({id:n,type:101}),u(new Ve)};a=i.onCancellationRequested(g),c={dispose:Fc(()=>{g(),a.dispose()})},this.d.add(c)}).finally(()=>{a?.dispose(),this.d.delete(c)})}o(t,e,s){const i=this.g++,r={id:i,type:102,channelName:t,name:e,arg:s};let o=null;const a=new R({onWillAddFirstListener:()=>{const l=()=>{this.d.add(a),this.p(r)};this.b===Ai.Idle?l():(o=vt(h=>this.u()),o.then(()=>{o=null,l()}))},onDidRemoveLastListener:()=>{o?(o.cancel(),o=null):(this.d.delete(a),this.p({id:i,type:103}))}}),c=l=>a.fire(l.data);return this.f.set(i,c),a.event}p(t){switch(t.type){case 100:case 102:{const e=this.q([t.type,t.id,t.channelName,t.name],t.arg);this.j?.logOutgoing(e,t.id,0,`${dn(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{const e=this.q([t.type,t.id]);this.j?.logOutgoing(e,t.id,0,dn(t.type));return}}}q(t,e=void 0){const s=new F1;return or(s,t),or(s,e),this.r(s.buffer)}r(t){try{return this.l.send(t),t.byteLength}catch{return 0}}s(t){const e=new il(t),s=mn(e),i=mn(e),n=s[0];switch(n){case 200:return this.j?.logIncoming(t.byteLength,0,0,Lo(n)),this.t({type:s[0]});case 201:case 202:case 204:case 203:return this.j?.logIncoming(t.byteLength,s[1],0,Lo(n),i),this.t({type:s[0],id:s[1],data:i})}}t(t){if(t.type===200){this.b=Ai.Idle,this.k.fire();return}this.f.get(t.id)?.(t)}get onDidInitializePromise(){return L.toPromise(this.onDidInitialize)}u(){return this.b===Ai.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.a=!0,this.h&&(this.h.dispose(),this.h=null),Xt(this.d.values()),this.d.clear()}};__decorate([xe],nl.prototype,"onDidInitializePromise",null);var Z4=class{get connections(){const t=[];return this.f.forEach(e=>t.push(e)),t}constructor(t,e,s){this.a=new Map,this.f=new Set,this.g=new R,this.onDidAddConnection=this.g.event,this.h=new R,this.onDidRemoveConnection=this.h.event,this.j=new De,this.j.add(t(({protocol:i,onDidClientDisconnect:n})=>{const r=L.once(i.onMessage);this.j.add(r(o=>{const a=new il(o),c=mn(a),l=new X4(i,c,e,s),h=new nl(i,e);this.a.forEach((f,p)=>l.registerChannel(p,f));const u={channelServer:l,channelClient:h,ctx:c};this.f.add(u),this.g.fire(u),this.j.add(n(()=>{l.dispose(),h.dispose(),this.f.delete(u),this.h.fire(u)}))}))}))}getChannel(t,e){const s=this;return{call(i,n,r){let o;if(jc(e)){const c=Mv(s.connections.filter(e));o=c?Promise.resolve(c):L.toPromise(L.filter(s.onDidAddConnection,e))}else o=e.routeCall(s,i,n);const a=o.then(c=>c.channelClient.getChannel(t));return B1(a).call(i,n,r)},listen(i,n){if(jc(e))return s.k(t,e,i,n);const r=e.routeEvent(s,i,n).then(o=>o.channelClient.getChannel(t));return B1(r).listen(i,n)}}}k(t,e,s,i){const n=this;let r;const o=new R({onWillAddFirstListener:()=>{r=new De;const a=new xy,c=new Map,l=u=>{const p=u.channelClient.getChannel(t).listen(s,i),g=a.add(p);c.set(u,g)},h=u=>{const f=c.get(u);f&&(f.dispose(),c.delete(u))};n.connections.filter(e).forEach(l),L.filter(n.onDidAddConnection,e)(l,void 0,r),n.onDidRemoveConnection(h,void 0,r),a.event(o.fire,o,r),r.add(a)},onDidRemoveLastListener:()=>{r?.dispose(),r=void 0}});return n.j.add(o),o.event}registerChannel(t,e){this.a.set(t,e);for(const s of this.f)s.channelServer.registerChannel(t,e)}dispose(){this.j.dispose();for(const t of this.f)t.channelClient.dispose(),t.channelServer.dispose();this.f.clear(),this.a.clear(),this.g.dispose(),this.h.dispose()}};function B1(t){return{call(e,s,i){return t.then(n=>n.call(e,s,i))},listen(e,s){const i=new Kd;return t.then(n=>i.input=n.listen(e,s)),i.event}}}function Y4(t){let e=!1;return{call(s,i,n){return e?t.call(s,i,n):Oi(0).then(()=>e=!0).then(()=>t.call(s,i,n))},listen(s,i){if(e)return t.listen(s,i);const n=new Kd;return Oi(0).then(()=>e=!0).then(()=>n.input=t.listen(s,i)),n.event}}}var z1=class{constructor(t){this.a=t}routeCall(t){return this.b(t)}routeEvent(t){return this.b(t)}async b(t){for(const e of t.connections)if(await Promise.resolve(this.a(e.ctx)))return Promise.resolve(e);return await L.toPromise(t.onDidAddConnection),await this.b(t)}},$t;(function(t){function e(r,o,a){const c=r,l=a&&a.disableMarshalling,h=new Map;for(const u in c)i(u)&&h.set(u,L.buffer(c[u],!0,void 0,o));return new class{listen(u,f,p){const g=h.get(f);if(g)return g;const m=c[f];if(typeof m=="function"){if(n(f))return m.call(c,p);if(i(f))return h.set(f,L.buffer(c[f],!0,void 0,o)),h.get(f)}throw new Ei(`Event not found: ${f}`)}call(u,f,p){const g=c[f];if(typeof g=="function"){if(!l&&Array.isArray(p))for(let w=0;w<p.length;w++)p[w]=fn(p[w]);let m=g.apply(c,p);return m instanceof Promise||(m=Promise.resolve(m)),m}throw new Ei(`Method not found: ${f}`)}}}t.fromService=e;function s(r,o){const a=o&&o.disableMarshalling;return new Proxy({},{get(c,l){if(typeof l=="string")return o?.properties?.has(l)?o.properties.get(l):n(l)?function(h){return r.listen(l,h)}:i(l)?r.listen(l):async function(...h){let u;o&&!St(o.context)?u=[o.context,...h]:u=h;const f=await r.call(l,u);return a?f:fn(f)};throw new Ei(`Property not found: ${String(l)}`)}})}t.toService=s;function i(r){return r[0]==="o"&&r[1]==="n"&&Yd(r.charCodeAt(2))}function n(r){return/^onDynamic/.test(r)&&Yd(r.charCodeAt(9))}})($t||($t={}));function eb(t){return!!t.parentPort}var tb=class{constructor(t){this.a=t,this.onMessage=L.fromNodeEventEmitter(this.a,"message",e=>e.data?A.wrap(e.data):A.alloc(0)),t.start()}send(t){this.a.postMessage(t.buffer)}disconnect(){this.a.close()}},sb=class Kw extends Z4{static b(e){Vv(eb(process),"Electron Utility Process");const s=new R;return process.parentPort.on("message",i=>{if(e?.handledClientConnection(i))return;const n=i.ports.at(0);n&&s.fire(n)}),L.map(s.event,i=>({protocol:new tb(i),onDidClientDisconnect:L.fromNodeEventEmitter(i,"close")}))}constructor(e){super(Kw.b(e))}};function ib(t,e,s){const i=n=>{n.data===e&&(t.removeListener("message",i),s())};t.on("message",i)}import{promises as nb}from"fs";import*as Ee from"fs";import{tmpdir as rb}from"os";import{promisify as ar}from"util";var ob=new fo(1e4);function rl(t){return cb(t,"NFC",ob)}var NS=new fo(1e4),ab=/[^\u0000-\u0080]/;function cb(t,e,s){if(!t)return t;const i=s.get(t);if(i)return i;let n;return ab.test(t)?n=t.normalize(e):n=t,s.set(t,n),n}var wn;(function(t){t[t.UNLINK=0]="UNLINK",t[t.MOVE=1]="MOVE"})(wn||(wn={}));async function _1(t,e=wn.UNLINK,s){if(b1(t))throw new Error("rimraf - will refuse to recursively delete root");return e===wn.UNLINK?ol(t):lb(t,s)}async function lb(t,e=h4(rb())){try{try{await Ee.promises.rename(t,e)}catch(s){return s.code==="ENOENT"?void 0:ol(t)}ol(e).catch(s=>{})}catch(s){if(s.code!=="ENOENT")throw s}}async function ol(t){return Ee.promises.rm(t,{recursive:!0,force:!0,maxRetries:3})}async function Ao(t,e){try{return await V1(t,e)}catch(s){if(s.code==="ENOENT"&&Ae&&b1(t))try{return await V1(`${t}.`,e)}catch{}throw s}}async function V1(t,e){return ub(await(e?hb(t):Ee.promises.readdir(t)))}async function hb(t){try{return await Ee.promises.readdir(t,{withFileTypes:!0})}catch(i){console.warn("[node.js fs] readdir with filetypes failed with error: ",i)}const e=[],s=await Ao(t);for(const i of s){let n=!1,r=!1,o=!1;try{const a=await Ee.promises.lstat(J(t,i));n=a.isFile(),r=a.isDirectory(),o=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}e.push({name:i,isFile:()=>n,isDirectory:()=>r,isSymbolicLink:()=>o})}return e}function ub(t){return t.map(e=>typeof e=="string"?vs?rl(e):e:(e.name=vs?rl(e.name):e.name,e))}async function fb(t){const e=await Ao(t),s=[];for(const i of e)await Bt.existsDirectory(J(t,i))&&s.push(i);return s}var Bt;(function(t){async function e(n){let r;try{if(r=await Ee.promises.lstat(n),!r.isSymbolicLink())return{stat:r}}catch{}try{return{stat:await Ee.promises.stat(n),symbolicLink:r?.isSymbolicLink()?{dangling:!1}:void 0}}catch(o){if(o.code==="ENOENT"&&r)return{stat:r,symbolicLink:{dangling:!0}};if(Ae&&o.code==="EACCES")try{return{stat:await Ee.promises.stat(await Ee.promises.readlink(n)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&r)return{stat:r,symbolicLink:{dangling:!0}};throw a}throw o}}t.stat=e;async function s(n){try{const{stat:r,symbolicLink:o}=await t.stat(n);return r.isFile()&&o?.dangling!==!0}catch{}return!1}t.existsFile=s;async function i(n){try{const{stat:r,symbolicLink:o}=await t.stat(n);return r.isDirectory()&&o?.dangling!==!0}catch{}return!1}t.existsDirectory=i})(Bt||(Bt={}));var db=new R1;function pb(t,e,s){return db.queueFor(k.file(t),()=>{const i=wb(s);return new Promise((n,r)=>mb(t,e,i,o=>o?r(o):n()))},Xc)}var q1=!0;function gb(t){q1=t}function mb(t,e,s,i){if(!q1)return Ee.writeFile(t,e,{mode:s.mode,flag:s.flag},i);Ee.open(t,s.flag,s.mode,(n,r)=>{if(n)return i(n);Ee.writeFile(r,e,o=>{if(o)return Ee.close(r,()=>i(o));Ee.fdatasync(r,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),gb(!1)),Ee.close(r,c=>i(c))))})})}function wb(t){return t?{mode:typeof t.mode=="number"?t.mode:438,flag:typeof t.flag=="string"?t.flag:"w"}:{mode:438,flag:"w"}}async function vb(t,e,s=6e4){if(t!==e)try{Ae&&typeof s=="number"?await W1(t,e,Date.now(),s):await Ee.promises.rename(t,e)}catch(i){if(t.toLowerCase()!==e.toLowerCase()&&i.code==="EXDEV"||t.endsWith("."))await H1(t,e,{preserveSymlinks:!1}),await _1(t,wn.MOVE);else throw i}}async function W1(t,e,s,i,n=0){try{return await Ee.promises.rename(t,e)}catch(r){if(r.code!=="EACCES"&&r.code!=="EPERM"&&r.code!=="EBUSY")throw r;if(Date.now()-s>=i)throw console.error(`[node.js fs] rename failed after ${n} retries with error: ${r}`),r;if(n===0){let o=!1;try{const{stat:a}=await Bt.stat(e);a.isFile()||(o=!0)}catch{}if(o)throw r}return await Oi(Math.min(100,n*10)),W1(t,e,s,i,n+1)}}async function H1(t,e,s){return J1(t,e,{root:{source:t,target:e},options:s,handledSourcePaths:new Set})}var G1=511;async function J1(t,e,s){if(s.handledSourcePaths.has(t))return;s.handledSourcePaths.add(t);const{stat:i,symbolicLink:n}=await Bt.stat(t);if(n){if(s.options.preserveSymlinks)try{return await Sb(t,e,s)}catch{}if(n.dangling)return}return i.isDirectory()?yb(t,e,i.mode&G1,s):bb(t,e,i.mode&G1)}async function yb(t,e,s,i){await Ee.promises.mkdir(e,{recursive:!0,mode:s});const n=await Ao(t);for(const r of n)await J1(J(t,r),J(e,r),i)}async function bb(t,e,s){await Ee.promises.copyFile(t,e),await Ee.promises.chmod(e,s)}async function Sb(t,e,s){let i=await Ee.promises.readlink(t);er(i,s.root.source,!wt)&&(i=J(s.root.target,i.substr(s.root.source.length+1))),await Ee.promises.symlink(i,e)}async function Eb(t){try{return await ar(Ee.realpath)(t)}catch{const s=$b(t);return await Ee.promises.access(s,Ee.constants.R_OK),s}}function $b(t){return bo(Ys(t),Dt)}var le=new class{get read(){return(t,e,s,i,n)=>new Promise((r,o)=>{Ee.read(t,e,s,i,n,(a,c,l)=>a?o(a):r({bytesRead:c,buffer:l}))})}get write(){return(t,e,s,i,n)=>new Promise((r,o)=>{Ee.write(t,e,s,i,n,(a,c,l)=>a?o(a):r({bytesWritten:c,buffer:l}))})}get fdatasync(){return ar(Ee.fdatasync)}get open(){return ar(Ee.open)}get close(){return ar(Ee.close)}get ftruncate(){return ar(Ee.ftruncate)}async exists(t){try{return await Ee.promises.access(t),!0}catch{return!1}}get readdir(){return Ao}get readDirsInDir(){return fb}get writeFile(){return pb}get rm(){return _1}get rename(){return vb}get copy(){return H1}get realpath(){return Eb}};function vn(t){return al(t,0)}function al(t,e){switch(typeof t){case"object":return t===null?Vs(349,e):Array.isArray(t)?kb(t,e):Pb(t,e);case"string":return K1(t,e);case"boolean":return xb(t,e);case"number":return Vs(t,e);case"undefined":return Vs(937,e);default:return Vs(617,e)}}function Vs(t,e){return(e<<5)-e+t|0}function xb(t,e){return Vs(t?433:863,e)}function K1(t,e){e=Vs(149417,e);for(let s=0,i=t.length;s<i;s++)e=Vs(t.charCodeAt(s),e);return e}function kb(t,e){return e=Vs(104579,e),t.reduce((s,i)=>al(i,s),e)}function Pb(t,e){return e=Vs(181387,e),Object.keys(t).sort().reduce((s,i)=>(s=K1(i,s),al(t[i],s)),e)}var Q1;(function(t){t[t.BLOCK_SIZE=64]="BLOCK_SIZE",t[t.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT"})(Q1||(Q1={}));function cl(t,e,s=32){const i=s-e,n=~((1<<i)-1);return(t<<e|(n&t)>>>i)>>>0}function cr(t,e=32){return t instanceof ArrayBuffer?H4(A.wrap(new Uint8Array(t))):(t>>>0).toString(16).padStart(e/4,"0")}var jS=class Qw{static{this.g=new DataView(new ArrayBuffer(320))}constructor(){this.h=1732584193,this.l=4023233417,this.m=2562383102,this.n=271733878,this.o=3285377520,this.p=new Uint8Array(67),this.q=new DataView(this.p.buffer),this.r=0,this.t=0,this.u=0,this.v=!1}update(e){const s=e.length;if(s===0)return;const i=this.p;let n=this.r,r=this.u,o,a;for(r!==0?(o=r,a=-1,r=0):(o=e.charCodeAt(0),a=0);;){let c=o;if(Iy(o))if(a+1<s){const l=e.charCodeAt(a+1);e1(l)?(a++,c=Oy(o,l)):c=65533}else{r=o;break}else e1(o)&&(c=65533);if(n=this.w(i,n,c),a++,a<s)o=e.charCodeAt(a);else break}this.r=n,this.u=r}w(e,s,i){return i<128?e[s++]=i:i<2048?(e[s++]=192|(i&1984)>>>6,e[s++]=128|(i&63)>>>0):i<65536?(e[s++]=224|(i&61440)>>>12,e[s++]=128|(i&4032)>>>6,e[s++]=128|(i&63)>>>0):(e[s++]=240|(i&1835008)>>>18,e[s++]=128|(i&258048)>>>12,e[s++]=128|(i&4032)>>>6,e[s++]=128|(i&63)>>>0),s>=64&&(this.y(),s-=64,this.t+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),s}digest(){return this.v||(this.v=!0,this.u&&(this.u=0,this.r=this.w(this.p,this.r,65533)),this.t+=this.r,this.x()),cr(this.h)+cr(this.l)+cr(this.m)+cr(this.n)+cr(this.o)}x(){this.p[this.r++]=128,this.p.subarray(this.r).fill(0),this.r>56&&(this.y(),this.p.fill(0));const e=8*this.t;this.q.setUint32(56,Math.floor(e/4294967296),!1),this.q.setUint32(60,e%4294967296,!1),this.y()}y(){const e=Qw.g,s=this.q;for(let u=0;u<64;u+=4)e.setUint32(u,s.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)e.setUint32(u,cl(e.getUint32(u-12,!1)^e.getUint32(u-32,!1)^e.getUint32(u-56,!1)^e.getUint32(u-64,!1),1),!1);let i=this.h,n=this.l,r=this.m,o=this.n,a=this.o,c,l,h;for(let u=0;u<80;u++)u<20?(c=n&r|~n&o,l=1518500249):u<40?(c=n^r^o,l=1859775393):u<60?(c=n&r|n&o|r&o,l=2400959708):(c=n^r^o,l=3395469782),h=cl(i,5)+c+a+l+e.getUint32(u*4,!1)&4294967295,a=o,o=r,r=cl(n,30),n=i,i=h;this.h=this.h+i&4294967295,this.l=this.l+n&4294967295,this.m=this.m+r&4294967295,this.n=this.n+o&4294967295,this.o=this.o+a&4294967295}},X1;(function(t){t[t.LParen=0]="LParen",t[t.RParen=1]="RParen",t[t.Neg=2]="Neg",t[t.Eq=3]="Eq",t[t.NotEq=4]="NotEq",t[t.Lt=5]="Lt",t[t.LtEq=6]="LtEq",t[t.Gt=7]="Gt",t[t.GtEq=8]="GtEq",t[t.RegexOp=9]="RegexOp",t[t.RegexStr=10]="RegexStr",t[t.True=11]="True",t[t.False=12]="False",t[t.In=13]="In",t[t.Not=14]="Not",t[t.And=15]="And",t[t.Or=16]="Or",t[t.Str=17]="Str",t[t.QuotedStr=18]="QuotedStr",t[t.Error=19]="Error",t[t.EOF=20]="EOF"})(X1||(X1={}));function ll(...t){switch(t.length){case 1:return v(1844,null,t[0]);case 2:return v(1845,null,t[0],t[1]);case 3:return v(1846,null,t[0],t[1],t[2]);default:return}}var Rb=v(1847,null),Cb=v(1848,null),lr=class id{constructor(){this.c="",this.d=0,this.e=0,this.f=[],this.g=[],this.m=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy}static getLexeme(e){switch(e.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return e.isTripleEq?"===":"==";case 4:return e.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return e.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return e.lexeme;case 18:return e.lexeme;case 19:return e.lexeme;case 20:return"EOF";default:throw Dc(`unhandled token type: ${JSON.stringify(e)}; have you forgotten to add a case?`)}}static{this.a=new Set(["i","g","s","m","y","u"].map(e=>e.charCodeAt(0)))}static{this.b=new Map([["not",14],["in",13],["false",12],["true",11]])}get errors(){return this.g}reset(e){return this.c=e,this.d=0,this.e=0,this.f=[],this.g=[],this}scan(){for(;!this.r();)switch(this.d=this.e,this.i()){case 40:this.k(0);break;case 41:this.k(1);break;case 33:if(this.h(61)){const s=this.h(61);this.f.push({type:4,offset:this.d,isTripleEq:s})}else this.k(2);break;case 39:this.o();break;case 47:this.q();break;case 61:if(this.h(61)){const s=this.h(61);this.f.push({type:3,offset:this.d,isTripleEq:s})}else this.h(126)?this.k(9):this.l(ll("==","=~"));break;case 60:this.k(this.h(61)?6:5);break;case 62:this.k(this.h(61)?8:7);break;case 38:this.h(38)?this.k(15):this.l(ll("&&"));break;case 124:this.h(124)?this.k(16):this.l(ll("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this.n()}return this.d=this.e,this.k(20),Array.from(this.f)}h(e){return this.r()||this.c.charCodeAt(this.e)!==e?!1:(this.e++,!0)}i(){return this.c.charCodeAt(this.e++)}j(){return this.r()?0:this.c.charCodeAt(this.e)}k(e){this.f.push({type:e,offset:this.d})}l(e){const s=this.d,i=this.c.substring(this.d,this.e),n={type:19,offset:this.d,lexeme:i};this.g.push({offset:s,lexeme:i,additionalInfo:e}),this.f.push(n)}n(){this.m.lastIndex=this.d;const e=this.m.exec(this.c);if(e){this.e=this.d+e[0].length;const s=this.c.substring(this.d,this.e),i=id.b.get(s);i?this.k(i):this.f.push({type:17,lexeme:s,offset:this.d})}}o(){for(;this.j()!==39&&!this.r();)this.i();if(this.r()){this.l(Rb);return}this.i(),this.f.push({type:18,lexeme:this.c.substring(this.d+1,this.e-1),offset:this.d+1})}q(){let e=this.e,s=!1,i=!1;for(;;){if(e>=this.c.length){this.e=e,this.l(Cb);return}const r=this.c.charCodeAt(e);if(s)s=!1;else if(r===47&&!i){e++;break}else r===91?i=!0:r===92?s=!0:r===93&&(i=!1);e++}for(;e<this.c.length&&id.a.has(this.c.charCodeAt(e));)e++;this.e=e;const n=this.c.substring(this.d,this.e);this.f.push({type:10,lexeme:n,offset:this.d})}r(){return this.e>=this.c.length}},ds;(function(t){t.serviceIds=new Map,t.DI_TARGET="$di$target",t.DI_DEPENDENCIES="$di$dependencies";function e(s){return s[t.DI_DEPENDENCIES]||[]}t.getServiceDependencies=e})(ds||(ds={}));var is=W("instantiationService");function Db(t,e,s){e[ds.DI_TARGET]===e?e[ds.DI_DEPENDENCIES].push({id:t,index:s}):(e[ds.DI_DEPENDENCIES]=[{id:t,index:s}],e[ds.DI_TARGET]=e)}function W(t){if(ds.serviceIds.has(t))return ds.serviceIds.get(t);const e=function(s,i,n){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");Db(e,s,n)};return e.toString=()=>t,ds.serviceIds.set(t,e),e}function TS(t){return t}var at=new Map;at.set("false",!1),at.set("true",!0),at.set("isMac",vs),at.set("isLinux",wt),at.set("isWindows",Ae),at.set("isWeb",ot),at.set("isMacNative",vs&&!ot),at.set("isEdge",Wd),at.set("isFirefox",Vd),at.set("isChrome",_c),at.set("isSafari",qd);var Ib=Object.prototype.hasOwnProperty,Z1;(function(t){t[t.False=0]="False",t[t.True=1]="True",t[t.Defined=2]="Defined",t[t.Not=3]="Not",t[t.Equals=4]="Equals",t[t.NotEquals=5]="NotEquals",t[t.And=6]="And",t[t.Regex=7]="Regex",t[t.NotRegex=8]="NotRegex",t[t.Or=9]="Or",t[t.In=10]="In",t[t.NotIn=11]="NotIn",t[t.Greater=12]="Greater",t[t.GreaterEquals=13]="GreaterEquals",t[t.Smaller=14]="Smaller",t[t.SmallerEquals=15]="SmallerEquals"})(Z1||(Z1={}));var Ob={regexParsingWithErrorRecovery:!0},Lb=v(1823,null),Ab=v(1824,null),Nb=v(1825,null),Y1=v(1826,null),jb=v(1827,null),Tb=v(1828,null),Mb=v(1829,null),Fb=v(1830,null),Ub=class to{static{this.c=new Error}get lexingErrors(){return this.d.errors}get parsingErrors(){return this.h}constructor(e=Ob){this.k=e,this.d=new lr,this.f=[],this.g=0,this.h=[],this.v=/g|y/g}parse(e){if(e===""){this.h.push({message:Lb,offset:0,lexeme:"",additionalInfo:Ab});return}this.f=this.d.reset(e).scan(),this.g=0,this.h=[];try{const s=this.l();if(!this.E()){const i=this.D(),n=i.type===17?Tb:void 0;throw this.h.push({message:jb,offset:i.offset,lexeme:lr.getLexeme(i),additionalInfo:n}),to.c}return s}catch(s){if(s!==to.c)throw s;return}}l(){return this.m()}m(){const e=[this.o()];for(;this.y(16);){const s=this.o();e.push(s)}return e.length===1?e[0]:ut.or(...e)}o(){const e=[this.s()];for(;this.y(15);){const s=this.s();e.push(s)}return e.length===1?e[0]:ut.and(...e)}s(){if(this.y(2)){const e=this.D();switch(e.type){case 11:return this.z(),It.INSTANCE;case 12:return this.z(),zt.INSTANCE;case 0:{this.z();const s=this.l();return this.A(1,Y1),s?.negate()}case 17:return this.z(),fr.create(e.lexeme);default:throw this.B("KEY | true | false | '(' expression ')'",e)}}return this.t()}t(){const e=this.D();switch(e.type){case 11:return this.z(),ut.true();case 12:return this.z(),ut.false();case 0:{this.z();const s=this.l();return this.A(1,Y1),s}case 17:{const s=e.lexeme;if(this.z(),this.y(9)){const n=this.D();if(!this.k.regexParsingWithErrorRecovery){if(this.z(),n.type!==10)throw this.B("REGEX",n);const r=n.lexeme,o=r.lastIndexOf("/"),a=o===r.length-1?void 0:this.w(r.substring(o+1));let c;try{c=new RegExp(r.substring(1,o),a)}catch{throw this.B("REGEX",n)}return gl.create(s,c)}switch(n.type){case 10:case 19:{const r=[n.lexeme];this.z();let o=this.D(),a=0;for(let f=0;f<n.lexeme.length;f++)n.lexeme.charCodeAt(f)===40?a++:n.lexeme.charCodeAt(f)===41&&a--;for(;!this.E()&&o.type!==15&&o.type!==16;){switch(o.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let f=0;f<o.lexeme.length;f++)o.lexeme.charCodeAt(f)===40?a++:n.lexeme.charCodeAt(f)===41&&a--}if(a<0)break;r.push(lr.getLexeme(o)),this.z(),o=this.D()}const c=r.join(""),l=c.lastIndexOf("/"),h=l===c.length-1?void 0:this.w(c.substring(l+1));let u;try{u=new RegExp(c.substring(1,l),h)}catch{throw this.B("REGEX",n)}return ut.regex(s,u)}case 18:{const r=n.lexeme;this.z();let o=null;if(!Ry(r)){const a=r.indexOf("/"),c=r.lastIndexOf("/");if(a!==c&&a>=0){const l=r.slice(a+1,c),h=r[c+1]==="i"?"i":"";try{o=new RegExp(l,h)}catch{throw this.B("REGEX",n)}}}if(o===null)throw this.B("REGEX",n);return gl.create(s,o)}default:throw this.B("REGEX",this.D())}}if(this.y(14)){this.A(13,Nb);const n=this.u();return ut.notIn(s,n)}switch(this.D().type){case 3:{this.z();const n=this.u();if(this.x().type===18)return ut.equals(s,n);switch(n){case"true":return ut.has(s);case"false":return ut.not(s);default:return ut.equals(s,n)}}case 4:{this.z();const n=this.u();if(this.x().type===18)return ut.notEquals(s,n);switch(n){case"true":return ut.not(s);case"false":return ut.has(s);default:return ut.notEquals(s,n)}}case 5:return this.z(),dl.create(s,this.u());case 6:return this.z(),pl.create(s,this.u());case 7:return this.z(),jo.create(s,this.u());case 8:return this.z(),fl.create(s,this.u());case 13:return this.z(),ut.in(s,this.u());default:return ut.has(s)}}case 20:throw this.h.push({message:Mb,offset:e.offset,lexeme:"",additionalInfo:Fb}),to.c;default:throw this.B(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this.D())}}u(){const e=this.D();switch(e.type){case 17:case 18:return this.z(),e.lexeme;case 11:return this.z(),"true";case 12:return this.z(),"false";case 13:return this.z(),"in";default:return""}}w(e){return e.replaceAll(this.v,"")}x(){return this.f[this.g-1]}y(e){return this.C(e)?(this.z(),!0):!1}z(){return this.E()||this.g++,this.x()}A(e,s){if(this.C(e))return this.z();throw this.B(s,this.D())}B(e,s,i){const n=v(1831,null,e,lr.getLexeme(s)),r=s.offset,o=lr.getLexeme(s);return this.h.push({message:n,offset:r,lexeme:o,additionalInfo:i}),to.c}C(e){return this.D().type===e}D(){return this.f[this.g]}E(){return this.D().type===20}},ut=class{static false(){return It.INSTANCE}static true(){return zt.INSTANCE}static has(t){return ur.create(t)}static equals(t,e){return hl.create(t,e)}static notEquals(t,e){return ul.create(t,e)}static regex(t,e){return gl.create(t,e)}static in(t,e){return ep.create(t,e)}static notIn(t,e){return tp.create(t,e)}static not(t){return fr.create(t)}static and(...t){return ip.create(t,null,!0)}static or(...t){return ml.create(t,null,!0)}static greater(t,e){return jo.create(t,e)}static greaterEquals(t,e){return fl.create(t,e)}static smaller(t,e){return dl.create(t,e)}static smallerEquals(t,e){return pl.create(t,e)}static{this.c=new Ub({regexParsingWithErrorRecovery:!1})}static deserialize(t){return t==null?void 0:this.c.parse(t)}};function hr(t,e){return t.cmp(e)}var It=class Xw{static{this.INSTANCE=new Xw}constructor(){this.type=0}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!1}serialize(){return"false"}keys(){return[]}map(e){return this}negate(){return zt.INSTANCE}},zt=class Zw{static{this.INSTANCE=new Zw}constructor(){this.type=1}cmp(e){return this.type-e.type}equals(e){return e.type===this.type}substituteConstants(){return this}evaluate(e){return!0}serialize(){return"true"}keys(){return[]}map(e){return this}negate(){return It.INSTANCE}},ur=class Yw{static create(e,s=null){const i=at.get(e);return typeof i=="boolean"?i?zt.INSTANCE:It.INSTANCE:new Yw(e,s)}constructor(e,s){this.key=e,this.c=s,this.type=2}cmp(e){return e.type!==this.type?this.type-e.type:np(this.key,e.key)}equals(e){return e.type===this.type?this.key===e.key:!1}substituteConstants(){const e=at.get(this.key);return typeof e=="boolean"?e?zt.INSTANCE:It.INSTANCE:this}evaluate(e){return!!e.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(e){return e.mapDefined(this.key)}negate(){return this.c||(this.c=fr.create(this.key,this)),this.c}},hl=class ev{static create(e,s,i=null){if(typeof s=="boolean")return s?ur.create(e,i):fr.create(e,i);const n=at.get(e);return typeof n=="boolean"?s===(n?"true":"false")?zt.INSTANCE:It.INSTANCE:new ev(e,s,i)}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=4}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){const e=at.get(this.c);if(typeof e=="boolean"){const s=e?"true":"false";return this.d===s?zt.INSTANCE:It.INSTANCE}return this}evaluate(e){return e.getValue(this.c)==this.d}serialize(){return`${this.c} == '${this.d}'`}keys(){return[this.c]}map(e){return e.mapEquals(this.c,this.d)}negate(){return this.f||(this.f=ul.create(this.c,this.d,this)),this.f}},ep=class tv{static create(e,s){return new tv(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=10,this.c=null}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.d,this.f,e.d,e.f)}equals(e){return e.type===this.type?this.d===e.d&&this.f===e.f:!1}substituteConstants(){return this}evaluate(e){const s=e.getValue(this.f),i=e.getValue(this.d);return Array.isArray(s)?s.includes(i):typeof i=="string"&&typeof s=="object"&&s!==null?Ib.call(s,i):!1}serialize(){return`${this.d} in '${this.f}'`}keys(){return[this.d,this.f]}map(e){return e.mapIn(this.d,this.f)}negate(){return this.c||(this.c=tp.create(this.d,this.f)),this.c}},tp=class sv{static create(e,s){return new sv(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=11,this.c=ep.create(e,s)}cmp(e){return e.type!==this.type?this.type-e.type:this.c.cmp(e.c)}equals(e){return e.type===this.type?this.c.equals(e.c):!1}substituteConstants(){return this}evaluate(e){return!this.c.evaluate(e)}serialize(){return`${this.d} not in '${this.f}'`}keys(){return this.c.keys()}map(e){return e.mapNotIn(this.d,this.f)}negate(){return this.c}},ul=class iv{static create(e,s,i=null){if(typeof s=="boolean")return s?fr.create(e,i):ur.create(e,i);const n=at.get(e);return typeof n=="boolean"?s===(n?"true":"false")?It.INSTANCE:zt.INSTANCE:new iv(e,s,i)}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=5}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){const e=at.get(this.c);if(typeof e=="boolean"){const s=e?"true":"false";return this.d===s?It.INSTANCE:zt.INSTANCE}return this}evaluate(e){return e.getValue(this.c)!=this.d}serialize(){return`${this.c} != '${this.d}'`}keys(){return[this.c]}map(e){return e.mapNotEquals(this.c,this.d)}negate(){return this.f||(this.f=hl.create(this.c,this.d,this)),this.f}},fr=class nv{static create(e,s=null){const i=at.get(e);return typeof i=="boolean"?i?It.INSTANCE:zt.INSTANCE:new nv(e,s)}constructor(e,s){this.c=e,this.d=s,this.type=3}cmp(e){return e.type!==this.type?this.type-e.type:np(this.c,e.c)}equals(e){return e.type===this.type?this.c===e.c:!1}substituteConstants(){const e=at.get(this.c);return typeof e=="boolean"?e?It.INSTANCE:zt.INSTANCE:this}evaluate(e){return!e.getValue(this.c)}serialize(){return`!${this.c}`}keys(){return[this.c]}map(e){return e.mapNot(this.c)}negate(){return this.d||(this.d=ur.create(this.c,this)),this.d}};function No(t,e){if(typeof t=="string"){const s=parseFloat(t);isNaN(s)||(t=s)}return typeof t=="string"||typeof t=="number"?e(t):It.INSTANCE}var jo=class rv{static create(e,s,i=null){return No(s,n=>new rv(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=12}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))>this.d}serialize(){return`${this.c} > ${this.d}`}keys(){return[this.c]}map(e){return e.mapGreater(this.c,this.d)}negate(){return this.f||(this.f=pl.create(this.c,this.d,this)),this.f}},fl=class ov{static create(e,s,i=null){return No(s,n=>new ov(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=13}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))>=this.d}serialize(){return`${this.c} >= ${this.d}`}keys(){return[this.c]}map(e){return e.mapGreaterEquals(this.c,this.d)}negate(){return this.f||(this.f=dl.create(this.c,this.d,this)),this.f}},dl=class av{static create(e,s,i=null){return No(s,n=>new av(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=14}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))<this.d}serialize(){return`${this.c} < ${this.d}`}keys(){return[this.c]}map(e){return e.mapSmaller(this.c,this.d)}negate(){return this.f||(this.f=fl.create(this.c,this.d,this)),this.f}},pl=class cv{static create(e,s,i=null){return No(s,n=>new cv(e,n,i))}constructor(e,s,i){this.c=e,this.d=s,this.f=i,this.type=15}cmp(e){return e.type!==this.type?this.type-e.type:ji(this.c,this.d,e.c,e.d)}equals(e){return e.type===this.type?this.c===e.c&&this.d===e.d:!1}substituteConstants(){return this}evaluate(e){return typeof this.d=="string"?!1:parseFloat(e.getValue(this.c))<=this.d}serialize(){return`${this.c} <= ${this.d}`}keys(){return[this.c]}map(e){return e.mapSmallerEquals(this.c,this.d)}negate(){return this.f||(this.f=jo.create(this.c,this.d,this)),this.f}},gl=class lv{static create(e,s){return new lv(e,s)}constructor(e,s){this.d=e,this.f=s,this.type=7,this.c=null}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.d<e.d)return-1;if(this.d>e.d)return 1;const s=this.f?this.f.source:"",i=e.f?e.f.source:"";return s<i?-1:s>i?1:0}equals(e){if(e.type===this.type){const s=this.f?this.f.source:"",i=e.f?e.f.source:"";return this.d===e.d&&s===i}return!1}substituteConstants(){return this}evaluate(e){const s=e.getValue(this.d);return this.f?this.f.test(s):!1}serialize(){const e=this.f?`/${this.f.source}/${this.f.flags}`:"/invalid/";return`${this.d} =~ ${e}`}keys(){return[this.d]}map(e){return e.mapRegex(this.d,this.f)}negate(){return this.c||(this.c=Bb.create(this)),this.c}},Bb=class nd{static create(e){return new nd(e)}constructor(e){this.c=e,this.type=8}cmp(e){return e.type!==this.type?this.type-e.type:this.c.cmp(e.c)}equals(e){return e.type===this.type?this.c.equals(e.c):!1}substituteConstants(){return this}evaluate(e){return!this.c.evaluate(e)}serialize(){return`!(${this.c.serialize()})`}keys(){return this.c.keys()}map(e){return new nd(this.c.map(e))}negate(){return this.c}};function sp(t){let e=null;for(let s=0,i=t.length;s<i;s++){const n=t[s].substituteConstants();if(t[s]!==n&&e===null){e=[];for(let r=0;r<s;r++)e[r]=t[r]}e!==null&&(e[s]=n)}return e===null?t:e}var ip=class zn{static create(e,s,i){return zn.d(e,s,i)}constructor(e,s){this.expr=e,this.c=s,this.type=6}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let s=0,i=this.expr.length;s<i;s++){const n=hr(this.expr[s],e.expr[s]);if(n!==0)return n}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].equals(e.expr[s]))return!1;return!0}return!1}substituteConstants(){const e=sp(this.expr);return e===this.expr?this:zn.create(e,this.c,!1)}evaluate(e){for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].evaluate(e))return!1;return!0}static d(e,s,i){const n=[];let r=!1;for(const o of e)if(o){if(o.type===1){r=!0;continue}if(o.type===0)return It.INSTANCE;if(o.type===6){n.push(...o.expr);continue}n.push(o)}if(n.length===0&&r)return zt.INSTANCE;if(n.length!==0){if(n.length===1)return n[0];n.sort(hr);for(let o=1;o<n.length;o++)n[o-1].equals(n[o])&&(n.splice(o,1),o--);if(n.length===1)return n[0];for(;n.length>1;){const o=n[n.length-1];if(o.type!==9)break;n.pop();const a=n.pop(),c=n.length===0,l=ml.create(o.expr.map(h=>zn.create([h,a],null,i)),null,c);l&&(n.push(l),n.sort(hr))}if(n.length===1)return n[0];if(i){for(let o=0;o<n.length;o++)for(let a=o+1;a<n.length;a++)if(n[o].negate().equals(n[a]))return It.INSTANCE;if(n.length===1)return n[0]}return new zn(n,s)}}serialize(){return this.expr.map(e=>e.serialize()).join(" && ")}keys(){const e=[];for(const s of this.expr)e.push(...s.keys());return e}map(e){return new zn(this.expr.map(s=>s.map(e)),null)}negate(){if(!this.c){const e=[];for(const s of this.expr)e.push(s.negate());this.c=ml.create(e,this,!0)}return this.c}},ml=class Xi{static create(e,s,i){return Xi.d(e,s,i)}constructor(e,s){this.expr=e,this.c=s,this.type=9}cmp(e){if(e.type!==this.type)return this.type-e.type;if(this.expr.length<e.expr.length)return-1;if(this.expr.length>e.expr.length)return 1;for(let s=0,i=this.expr.length;s<i;s++){const n=hr(this.expr[s],e.expr[s]);if(n!==0)return n}return 0}equals(e){if(e.type===this.type){if(this.expr.length!==e.expr.length)return!1;for(let s=0,i=this.expr.length;s<i;s++)if(!this.expr[s].equals(e.expr[s]))return!1;return!0}return!1}substituteConstants(){const e=sp(this.expr);return e===this.expr?this:Xi.create(e,this.c,!1)}evaluate(e){for(let s=0,i=this.expr.length;s<i;s++)if(this.expr[s].evaluate(e))return!0;return!1}static d(e,s,i){let n=[],r=!1;if(e){for(let o=0,a=e.length;o<a;o++){const c=e[o];if(c){if(c.type===0){r=!0;continue}if(c.type===1)return zt.INSTANCE;if(c.type===9){n=n.concat(c.expr);continue}n.push(c)}}if(n.length===0&&r)return It.INSTANCE;n.sort(hr)}if(n.length!==0){if(n.length===1)return n[0];for(let o=1;o<n.length;o++)n[o-1].equals(n[o])&&(n.splice(o,1),o--);if(n.length===1)return n[0];if(i){for(let o=0;o<n.length;o++)for(let a=o+1;a<n.length;a++)if(n[o].negate().equals(n[a]))return zt.INSTANCE;if(n.length===1)return n[0]}return new Xi(n,s)}}serialize(){return this.expr.map(e=>e.serialize()).join(" || ")}keys(){const e=[];for(const s of this.expr)e.push(...s.keys());return e}map(e){return new Xi(this.expr.map(s=>s.map(e)),null)}negate(){if(!this.c){const e=[];for(const s of this.expr)e.push(s.negate());for(;e.length>1;){const s=e.shift(),i=e.shift(),n=[];for(const r of rp(s))for(const o of rp(i))n.push(ip.create([r,o],null,!1));e.unshift(Xi.create(n,null,!1))}this.c=Xi.create(e,this,!0)}return this.c}},zb=class bc extends ur{static{this.d=[]}static all(){return bc.d.values()}constructor(e,s,i){super(e,null),this.f=s,typeof i=="object"?bc.d.push({...i,key:e}):i!==!0&&bc.d.push({key:e,description:i,type:s!=null?typeof s:void 0})}bindTo(e){return e.createKey(this.key,this.f)}getValue(e){return e.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(e){return hl.create(this.key,e)}notEqualsTo(e){return ul.create(this.key,e)}greater(e){return jo.create(this.key,e)}},MS=W("contextKeyService");function np(t,e){return t<e?-1:t>e?1:0}function ji(t,e,s,i){return t<s?-1:t>s?1:e<i?-1:e>i?1:0}function rp(t){return t.type===9?t.expr:[t]}var Y=W("logService"),dr=W("loggerService");function _b(t){return Nc(t)}var ie;(function(t){t[t.Off=0]="Off",t[t.Trace=1]="Trace",t[t.Debug=2]="Debug",t[t.Info=3]="Info",t[t.Warning=4]="Warning",t[t.Error=5]="Error"})(ie||(ie={}));var wl=ie.Info;function Vb(t,e){return t!==ie.Off&&t<=e}function yn(t,e=!1){let s="";for(let i=0;i<t.length;i++){let n=t[i];if(n instanceof Error&&(n=Qt(n,e)),typeof n=="object")try{n=JSON.stringify(n)}catch{}s+=(i>0?" ":"")+n}return s}var pr=class extends T{constructor(){super(...arguments),this.b=wl,this.c=this.B(new R)}get onDidChangeLogLevel(){return this.c.event}setLevel(t){this.b!==t&&(this.b=t,this.c.fire(this.b))}getLevel(){return this.b}f(t){return Vb(this.b,t)}g(t){return this.q.isDisposed?!1:this.f(t)}},qb=class extends pr{constructor(t){super(),this.h=t}f(t){return this.h||super.f(t)}trace(t,...e){this.g(ie.Trace)&&this.m(ie.Trace,yn([t,...e],!0))}debug(t,...e){this.g(ie.Debug)&&this.m(ie.Debug,yn([t,...e]))}info(t,...e){this.g(ie.Info)&&this.m(ie.Info,yn([t,...e]))}warn(t,...e){this.g(ie.Warning)&&this.m(ie.Warning,yn([t,...e]))}error(t,...e){if(this.g(ie.Error))if(t instanceof Error){const s=Array.prototype.slice.call(arguments);s[0]=t.stack,this.m(ie.Error,yn(s))}else this.m(ie.Error,yn([t,...e]))}flush(){}},Wb=class extends pr{constructor(t=wl,e=!0){super(),this.h=e,this.setLevel(t)}trace(t,...e){this.g(ie.Trace)&&(this.h?console.log("%cTRACE","color: #888",t,...e):console.log(t,...e))}debug(t,...e){this.g(ie.Debug)&&(this.h?console.log("%cDEBUG","background: #eee; color: #888",t,...e):console.log(t,...e))}info(t,...e){this.g(ie.Info)&&(this.h?console.log("%c INFO","color: #33f",t,...e):console.log(t,...e))}warn(t,...e){this.g(ie.Warning)&&(this.h?console.warn("%c WARN","color: #993",t,...e):console.log(t,...e))}error(t,...e){this.g(ie.Error)&&(this.h?console.error("%c  ERR","color: #f33",t,...e):console.error(t,...e))}flush(){}},Hb=class extends pr{constructor(t,e=wl){super(),this.h=t,this.setLevel(e)}trace(t,...e){this.g(ie.Trace)&&this.h.log(ie.Trace,[this.j(t),...e])}debug(t,...e){this.g(ie.Debug)&&this.h.log(ie.Debug,[this.j(t),...e])}info(t,...e){this.g(ie.Info)&&this.h.log(ie.Info,[this.j(t),...e])}warn(t,...e){this.g(ie.Warning)&&this.h.log(ie.Warning,[this.j(t),...e])}error(t,...e){this.g(ie.Error)&&this.h.log(ie.Error,[this.j(t),...e])}j(t){return typeof t=="string"?t:Qt(t,this.g(ie.Trace))}flush(){}},Gb=class extends pr{constructor(t){super(),this.h=t,t.length&&this.setLevel(t[0].getLevel())}setLevel(t){for(const e of this.h)e.setLevel(t);super.setLevel(t)}trace(t,...e){for(const s of this.h)s.trace(t,...e)}debug(t,...e){for(const s of this.h)s.debug(t,...e)}info(t,...e){for(const s of this.h)s.info(t,...e)}warn(t,...e){for(const s of this.h)s.warn(t,...e)}error(t,...e){for(const s of this.h)s.error(t,...e)}flush(){for(const t of this.h)t.flush()}dispose(){for(const t of this.h)t.dispose();super.dispose()}},Jb=class extends T{constructor(t,e,s){if(super(),this.j=t,this.m=e,this.b=new lt,this.f=this.B(new R),this.onDidChangeLoggers=this.f.event,this.g=this.B(new R),this.onDidChangeLogLevel=this.g.event,this.h=this.B(new R),this.onDidChangeVisibility=this.h.event,s)for(const i of s)this.b.set(i.resource,{logger:void 0,info:i})}n(t){return $e(t)?[...this.b.values()].find(e=>e.info.id===t):this.b.get(t)}getLogger(t){return this.n(t)?.logger}createLogger(t,e){const s=this.s(t),i=$e(t)?t:e?.id??vn(s.toString()).toString(16);let n=this.b.get(s)?.logger;const r=e?.logLevel==="always"?ie.Trace:e?.logLevel;n||(n=this.t(s,r??this.getLogLevel(s)??this.j,{...e,id:i}));const o={logger:n,info:{resource:s,id:i,logLevel:r,name:e?.name,hidden:e?.hidden,group:e?.group,extensionId:e?.extensionId,when:e?.when}};return this.registerLogger(o.info),this.b.set(s,o),n}s(t){return $e(t)?_(this.m,`${t}.log`):t}setLogLevel(t,e){if(k.isUri(t)){const s=t,i=e,n=this.b.get(s);n&&i!==n.info.logLevel&&(n.info.logLevel=i===this.j?void 0:i,n.logger?.setLevel(i),this.b.set(n.info.resource,n),this.g.fire([s,i]))}else{this.j=t;for(const[s,i]of this.b.entries())this.b.get(s)?.info.logLevel===void 0&&i.logger?.setLevel(this.j);this.g.fire(this.j)}}setVisibility(t,e){const s=this.n(t);s&&e!==!s.info.hidden&&(s.info.hidden=!e,this.b.set(s.info.resource,s),this.h.fire([s.info.resource,e]))}getLogLevel(t){let e;return t&&(e=this.b.get(t)?.info.logLevel),e??this.j}registerLogger(t){const e=this.b.get(t.resource);e?e.info.hidden!==t.hidden&&this.setVisibility(t.resource,!t.hidden):(this.b.set(t.resource,{info:t,logger:void 0}),this.f.fire({added:[t],removed:[]}))}deregisterLogger(t){const e=this.s(t),s=this.b.get(e);s&&(s.logger&&s.logger.dispose(),this.b.delete(e),this.f.fire({added:[],removed:[s.info]}))}*getRegisteredLoggers(){for(const t of this.b.values())yield t.info}getRegisteredLogger(t){return this.b.get(t)?.info}dispose(){this.b.forEach(t=>t.logger?.dispose()),this.b.clear(),super.dispose()}},Kb=class{constructor(){this.onDidChangeLogLevel=new R().event}setLevel(t){}getLevel(){return ie.Info}trace(t,...e){}debug(t,...e){}info(t,...e){}warn(t,...e){}error(t,...e){}critical(t,...e){}dispose(){}flush(){}},Qb=class extends Kb{};function To(t){switch(t){case ie.Trace:return"trace";case ie.Debug:return"debug";case ie.Info:return"info";case ie.Warning:return"warn";case ie.Error:return"error";case ie.Off:return"off"}}var FS=new zb("logLevel",To(ie.Info)),pe=W("productService"),vl=class extends T{constructor(e,s,i){super(),this.b=i,this.a=s.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3,e&&this.B(new fs(()=>{this.c(e)},3e4)).schedule()}async c(e){this.b.trace("[code cache cleanup]: Starting to clean up old code cache folders.");try{const s=Date.now(),i=Zt(e),n=Ct(e),r=await le.readdir(i);await Promise.all(r.map(async o=>{if(o===n)return;const a=J(i,o),c=await nb.stat(a);if(c.isDirectory()&&s-c.mtime.getTime()>this.a)return this.b.trace(`[code cache cleanup]: Removing code cache folder ${o}.`),le.rm(a)}))}catch(s){it(s)}}};vl=__decorate([__param(1,pe),__param(2,Y)],vl);import{promises as op}from"fs";var ae=W("environmentService"),_t=ae,yl=class extends T{constructor(e,s,i){super(),this.b=e,this.c=s,this.a=i.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3,this.b.isBuilt&&this.B(new fs(()=>{this.f()},4e4)).schedule()}async f(){this.c.trace("[language pack cache cleanup]: Starting to clean up unused language packs.");try{const e=Object.create(null),s=JSON.parse(await op.readFile(J(this.b.userDataPath,"languagepacks.json"),"utf8"));for(const a of Object.keys(s)){const c=s[a];e[`${c.hash}.${a}`]=!0}const i=J(this.b.userDataPath,"clp");if(!await le.exists(i))return;const r=await le.readdir(i);for(const a of r){if(e[a]){this.c.trace(`[language pack cache cleanup]: Skipping folder ${a}. Language pack still in use.`);continue}this.c.trace(`[language pack cache cleanup]: Removing unused language pack: ${a}`),await le.rm(J(i,a))}const o=Date.now();for(const a of Object.keys(e)){const c=J(i,a),l=await le.readdir(c);for(const h of l){if(h==="tcf.json")continue;const u=J(c,h),f=await op.stat(u);f.isDirectory()&&o-f.mtime.getTime()>this.a&&(this.c.trace(`[language pack cache cleanup]: Removing language pack cache folder: ${J(a,h)}`),await le.rm(u))}}}catch(e){it(e)}}};yl=__decorate([__param(0,_t),__param(1,Y),__param(2,pe)],yl);var ge=W("configurationService");function bl(t){return t&&typeof t=="object"&&(!t.overrideIdentifier||typeof t.overrideIdentifier=="string")&&(!t.resource||t.resource instanceof k)}function Xb(t){return t&&typeof t=="object"&&(!t.overrideIdentifiers||Array.isArray(t.overrideIdentifiers))&&!t.overrideIdentifier&&(!t.resource||t.resource instanceof k)}var ap;(function(t){t[t.APPLICATION=1]="APPLICATION",t[t.USER=2]="USER",t[t.USER_LOCAL=3]="USER_LOCAL",t[t.USER_REMOTE=4]="USER_REMOTE",t[t.WORKSPACE=5]="WORKSPACE",t[t.WORKSPACE_FOLDER=6]="WORKSPACE_FOLDER",t[t.DEFAULT=7]="DEFAULT",t[t.MEMORY=8]="MEMORY"})(ap||(ap={}));function Zb(t){switch(t){case 1:return"APPLICATION";case 2:return"USER";case 3:return"USER_LOCAL";case 4:return"USER_REMOTE";case 5:return"WORKSPACE";case 6:return"WORKSPACE_FOLDER";case 7:return"DEFAULT";case 8:return"MEMORY"}}function Sl(t,e){const s=Object.create(null);for(const i in t)cp(s,i,t[i],e);return s}function cp(t,e,s,i){const n=e.split("."),r=n.pop();let o=t;for(let a=0;a<n.length;a++){const c=n[a];let l=o[c];switch(typeof l){case"undefined":l=o[c]=Object.create(null);break;case"object":if(l===null){i(`Ignoring ${e} as ${n.slice(0,a+1).join(".")} is null`);return}break;default:i(`Ignoring ${e} as ${n.slice(0,a+1).join(".")} is ${JSON.stringify(l)}`);return}o=l}if(typeof o=="object"&&o!==null)try{o[r]=s}catch{i(`Ignoring ${e} as ${n.join(".")} is ${JSON.stringify(o)}`)}else i(`Ignoring ${e} as ${n.join(".")} is ${JSON.stringify(o)}`)}function Yb(t,e){const s=e.split(".");lp(t,s)}function lp(t,e){if(!t)return;const s=e.shift();if(e.length===0){delete t[s];return}if(Object.keys(t).indexOf(s)!==-1){const i=t[s];typeof i=="object"&&!Array.isArray(i)&&(lp(i,e),Object.keys(i).length===0&&delete t[s])}}function Mo(t,e,s){function i(o,a){let c=o;for(const l of a){if(typeof c!="object"||c===null)return;c=c[l]}return c}const n=e.split("."),r=i(t,n);return typeof r>"u"?s:r}function e2(t){return t.replace(/^\[/,"").replace(/]$/g,"").replace(/\]\[/g,", ")}function t2(t){let e=!1;const s=new Map,i=new Map;if(s2(t,h=>{if(t===h)return!0;const u=JSON.stringify(h);if(u.length<30)return!0;const f=s.get(u);if(!f){const p={schemas:[h]};return s.set(u,p),i.set(h,p),!0}return f.schemas.push(h),i.set(h,f),e=!0,!1}),s.clear(),!e)return JSON.stringify(t);let r="$defs";for(;t.hasOwnProperty(r);)r+="_";const o=[];function a(h){return JSON.stringify(h,(u,f)=>{if(f!==h){const p=i.get(f);if(p&&p.schemas.length>1)return p.id||(p.id=`_${o.length}`,o.push(p.schemas[0])),{$ref:`#/${r}/${p.id}`}}return f})}const c=a(t),l=[];for(let h=0;h<o.length;h++)l.push(`"_${h}":${a(o[h])}`);return l.length?`${c.substring(0,c.length-1)},"${r}":{${l.join(",")}}}`:c}function bn(t){return typeof t=="object"&&t!==null}function s2(t,e){if(!t||typeof t!="object")return;const s=(...c)=>{for(const l of c)bn(l)&&o.push(l)},i=(...c)=>{for(const l of c)if(bn(l))for(const h in l){const u=l[h];bn(u)&&o.push(u)}},n=(...c)=>{for(const l of c)if(Array.isArray(l))for(const h of l)bn(h)&&o.push(h)},r=c=>{if(Array.isArray(c))for(const l of c)bn(l)&&o.push(l);else bn(c)&&o.push(c)},o=[t];let a=o.pop();for(;a;)e(a)&&(s(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),i(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),n(a.anyOf,a.allOf,a.oneOf,a.prefixItems),r(a.items)),a=o.pop()}var i2=class{constructor(){this.a=new Map}add(t,e){Lc($e(t)),Lc(Be(e)),Lc(!this.a.has(t),"There is already an extension with this id"),this.a.set(t,e)}knows(t){return this.a.has(t)}as(t){return this.a.get(t)||null}dispose(){this.a.forEach(t=>{jc(t.dispose)&&t.dispose()}),this.a.clear()}},Ot=new i2,El={JSONContribution:"base.contributions.json"};function hp(t){return t.length>0&&t.charAt(t.length-1)==="#"?t.substring(0,t.length-1):t}var n2=class extends T{constructor(){super(...arguments),this.a={},this.b={},this.c=this.B(new R),this.onDidChangeSchema=this.c.event,this.f=this.B(new R),this.onDidChangeSchemaAssociations=this.f.event}registerSchema(t,e,s){const i=hp(t);this.a[i]=e,this.c.fire(t),s&&s.add(de(()=>{delete this.a[i],this.c.fire(t)}))}registerSchemaAssociation(t,e){const s=hp(t);return this.b[s]||(this.b[s]=[]),this.b[s].includes(e)||(this.b[s].push(e),this.f.fire()),de(()=>{const i=this.b[s];if(i){const n=i.indexOf(e);n!==-1&&(i.splice(n,1),i.length===0&&delete this.b[s],this.f.fire())}})}notifySchemaChanged(t){this.c.fire(t)}getSchemaContributions(){return{schemas:this.a}}getSchemaContent(t){const e=this.a[t];return e?t2(e):void 0}hasSchemaContent(t){return!!this.a[t]}getSchemaAssociations(){return this.b}},r2=new n2;Ot.add(El.JSONContribution,r2);var up;(function(t){t.Multiline="multilineText",t.Singleline="singlelineText"})(up||(up={}));var ns={Configuration:"base.contributions.configuration"},fp;(function(t){t[t.APPLICATION=1]="APPLICATION",t[t.MACHINE=2]="MACHINE",t[t.APPLICATION_MACHINE=3]="APPLICATION_MACHINE",t[t.WINDOW=4]="WINDOW",t[t.RESOURCE=5]="RESOURCE",t[t.LANGUAGE_OVERRIDABLE=6]="LANGUAGE_OVERRIDABLE",t[t.MACHINE_OVERRIDABLE=7]="MACHINE_OVERRIDABLE"})(fp||(fp={}));var gr={properties:{},patternProperties:{}},Fo={properties:{},patternProperties:{}},Uo={properties:{},patternProperties:{}},Bo={properties:{},patternProperties:{}},zo={properties:{},patternProperties:{}},_o={properties:{},patternProperties:{}},mr={properties:{},patternProperties:{}},Ti="vscode://schemas/settings/resourceLanguage",Vo=Ot.as(El.JSONContribution),o2=class extends T{constructor(){super(),this.a=[],this.n=new Set,this.r=this.B(new R),this.onDidSchemaChange=this.r.event,this.s=this.B(new R),this.onDidUpdateConfiguration=this.s.event,this.b=new Map,this.c={id:"defaultOverrides",title:v(1812,null),properties:{}},this.f=[this.c],this.m={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.g={},this.h=new Map,this.j={},Vo.registerSchema(Ti,this.m),this.N()}registerConfiguration(t,e=!0){return this.registerConfigurations([t],e),t}registerConfigurations(t,e=!0){const s=new Set;this.F(t,e,s),Vo.registerSchema(Ti,this.m),this.r.fire(),this.s.fire({properties:s})}deregisterConfigurations(t){const e=new Set;this.G(t,e),Vo.registerSchema(Ti,this.m),this.r.fire(),this.s.fire({properties:e})}updateConfigurations({add:t,remove:e}){const s=new Set;this.G(e,s),this.F(t,!1,s),Vo.registerSchema(Ti,this.m),this.r.fire(),this.s.fire({properties:s})}registerDefaultConfigurations(t){const e=new Set;this.u(t,e),this.r.fire(),this.s.fire({properties:e,defaultsOverrides:!0})}u(t,e){this.a.push(...t);const s=[];for(const{overrides:i,source:n}of t)for(const r in i){e.add(r);const o=this.b.get(r)??this.b.set(r,{configurationDefaultOverrides:[]}).get(r),a=i[r];if(o.configurationDefaultOverrides.push({value:a,source:n}),qs.test(r)){const c=this.z(r,a,n,o.configurationDefaultOverrideValue);if(!c)continue;o.configurationDefaultOverrideValue=c,this.y(r,c,n),s.push(...wr(r))}else{const c=this.C(r,a,n,o.configurationDefaultOverrideValue);if(!c)continue;o.configurationDefaultOverrideValue=c;const l=this.g[r];l&&(this.O(r,l),this.J(r,l))}}this.D(s)}deregisterDefaultConfigurations(t){const e=new Set;this.w(t,e),this.r.fire(),this.s.fire({properties:e,defaultsOverrides:!0})}w(t,e){for(const s of t){const i=this.a.indexOf(s);i!==-1&&this.a.splice(i,1)}for(const{overrides:s,source:i}of t)for(const n in s){const r=this.b.get(n);if(!r)continue;const o=r.configurationDefaultOverrides.findIndex(a=>i?a.source?.id===i.id:a.value===s[n]);if(o!==-1){if(r.configurationDefaultOverrides.splice(o,1),r.configurationDefaultOverrides.length===0&&this.b.delete(n),qs.test(n)){let a;for(const c of r.configurationDefaultOverrides)a=this.z(n,c.value,c.source,a);a&&!Sd(a.value)?(r.configurationDefaultOverrideValue=a,this.y(n,a,i)):(this.b.delete(n),delete this.g[n],delete this.c.properties[n])}else{let a;for(const l of r.configurationDefaultOverrides)a=this.C(n,l.value,l.source,a);r.configurationDefaultOverrideValue=a;const c=this.g[n];c&&(this.O(n,c),this.J(n,c))}e.add(n)}}this.M()}y(t,e,s){const i={type:"object",default:e.value,description:v(1813,null,e2(t)),$ref:Ti,defaultDefaultValue:e.value,source:s,defaultValueSource:s};this.g[t]=i,this.c.properties[t]=i}z(t,e,s,i){const n=i?.value||{},r=i?.source??new Map;if(!(r instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(const o of Object.keys(e)){const a=e[o];if(Be(a)&&(rt(n[o])||Be(n[o]))){if(n[o]={...n[o]??{},...a},s)for(const l in a)r.set(`${o}.${l}`,s)}else n[o]=a,s?r.set(o,s):r.delete(o)}return{value:n,source:r}}C(t,e,s,i){const n=this.g[t],r=i?.value??n?.defaultDefaultValue;let o=s;if(Be(e)&&(n!==void 0&&n.type==="object"||n===void 0&&(rt(r)||Be(r)))){if(o=i?.source??new Map,!(o instanceof Map)){console.error("defaultValueSource is not a Map");return}for(const c in e)s&&o.set(`${t}.${c}`,s);e={...Be(r)?r:{},...e}}return{value:e,source:o}}deltaConfiguration(t){let e=!1;const s=new Set;t.removedDefaults&&(this.w(t.removedDefaults,s),e=!0),t.addedDefaults&&(this.u(t.addedDefaults,s),e=!0),t.removedConfigurations&&this.G(t.removedConfigurations,s),t.addedConfigurations&&this.F(t.addedConfigurations,!1,s),this.r.fire(),this.s.fire({properties:s,defaultsOverrides:e})}notifyConfigurationSchemaUpdated(...t){this.r.fire()}registerOverrideIdentifiers(t){this.D(t),this.r.fire()}D(t){for(const e of t)this.n.add(e);this.M()}F(t,e,s){t.forEach(i=>{this.H(i,e,i.extensionInfo,i.restrictedProperties,void 0,s),this.f.push(i),this.I(i)})}G(t,e){const s=i=>{if(i.properties)for(const n in i.properties){e.add(n);const r=this.g[n];r?.policy?.name&&this.h.delete(r.policy.name),delete this.g[n],this.L(n,i.properties[n])}i.allOf?.forEach(n=>s(n))};for(const i of t){s(i);const n=this.f.indexOf(i);n!==-1&&this.f.splice(n,1)}}H(t,e=!0,s,i,n=4,r){n=St(t.scope)?n:t.scope;const o=t.properties;if(o)for(const c in o){const l=o[c];if(e&&l2(c,l)){delete o[c];continue}l.source=s,l.defaultDefaultValue=o[c].default,this.O(c,l),qs.test(c)?l.scope=void 0:(l.scope=St(l.scope)?n:l.scope,l.restricted=St(l.restricted)?!!i?.includes(c):l.restricted),l.experiment?l.tags?.some(f=>f.toLowerCase()==="onexp")||(l.tags=l.tags??[],l.tags.push("onExP")):l.tags?.some(f=>f.toLowerCase()==="onexp")&&(console.error(`Invalid tag 'onExP' found for property '${c}'. Please use 'experiment' property instead.`),l.experiment={mode:"startup"});const h=o[c].hasOwnProperty("included")&&!o[c].included,u=o[c].policy?.name;h?(this.j[c]=o[c],u&&(this.h.set(u,c),r.add(c)),delete o[c]):(r.add(c),u&&this.h.set(u,c),this.g[c]=o[c],!o[c].deprecationMessage&&o[c].markdownDeprecationMessage&&(o[c].deprecationMessage=o[c].markdownDeprecationMessage))}const a=t.allOf;if(a)for(const c of a)this.H(c,e,s,i,n,r)}getConfigurations(){return this.f}getConfigurationProperties(){return this.g}getPolicyConfigurations(){return this.h}getExcludedConfigurationProperties(){return this.j}getRegisteredDefaultConfigurations(){return[...this.a]}getConfigurationDefaultsOverrides(){const t=new Map;for(const[e,s]of this.b)s.configurationDefaultOverrideValue&&t.set(e,s.configurationDefaultOverrideValue);return t}I(t){const e=s=>{const i=s.properties;if(i)for(const r in i)this.J(r,i[r]);s.allOf?.forEach(e)};e(t)}J(t,e){switch(gr.properties[t]=e,e.scope){case 1:Fo.properties[t]=e;break;case 2:Bo.properties[t]=e;break;case 3:Uo.properties[t]=e;break;case 7:zo.properties[t]=e;break;case 4:_o.properties[t]=e;break;case 5:mr.properties[t]=e;break;case 6:mr.properties[t]=e,this.m.properties[t]=e;break}}L(t,e){switch(delete gr.properties[t],e.scope){case 1:delete Fo.properties[t];break;case 2:delete Bo.properties[t];break;case 3:delete Uo.properties[t];break;case 7:delete zo.properties[t];break;case 4:delete _o.properties[t];break;case 5:case 6:delete mr.properties[t],delete this.m.properties[t];break}}M(){for(const t of this.n.values()){const e=`[${t}]`,s={type:"object",description:v(1814,null),errorMessage:v(1815,null),$ref:Ti};this.O(e,s),gr.properties[e]=s,Fo.properties[e]=s,Uo.properties[e]=s,Bo.properties[e]=s,zo.properties[e]=s,_o.properties[e]=s,mr.properties[e]=s}}N(){const t={type:"object",description:v(1816,null),errorMessage:v(1817,null),$ref:Ti};gr.patternProperties[ii]=t,Fo.patternProperties[ii]=t,Uo.patternProperties[ii]=t,Bo.patternProperties[ii]=t,zo.patternProperties[ii]=t,_o.patternProperties[ii]=t,mr.patternProperties[ii]=t,this.r.fire()}O(t,e){const s=this.b.get(t)?.configurationDefaultOverrideValue;let i,n;s&&(!e.disallowConfigurationDefault||!s.source)&&(i=s.value,n=s.source),rt(i)&&(i=e.defaultDefaultValue,n=void 0),rt(i)&&(i=c2(e.type)),e.default=i,e.defaultValueSource=n}},dp="\\[([^\\]]+)\\]",pp=new RegExp(dp,"g"),ii=`^(${dp})+$`,qs=new RegExp(ii);function wr(t){const e=[];if(qs.test(t)){let s=pp.exec(t);for(;s?.length;){const i=s[1].trim();i&&e.push(i),s=pp.exec(t)}}return Rt(e)}function a2(t){return t.reduce((e,s)=>`${e}[${s}]`,"")}function c2(t){switch(Array.isArray(t)?t[0]:t){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var qo=new o2;Ot.add(ns.Configuration,qo);function l2(t,e){return t.trim()?qs.test(t)?v(1819,null,t):qo.getConfigurationProperties()[t]!==void 0?v(1820,null,t):e.policy?.name&&qo.getPolicyConfigurations().get(e.policy?.name)!==void 0?v(1821,null,t,e.policy?.name,qo.getPolicyConfigurations().get(e.policy?.name)):null:v(1818,null)}function gp(t){const e={};for(const s of t){const i=s.properties;if(Be(i))for(const n in i)e[n]=i[n];s.allOf&&Object.assign(e,gp(s.allOf))}return e}function h2(t){switch(t){case"application":return 1;case"machine":return 2;case"resource":return 5;case"machine-overridable":return 7;case"language-overridable":return 6;default:return 4}}var mp="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",wp=new RegExp(mp),u2="__web_extension",f2="skipWalkthrough",$l="skipPublisherTrust",xl="extensionInstallSource",d2="dependecyOrPackExtensionInstall",p2="clientTargetPlatform",vp;(function(t){t.COMMAND="command",t.SETTINGS_SYNC="settingsSync"})(vp||(vp={}));function yp(t){switch(t){case"win32-x64":return"Windows 64 bit";case"win32-arm64":return"Windows ARM";case"linux-x64":return"Linux 64 bit";case"linux-arm64":return"Linux ARM 64";case"linux-armhf":return"Linux ARM";case"alpine-x64":return"Alpine Linux 64 bit";case"alpine-arm64":return"Alpine ARM 64";case"darwin-x64":return"Mac";case"darwin-arm64":return"Mac Silicon";case"web":return"Web";case"universal":return"universal";case"unknown":return"unknown";case"undefined":return"undefined"}}function g2(t){switch(t){case"win32-x64":return"win32-x64";case"win32-arm64":return"win32-arm64";case"linux-x64":return"linux-x64";case"linux-arm64":return"linux-arm64";case"linux-armhf":return"linux-armhf";case"alpine-x64":return"alpine-x64";case"alpine-arm64":return"alpine-arm64";case"darwin-x64":return"darwin-x64";case"darwin-arm64":return"darwin-arm64";case"web":return"web";case"universal":return"universal";default:return"unknown"}}function bp(t,e){switch(t){case 3:return e==="x64"?"win32-x64":e==="arm64"?"win32-arm64":"unknown";case 2:return e==="x64"?"linux-x64":e==="arm64"?"linux-arm64":e==="arm"?"linux-armhf":"unknown";case"alpine":return e==="x64"?"alpine-x64":e==="arm64"?"alpine-arm64":"unknown";case 1:return e==="x64"?"darwin-x64":e==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}function Sn(t,e){return e==="web"&&!t.includes("web")}function Sp(t,e,s){return Sn(e,s)?!1:t==="undefined"||t==="universal"?!0:t==="unknown"?!1:t===s}function m2(t){return t&&typeof t=="object"&&typeof t.id=="string"&&(!t.uuid||typeof t.uuid=="string")}var Ep;(function(t){t.NoneOrRelevance="NoneOrRelevance",t.LastUpdatedDate="LastUpdatedDate",t.Title="Title",t.PublisherName="PublisherName",t.InstallCount="InstallCount",t.PublishedDate="PublishedDate",t.AverageRating="AverageRating",t.WeightedRating="WeightedRating"})(Ep||(Ep={}));var $p;(function(t){t[t.Default=0]="Default",t[t.Ascending=1]="Ascending",t[t.Descending=2]="Descending"})($p||($p={}));var xp;(function(t){t.Category="Category",t.ExtensionId="ExtensionId",t.ExtensionName="ExtensionName",t.ExcludeWithFlags="ExcludeWithFlags",t.Featured="Featured",t.SearchText="SearchText",t.Tag="Tag",t.Target="Target"})(xp||(xp={}));var kp;(function(t){t.Install="install",t.Uninstall="uninstall"})(kp||(kp={}));var Pp;(function(t){t[t.None=1]="None",t[t.Install=2]="Install",t[t.Update=3]="Update",t[t.Migrate=4]="Migrate"})(Pp||(Pp={}));var Es=W("extensionGalleryService"),Rp;(function(t){t.Timeout="Timeout",t.Cancelled="Cancelled",t.ClientError="ClientError",t.ServerError="ServerError",t.Failed="Failed",t.DownloadFailedWriting="DownloadFailedWriting",t.Offline="Offline"})(Rp||(Rp={}));var Ws=class extends Error{constructor(t,e){super(t),this.code=e,this.name=e}},Cp;(function(t){t.NotFound="NotFound",t.Unsupported="Unsupported",t.Deprecated="Deprecated",t.Malicious="Malicious",t.Incompatible="Incompatible",t.IncompatibleApi="IncompatibleApi",t.IncompatibleTargetPlatform="IncompatibleTargetPlatform",t.ReleaseVersionNotFound="ReleaseVersionNotFound",t.Invalid="Invalid",t.Download="Download",t.DownloadSignature="DownloadSignature",t.DownloadFailedWriting="DownloadFailedWriting",t.UpdateMetadata="UpdateMetadata",t.Extract="Extract",t.Scanning="Scanning",t.ScanningExtension="ScanningExtension",t.ReadRemoved="ReadRemoved",t.UnsetRemoved="UnsetRemoved",t.Delete="Delete",t.Rename="Rename",t.IntializeDefaultProfile="IntializeDefaultProfile",t.AddToProfile="AddToProfile",t.InstalledExtensionNotFound="InstalledExtensionNotFound",t.PostInstall="PostInstall",t.CorruptZip="CorruptZip",t.IncompleteZip="IncompleteZip",t.PackageNotSigned="PackageNotSigned",t.SignatureVerificationInternal="SignatureVerificationInternal",t.SignatureVerificationFailed="SignatureVerificationFailed",t.NotAllowed="NotAllowed",t.Gallery="Gallery",t.Cancelled="Cancelled",t.Unknown="Unknown",t.Internal="Internal"})(Cp||(Cp={}));var Ye;(function(t){t.NotSigned="NotSigned",t.Success="Success",t.RequiredArgumentMissing="RequiredArgumentMissing",t.InvalidArgument="InvalidArgument",t.PackageIsUnreadable="PackageIsUnreadable",t.UnhandledException="UnhandledException",t.SignatureManifestIsMissing="SignatureManifestIsMissing",t.SignatureManifestIsUnreadable="SignatureManifestIsUnreadable",t.SignatureIsMissing="SignatureIsMissing",t.SignatureIsUnreadable="SignatureIsUnreadable",t.CertificateIsUnreadable="CertificateIsUnreadable",t.SignatureArchiveIsUnreadable="SignatureArchiveIsUnreadable",t.FileAlreadyExists="FileAlreadyExists",t.SignatureArchiveIsInvalidZip="SignatureArchiveIsInvalidZip",t.SignatureArchiveHasSameSignatureFile="SignatureArchiveHasSameSignatureFile",t.PackageIntegrityCheckFailed="PackageIntegrityCheckFailed",t.SignatureIsInvalid="SignatureIsInvalid",t.SignatureManifestIsInvalid="SignatureManifestIsInvalid",t.SignatureIntegrityCheckFailed="SignatureIntegrityCheckFailed",t.EntryIsMissing="EntryIsMissing",t.EntryIsTampered="EntryIsTampered",t.Untrusted="Untrusted",t.CertificateRevoked="CertificateRevoked",t.SignatureIsNotValid="SignatureIsNotValid",t.UnknownError="UnknownError",t.PackageIsInvalidZip="PackageIsInvalidZip",t.SignatureArchiveHasTooManyEntries="SignatureArchiveHasTooManyEntries"})(Ye||(Ye={}));var Te=class extends Error{constructor(t,e){super(t),this.code=e,this.name=e}},Hs=W("extensionManagementService"),kl="extensionsIdentifiers/disabled",Dp=W("IGlobalExtensionEnablementService"),Ip=W("IExtensionTipsService"),Mi=W("IAllowedExtensionsService");async function Pl(t,e){let s;try{s=await e.resolve(t)}catch(i){if(i.fileOperationResult===1)return 0;throw i}return s.children?(await Promise.all(s.children.map(n=>Pl(n.resource,e)))).reduce((n,r)=>n+r,0):s.size??0}var _S=xd(1969,"Extensions"),VS=xd(1970,"Preferences"),Wo="extensions.allowed",w2="extensions.verifySignature";Ot.as(ns.Configuration).registerConfiguration({id:"extensions",order:30,title:v(1952,null),type:"object",properties:{[Wo]:{type:"object",markdownDescription:v(1953,null),default:"*",defaultSnippets:[{body:{},description:v(1954,null)},{body:{"*":!0},description:v(1955,null)}],scope:1,policy:{name:"AllowedExtensions",minimumVersion:"1.96",description:v(1956,null)},additionalProperties:!1,patternProperties:{"([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$":{anyOf:[{type:["boolean","string"],enum:[!0,!1,"stable"],description:v(1957,null),enumDescriptions:[v(1958,null),v(1959,null),v(1960,null)]},{type:"array",items:{type:"string"},description:v(1961,null)}]},"([a-z0-9A-Z][a-z0-9-A-Z]*)$":{type:["boolean","string"],enum:[!0,!1,"stable"],description:v(1962,null),enumDescriptions:[v(1963,null),v(1964,null),v(1965,null)]},"\\*":{type:"boolean",enum:[!0,!1],description:v(1966,null),enumDescriptions:[v(1967,null),v(1968,null)]}}}}});function v2(t,e){return t?e?.capabilities.signing?.allPrivateRepositorySigned===!0:e?.capabilities.signing?.allPublicRepositorySigned===!0}function y2(t){return t.tags.find(e=>e.startsWith("lp-"))?.split("lp-")[1]}var Rl=W("languagePackService"),Cl=class extends T{constructor(e){super(),this.c=e}async getAvailableLanguages(){const e=new Ss;setTimeout(()=>e.cancel(),1e3);let s;try{s=await this.c.query({text:'category:"language packs"',pageSize:20},e.token)}catch{return[]}const n=s.firstPage.filter(r=>r.properties.localizedLanguages?.length&&r.tags.some(o=>o.startsWith("lp-"))).map(r=>{const o=r.properties.localizedLanguages?.[0],a=y2(r);return{...this.f(a,o,r),extensionId:r.identifier.id,galleryExtension:r}});return n.push(this.f("en","English")),n}f(e,s,i){const n=s??e;let r;if(n!==e&&(r=`(${e})`),e.toLowerCase()===bs.toLowerCase()&&(r??="",r+=v(2107,null)),i?.installCount){r??="";const o=i.installCount;let a;o>1e6?a=`${Math.floor(o/1e5)/10}M`:o>1e3?a=`${Math.floor(o/1e3)}K`:a=String(o),r+=` $(cloud-download) ${a}`}return{id:e,label:n,description:r}}};Cl=__decorate([__param(0,Es)],Cl);var Dl=class extends T{constructor(e){super(),this.a=e,this.b()}b(){this.a.update()}};Dl=__decorate([__param(0,Rl)],Dl);var Il=class extends T{constructor(e,s){super(),this.a=e,this.b=s,this.B(new fs(()=>{this.c()},10*1e3)).schedule()}async c(){this.b.trace("[logs cleanup]: Starting to clean up old logs.");try{const e=tr(this.a.logsHome),s=E1(this.a.logsHome.with({scheme:oe.file})).fsPath,r=(await le.readdir(s)).filter(a=>/^\d{8}T\d{6}$/.test(a)).sort().filter(a=>a!==e),o=r.slice(0,Math.max(0,r.length-9));o.length>0&&(this.b.trace(`[logs cleanup]: Removing log folders '${o.join(", ")}'`),await Promise.all(o.map(a=>le.rm(J(s,a)))))}catch(e){it(e)}}};Il=__decorate([__param(0,ae),__param(1,Y)],Il);var Op=class extends T{constructor(t,e,s){super(),this.a=t,this.b=e,this.c=s}async getItems(){const t={profile:this.b,workspace:this.c},e=await this.a.call("getItems",t);return new Map(e)}updateItems(t){const e={profile:this.b,workspace:this.c};return t.insert&&(e.insert=Array.from(t.insert.entries())),t.delete&&(e.delete=Array.from(t.delete.values())),this.a.call("updateItems",e)}optimize(){const t={profile:this.b,workspace:this.c};return this.a.call("optimize",t)}},Lp=class extends Op{constructor(t,e){super(t,e,void 0),this.f=this.B(new R),this.onDidChangeItemsExternal=this.f.event,this.g()}g(){this.B(this.a.listen("onDidChangeStorage",{profile:this.b})(t=>this.h(t)))}h(t){(Array.isArray(t.changed)||Array.isArray(t.deleted))&&this.f.fire({changed:t.changed?new Map(t.changed):void 0,deleted:t.deleted?new Set(t.deleted):void 0})}},Ap=class extends Lp{constructor(t){super(t,void 0)}async close(){this.dispose()}},Np=class extends Lp{constructor(t,e){super(t,e)}async close(){this.dispose()}},b2=class extends Op{constructor(t,e){super(t,void 0,e),this.onDidChangeItemsExternal=L.None}async close(){this.dispose()}},S2=class{constructor(t){this.a=t}isUsed(t){const e={payload:t,profile:void 0,workspace:void 0};return this.a.call("isUsed",e)}},E2=class{constructor(){this.b="",this.c=0}reset(t){return this.b=t,this.c=0,this}next(){return this.c+=1,this}hasNext(){return this.c<this.b.length-1}cmp(t){const e=t.charCodeAt(0),s=this.b.charCodeAt(this.c);return e-s}value(){return this.b[this.c]}},$2=class{constructor(t=!0){this.e=t}reset(t){return this.b=t,this.c=0,this.d=0,this.next()}hasNext(){return this.d<this.b.length}next(){this.c=this.d;let t=!0;for(;this.d<this.b.length;this.d++)if(this.b.charCodeAt(this.d)===46)if(t)this.c++;else break;else t=!1;return this}cmp(t){return this.e?Wc(t,this.b,0,t.length,this.c,this.d):Yn(t,this.b,0,t.length,this.c,this.d)}value(){return this.b.substring(this.c,this.d)}},jp=class{constructor(t=!0,e=!0){this.f=t,this.g=e}reset(t){this.d=0,this.e=0,this.b=t,this.c=t.length;for(let e=t.length-1;e>=0;e--,this.c--){const s=this.b.charCodeAt(e);if(!(s===47||this.f&&s===92))break}return this.next()}hasNext(){return this.e<this.c}next(){this.d=this.e;let t=!0;for(;this.e<this.c;this.e++){const e=this.b.charCodeAt(this.e);if(e===47||this.f&&e===92)if(t)this.d++;else break;else t=!1}return this}cmp(t){return this.g?Wc(t,this.b,0,t.length,this.d,this.e):Yn(t,this.b,0,t.length,this.d,this.e)}value(){return this.b.substring(this.d,this.e)}},Tp;(function(t){t[t.Scheme=1]="Scheme",t[t.Authority=2]="Authority",t[t.Path=3]="Path",t[t.Query=4]="Query",t[t.Fragment=5]="Fragment"})(Tp||(Tp={}));var x2=class{constructor(t,e){this.f=t,this.g=e,this.d=[],this.e=0}reset(t){return this.c=t,this.d=[],this.c.scheme&&this.d.push(1),this.c.authority&&this.d.push(2),this.c.path&&(this.b=new jp(!1,!this.f(t)),this.b.reset(t.path),this.b.value()&&this.d.push(3)),this.g(t)||(this.c.query&&this.d.push(4),this.c.fragment&&this.d.push(5)),this.e=0,this}next(){return this.d[this.e]===3&&this.b.hasNext()?this.b.next():this.e+=1,this}hasNext(){return this.d[this.e]===3&&this.b.hasNext()||this.e<this.d.length-1}cmp(t){if(this.d[this.e]===1)return Eo(t,this.c.scheme);if(this.d[this.e]===2)return Eo(t,this.c.authority);if(this.d[this.e]===3)return this.b.cmp(t);if(this.d[this.e]===4)return So(t,this.c.query);if(this.d[this.e]===5)return So(t,this.c.fragment);throw new Error}value(){if(this.d[this.e]===1)return this.c.scheme;if(this.d[this.e]===2)return this.c.authority;if(this.d[this.e]===3)return this.b.value();if(this.d[this.e]===4)return this.c.query;if(this.d[this.e]===5)return this.c.fragment;throw new Error}},Fi=class rd{static{this.Val=Symbol("undefined_placeholder")}static wrap(e){return e===void 0?rd.Val:e}static unwrap(e){return e===rd.Val?void 0:e}},Ho=class{constructor(){this.height=1,this.value=void 0,this.key=void 0,this.left=void 0,this.mid=void 0,this.right=void 0}isEmpty(){return!this.left&&!this.mid&&!this.right&&this.value===void 0}rotateLeft(){const t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){const t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}},Mp;(function(t){t[t.Left=-1]="Left",t[t.Mid=0]="Mid",t[t.Right=1]="Right"})(Mp||(Mp={}));var En=class so{static forUris(e=()=>!1,s=()=>!1){return new so(new x2(e,s))}static forPaths(e=!1){return new so(new jp(void 0,!e))}static forStrings(){return new so(new E2)}static forConfigKeys(){return new so(new $2)}constructor(e){this.b=e}clear(){this.c=void 0}fill(e,s){if(s){const i=s.slice(0);yd(i);for(const n of i)this.set(n,e)}else{const i=e.slice(0);yd(i);for(const n of i)this.set(n[0],n[1])}}set(e,s){const i=this.b.reset(e);let n;this.c||(this.c=new Ho,this.c.segment=i.value());const r=[];for(n=this.c;;){const a=i.cmp(n.segment);if(a>0)n.left||(n.left=new Ho,n.left.segment=i.value()),r.push([-1,n]),n=n.left;else if(a<0)n.right||(n.right=new Ho,n.right.segment=i.value()),r.push([1,n]),n=n.right;else if(i.hasNext())i.next(),n.mid||(n.mid=new Ho,n.mid.segment=i.value()),r.push([0,n]),n=n.mid;else break}const o=Fi.unwrap(n.value);n.value=Fi.wrap(s),n.key=e;for(let a=r.length-1;a>=0;a--){const c=r[a][1];c.updateHeight();const l=c.balanceFactor();if(l<-1||l>1){const h=r[a][0],u=r[a+1][0];if(h===1&&u===1)r[a][1]=c.rotateLeft();else if(h===-1&&u===-1)r[a][1]=c.rotateRight();else if(h===1&&u===-1)c.right=r[a+1][1]=r[a+1][1].rotateRight(),r[a][1]=c.rotateLeft();else if(h===-1&&u===1)c.left=r[a+1][1]=r[a+1][1].rotateLeft(),r[a][1]=c.rotateRight();else throw new Error;if(a>0)switch(r[a-1][0]){case-1:r[a-1][1].left=r[a][1];break;case 1:r[a-1][1].right=r[a][1];break;case 0:r[a-1][1].mid=r[a][1];break}else this.c=r[0][1]}}return o}get(e){return Fi.unwrap(this.d(e)?.value)}d(e){const s=this.b.reset(e);let i=this.c;for(;i;){const n=s.cmp(i.segment);if(n>0)i=i.left;else if(n<0)i=i.right;else if(s.hasNext())s.next(),i=i.mid;else break}return i}has(e){const s=this.d(e);return!(s?.value===void 0&&s?.mid===void 0)}delete(e){return this.e(e,!1)}deleteSuperstr(e){return this.e(e,!0)}e(e,s){const i=this.b.reset(e),n=[];let r=this.c;for(;r;){const o=i.cmp(r.segment);if(o>0)n.push([-1,r]),r=r.left;else if(o<0)n.push([1,r]),r=r.right;else if(i.hasNext())i.next(),n.push([0,r]),r=r.mid;else break}if(r){if(s?(r.left=void 0,r.mid=void 0,r.right=void 0,r.height=1):(r.key=void 0,r.value=void 0),!r.mid&&!r.value)if(r.left&&r.right){const o=[[1,r]],a=this.f(r.right,o);if(a.key){r.key=a.key,r.value=a.value,r.segment=a.segment;const c=a.right;if(o.length>1){const[h,u]=o[o.length-1];switch(h){case-1:u.left=c;break;case 0:Ac(!1);case 1:Ac(!1)}}else r.right=c;const l=this.g(o);if(n.length>0){const[h,u]=n[n.length-1];switch(h){case-1:u.left=l;break;case 0:u.mid=l;break;case 1:u.right=l;break}}else this.c=l}}else{const o=r.left??r.right;if(n.length>0){const[a,c]=n[n.length-1];switch(a){case-1:c.left=o;break;case 0:c.mid=o;break;case 1:c.right=o;break}}else this.c=o}this.c=this.g(n)??this.c}}f(e,s){for(;e.left;)s.push([-1,e]),e=e.left;return e}g(e){for(let s=e.length-1;s>=0;s--){const i=e[s][1];i.updateHeight();const n=i.balanceFactor();if(n>1?(i.right.balanceFactor()>=0||(i.right=i.right.rotateRight()),e[s][1]=i.rotateLeft()):n<-1&&(i.left.balanceFactor()<=0||(i.left=i.left.rotateLeft()),e[s][1]=i.rotateRight()),s>0)switch(e[s-1][0]){case-1:e[s-1][1].left=e[s][1];break;case 1:e[s-1][1].right=e[s][1];break;case 0:e[s-1][1].mid=e[s][1];break}else return e[0][1]}}findSubstr(e){const s=this.b.reset(e);let i=this.c,n;for(;i;){const r=s.cmp(i.segment);if(r>0)i=i.left;else if(r<0)i=i.right;else if(s.hasNext())s.next(),n=Fi.unwrap(i.value)||n,i=i.mid;else break}return i&&Fi.unwrap(i.value)||n}findSuperstr(e){return this.h(e,!1)}h(e,s){const i=this.b.reset(e);let n=this.c;for(;n;){const r=i.cmp(n.segment);if(r>0)n=n.left;else if(r<0)n=n.right;else if(i.hasNext())i.next(),n=n.mid;else return n.mid?this.j(n.mid):s?Fi.unwrap(n.value):void 0}}hasElementOrSubtree(e){return this.h(e,!0)!==void 0}forEach(e){for(const[s,i]of this)e(i,s)}*[Symbol.iterator](){yield*this.j(this.c)}j(e){const s=[];return this.l(e,s),s[Symbol.iterator]()}l(e,s){e&&(e.left&&this.l(e.left,s),e.value!==void 0&&s.push([e.key,Fi.unwrap(e.value)]),e.mid&&this.l(e.mid,s),e.right&&this.l(e.right,s))}_isBalanced(){const e=s=>{if(!s)return!0;const i=s.balanceFactor();return i<-1||i>1?!1:e(s.left)&&e(s.right)};return e(this.c)}},GS=W("contextService");function k2(t){const e=t;return typeof e?.id=="string"&&k.isUri(e.uri)}var P2={id:"ext-dev"};function R2(t){const e=t;return typeof e?.id=="string"&&k.isUri(e.configPath)}var Fp;(function(t){t[t.EMPTY=1]="EMPTY",t[t.FOLDER=2]="FOLDER",t[t.WORKSPACE=3]="WORKSPACE"})(Fp||(Fp={}));var Up="code-workspace",JS=`.${Up}`,KS=[{name:v(2713,null),extensions:[Up]}];import"crypto";var C2=128/4,Bp;(function(t){t[t.Transfer=0]="Transfer",t[t.Notify=1]="Notify",t[t.Force=2]="Force"})(Bp||(Bp={}));var Go=W("nativeHostService"),Jo=W("mainProcessService"),D2=class{constructor(t,e){this.a=t,this.b=e}getChannel(t){return this.a.getChannel(t,this.b)}registerChannel(t,e){this.a.registerChannel(t,e)}},Ol=class extends T{constructor(e,s,i,n){super(),this.a=e,this.b=s,this.c=i,this.f=n,this.B(new fs(()=>{this.g()},30*1e3)).schedule()}async g(){this.b.trace("[storage cleanup]: Starting to clean up workspace storage folders for unused empty workspaces.");try{const e=this.a.workspaceStorageHome.with({scheme:oe.file}).fsPath,s=await le.readdir(e),i=new S2(this.f.getChannel("storage"));await Promise.all(s.map(async n=>{const r=J(e,n);n.length===C2||n===P2.id||(await this.c.getWindows({includeAuxiliaryWindows:!1})).some(c=>c.workspace?.id===n)||await i.isUsed(r)||(this.b.trace(`[storage cleanup]: Deleting workspace storage folder ${n} as it seems to be an unused empty workspace.`),await le.rm(r))}))}catch(e){it(e)}}};Ol=__decorate([__param(0,_t),__param(1,Y),__param(2,Go),__param(3,Jo)],Ol);var zp=W("checksumService");import{createHash as I2}from"crypto";var K=W("fileService");function $n(t){return t.create===!0}var Vt;(function(t){t[t.Unknown=0]="Unknown",t[t.File=1]="File",t[t.Directory=2]="Directory",t[t.SymbolicLink=64]="SymbolicLink"})(Vt||(Vt={}));var xn;(function(t){t[t.Readonly=1]="Readonly",t[t.Locked=2]="Locked"})(xn||(xn={}));var _p;(function(t){t[t.UPDATED=2]="UPDATED",t[t.ADDED=4]="ADDED",t[t.DELETED=8]="DELETED"})(_p||(_p={}));var Vp;(function(t){t[t.None=0]="None",t[t.FileReadWrite=2]="FileReadWrite",t[t.FileOpenReadWriteClose=4]="FileOpenReadWriteClose",t[t.FileReadStream=16]="FileReadStream",t[t.FileFolderCopy=8]="FileFolderCopy",t[t.PathCaseSensitive=1024]="PathCaseSensitive",t[t.Readonly=2048]="Readonly",t[t.Trash=4096]="Trash",t[t.FileWriteUnlock=8192]="FileWriteUnlock",t[t.FileAtomicRead=16384]="FileAtomicRead",t[t.FileAtomicWrite=32768]="FileAtomicWrite",t[t.FileAtomicDelete=65536]="FileAtomicDelete",t[t.FileClone=131072]="FileClone",t[t.FileRealpath=262144]="FileRealpath"})(Vp||(Vp={}));function rs(t){return!!(t.capabilities&2)}function Ll(t){return!!(t.capabilities&8)}function qp(t){return!!(t.capabilities&131072)}function O2(t){return!!(t.capabilities&262144)}function ni(t){return!!(t.capabilities&4)}function Al(t){return!!(t.capabilities&16)}function Nl(t){return rs(t)?!!(t.capabilities&16384):!1}function Wp(t){return rs(t)?!!(t.capabilities&32768):!1}function L2(t){return!!(t.capabilities&65536)}var Z;(function(t){t.FileExists="EntryExists",t.FileNotFound="EntryNotFound",t.FileNotADirectory="EntryNotADirectory",t.FileIsADirectory="EntryIsADirectory",t.FileExceedsStorageQuota="EntryExceedsStorageQuota",t.FileTooLarge="EntryTooLarge",t.FileWriteLocked="EntryWriteLocked",t.NoPermissions="NoPermissions",t.Unavailable="Unavailable",t.Unknown="Unknown"})(Z||(Z={}));var jl=class hv extends Error{static create(e,s){const i=new hv(e.toString(),s);return A2(i,s),i}constructor(e,s){super(e),this.code=s}};function $s(t,e){return jl.create(t,e)}function Ui(t){return t||$s(v(2056,null),Z.Unknown)}function A2(t,e){return t.name=e?`${e} (FileSystemError)`:"FileSystemError",t}function Ko(t){if(!t)return Z.Unknown;if(t instanceof jl)return t.code;const e=/^(.+) \(FileSystemError\)$/.exec(t.name);if(!e)return Z.Unknown;switch(e[1]){case Z.FileExists:return Z.FileExists;case Z.FileIsADirectory:return Z.FileIsADirectory;case Z.FileNotADirectory:return Z.FileNotADirectory;case Z.FileNotFound:return Z.FileNotFound;case Z.FileTooLarge:return Z.FileTooLarge;case Z.FileWriteLocked:return Z.FileWriteLocked;case Z.NoPermissions:return Z.NoPermissions;case Z.Unavailable:return Z.Unavailable}return Z.Unknown}function Me(t){if(t instanceof et)return t.fileOperationResult;switch(Ko(t)){case Z.FileNotFound:return 1;case Z.FileIsADirectory:return 0;case Z.FileNotADirectory:return 9;case Z.FileWriteLocked:return 5;case Z.NoPermissions:return 6;case Z.FileExists:return 4;case Z.FileTooLarge:return 7;default:return 10}}var Hp;(function(t){t[t.CREATE=0]="CREATE",t[t.DELETE=1]="DELETE",t[t.MOVE=2]="MOVE",t[t.COPY=3]="COPY",t[t.WRITE=4]="WRITE"})(Hp||(Hp={}));var kn=class{constructor(t,e,s){this.resource=t,this.operation=e,this.target=s}isOperation(t){return this.operation===t}},Gp;(function(t){t[t.UPDATED=0]="UPDATED",t[t.ADDED=1]="ADDED",t[t.DELETED=2]="DELETED"})(Gp||(Gp={}));var N2=class Sc{static{this.a=null}constructor(e,s){this.c=s,this.b=void 0,this.d=new xi(()=>{const i=En.forUris(()=>this.c);return i.fill(this.rawAdded.map(n=>[n,!0])),i}),this.f=new xi(()=>{const i=En.forUris(()=>this.c);return i.fill(this.rawUpdated.map(n=>[n,!0])),i}),this.g=new xi(()=>{const i=En.forUris(()=>this.c);return i.fill(this.rawDeleted.map(n=>[n,!0])),i}),this.rawAdded=[],this.rawUpdated=[],this.rawDeleted=[];for(const i of e){switch(i.type){case 1:this.rawAdded.push(i.resource);break;case 0:this.rawUpdated.push(i.resource);break;case 2:this.rawDeleted.push(i.resource);break}this.b!==Sc.a&&(typeof i.cId=="number"?this.b===void 0?this.b=i.cId:this.b!==i.cId&&(this.b=Sc.a):this.b!==void 0&&(this.b=Sc.a))}}contains(e,...s){return this.h(e,{includeChildren:!1},...s)}affects(e,...s){return this.h(e,{includeChildren:!0},...s)}h(e,s,...i){if(!e)return!1;const n=i.length>0;return!!((!n||i.includes(1))&&(this.d.value.get(e)||s.includeChildren&&this.d.value.findSuperstr(e))||(!n||i.includes(0))&&(this.f.value.get(e)||s.includeChildren&&this.f.value.findSuperstr(e))||(!n||i.includes(2))&&(this.g.value.findSubstr(e)||s.includeChildren&&this.g.value.findSuperstr(e)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(e){return this.b===e}hasCorrelation(){return typeof this.b=="number"}};function j2(t,e,s){return!t||!e||t===e||e.length>t.length?!1:(e.charAt(e.length-1)!==Dt&&(e+=Dt),s?Hc(t,e):t.indexOf(e)===0)}var et=class extends Error{constructor(t,e,s){super(t),this.fileOperationResult=e,this.options=s}},Tl=class extends et{constructor(t,e,s,i){super(t,e,i),this.fileOperationResult=e,this.size=s}},Ml=class extends et{constructor(t,e,s){super(t,2,s),this.stat=e}},Jp;(function(t){t[t.FILE_IS_DIRECTORY=0]="FILE_IS_DIRECTORY",t[t.FILE_NOT_FOUND=1]="FILE_NOT_FOUND",t[t.FILE_NOT_MODIFIED_SINCE=2]="FILE_NOT_MODIFIED_SINCE",t[t.FILE_MODIFIED_SINCE=3]="FILE_MODIFIED_SINCE",t[t.FILE_MOVE_CONFLICT=4]="FILE_MOVE_CONFLICT",t[t.FILE_WRITE_LOCKED=5]="FILE_WRITE_LOCKED",t[t.FILE_PERMISSION_DENIED=6]="FILE_PERMISSION_DENIED",t[t.FILE_TOO_LARGE=7]="FILE_TOO_LARGE",t[t.FILE_INVALID_PATH=8]="FILE_INVALID_PATH",t[t.FILE_NOT_DIRECTORY=9]="FILE_NOT_DIRECTORY",t[t.FILE_OTHER_ERROR=10]="FILE_OTHER_ERROR"})(Jp||(Jp={}));var Kp;(function(t){t[t.FILE=0]="FILE",t[t.FOLDER=1]="FOLDER",t[t.ROOT_FOLDER=2]="ROOT_FOLDER"})(Kp||(Kp={}));var Fl="";function Qp(t){if(!(typeof t.size!="number"||typeof t.mtime!="number"))return t.mtime.toString(29)+t.size.toString(31)}var vr=class At{static{this.KB=1024}static{this.MB=At.KB*At.KB}static{this.GB=At.MB*At.KB}static{this.TB=At.GB*At.KB}static formatSize(e){return Nc(e)||(e=0),e<At.KB?v(2057,null,e.toFixed(0)):e<At.MB?v(2058,null,(e/At.KB).toFixed(2)):e<At.GB?v(2059,null,(e/At.MB).toFixed(2)):e<At.TB?v(2060,null,(e/At.GB).toFixed(2)):v(2061,null,(e/At.TB).toFixed(2))}},Ul=class{constructor(e){this.a=e}async checksum(e){const s=(await this.a.readFileStream(e)).value;return new Promise((i,n)=>{const r=I2("sha256");Oo(s,{onData:o=>r.update(o.buffer),onError:o=>n(o),onEnd:()=>i(r.digest("base64").replace(/=+$/,""))})})}};Ul=__decorate([__param(0,K)],Ul);var Xp;(function(t){t[t.None=0]="None",t[t.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=2]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",t[t.InvalidUnicode=4]="InvalidUnicode",t[t.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",t[t.InvalidCharacter=6]="InvalidCharacter"})(Xp||(Xp={}));var Zp;(function(t){t[t.OpenBraceToken=1]="OpenBraceToken",t[t.CloseBraceToken=2]="CloseBraceToken",t[t.OpenBracketToken=3]="OpenBracketToken",t[t.CloseBracketToken=4]="CloseBracketToken",t[t.CommaToken=5]="CommaToken",t[t.ColonToken=6]="ColonToken",t[t.NullKeyword=7]="NullKeyword",t[t.TrueKeyword=8]="TrueKeyword",t[t.FalseKeyword=9]="FalseKeyword",t[t.StringLiteral=10]="StringLiteral",t[t.NumericLiteral=11]="NumericLiteral",t[t.LineCommentTrivia=12]="LineCommentTrivia",t[t.BlockCommentTrivia=13]="BlockCommentTrivia",t[t.LineBreakTrivia=14]="LineBreakTrivia",t[t.Trivia=15]="Trivia",t[t.Unknown=16]="Unknown",t[t.EOF=17]="EOF"})(Zp||(Zp={}));var Yp;(function(t){t[t.InvalidSymbol=1]="InvalidSymbol",t[t.InvalidNumberFormat=2]="InvalidNumberFormat",t[t.PropertyNameExpected=3]="PropertyNameExpected",t[t.ValueExpected=4]="ValueExpected",t[t.ColonExpected=5]="ColonExpected",t[t.CommaExpected=6]="CommaExpected",t[t.CloseBraceExpected=7]="CloseBraceExpected",t[t.CloseBracketExpected=8]="CloseBracketExpected",t[t.EndOfFileExpected=9]="EndOfFileExpected",t[t.InvalidCommentToken=10]="InvalidCommentToken",t[t.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=12]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",t[t.InvalidUnicode=14]="InvalidUnicode",t[t.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",t[t.InvalidCharacter=16]="InvalidCharacter"})(Yp||(Yp={}));var yr;(function(t){t.DEFAULT={allowTrailingComma:!0}})(yr||(yr={}));function eg(t,e=!1){let s=0;const i=t.length;let n="",r=0,o=16,a=0;function c(m){let w=0,b=0;for(;w<m;){const S=t.charCodeAt(s);if(S>=48&&S<=57)b=b*16+S-48;else if(S>=65&&S<=70)b=b*16+S-65+10;else if(S>=97&&S<=102)b=b*16+S-97+10;else break;s++,w++}return w<m&&(b=-1),b}function l(m){s=m,n="",r=0,o=16,a=0}function h(){const m=s;if(t.charCodeAt(s)===48)s++;else for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;if(s<t.length&&t.charCodeAt(s)===46)if(s++,s<t.length&&Pn(t.charCodeAt(s)))for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;else return a=3,t.substring(m,s);let w=s;if(s<t.length&&(t.charCodeAt(s)===69||t.charCodeAt(s)===101))if(s++,(s<t.length&&t.charCodeAt(s)===43||t.charCodeAt(s)===45)&&s++,s<t.length&&Pn(t.charCodeAt(s))){for(s++;s<t.length&&Pn(t.charCodeAt(s));)s++;w=s}else a=3;return t.substring(m,w)}function u(){let m="",w=s;for(;;){if(s>=i){m+=t.substring(w,s),a=2;break}const b=t.charCodeAt(s);if(b===34){m+=t.substring(w,s),s++;break}if(b===92){if(m+=t.substring(w,s),s++,s>=i){a=2;break}switch(t.charCodeAt(s++)){case 34:m+='"';break;case 92:m+="\\";break;case 47:m+="/";break;case 98:m+="\b";break;case 102:m+="\f";break;case 110:m+=`
`;break;case 114:m+="\r";break;case 116:m+="	";break;case 117:{const $=c(4);$>=0?m+=String.fromCharCode($):a=4;break}default:a=5}w=s;continue}if(b>=0&&b<=31)if(Qo(b)){m+=t.substring(w,s),a=2;break}else a=6;s++}return m}function f(){if(n="",a=0,r=s,s>=i)return r=i,o=17;let m=t.charCodeAt(s);if(Bl(m)){do s++,n+=String.fromCharCode(m),m=t.charCodeAt(s);while(Bl(m));return o=15}if(Qo(m))return s++,n+=String.fromCharCode(m),m===13&&t.charCodeAt(s)===10&&(s++,n+=`
`),o=14;switch(m){case 123:return s++,o=1;case 125:return s++,o=2;case 91:return s++,o=3;case 93:return s++,o=4;case 58:return s++,o=6;case 44:return s++,o=5;case 34:return s++,n=u(),o=10;case 47:{const w=s-1;if(t.charCodeAt(s+1)===47){for(s+=2;s<i&&!Qo(t.charCodeAt(s));)s++;return n=t.substring(w,s),o=12}if(t.charCodeAt(s+1)===42){s+=2;const b=i-1;let S=!1;for(;s<b;){if(t.charCodeAt(s)===42&&t.charCodeAt(s+1)===47){s+=2,S=!0;break}s++}return S||(s++,a=1),n=t.substring(w,s),o=13}return n+=String.fromCharCode(m),s++,o=16}case 45:if(n+=String.fromCharCode(m),s++,s===i||!Pn(t.charCodeAt(s)))return o=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return n+=h(),o=11;default:for(;s<i&&p(m);)s++,m=t.charCodeAt(s);if(r!==s){switch(n=t.substring(r,s),n){case"true":return o=8;case"false":return o=9;case"null":return o=7}return o=16}return n+=String.fromCharCode(m),s++,o=16}}function p(m){if(Bl(m)||Qo(m))return!1;switch(m){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function g(){let m;do m=f();while(m>=12&&m<=15);return m}return{setPosition:l,getPosition:()=>s,scan:e?g:f,getToken:()=>o,getTokenValue:()=>n,getTokenOffset:()=>r,getTokenLength:()=>s-r,getTokenError:()=>a}}function Bl(t){return t===32||t===9||t===11||t===12||t===160||t===5760||t>=8192&&t<=8203||t===8239||t===8287||t===12288||t===65279}function Qo(t){return t===10||t===13||t===8232||t===8233}function Pn(t){return t>=48&&t<=57}var tg;(function(t){t[t.nullCharacter=0]="nullCharacter",t[t.maxAsciiCharacter=127]="maxAsciiCharacter",t[t.lineFeed=10]="lineFeed",t[t.carriageReturn=13]="carriageReturn",t[t.lineSeparator=8232]="lineSeparator",t[t.paragraphSeparator=8233]="paragraphSeparator",t[t.nextLine=133]="nextLine",t[t.space=32]="space",t[t.nonBreakingSpace=160]="nonBreakingSpace",t[t.enQuad=8192]="enQuad",t[t.emQuad=8193]="emQuad",t[t.enSpace=8194]="enSpace",t[t.emSpace=8195]="emSpace",t[t.threePerEmSpace=8196]="threePerEmSpace",t[t.fourPerEmSpace=8197]="fourPerEmSpace",t[t.sixPerEmSpace=8198]="sixPerEmSpace",t[t.figureSpace=8199]="figureSpace",t[t.punctuationSpace=8200]="punctuationSpace",t[t.thinSpace=8201]="thinSpace",t[t.hairSpace=8202]="hairSpace",t[t.zeroWidthSpace=8203]="zeroWidthSpace",t[t.narrowNoBreakSpace=8239]="narrowNoBreakSpace",t[t.ideographicSpace=12288]="ideographicSpace",t[t.mathematicalSpace=8287]="mathematicalSpace",t[t.ogham=5760]="ogham",t[t._=95]="_",t[t.$=36]="$",t[t._0=48]="_0",t[t._1=49]="_1",t[t._2=50]="_2",t[t._3=51]="_3",t[t._4=52]="_4",t[t._5=53]="_5",t[t._6=54]="_6",t[t._7=55]="_7",t[t._8=56]="_8",t[t._9=57]="_9",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.ampersand=38]="ampersand",t[t.asterisk=42]="asterisk",t[t.at=64]="at",t[t.backslash=92]="backslash",t[t.bar=124]="bar",t[t.caret=94]="caret",t[t.closeBrace=125]="closeBrace",t[t.closeBracket=93]="closeBracket",t[t.closeParen=41]="closeParen",t[t.colon=58]="colon",t[t.comma=44]="comma",t[t.dot=46]="dot",t[t.doubleQuote=34]="doubleQuote",t[t.equals=61]="equals",t[t.exclamation=33]="exclamation",t[t.greaterThan=62]="greaterThan",t[t.lessThan=60]="lessThan",t[t.minus=45]="minus",t[t.openBrace=123]="openBrace",t[t.openBracket=91]="openBracket",t[t.openParen=40]="openParen",t[t.percent=37]="percent",t[t.plus=43]="plus",t[t.question=63]="question",t[t.semicolon=59]="semicolon",t[t.singleQuote=39]="singleQuote",t[t.slash=47]="slash",t[t.tilde=126]="tilde",t[t.backspace=8]="backspace",t[t.formFeed=12]="formFeed",t[t.byteOrderMark=65279]="byteOrderMark",t[t.tab=9]="tab",t[t.verticalTab=11]="verticalTab"})(tg||(tg={}));function We(t,e=[],s=yr.DEFAULT){let i=null,n=[];const r=[];function o(c){Array.isArray(n)?n.push(c):i!==null&&(n[i]=c)}return br(t,{onObjectBegin:()=>{const c={};o(c),r.push(n),n=c,i=null},onObjectProperty:c=>{i=c},onObjectEnd:()=>{n=r.pop()},onArrayBegin:()=>{const c=[];o(c),r.push(n),n=c,i=null},onArrayEnd:()=>{n=r.pop()},onLiteralValue:o,onError:(c,l,h)=>{e.push({error:c,offset:l,length:h})}},s),n[0]}function T2(t,e=[],s=yr.DEFAULT){let i={type:"array",offset:-1,length:-1,children:[],parent:void 0};function n(c){i.type==="property"&&(i.length=c-i.offset,i=i.parent)}function r(c){return i.children.push(c),c}br(t,{onObjectBegin:c=>{i=r({type:"object",offset:c,length:-1,parent:i,children:[]})},onObjectProperty:(c,l,h)=>{i=r({type:"property",offset:l,length:-1,parent:i,children:[]}),i.children.push({type:"string",value:c,offset:l,length:h,parent:i})},onObjectEnd:(c,l)=>{i.length=c+l-i.offset,i=i.parent,n(c+l)},onArrayBegin:(c,l)=>{i=r({type:"array",offset:c,length:-1,parent:i,children:[]})},onArrayEnd:(c,l)=>{i.length=c+l-i.offset,i=i.parent,n(c+l)},onLiteralValue:(c,l,h)=>{r({type:Rn(c),offset:l,length:h,parent:i,value:c}),n(l+h)},onSeparator:(c,l,h)=>{i.type==="property"&&(c===":"?i.colonOffset=l:c===","&&n(l))},onError:(c,l,h)=>{e.push({error:c,offset:l,length:h})}},s);const a=i.children[0];return a&&delete a.parent,a}function sg(t,e){if(!t)return;let s=t;for(const i of e)if(typeof i=="string"){if(s.type!=="object"||!Array.isArray(s.children))return;let n=!1;for(const r of s.children)if(Array.isArray(r.children)&&r.children[0].value===i){s=r.children[1],n=!0;break}if(!n)return}else{const n=i;if(s.type!=="array"||n<0||!Array.isArray(s.children)||n>=s.children.length)return;s=s.children[n]}return s}function br(t,e,s=yr.DEFAULT){const i=eg(t,!1);function n(P){return P?()=>P(i.getTokenOffset(),i.getTokenLength()):()=>!0}function r(P){return P?z=>P(z,i.getTokenOffset(),i.getTokenLength()):()=>!0}const o=n(e.onObjectBegin),a=r(e.onObjectProperty),c=n(e.onObjectEnd),l=n(e.onArrayBegin),h=n(e.onArrayEnd),u=r(e.onLiteralValue),f=r(e.onSeparator),p=n(e.onComment),g=r(e.onError),m=s&&s.disallowComments,w=s&&s.allowTrailingComma;function b(){for(;;){const P=i.scan();switch(i.getTokenError()){case 4:S(14);break;case 5:S(15);break;case 3:S(13);break;case 1:m||S(11);break;case 2:S(12);break;case 6:S(16);break}switch(P){case 12:case 13:m?S(10):p();break;case 16:S(1);break;case 15:case 14:break;default:return P}}}function S(P,z=[],B=[]){if(g(P),z.length+B.length>0){let j=i.getToken();for(;j!==17;){if(z.indexOf(j)!==-1){b();break}else if(B.indexOf(j)!==-1)break;j=b()}}}function $(P){const z=i.getTokenValue();return P?u(z):a(z),b(),!0}function U(){switch(i.getToken()){case 11:{let P=0;try{P=JSON.parse(i.getTokenValue()),typeof P!="number"&&(S(2),P=0)}catch{S(2)}u(P);break}case 7:u(null);break;case 8:u(!0);break;case 9:u(!1);break;default:return!1}return b(),!0}function q(){return i.getToken()!==10?(S(3,[],[2,5]),!1):($(!1),i.getToken()===6?(f(":"),b(),E()||S(4,[],[2,5])):S(5,[],[2,5]),!0)}function me(){o(),b();let P=!1;for(;i.getToken()!==2&&i.getToken()!==17;){if(i.getToken()===5){if(P||S(4,[],[]),f(","),b(),i.getToken()===2&&w)break}else P&&S(6,[],[]);q()||S(4,[],[2,5]),P=!0}return c(),i.getToken()!==2?S(7,[2],[]):b(),!0}function N(){l(),b();let P=!1;for(;i.getToken()!==4&&i.getToken()!==17;){if(i.getToken()===5){if(P||S(4,[],[]),f(","),b(),i.getToken()===4&&w)break}else P&&S(6,[],[]);E()||S(4,[],[4,5]),P=!0}return h(),i.getToken()!==4?S(8,[4],[]):b(),!0}function E(){switch(i.getToken()){case 3:return N();case 1:return me();case 10:return $(!0);default:return U()}}return b(),i.getToken()===17?s.allowEmptyContent?!0:(S(4,[],[]),!1):E()?(i.getToken()!==17&&S(9,[],[]),!0):(S(4,[],[]),!1)}function Rn(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(t){if(Array.isArray(t))return"array"}else return"null";return"object"}default:return"null"}}function M2(t,e,s){let i,n,r,o,a;if(e){for(o=e.offset,a=o+e.length,r=o;r>0&&!Xo(t,r-1);)r--;let $=a;for(;$<t.length&&!Xo(t,$);)$++;n=t.substring(r,$),i=F2(n,s)}else n=t,i=0,r=0,o=0,a=t.length;const c=ig(s,t);let l=!1,h=0,u;s.insertSpaces?u=zl(" ",s.tabSize||4):u="	";const f=eg(n,!1);let p=!1;function g(){return c+zl(u,i+h)}function m(){let $=f.scan();for(l=!1;$===15||$===14;)l=l||$===14,$=f.scan();return p=$===16||f.getTokenError()!==0,$}const w=[];function b($,U,q){!p&&U<a&&q>o&&t.substring(U,q)!==$&&w.push({offset:U,length:q-U,content:$})}let S=m();if(S!==17){const $=f.getTokenOffset()+r,U=zl(u,i);b(U,r,$)}for(;S!==17;){let $=f.getTokenOffset()+f.getTokenLength()+r,U=m(),q="";for(;!l&&(U===12||U===13);){const N=f.getTokenOffset()+r;b(" ",$,N),$=f.getTokenOffset()+f.getTokenLength()+r,q=U===12?g():"",U=m()}if(U===2)S!==1&&(h--,q=g());else if(U===4)S!==3&&(h--,q=g());else{switch(S){case 3:case 1:h++,q=g();break;case 5:case 12:q=g();break;case 13:l?q=g():q=" ";break;case 6:q=" ";break;case 10:if(U===6){q="";break}case 7:case 8:case 9:case 11:case 2:case 4:U===12||U===13?q=" ":U!==5&&U!==17&&(p=!0);break;case 16:p=!0;break}l&&(U===12||U===13)&&(q=g())}const me=f.getTokenOffset()+r;b(q,$,me),S=U}return w}function Sr(t,e){const s=JSON.stringify(t,void 0,e.insertSpaces?e.tabSize||4:"	");return e.eol!==void 0?s.replace(/\r\n|\r|\n/g,e.eol):s}function zl(t,e){let s="";for(let i=0;i<e;i++)s+=t;return s}function F2(t,e){let s=0,i=0;const n=e.tabSize||4;for(;s<t.length;){const r=t.charAt(s);if(r===" ")i++;else if(r==="	")i+=n;else break;s++}return Math.floor(i/n)}function ig(t,e){for(let s=0;s<e.length;s++){const i=e.charAt(s);if(i==="\r")return s+1<e.length&&e.charAt(s+1)===`
`?`\r
`:"\r";if(i===`
`)return`
`}return t&&t.eol||`
`}function Xo(t,e){return`\r
`.indexOf(t.charAt(e))!==-1}function _l(t,e,s,i,n){const r=e.slice(),a=T2(t,[]);let c,l;for(;r.length>0&&(l=r.pop(),c=sg(a,r),c===void 0&&s!==void 0);)typeof l=="string"?s={[l]:s}:s=[s];if(c)if(c.type==="object"&&typeof l=="string"&&Array.isArray(c.children)){const h=sg(c,[l]);if(h!==void 0)if(s===void 0){if(!h.parent)throw new Error("Malformed AST");const u=c.children.indexOf(h.parent);let f,p=h.parent.offset+h.parent.length;if(u>0){const g=c.children[u-1];f=g.offset+g.length}else f=c.offset+1,c.children.length>1&&(p=c.children[1].offset);return Bi(t,{offset:f,length:p-f,content:""},i)}else return Bi(t,{offset:h.offset,length:h.length,content:JSON.stringify(s)},i);else{if(s===void 0)return[];const u=`${JSON.stringify(l)}: ${JSON.stringify(s)}`,f=n?n(c.children.map(g=>g.children[0].value)):c.children.length;let p;if(f>0){const g=c.children[f-1];p={offset:g.offset+g.length,length:0,content:","+u}}else c.children.length===0?p={offset:c.offset+1,length:0,content:u}:p={offset:c.offset+1,length:0,content:u+","};return Bi(t,p,i)}}else if(c.type==="array"&&typeof l=="number"&&Array.isArray(c.children))if(s!==void 0){const h=`${JSON.stringify(s)}`;let u;if(c.children.length===0||l===0)u={offset:c.offset+1,length:0,content:c.children.length===0?h:h+","};else{const f=l===-1||l>c.children.length?c.children.length:l,p=c.children[f-1];u={offset:p.offset+p.length,length:0,content:","+h}}return Bi(t,u,i)}else{const h=l,u=c.children[h];let f;if(c.children.length===1)f={offset:c.offset+1,length:c.length-2,content:""};else if(c.children.length-1===h){const p=c.children[h-1],g=p.offset+p.length,m=c.offset+c.length;f={offset:g,length:m-2-g,content:""}}else f={offset:u.offset,length:c.children[h+1].offset-u.offset,content:""};return Bi(t,f,i)}else throw new Error(`Can not add ${typeof l!="number"?"index":"property"} to parent of type ${c.type}`);else return s===void 0?[]:Bi(t,{offset:a?a.offset:0,length:a?a.length:0,content:JSON.stringify(s)},i)}function Bi(t,e,s){let i=Vl(t,e),n=e.offset,r=e.offset+e.content.length;if(e.length===0||e.content.length===0){for(;n>0&&!Xo(i,n-1);)n--;for(;r<i.length&&!Xo(i,r);)r++}const o=M2(i,{offset:n,length:r-n},s);for(let c=o.length-1;c>=0;c--){const l=o[c];i=Vl(i,l),n=Math.min(n,l.offset),r=Math.max(r,l.offset+l.length),r+=l.content.length-l.length}const a=t.length-(i.length-r)-n;return[{offset:n,length:a,content:i.substring(n,r)}]}function Vl(t,e){return t.substring(0,e.offset)+e.content+t.substring(e.offset+e.length)}function ng(t,e){const s=e.slice(0).sort((n,r)=>{const o=n.offset-r.offset;return o===0?n.length-r.length:o});let i=t.length;for(let n=s.length-1;n>=0;n--){const r=s[n];if(r.offset+r.length<=i)t=Vl(t,r);else throw new Error("Overlapping edit");i=r.offset}return t}function qt(t){if(!t||typeof t!="object"||t instanceof RegExp)return t;const e=Array.isArray(t)?[]:{};return Object.entries(t).forEach(([s,i])=>{e[s]=i&&typeof i=="object"?qt(i):i}),e}function U2(t){if(!t||typeof t!="object")return t;const e=[t];for(;e.length>0;){const s=e.shift();Object.freeze(s);for(const i in s)if(rg.call(s,i)){const n=s[i];typeof n=="object"&&!Object.isFrozen(n)&&!zv(n)&&e.push(n)}}return t}var rg=Object.prototype.hasOwnProperty;function ql(t,e){return Wl(t,e,new Set)}function Wl(t,e,s){if(St(t))return t;const i=e(t);if(typeof i<"u")return i;if(Array.isArray(t)){const n=[];for(const r of t)n.push(Wl(r,e,s));return n}if(Be(t)){if(s.has(t))throw new Error("Cannot clone recursive data-structure");s.add(t);const n={};for(const r in t)rg.call(t,r)&&(n[r]=Wl(t[r],e,s));return s.delete(t),n}return t}function Zo(t,e,s=!0){return Be(t)?(Be(e)&&Object.keys(e).forEach(i=>{i in t?s&&(Be(t[i])&&Be(e[i])?Zo(t[i],e[i],s):t[i]=e[i]):t[i]=e[i]}),t):e}function yt(t,e){if(t===e)return!0;if(t==null||e===null||e===void 0||typeof t!=typeof e||typeof t!="object"||Array.isArray(t)!==Array.isArray(e))return!1;let s,i;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(s=0;s<t.length;s++)if(!yt(t[s],e[s]))return!1}else{const n=[];for(i in t)n.push(i);n.sort();const r=[];for(i in e)r.push(i);if(r.sort(),!yt(n,r))return!1;for(s=0;s<n.length;s++)if(!yt(t[n[s]],e[n[s]]))return!1}return!0}function og(t){const e=new Set;return JSON.stringify(t,(s,i)=>{if(Be(i)||Array.isArray(i)){if(e.has(i))return"[Circular]";e.add(i)}return typeof i=="bigint"?`[BigInt ${i.toString()}]`:i})}function Er(t){return Object.isFrozen(t)?t:U2(t)}var tt=class Zi{static createEmptyModel(e){return new Zi({},[],[],void 0,e)}constructor(e,s,i,n,r){this.b=e,this.c=s,this.d=i,this.raw=n,this.f=r,this.a=new Map}get rawConfiguration(){if(!this.g)if(this.raw){const e=(Array.isArray(this.raw)?this.raw:[this.raw]).map(s=>{if(s instanceof Zi)return s;const i=new Hl("",this.f);return i.parseRaw(s),i.configurationModel});this.g=e.reduce((s,i)=>i===s?i:s.merge(i),e[0])}else this.g=this;return this.g}get contents(){return this.b}get overrides(){return this.d}get keys(){return this.c}isEmpty(){return this.c.length===0&&Object.keys(this.b).length===0&&this.d.length===0}getValue(e){return e?Mo(this.contents,e):this.contents}inspect(e,s){const i=this;return{get value(){return Er(i.rawConfiguration.getValue(e))},get override(){return s?Er(i.rawConfiguration.getOverrideValue(e,s)):void 0},get merged(){return Er(s?i.rawConfiguration.override(s).getValue(e):i.rawConfiguration.getValue(e))},get overrides(){const n=[];for(const{contents:r,identifiers:o,keys:a}of i.rawConfiguration.overrides){const c=new Zi(r,a,[],void 0,i.f).getValue(e);c!==void 0&&n.push({identifiers:o,value:c})}return n.length?Er(n):void 0}}}getOverrideValue(e,s){const i=this.j(s);return i?e?Mo(i,e):i:void 0}getKeysForOverrideIdentifier(e){const s=[];for(const i of this.overrides)i.identifiers.includes(e)&&s.push(...i.keys);return Rt(s)}getAllOverrideIdentifiers(){const e=[];for(const s of this.overrides)e.push(...s.identifiers);return Rt(e)}override(e){let s=this.a.get(e);return s||(s=this.h(e),this.a.set(e,s)),s}merge(...e){const s=qt(this.contents),i=qt(this.overrides),n=[...this.keys],r=this.raw?Array.isArray(this.raw)?[...this.raw]:[this.raw]:[this];for(const o of e)if(r.push(...o.raw?Array.isArray(o.raw)?o.raw:[o.raw]:[o]),!o.isEmpty()){this.i(s,o.contents);for(const a of o.overrides){const[c]=i.filter(l=>Tt(l.identifiers,a.identifiers));c?(this.i(c.contents,a.contents),c.keys.push(...a.keys),c.keys=Rt(c.keys)):i.push(qt(a))}for(const a of o.keys)n.indexOf(a)===-1&&n.push(a)}return new Zi(s,n,i,!r.length||r.every(o=>o instanceof Zi)?void 0:r,this.f)}h(e){const s=this.j(e);if(!s||typeof s!="object"||!Object.keys(s).length)return this;const i={};for(const n of Rt([...Object.keys(this.contents),...Object.keys(s)])){let r=this.contents[n];const o=s[n];o&&(typeof r=="object"&&typeof o=="object"?(r=qt(r),this.i(r,o)):r=o),i[n]=r}return new Zi(i,this.keys,this.overrides,void 0,this.f)}i(e,s){for(const i of Object.keys(s)){if(i in e&&Be(e[i])&&Be(s[i])){this.i(e[i],s[i]);continue}e[i]=qt(s[i])}}j(e){let s=null,i=null;const n=r=>{r&&(i?this.i(i,r):i=qt(r))};for(const r of this.overrides)r.identifiers.length===1&&r.identifiers[0]===e?s=r.contents:r.identifiers.includes(e)&&n(r.contents);return n(s),i}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(e,s){this.k(e,s,!0)}setValue(e,s){this.k(e,s,!1)}removeValue(e){const s=this.keys.indexOf(e);s!==-1&&(this.keys.splice(s,1),Yb(this.contents,e),qs.test(e)&&this.overrides.splice(this.overrides.findIndex(i=>Tt(i.identifiers,wr(e))),1))}k(e,s,i){if(cp(this.contents,e,s,n=>this.f.error(n)),i=i||this.keys.indexOf(e)===-1,i&&this.keys.push(e),qs.test(e)){const n=wr(e),r={identifiers:n,keys:Object.keys(this.contents[e]),contents:Sl(this.contents[e],a=>this.f.error(a))},o=this.overrides.findIndex(a=>Tt(a.identifiers,n));o!==-1?this.overrides[o]=r:this.overrides.push(r)}}},Hl=class{constructor(t,e){this.f=t,this.g=e,this.a=null,this.b=null,this.c=[],this.d=[]}get configurationModel(){return this.b||tt.createEmptyModel(this.g)}get restrictedConfigurations(){return this.c}get errors(){return this.d}parse(t,e){if(!St(t)){const s=this.h(t);this.parseRaw(s,e)}}reparse(t){this.a&&this.parseRaw(this.a,t)}parseRaw(t,e){this.a=t;const{contents:s,keys:i,overrides:n,restricted:r,hasExcludedProperties:o}=this.i(t,e);this.b=new tt(s,i,n,o?[t]:void 0,this.g),this.c=r||[]}h(t){let e={},s=null,i=[];const n=[],r=[];function o(c){Array.isArray(i)?i.push(c):s!==null&&(i[s]=c)}const a={onObjectBegin:()=>{const c={};o(c),n.push(i),i=c,s=null},onObjectProperty:c=>{s=c},onObjectEnd:()=>{i=n.pop()},onArrayBegin:()=>{const c=[];o(c),n.push(i),i=c,s=null},onArrayEnd:()=>{i=n.pop()},onLiteralValue:o,onError:(c,l,h)=>{r.push({error:c,offset:l,length:h})}};if(t)try{br(t,a),e=i[0]||{}}catch(c){this.g.error(`Error while parsing settings file ${this.f}: ${c}`),this.d=[c]}return e}i(t,e){const s=Ot.as(ns.Configuration),i=s.getConfigurationProperties(),n=s.getExcludedConfigurationProperties(),r=this.j(t,i,n,!0,e);t=r.raw;const o=Sl(t,l=>this.g.error(`Conflict in settings file ${this.f}: ${l}`)),a=Object.keys(t),c=this.m(t,l=>this.g.error(`Conflict in settings file ${this.f}: ${l}`));return{contents:o,keys:a,overrides:c,restricted:r.restricted,hasExcludedProperties:r.hasExcludedProperties}}j(t,e,s,i,n){let r=!1;if(!n?.scopes&&!n?.skipRestricted&&!n?.skipUnregistered&&!n?.exclude?.length)return{raw:t,restricted:[],hasExcludedProperties:r};const o={},a=[];for(const c in t)if(qs.test(c)&&i){const l=this.j(t[c],e,s,!1,n);o[c]=l.raw,r=r||l.hasExcludedProperties,a.push(...l.restricted)}else{const l=e[c];l?.restricted&&a.push(c),this.l(c,l,s,n)?o[c]=t[c]:r=!0}return{raw:o,restricted:a,hasExcludedProperties:r}}l(t,e,s,i){if(i.exclude?.includes(t))return!1;if(i.include?.includes(t))return!0;if(i.skipRestricted&&e?.restricted||i.skipUnregistered&&!e)return!1;const n=e??s[t],r=n?typeof n.scope<"u"?n.scope:4:void 0;return r===void 0||i.scopes===void 0?!0:i.scopes.includes(r)}m(t,e){const s=[];for(const i of Object.keys(t))if(qs.test(i)){const n={};for(const r in t[i])n[r]=t[i][r];s.push({identifiers:wr(i),keys:Object.keys(n),contents:Sl(n,e)})}return s}},B2=class extends T{constructor(t,e,s,i,n){super(),this.c=t,this.f=e,this.g=i,this.h=n,this.b=this.B(new R),this.onDidChange=this.b.event,this.a=new Hl(this.c.toString(),n),this.B(this.g.watch(s.dirname(this.c))),this.B(this.g.watch(this.c)),this.B(L.any(L.filter(this.g.onDidFilesChange,r=>r.contains(this.c)),L.filter(this.g.onDidRunOperation,r=>(r.isOperation(0)||r.isOperation(3)||r.isOperation(1)||r.isOperation(4))&&s.isEqual(r.resource,t)))(()=>this.b.fire()))}async loadConfiguration(){try{const t=await this.g.readFile(this.c);return this.a.parse(t.value.toString()||"{}",this.f),this.a.configurationModel}catch{return tt.createEmptyModel(this.h)}}reparse(t){return t&&(this.f=t),this.a.reparse(this.f),this.a.configurationModel}getRestrictedSettings(){return this.a.restrictedConfigurations}},z2=class{constructor(t,e,s,i,n,r,o,a,c,l,h,u,f){this.a=t,this.b=e,this.c=s,this.overrideIdentifiers=i,this.d=n,this.f=r,this.g=o,this.h=a,this.i=c,this.j=l,this.k=h,this.l=u,this.m=f}get value(){return Er(this.c)}n(t){return t?.value!==void 0||t?.override!==void 0||t?.overrides!==void 0?t:void 0}get q(){return this.p||(this.p=this.d.inspect(this.a,this.b.overrideIdentifier)),this.p}get defaultValue(){return this.q.merged}get default(){return this.n(this.q)}get s(){return this.r===void 0&&(this.r=this.f?this.f.inspect(this.a):null),this.r}get policyValue(){return this.s?.merged}get policy(){return this.s?.value!==void 0?{value:this.s.value}:void 0}get u(){return this.t===void 0&&(this.t=this.g?this.g.inspect(this.a):null),this.t}get applicationValue(){return this.u?.merged}get application(){return this.n(this.u)}get w(){return this.v||(this.v=this.h.inspect(this.a,this.b.overrideIdentifier)),this.v}get userValue(){return this.w.merged}get user(){return this.n(this.w)}get y(){return this.x||(this.x=this.i.inspect(this.a,this.b.overrideIdentifier)),this.x}get userLocalValue(){return this.y.merged}get userLocal(){return this.n(this.y)}get A(){return this.z||(this.z=this.j.inspect(this.a,this.b.overrideIdentifier)),this.z}get userRemoteValue(){return this.A.merged}get userRemote(){return this.n(this.A)}get D(){return this.B===void 0&&(this.B=this.k?this.k.inspect(this.a,this.b.overrideIdentifier):null),this.B}get workspaceValue(){return this.D?.merged}get workspace(){return this.n(this.D)}get F(){return this.E===void 0&&(this.E=this.l?this.l.inspect(this.a,this.b.overrideIdentifier):null),this.E}get workspaceFolderValue(){return this.F?.merged}get workspaceFolder(){return this.n(this.F)}get H(){return this.G===void 0&&(this.G=this.m.inspect(this.a,this.b.overrideIdentifier)),this.G}get memoryValue(){return this.H.merged}get memory(){return this.n(this.H)}},Gl=class uv{constructor(e,s,i,n,r,o,a,c,l,h){this.j=e,this.l=s,this.m=i,this.n=n,this.p=r,this.q=o,this.r=a,this.s=c,this.t=l,this.u=h,this.h=null,this.i=new lt,this.v=null}getValue(e,s,i){return this.w(e,s,i).getValue(e)}updateValue(e,s,i={}){let n;i.resource?(n=this.t.get(i.resource),n||(n=tt.createEmptyModel(this.u),this.t.set(i.resource,n))):n=this.s,s===void 0?n.removeValue(e):n.setValue(e,s),i.resource||(this.h=null)}inspect(e,s,i){const n=this.w(e,s,i),r=this.A(s.resource,i),o=s.resource?this.t.get(s.resource)||this.s:this.s,a=new Set;for(const c of n.overrides)for(const l of c.identifiers)n.getOverrideValue(e,l)!==void 0&&a.add(l);return new z2(e,s,n.getValue(e),a.size?[...a]:void 0,this.j,this.l.isEmpty()?void 0:this.l,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,i?this.q:void 0,r||void 0,o)}keys(e){const s=this.A(void 0,e);return{default:this.j.keys.slice(0),user:this.userConfiguration.keys.slice(0),workspace:this.q.keys.slice(0),workspaceFolder:s?s.keys.slice(0):[]}}updateDefaultConfiguration(e){this.j=e,this.h=null,this.i.clear()}updatePolicyConfiguration(e){this.l=e}updateApplicationConfiguration(e){this.m=e,this.h=null,this.i.clear()}updateLocalUserConfiguration(e){this.n=e,this.v=null,this.h=null,this.i.clear()}updateRemoteUserConfiguration(e){this.p=e,this.v=null,this.h=null,this.i.clear()}updateWorkspaceConfiguration(e){this.q=e,this.h=null,this.i.clear()}updateFolderConfiguration(e,s){this.r.set(e,s),this.i.delete(e)}deleteFolderConfiguration(e){this.folderConfigurations.delete(e),this.i.delete(e)}compareAndUpdateDefaultConfiguration(e,s){const i=[];if(!s){const{added:n,updated:r,removed:o}=ri(this.j,e);s=[...n,...r,...o]}for(const n of s)for(const r of wr(n)){const o=this.j.getKeysForOverrideIdentifier(r),a=e.getKeysForOverrideIdentifier(r),c=[...a.filter(l=>o.indexOf(l)===-1),...o.filter(l=>a.indexOf(l)===-1),...o.filter(l=>!yt(this.j.override(r).getValue(l),e.override(r).getValue(l)))];i.push([r,c])}return this.updateDefaultConfiguration(e),{keys:s,overrides:i}}compareAndUpdatePolicyConfiguration(e){const{added:s,updated:i,removed:n}=ri(this.l,e),r=[...s,...i,...n];return r.length&&this.updatePolicyConfiguration(e),{keys:r,overrides:[]}}compareAndUpdateApplicationConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ri(this.applicationConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateApplicationConfiguration(e),{keys:o,overrides:r}}compareAndUpdateLocalUserConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ri(this.localUserConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateLocalUserConfiguration(e),{keys:o,overrides:r}}compareAndUpdateRemoteUserConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ri(this.remoteUserConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateRemoteUserConfiguration(e),{keys:o,overrides:r}}compareAndUpdateWorkspaceConfiguration(e){const{added:s,updated:i,removed:n,overrides:r}=ri(this.workspaceConfiguration,e),o=[...s,...i,...n];return o.length&&this.updateWorkspaceConfiguration(e),{keys:o,overrides:r}}compareAndUpdateFolderConfiguration(e,s){const i=this.folderConfigurations.get(e),{added:n,updated:r,removed:o,overrides:a}=ri(i,s),c=[...n,...r,...o];return(c.length||!i)&&this.updateFolderConfiguration(e,s),{keys:c,overrides:a}}compareAndDeleteFolderConfiguration(e){const s=this.folderConfigurations.get(e);if(!s)throw new Error("Unknown folder");this.deleteFolderConfiguration(e);const{added:i,updated:n,removed:r,overrides:o}=ri(s,void 0);return{keys:[...i,...n,...r],overrides:o}}get defaults(){return this.j}get applicationConfiguration(){return this.m}get userConfiguration(){if(!this.v)if(this.p.isEmpty())this.v=this.n;else{const e=this.n.merge(this.p);this.v=new tt(e.contents,e.keys,e.overrides,void 0,this.u)}return this.v}get localUserConfiguration(){return this.n}get remoteUserConfiguration(){return this.p}get workspaceConfiguration(){return this.q}get folderConfigurations(){return this.r}w(e,s,i){let n=this.x(s,i);if(s.overrideIdentifier&&(n=n.override(s.overrideIdentifier)),!this.l.isEmpty()&&this.l.getValue(e)!==void 0){n=n.merge();for(const r of this.l.keys)n.setValue(r,this.l.getValue(r))}return n}x({resource:e},s){let i=this.y();if(s&&e){const n=s.getFolder(e);n&&(i=this.z(n.uri)||i);const r=this.t.get(e);r&&(i=i.merge(r))}return i}y(){return this.h||(this.h=this.j.merge(this.applicationConfiguration,this.userConfiguration,this.q,this.s)),this.h}z(e){let s=this.i.get(e);if(!s){const i=this.y(),n=this.r.get(e);n?(s=i.merge(n),this.i.set(e,s)):s=i}return s}A(e,s){if(s&&e){const i=s.getFolder(e);if(i)return this.r.get(i.uri)}}toData(){return{defaults:{contents:this.j.contents,overrides:this.j.overrides,keys:this.j.keys},policy:{contents:this.l.contents,overrides:this.l.overrides,keys:this.l.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys,raw:Array.isArray(this.applicationConfiguration.raw)?void 0:this.applicationConfiguration.raw},userLocal:{contents:this.localUserConfiguration.contents,overrides:this.localUserConfiguration.overrides,keys:this.localUserConfiguration.keys,raw:Array.isArray(this.localUserConfiguration.raw)?void 0:this.localUserConfiguration.raw},userRemote:{contents:this.remoteUserConfiguration.contents,overrides:this.remoteUserConfiguration.overrides,keys:this.remoteUserConfiguration.keys,raw:Array.isArray(this.remoteUserConfiguration.raw)?void 0:this.remoteUserConfiguration.raw},workspace:{contents:this.q.contents,overrides:this.q.overrides,keys:this.q.keys},folders:[...this.r.keys()].reduce((e,s)=>{const{contents:i,overrides:n,keys:r}=this.r.get(s);return e.push([s,{contents:i,overrides:n,keys:r}]),e},[])}}allKeys(){const e=new Set;return this.j.keys.forEach(s=>e.add(s)),this.userConfiguration.keys.forEach(s=>e.add(s)),this.q.keys.forEach(s=>e.add(s)),this.r.forEach(s=>s.keys.forEach(i=>e.add(i))),[...e.values()]}B(){const e=new Set;return this.j.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.userConfiguration.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.q.getAllOverrideIdentifiers().forEach(s=>e.add(s)),this.r.forEach(s=>s.getAllOverrideIdentifiers().forEach(i=>e.add(i))),[...e.values()]}D(e){const s=new Set;return this.j.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.userConfiguration.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.q.getKeysForOverrideIdentifier(e).forEach(i=>s.add(i)),this.r.forEach(i=>i.getKeysForOverrideIdentifier(e).forEach(n=>s.add(n))),[...s.values()]}static parse(e,s){const i=this.E(e.defaults,s),n=this.E(e.policy,s),r=this.E(e.application,s),o=this.E(e.userLocal,s),a=this.E(e.userRemote,s),c=this.E(e.workspace,s),l=e.folders.reduce((h,u)=>(h.set(k.revive(u[0]),this.E(u[1],s)),h),new lt);return new uv(i,n,r,o,a,c,l,tt.createEmptyModel(s),new lt,s)}static E(e,s){return new tt(e.contents,e.keys,e.overrides,e.raw,s)}},_2=class{constructor(t,e,s,i,n){this.change=t,this.f=e,this.g=s,this.h=i,this.i=n,this.a=`
`,this.b=this.a.charCodeAt(0),this.c=46,this.affectedKeys=new Set,this.j=void 0;for(const r of t.keys)this.affectedKeys.add(r);for(const[,r]of t.overrides)for(const o of r)this.affectedKeys.add(o);this.d=this.a;for(const r of this.affectedKeys)this.d+=r+this.a}get previousConfiguration(){return!this.j&&this.f&&(this.j=Gl.parse(this.f.data,this.i)),this.j}affectsConfiguration(t,e){const s=this.a+t,i=this.d.indexOf(s);if(i<0)return!1;const n=i+s.length;if(n>=this.d.length)return!1;const r=this.d.charCodeAt(n);if(r!==this.b&&r!==this.c)return!1;if(e){const o=this.previousConfiguration?this.previousConfiguration.getValue(t,e,this.f?.workspace):void 0,a=this.g.getValue(t,e,this.h);return!yt(o,a)}return!0}};function ri(t,e){const{added:s,removed:i,updated:n}=ag(e?.rawConfiguration,t?.rawConfiguration),r=[],o=t?.getAllOverrideIdentifiers()||[],a=e?.getAllOverrideIdentifiers()||[];if(e){const c=a.filter(l=>!o.includes(l));for(const l of c)r.push([l,e.getKeysForOverrideIdentifier(l)])}if(t){const c=o.filter(l=>!a.includes(l));for(const l of c)r.push([l,t.getKeysForOverrideIdentifier(l)])}if(e&&t){for(const c of o)if(a.includes(c)){const l=ag({contents:t.getOverrideValue(void 0,c)||{},keys:t.getKeysForOverrideIdentifier(c)},{contents:e.getOverrideValue(void 0,c)||{},keys:e.getKeysForOverrideIdentifier(c)});r.push([c,[...l.added,...l.removed,...l.updated]])}}return{added:s,removed:i,updated:n,overrides:r}}function ag(t,e){const s=t?e?t.keys.filter(r=>e.keys.indexOf(r)===-1):[...t.keys]:[],i=e?t?e.keys.filter(r=>t.keys.indexOf(r)===-1):[...e.keys]:[],n=[];if(t&&e){for(const r of e.keys)if(t.keys.indexOf(r)!==-1){const o=Mo(e.contents,r),a=Mo(t.contents,r);yt(o,a)||n.push(r)}}return{added:s,removed:i,updated:n}}var cg=W("policy"),V2=class extends T{constructor(){super(...arguments),this.policyDefinitions={},this.f=new Map,this.g=this.B(new R),this.onDidChange=this.g.event}async updatePolicyDefinitions(t){const e=Object.keys(this.policyDefinitions).length;return this.policyDefinitions={...t,...this.policyDefinitions},e!==Object.keys(this.policyDefinitions).length&&await this.h(this.policyDefinitions),nn.reduce(this.f.entries(),(s,[i,n])=>({...s,[i]:n}),{})}getPolicyValue(t){return this.f.get(t)}serialize(){return nn.reduce(Object.entries(this.policyDefinitions),(t,[e,s])=>({...t,[e]:{definition:s,value:this.f.get(e)}}),{})}},lg=class{constructor(){this.onDidChange=L.None,this.policyDefinitions={}}async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}},q2=class extends T{get configurationModel(){return this.b}constructor(t){super(),this.c=t,this.a=this.B(new R),this.onDidChangeConfiguration=this.a.event,this.b=tt.createEmptyModel(t)}async initialize(){return this.h(),this.B(Ot.as(ns.Configuration).onDidUpdateConfiguration(({properties:t,defaultsOverrides:e})=>this.f(Array.from(t),e))),this.configurationModel}reload(){return this.h(),this.configurationModel}f(t,e){this.j(t,Ot.as(ns.Configuration).getConfigurationProperties()),this.a.fire({defaults:this.configurationModel,properties:t})}g(){return{}}h(){this.b=tt.createEmptyModel(this.c);const t=Ot.as(ns.Configuration).getConfigurationProperties();this.j(Object.keys(t),t)}j(t,e){const s=this.g();for(const i of t){const n=s[i],r=e[i];n!==void 0?this.b.setValue(i,n):r?this.b.setValue(i,qt(r.default)):this.b.removeValue(i)}}},W2=class{constructor(){this.onDidChangeConfiguration=L.None,this.configurationModel=tt.createEmptyModel(new Qb)}async initialize(){return this.configurationModel}},Jl=class extends T{get configurationModel(){return this.c}constructor(e,s,i){super(),this.f=e,this.g=s,this.h=i,this.a=this.B(new R),this.onDidChangeConfiguration=this.a.event,this.c=tt.createEmptyModel(this.h),this.b=Ot.as(ns.Configuration)}async initialize(){return this.h.trace("PolicyConfiguration#initialize"),this.n(await this.j(this.f.configurationModel.keys),!1),this.n(await this.j(Object.keys(this.b.getExcludedConfigurationProperties())),!1),this.B(this.g.onDidChange(e=>this.m(e))),this.B(this.f.onDidChangeConfiguration(async({properties:e})=>this.n(await this.j(e),!0))),this.c}async j(e){this.h.trace("PolicyConfiguration#updatePolicyDefinitions",e);const s={},i=[],n=this.b.getConfigurationProperties(),r=this.b.getExcludedConfigurationProperties();for(const o of e){const a=n[o]??r[o];if(!a){i.push(o);continue}if(a.policy){if(a.type!=="string"&&a.type!=="number"&&a.type!=="array"&&a.type!=="object"&&a.type!=="boolean"){this.h.warn(`Policy ${a.policy.name} has unsupported type ${a.type}`);continue}const{value:c}=a.policy;i.push(o),s[a.policy.name]={type:a.type==="number"?"number":a.type==="boolean"?"boolean":"string",value:c}}}return Sd(s)||await this.g.updatePolicyDefinitions(s),i}m(e){this.h.trace("PolicyConfiguration#onDidChangePolicies",e);const s=this.b.getPolicyConfigurations(),i=sn(e.map(n=>s.get(n)));this.n(i,!0)}n(e,s){this.h.trace("PolicyConfiguration#update",e);const i=this.b.getConfigurationProperties(),n=this.b.getExcludedConfigurationProperties(),r=[],o=this.c.isEmpty();for(const a of e){const c=i[a]??n[a],l=c?.policy?.name;if(l){let h=this.g.getPolicyValue(l);if($e(h)&&c.type!=="string")try{h=this.r(h)}catch(u){this.h.error(`Error parsing policy value ${l}:`,se(u));continue}(o?h!==void 0:!yt(this.c.getValue(a),h))&&r.push([a,h])}else this.c.getValue(a)!==void 0&&r.push([a,void 0])}if(r.length){this.h.trace("PolicyConfiguration#changed",r);const a=this.c;this.c=tt.createEmptyModel(this.h);for(const c of a.keys)this.c.setValue(c,a.getValue(c));for(const[c,l]of r)l===void 0?this.c.removeValue(c):this.c.setValue(c,l);s&&this.a.fire(this.c)}}r(e){let s={},i=null,n=[];const r=[],o=[];function a(l){if(Array.isArray(n))n.push(l);else if(i!==null){if(n[i]!==void 0)throw new Error(`Duplicate property found: ${i}`);n[i]=l}}if(e&&(br(e,{onObjectBegin:()=>{const l={};a(l),r.push(n),n=l,i=null},onObjectProperty:l=>{i=l},onObjectEnd:()=>{n=r.pop()},onArrayBegin:()=>{const l=[];a(l),r.push(n),n=l,i=null},onArrayEnd:()=>{n=r.pop()},onLiteralValue:a,onError:(l,h,u)=>{o.push({error:l,offset:h,length:u})}}),s=n[0]||{}),o.length>0)throw new Error(o.map(l=>se(l.error)).join(`
`));return s}};Jl=__decorate([__param(1,cg),__param(2,Y)],Jl);var H2=class extends T{constructor(t,e,s,i){super(),this.m=t,this.n=i,this.h=this.B(new R),this.onDidChangeConfiguration=this.h.event,this.b=this.B(new q2(i)),this.c=s instanceof lg?new W2:this.B(new Jl(this.b,s,i)),this.f=this.B(new B2(this.m,{},Xc,e,i)),this.a=new Gl(this.b.configurationModel,this.c.configurationModel,tt.createEmptyModel(i),tt.createEmptyModel(i),tt.createEmptyModel(i),tt.createEmptyModel(i),new lt,tt.createEmptyModel(i),new lt,i),this.j=new G2(t,e,this),this.g=this.B(new fs(()=>this.reloadConfiguration(),50)),this.B(this.b.onDidChangeConfiguration(({defaults:n,properties:r})=>this.s(n,r))),this.B(this.c.onDidChangeConfiguration(n=>this.t(n))),this.B(this.f.onDidChange(()=>this.g.schedule()))}async initialize(){const[t,e,s]=await Promise.all([this.b.initialize(),this.c.initialize(),this.f.loadConfiguration()]);this.a=new Gl(t,e,tt.createEmptyModel(this.n),s,tt.createEmptyModel(this.n),tt.createEmptyModel(this.n),new lt,tt.createEmptyModel(this.n),new lt,this.n)}getConfigurationData(){return this.a.toData()}getValue(t,e){const s=typeof t=="string"?t:void 0,i=bl(t)?t:bl(e)?e:{};return this.a.getValue(s,i,void 0)}async updateValue(t,e,s,i,n){const r=Xb(s)?s:bl(s)?{resource:s.resource,overrideIdentifiers:s.overrideIdentifier?[s.overrideIdentifier]:void 0}:void 0,o=r?i:s;if(o!==void 0&&o!==3&&o!==2)throw new Error(`Unable to write ${t} to target ${o}.`);r?.overrideIdentifiers&&(r.overrideIdentifiers=Rt(r.overrideIdentifiers),r.overrideIdentifiers=r.overrideIdentifiers.length?r.overrideIdentifiers:void 0);const a=this.inspect(t,{resource:r?.resource,overrideIdentifier:r?.overrideIdentifiers?r.overrideIdentifiers[0]:void 0});if(a.policyValue!==void 0)throw new Error(`Unable to write ${t} because it is configured in system policy.`);if(yt(e,a.defaultValue)&&(e=void 0),r?.overrideIdentifiers?.length&&r.overrideIdentifiers.length>1){const l=r.overrideIdentifiers.sort(),h=this.a.localUserConfiguration.overrides.find(u=>Tt([...u.identifiers].sort(),l));h&&(r.overrideIdentifiers=h.identifiers)}const c=r?.overrideIdentifiers?.length?[a2(r.overrideIdentifiers),t]:[t];await this.j.write(c,e),await this.reloadConfiguration()}inspect(t,e={}){return this.a.inspect(t,e,void 0)}keys(){return this.a.keys(void 0)}async reloadConfiguration(){const t=await this.f.loadConfiguration();this.r(t)}r(t){const e=this.a.toData(),s=this.a.compareAndUpdateLocalUserConfiguration(t);this.u(s,e,2)}s(t,e){const s=this.a.toData(),i=this.a.compareAndUpdateDefaultConfiguration(t,e);this.u(i,s,7)}t(t){const e=this.a.toData(),s=this.a.compareAndUpdatePolicyConfiguration(t);this.u(s,e,7)}u(t,e,s){const i=new _2(t,{data:e},this.a,void 0,this.n);i.source=s,this.h.fire(i)}},G2=class{constructor(t,e,s){this.b=t,this.c=e,this.d=s,this.a=new un}write(t,e){return this.a.queue(()=>this.e(t,e))}async e(t,e){let s;try{s=(await this.c.readFile(this.b)).value.toString()}catch(r){if(r.fileOperationResult===1)s="{}";else throw r}const i=[];if(We(s,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0)throw new Error("Unable to write into the settings file. Please open the file to correct errors/warnings in the file and try again.");const n=this.f(s,t,e);s=ng(s,n),await this.c.writeFile(this.b,A.fromString(s))}f(t,e,s){const{tabSize:i,insertSpaces:n,eol:r}=this.h;if(!e.length){const o=JSON.stringify(s,null,n?" ".repeat(i):"	");return[{content:o,length:o.length,offset:0}]}return _l(t,e,s,{tabSize:i,insertSpaces:n,eol:r})}get h(){if(!this.g){let t=an===3||an===2?`
`:`\r
`;const e=this.d.getValue("files.eol",{overrideIdentifier:"jsonc"});e&&typeof e=="string"&&e!=="auto"&&(t=e),this.g={eol:t,insertSpaces:!!this.d.getValue("editor.insertSpaces",{overrideIdentifier:"jsonc"}),tabSize:this.d.getValue("editor.tabSize",{overrideIdentifier:"jsonc"})}}return this.g}},J2="diagnosticsService",hg=W(J2);function ug(t){const e=t;return!!e?.hostName&&!!e?.errorMessage}import*as K2 from"fs";import*as Lt from"os";import{networkInterfaces as Q2}from"os";var X2=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Z2(t){return X2.test(t)}var st=function(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);const t=new Uint8Array(16),e=[];for(let s=0;s<256;s++)e.push(s.toString(16).padStart(2,"0"));return function(){crypto.getRandomValues(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let i=0,n="";return n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+="-",n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n+=e[t[i++]],n}}();import"os";var fg=new class{c(t){return this.a||(this.a=En.forStrings(),this.a.set("00-50-56",!0),this.a.set("00-0C-29",!0),this.a.set("00-05-69",!0),this.a.set("00-03-FF",!0),this.a.set("00-1C-42",!0),this.a.set("00-16-3E",!0),this.a.set("08-00-27",!0),this.a.set("00:50:56",!0),this.a.set("00:0C:29",!0),this.a.set("00:05:69",!0),this.a.set("00:03:FF",!0),this.a.set("00:1C:42",!0),this.a.set("00:16:3E",!0),this.a.set("08:00:27",!0)),!!this.a.findSubstr(t)}value(){if(this.b===void 0){let t=0,e=0;const s=Q2();for(const i in s){const n=s[i];if(n)for(const{mac:r,internal:o}of n)o||(e+=1,this.c(r.toUpperCase())&&(t+=1))}this.b=e>0?t/e:0}return this.b}};import{exec as Yo}from"child_process";import{totalmem as Y2}from"os";function dg(t){return new Promise((e,s)=>{let i;const n=new Map,r=Y2();function o(l,h,u,f,p){const g=n.get(h);if(l===t||g){const m={name:a(u),cmd:u,pid:l,ppid:h,load:f,mem:Ae?p:r*(p/100)};n.set(l,m),l===t&&(i=m),g&&(g.children||(g.children=[]),g.children.push(m),g.children.length>1&&(g.children=g.children.sort((w,b)=>w.pid-b.pid)))}}function a(l){const h=/--utility-sub-type=network/i,u=/--crashes-directory/i,f=/\\pipe\\winpty-control/i,p=/conhost\.exe.+--headless/i,g=/--type=([a-zA-Z-]+)/;if(u.exec(l))return"electron-crash-reporter";if(f.exec(l))return"winpty-agent";if(p.exec(l))return"conpty-agent";let m=g.exec(l);if(m&&m.length===2)return m[1]==="renderer"?"window":m[1]==="utility"?h.exec(l)?"utility-network-service":"utility-process":m[1]==="extensionHost"?"extension-host":m[1];const w=/[a-zA-Z-]+\.js/g;let b="";do m=w.exec(l),m&&(b+=m+" ");while(m);return b&&l.indexOf("node ")<0&&l.indexOf("node.exe")<0?`electron-nodejs (${b})`:l}if(process.platform==="win32"){const l=h=>h.indexOf("\\\\?\\")===0||h.indexOf("\\??\\")===0?h.substring(4):h.indexOf('"\\\\?\\')===0||h.indexOf('"\\??\\')===0?'"'+h.substring(5):h;import("@vscode/windows-process-tree").then(h=>{h.getProcessList(t,u=>{if(!u){s(new Error(`Root process ${t} not found`));return}h.getProcessCpuUsage(u,f=>{const p=new Map;f.forEach(g=>{const m=l(g.commandLine||"");p.set(g.pid,{name:a(m),cmd:m,pid:g.pid,ppid:g.ppid,load:g.cpu||0,mem:g.memory||0})}),i=p.get(t),i?(p.forEach(g=>{const m=p.get(g.ppid);m&&(m.children||(m.children=[]),m.children.push(g))}),p.forEach(g=>{g.children&&(g.children=g.children.sort((m,w)=>m.pid-w.pid))}),e(i)):s(new Error(`Root process ${t} not found`))})},h.ProcessDataFlag.CommandLine|h.ProcessDataFlag.Memory)})}else{let l=function(){let h=[i];const u=[];for(;h.length;){const p=h.shift();p&&(u.push(p.pid),p.children&&(h=h.concat(p.children)))}let f=JSON.stringify(ei.asFileUri("vs/base/node/cpuUsage.sh").fsPath);f+=" "+u.join(" "),Yo(f,{},(p,g,m)=>{if(p||m)s(p||new Error(m.toString()));else{const w=g.toString().split(`
`);for(let b=0;b<u.length;b++){const S=n.get(u[b]);S.load=parseFloat(w[b])}if(!i){s(new Error(`Root process ${t} not found`));return}e(i)}})};var c=l;Yo("which ps",{},(h,u,f)=>{if(h||f)if(process.platform!=="linux")s(h||new Error(f.toString()));else{const p=JSON.stringify(ei.asFileUri("vs/base/node/ps.sh").fsPath);Yo(p,{},(g,m,w)=>{g||w?s(g||new Error(w.toString())):(pg(m,o),l())})}else{const p=u.toString().trim();Yo(`${p} -ax -o pid=,ppid=,pcpu=,pmem=,command=`,{maxBuffer:1e3*1024,env:{LC_NUMERIC:"en_US.UTF-8"}},(m,w,b)=>{m||b&&!b.includes("screen size is bogus")?s(m||new Error(b.toString())):(pg(w,o),process.platform==="linux"?l():i?e(i):s(new Error(`Root process ${t} not found`)))})}})}})}function pg(t,e){const s=/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+\.[0-9]+)\s+([0-9]+\.[0-9]+)\s+(.+)$/,i=t.toString().split(`
`);for(const n of i){const r=s.exec(n.trim());r&&r.length===6&&e(parseInt(r[1]),parseInt(r[2]),r[5],parseFloat(r[3]),parseFloat(r[4]))}}var ke=W("telemetryService"),gg=W("customEndpointTelemetryService"),e5="telemetry",ea="telemetry.telemetryLevel",mg="telemetry.enableCrashReporter",Kl="telemetry.enableTelemetry",wg;(function(t){t[t.NONE=0]="NONE",t[t.CRASH=1]="CRASH",t[t.ERROR=2]="ERROR",t[t.USAGE=3]="USAGE"})(wg||(wg={}));var vg;(function(t){t.OFF="off",t.CRASH="crash",t.ERROR="error",t.ON="all"})(vg||(vg={}));var yg=new Map;async function Ql(t,e){const s=`${t}::${e.join(":")}`,i=yg.get(s);if(i)return i;const n=[{tag:"grunt.js",filePattern:/^gruntfile\.js$/i},{tag:"gulp.js",filePattern:/^gulpfile\.js$/i},{tag:"tsconfig.json",filePattern:/^tsconfig\.json$/i},{tag:"package.json",filePattern:/^package\.json$/i},{tag:"jsconfig.json",filePattern:/^jsconfig\.json$/i},{tag:"tslint.json",filePattern:/^tslint\.json$/i},{tag:"eslint.json",filePattern:/^eslint\.json$/i},{tag:"tasks.json",filePattern:/^tasks\.json$/i},{tag:"launch.json",filePattern:/^launch\.json$/i},{tag:"mcp.json",filePattern:/^mcp\.json$/i},{tag:"settings.json",filePattern:/^settings\.json$/i},{tag:"webpack.config.js",filePattern:/^webpack\.config\.js$/i},{tag:"project.json",filePattern:/^project\.json$/i},{tag:"makefile",filePattern:/^makefile$/i},{tag:"sln",filePattern:/^.+\.sln$/i},{tag:"csproj",filePattern:/^.+\.csproj$/i},{tag:"cmake",filePattern:/^.+\.cmake$/i},{tag:"github-actions",filePattern:/^.+\.ya?ml$/i,relativePathPattern:/^\.github(?:\/|\\)workflows$/i},{tag:"devcontainer.json",filePattern:/^devcontainer\.json$/i},{tag:"dockerfile",filePattern:/^(dockerfile|docker\-compose\.ya?ml)$/i},{tag:"cursorrules",filePattern:/^\.cursorrules$/i},{tag:"cursorrules-dir",filePattern:/\.mdc$/i,relativePathPattern:/^\.cursor[\/\\]rules$/i},{tag:"github-instructions-dir",filePattern:/\.instructions\.md$/i,relativePathPattern:/^\.github[\/\\]instructions$/i},{tag:"github-prompts-dir",filePattern:/\.prompt\.md$/i,relativePathPattern:/^\.github[\/\\]prompts$/i},{tag:"clinerules",filePattern:/^\.clinerules$/i},{tag:"clinerules-dir",filePattern:/\.md$/i,relativePathPattern:/^\.clinerules$/i},{tag:"agent.md",filePattern:/^agent\.md$/i},{tag:"agents.md",filePattern:/^agents\.md$/i},{tag:"claude.md",filePattern:/^claude\.md$/i},{tag:"gemini.md",filePattern:/^gemini\.md$/i},{tag:"copilot-instructions.md",filePattern:/^copilot\-instructions\.md$/i,relativePathPattern:/^\.github$/i}],r=new Map,o=new Map,a=2e4;function c(h,u,f,p){const g=u.substring(h.length+1);return Ze.withAsyncBody(async m=>{let w;p.readdirCount++;try{w=await le.readdir(u,{withFileTypes:!0})}catch{m();return}if(p.count>=a){p.count+=w.length,p.maxReached=!0,m();return}let b=w.length;if(b===0){m();return}let S=w;p.count+w.length>a&&(p.maxReached=!0,b=a-p.count,S=w.slice(0,b)),p.count+=w.length;for(const $ of S)if($.isDirectory()){if(f.includes($.name)||await c(h,J(u,$.name),f,p),--b===0){m();return}}else{const U=$.name.lastIndexOf(".");if(U>=0){const q=$.name.substring(U+1);q&&r.set(q,(r.get(q)??0)+1)}for(const q of n)q.relativePathPattern?.test(g)!==!1&&q.filePattern.test($.name)&&o.set(q.tag,(o.get(q.tag)??0)+1);if(--b===0){m();return}}})}const l=Ze.withAsyncBody(async h=>{const u={count:0,maxReached:!1,readdirCount:0},f=new cn(!0);await c(t,t,e,u);const p=await s5(t);h({configFiles:Xl(o),fileTypes:Xl(r),fileCount:u.count,maxFilesReached:u.maxReached,launchConfigFiles:p,totalScanTime:f.elapsed(),totalReaddirCount:u.readdirCount})});return yg.set(s,l),l}function Xl(t){return Array.from(t.entries(),([e,s])=>({name:e,count:s})).sort((e,s)=>s.count-e.count)}function t5(){const t={os:`${Lt.type()} ${Lt.arch()} ${Lt.release()}`,memory:`${(Lt.totalmem()/vr.GB).toFixed(2)}GB (${(Lt.freemem()/vr.GB).toFixed(2)}GB free)`,vmHint:`${Math.round(fg.value()*100)}%`},e=Lt.cpus();return e&&e.length>0&&(t.cpus=`${e[0].model} (${e.length} x ${e[0].speed})`),t}async function s5(t){try{const e=new Map,s=J(t,".vscode","launch.json"),i=await K2.promises.readFile(s),n=[],r=We(i.toString(),n);if(n.length)return console.log(`Unable to parse ${s}`),[];if(Rn(r)==="object"&&r.configurations)for(const o of r.configurations){const a=o.type;a&&(e.has(a)?e.set(a,e.get(a)+1):e.set(a,1))}return Xl(e)}catch{return[]}}var Zl=class{constructor(e,s){this.c=e,this.d=s}f(e){const s=[];return s.push(`OS Version:       ${e.os}`),s.push(`CPUs:             ${e.cpus}`),s.push(`Memory (System):  ${e.memory}`),s.push(`VM:               ${e.vmHint}`),s.join(`
`)}g(e){const s=[];s.push(`Version:          ${this.d.nameShort} ${this.d.version} (${this.d.commit||"Commit unknown"}, ${this.d.date||"Date unknown"})`),s.push(`OS Version:       ${Lt.type()} ${Lt.arch()} ${Lt.release()}`);const i=Lt.cpus();return i&&i.length>0&&s.push(`CPUs:             ${i[0].model} (${i.length} x ${i[0].speed})`),s.push(`Memory (System):  ${(Lt.totalmem()/vr.GB).toFixed(2)}GB (${(Lt.freemem()/vr.GB).toFixed(2)}GB free)`),Ae||s.push(`Load (avg):       ${Lt.loadavg().map(n=>Math.round(n)).join(", ")}`),s.push(`VM:               ${Math.round(fg.value()*100)}%`),s.push(`Screen Reader:    ${e.screenReader?"yes":"no"}`),s.push(`Process Argv:     ${e.mainArguments.join(" ")}`),s.push(`GPU Status:       ${this.j(e.gpuFeatureStatus)}`),s.join(`
`)}async getPerformanceInfo(e,s){return Promise.all([dg(e.mainPID),this.k(e)]).then(async i=>{let[n,r]=i,o=this.m(e,n);return s.forEach(a=>{if(ug(a))o+=`
${a.errorMessage}`,r+=`
${a.errorMessage}`;else if(o+=`

Remote: ${a.hostName}`,a.processes&&(o+=`
${this.m(e,a.processes)}`),a.workspaceMetadata){r+=`
|  Remote: ${a.hostName}`;for(const c of Object.keys(a.workspaceMetadata)){const l=a.workspaceMetadata[c];let h=`${l.fileCount} files`;l.maxFilesReached&&(h=`more than ${h}`),r+=`|    Folder (${c}): ${h}`,r+=this.h(l)}}}),{processInfo:o,workspaceInfo:r}})}async getSystemInfo(e,s){const{memory:i,vmHint:n,os:r,cpus:o}=t5(),a={os:r,memory:i,cpus:o,vmHint:n,processArgs:`${e.mainArguments.join(" ")}`,gpuStatus:e.gpuFeatureStatus,screenReader:`${e.screenReader?"yes":"no"}`,remoteData:s};return Ae||(a.load=`${Lt.loadavg().map(c=>Math.round(c)).join(", ")}`),wt&&(a.linuxEnv={desktopSession:process.env.DESKTOP_SESSION,xdgSessionDesktop:process.env.XDG_SESSION_DESKTOP,xdgCurrentDesktop:process.env.XDG_CURRENT_DESKTOP,xdgSessionType:process.env.XDG_SESSION_TYPE}),Promise.resolve(a)}async getDiagnostics(e,s){const i=[];return dg(e.mainPID).then(async n=>(i.push(""),i.push(this.g(e)),i.push(""),i.push(this.m(e,n)),e.windows.some(r=>r.folderURIs&&r.folderURIs.length>0&&!r.remoteAuthority)&&(i.push(""),i.push("Workspace Stats: "),i.push(await this.k(e))),s.forEach(r=>{if(ug(r))i.push(`
${r.errorMessage}`);else if(i.push(`

`),i.push(`Remote:           ${r.hostName}`),i.push(this.f(r.machineInfo)),r.processes&&i.push(this.m(e,r.processes)),r.workspaceMetadata)for(const o of Object.keys(r.workspaceMetadata)){const a=r.workspaceMetadata[o];let c=`${a.fileCount} files`;a.maxFilesReached&&(c=`more than ${c}`),i.push(`Folder (${o}): ${c}`),i.push(this.h(a))}}),i.push(""),i.push(""),i.join(`
`)))}h(e){const s=[];let n=0;const r=(l,h)=>{const u=` ${l}(${h})`;n+u.length>60?(s.push(o),o="|                 ",n=o.length):n+=u.length,o+=u};let o="|      File types:";const a=10,c=e.fileTypes.length>a?a:e.fileTypes.length;for(let l=0;l<c;l++){const h=e.fileTypes[l];r(h.name,h.count)}if(s.push(o),e.configFiles.length>=0&&(o="|      Conf files:",n=0,e.configFiles.forEach(l=>{r(l.name,l.count)}),s.push(o)),e.launchConfigFiles.length>0){let l="|      Launch Configs:";e.launchConfigFiles.forEach(h=>{const u=h.count>1?` ${h.name}(${h.count})`:` ${h.name}`;l+=u}),s.push(l)}return s.join(`
`)}j(e){const s=Math.max(...Object.keys(e).map(i=>i.length));return Object.keys(e).map(i=>`${i}:  ${" ".repeat(s-i.length)}  ${e[i]}`).join(`
                  `)}k(e){const s=[],i=[];return e.windows.forEach(n=>{n.folderURIs.length===0||n.remoteAuthority||(s.push(`|  Window (${n.title})`),n.folderURIs.forEach(r=>{const o=k.revive(r);if(o.scheme===oe.file){const a=o.fsPath;i.push(Ql(a,["node_modules",".git"]).then(c=>{let l=`${c.fileCount} files`;c.maxFilesReached&&(l=`more than ${l}`),s.push(`|    Folder (${Ct(a)}): ${l}`),s.push(this.h(c))}).catch(c=>{s.push(`|      Error: Unable to collect workspace stats for folder ${a} (${c.toString()})`)}))}else s.push(`|    Folder (${o.toString()}): Workspace stats not available.`)}))}),Promise.all(i).then(n=>s.join(`
`)).catch(n=>`Unable to collect workspace stats: ${n}`)}m(e,s){const i=new Map;e.windows.forEach(r=>i.set(r.pid,`window [${r.id}] (${r.title})`)),e.pidToNames.forEach(({pid:r,name:o})=>i.set(r,o));const n=[];return n.push("CPU %	Mem MB	   PID	Process"),s&&this.n(e.mainPID,i,n,s,0),n.join(`
`)}n(e,s,i,n,r){const o=r===0;let a;o?a=n.pid===e?this.d.applicationName:"remote-server":s.has(n.pid)?a=s.get(n.pid):a=`${"  ".repeat(r)} ${n.name}`;const c=process.platform==="win32"?n.mem:Lt.totalmem()*(n.mem/100);i.push(`${n.load.toFixed(0).padStart(5," ")}	${(c/vr.MB).toFixed(0).padStart(6," ")}	${n.pid.toFixed(0).padStart(6," ")}	${a}`),Array.isArray(n.children)&&n.children.forEach(l=>this.n(e,s,i,l,r+1))}async getWorkspaceFileExtensions(e){const s=new Set;for(const{uri:i}of e.folders){const n=k.revive(i);if(n.scheme!==oe.file)continue;const r=n.fsPath;try{(await Ql(r,["node_modules",".git"])).fileTypes.forEach(a=>s.add(a.name))}catch{}}return{extensions:[...s]}}async reportWorkspaceStats(e){for(const{uri:s}of e.folders){const i=k.revive(s);if(i.scheme!==oe.file)continue;const n=i.fsPath;try{const r=await Ql(n,["node_modules",".git"]);this.c.publicLog2("workspace.stats",{"workspace.id":e.telemetryId,rendererSessionId:e.rendererSessionId}),r.fileTypes.forEach(o=>{this.c.publicLog2("workspace.stats.file",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),r.launchConfigFiles.forEach(o=>{this.c.publicLog2("workspace.stats.launchConfigFile",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),r.configFiles.forEach(o=>{this.c.publicLog2("workspace.stats.configFiles",{rendererSessionId:e.rendererSessionId,type:o.name,count:o.count})}),this.c.publicLog2("workspace.stats.metadata",{duration:r.totalScanTime,reachedLimit:r.maxFilesReached,fileCount:r.fileCount,readdirCount:r.totalReaddirCount})}catch{}}}};Zl=__decorate([__param(0,ke),__param(1,pe)],Zl);var bg=W("downloadService"),oi=W("requestService"),i5=class{constructor(t){this.b=t}toJSON(){if(!this.a){const t=Object.create(null);for(const e in this.b)e.toLowerCase()==="authorization"||e.toLowerCase()==="proxy-authorization"?t[e]="*****":t[e]=this.b[e];this.a=t}return this.a}},n5=class extends T{constructor(t){super(),this.b=t,this.a=0}async c(t,e){const s=`#${++this.a}: ${t.url}`;this.b.trace(`${s} - begin`,t.type,new i5(t.headers??{}));try{const i=await e();return this.b.trace(`${s} - end`,t.type,i.res.statusCode,i.res.headers),i}catch(i){throw this.b.error(`${s} - error`,t.type,se(i)),i}}};function Cn(t){return t.res.statusCode&&t.res.statusCode>=200&&t.res.statusCode<300||t.res.statusCode===1223}function r5(t){return!!t.res.statusCode&&t.res.statusCode>=400&&t.res.statusCode<500}function o5(t){return!!t.res.statusCode&&t.res.statusCode>=500&&t.res.statusCode<600}function Yl(t){return t.res.statusCode===204}async function eh(t){return Yl(t)?null:(await Li(t.stream)).toString()}async function xs(t){if(!Cn(t))throw new Error("Server returned "+t.res.statusCode);return eh(t)}async function ps(t){if(!Cn(t))throw new Error("Server returned "+t.res.statusCode);if(Yl(t))return null;const s=(await Li(t.stream)).toString();try{return JSON.parse(s)}catch(i){throw i.message+=`:
`+s,i}}var th=[],Sg=void 0,Eg=void 0;function a5(t=!0,e=!0){if(Sg===t&&Eg===e)return;Sg=t,Eg=e;const s=Ot.as(ns.Configuration),i=th;th=[{id:"http",order:15,title:v(2256,null),type:"object",scope:2,properties:{"http.useLocalProxyConfiguration":{type:"boolean",default:e,markdownDescription:v(2257,null),restricted:!0}}},{id:"http",order:15,title:v(2258,null),type:"object",scope:1,properties:{"http.electronFetch":{type:"boolean",default:!1,description:v(2259,null),restricted:!0}}},{id:"http",order:15,title:v(2260,null),type:"object",scope:t?1:2,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:v(2261,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,markdownDescription:v(2262,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:v(2263,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:v(2264,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:v(2265,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[v(2266,null),v(2267,null),v(2268,null),v(2269,null)],default:"override",markdownDescription:v(2270,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,markdownDescription:v(2271,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,markdownDescription:v(2272,null,"`#http.useLocalProxyConfiguration#`"),restricted:!0},"http.fetchAdditionalSupport":{type:"boolean",default:!0,markdownDescription:v(2273,null,"`#http.useLocalProxyConfiguration#`","`#http.proxySupport#`","`#http.systemCertificates#`"),restricted:!0}}}],s.updateConfigurations({add:th,remove:i})}a5();var sh=class{constructor(e,s){this.a=e,this.b=s}async download(e,s,i=Q.None){if(e.scheme===oe.file||e.scheme===oe.vscodeRemote){await this.b.copy(e,s);return}const n={type:"GET",url:e.toString(!0)},r=await this.a.request(n,i);if(r.res.statusCode===200)await this.b.writeFile(s,r.stream);else{const o=await xs(r);throw new Error(`Expected 200, got back ${r.res.statusCode} instead.

${o}`)}}};sh=__decorate([__param(0,oi),__param(1,K)],sh);var $g="extensions.user.cache",c5="extensions.builtin.cache",xg="undefined_publisher",kg;(function(t){t[t.System=0]="System",t[t.User=1]="User"})(kg||(kg={}));var Pg;(function(t){t.WIN32_X64="win32-x64",t.WIN32_ARM64="win32-arm64",t.LINUX_X64="linux-x64",t.LINUX_ARM64="linux-arm64",t.LINUX_ARMHF="linux-armhf",t.ALPINE_X64="alpine-x64",t.ALPINE_ARM64="alpine-arm64",t.DARWIN_X64="darwin-x64",t.DARWIN_ARM64="darwin-arm64",t.WEB="web",t.UNIVERSAL="universal",t.UNKNOWN="unknown",t.UNDEFINED="undefined"})(Pg||(Pg={}));var Dn=class{constructor(t){this.value=t,this._lower=t.toLowerCase()}static equals(t,e){if(typeof t>"u"||t===null)return typeof e>"u"||e===null;if(typeof e>"u"||e===null)return!1;if(typeof t=="string"||typeof e=="string"){const s=typeof t=="string"?t:t.value,i=typeof e=="string"?e:e.value;return Pi(s,i)}return t._lower===e._lower}static toKey(t){return typeof t=="string"?t.toLowerCase():t._lower}},l5=class{constructor(){this.c=new Map}clear(){this.c.clear()}delete(t){this.c.delete(Dn.toKey(t))}get(t){return this.c.get(Dn.toKey(t))}has(t){return this.c.has(Dn.toKey(t))}set(t,e){this.c.set(Dn.toKey(t),e)}values(){return this.c.values()}forEach(t){this.c.forEach(t)}[Symbol.iterator](){return this.c[Symbol.iterator]()}};function ih(t){return h5(t)}function h5(t){return t.contributes&&t.contributes.localizations?t.contributes.localizations.length>0:!1}function u5(t){return t.map(e=>{const[s,i]=e.split("@");return{proposalName:s,version:i?parseInt(i):void 0}})}function f5(t){return t.map(e=>e.split("@")[0])}var lE=W("IBuiltinExtensionsScannerService");function d5(t){if(Zn===2&&/^penguin(\.|$)/i.test(t))return"chromebook"}function p5(t,e,s,i,n,r,o,a,c,l,h){const u=Object.create(null);u["common.machineId"]=r,u["common.sqmId"]=o,u["common.devDeviceId"]=a,u.sessionID=st()+Date.now(),u.commitHash=i,u.version=n,u["common.releaseDate"]=l,u["common.platformVersion"]=(t||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),u["common.platform"]=Ud(Zn),u["common.nodePlatform"]=i1,u["common.nodeArch"]=s,u["common.product"]=h||"desktop",c&&(u["common.msftInternal"]=c);let f=0;const p=Date.now();Object.defineProperties(u,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-p,enumerable:!0},"common.sequence":{get:()=>f++,enumerable:!0}}),ay&&(u["common.snap"]="true");const g=d5(e);return g&&(u["common.platformDetail"]=g),u}function g5(t){const e=Ne.USERDNSDOMAIN;if(!e)return!1;const s=e.toLowerCase();return t.some(i=>s===i)}var ta=class{constructor(t){this.value=t,this.isTrustedTelemetryValue=!0}},m5=class{constructor(){this.telemetryLevel=0,this.sessionId="someValue.sessionId",this.machineId="someValue.machineId",this.sqmId="someValue.sqmId",this.devDeviceId="someValue.devDeviceId",this.firstSessionDate="someValue.firstSessionDate",this.sendErrorTelemetry=!1}publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},w5=new m5,Rg="telemetry",v5={id:Rg,name:v(2297,null)},y5={log:()=>null,flush:()=>Promise.resolve(void 0)};function Cg(t,e){return!e.isBuilt&&!e.disableTelemetry?!0:!(e.disableTelemetry||!t.enableTelemetry)}function Dg(t,e){return e.extensionTestsLocationURI?!0:!(e.isBuilt||e.disableTelemetry||t.enableTelemetry&&t.aiConfig?.ariaKey)}function Ig(t){const e=t.getValue(ea),s=t.getValue(mg);if(t.getValue(Kl)===!1||s===!1)return 0;switch(e??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}function Og(t){const e={},s={},i={};Lg(t,i);for(let n in i){n=n.length>150?n.substr(n.length-149):n;const r=i[n];typeof r=="number"?s[n]=r:typeof r=="boolean"?s[n]=r?1:0:typeof r=="string"?(r.length>8192&&console.warn(`Telemetry property: ${n} has been trimmed to 8192, the original length is ${r.length}`),e[n]=r.substring(0,8191)):typeof r<"u"&&r!==null&&(e[n]=r)}return{properties:e,measurements:s}}function Lg(t,e,s=0,i){if(t)for(const n of Object.getOwnPropertyNames(t)){const r=t[n],o=i?i+n:n;Array.isArray(r)?e[o]=og(r):r instanceof Date?e[o]=r.toISOString():Be(r)?s<2?Lg(r,e,s+1,o+"."):e[o]=og(r):e[o]=r}}function b5(t,e){const s=t.msftInternalDomains||[],i=e.getValue("telemetry.internalTesting");return g5(s)||i}function S5(t){return[t.appRoot,t.extensionsPath,t.userHome.fsPath,t.tmpDir.fsPath,t.userDataPath]}function E5(t,e){if(!t||!t.includes("/")&&!t.includes("\\"))return t;let s=t;const i=[];for(const a of e)for(;;){const c=a.exec(t);if(!c)break;i.push([c.index,a.lastIndex])}const n=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,r=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g;let o=0;for(s="";;){const a=r.exec(t);if(!a)break;const c=i.some(([l,h])=>a.index<h&&l<r.lastIndex);!n.test(a[0])&&!c&&(s+=t.substring(o,a.index)+"<REDACTED: user-file-path>",o=r.lastIndex)}return o<t.length&&(s+=t.substr(o)),s}function $5(t){if(!t)return t;const e=[{label:"URL",regex:/[a-zA-Z][a-zA-Z0-9+.-]*:\/\/[^\s]*/},{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"JWT",regex:/eyJ[0eXAiOiJKV1Qi|hbGci|a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Microsoft Entra ID",regex:/eyJ(?:0eXAiOiJKV1Qi|hbGci|[a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+\.)/},{label:"Email",regex:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/}];for(const s of e)if(s.regex.test(t))return`<REDACTED: ${s.label}>`;return t}function x5(t,e){return ql(t,s=>{if(s instanceof ta||Object.hasOwnProperty.call(s,"isTrustedTelemetryValue"))return s.value;if(typeof s=="string"){let i=s.replaceAll("%20"," ");i=E5(i,e);for(const n of e)i=i.replace(n,"");return i=$5(i),i}})}function G(t,e){return t.uuid&&e.uuid?t.uuid===e.uuid:t.id===e.id?!0:Eo(t.id,e.id)===0}var k5=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/,Wt=class Ec{static create(e){const s=e.manifest?e.manifest.version:e.version,i=e.manifest?e.targetPlatform:e.properties.targetPlatform;return new Ec(e.identifier,s,i)}static parse(e){const s=k5.exec(e);return s&&s[1]&&s[2]?new Ec({id:s[1]},s[2],s[4]||void 0):null}constructor(e,s,i="undefined"){this.identifier=e,this.version=s,this.targetPlatform=i,this.id=e.id}toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(e){return e instanceof Ec?G(this,e)&&this.version===e.version&&this.targetPlatform===e.targetPlatform:!1}},P5=/^([^.]+\..+)@((prerelease)|(\d+\.\d+\.\d+(-.*)?))$/;function R5(t){const e=P5.exec(t);return e&&e[1]?[$r(e[1]),e[2]]:[$r(t),void 0]}function sa(t,e){return`${t}.${e}`}function $r(t){return t.toLowerCase()}function ks(t,e){return $r(sa(t??xg,e))}function Ag(t,e){const s=[],i=n=>{for(const r of s)if(r.some(o=>G(e(o),e(n))))return r;return null};for(const n of t){const r=i(n);r?r.push(n):s.push([n])}return s}function C5(t){return{id:t.identifier.id,name:t.manifest.name,galleryId:null,publisherId:t.publisherId,publisherName:t.manifest.publisher,publisherDisplayName:t.publisherDisplayName,dependencies:t.manifest.extensionDependencies&&t.manifest.extensionDependencies.length>0}}function nh(t){return{id:new ta(t.identifier.id),name:new ta(t.name),extensionVersion:t.version,galleryId:t.identifier.uuid,publisherId:t.publisherId,publisherName:t.publisher,publisherDisplayName:t.publisherDisplayName,isPreReleaseVersion:t.properties.isPreReleaseVersion,dependencies:!!(t.properties.dependencies&&t.properties.dependencies.length>0),isSigned:t.isSigned,...t.telemetryData}}var hE=new Dn("pprice.better-merge");async function D5(t,e){if(!wt)return!1;let s;try{s=(await t.readFile(k.file("/etc/os-release"))).value.toString()}catch{try{s=(await t.readFile(k.file("/usr/lib/os-release"))).value.toString()}catch(n){e.debug("Error while getting the os-release file.",se(n))}}return!!s&&(s.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}async function Ng(t,e){const s=await D5(t,e),i=bp(s?"alpine":Zn,n1);return e.debug("ComputeTargetPlatform:",i),i}function I5(t,e){return O5(t,e)!==void 0}function O5(t,e){return e.find(({extensionOrPublisher:s})=>$e(s)?Eo(t.id.split(".")[0],s)===0:G(t,s))}function rh(t){const e=[];typeof t=="number"&&e.push("code/timeOrigin",t);function s(n,r){e.push(n,r?.startTime??Date.now())}function i(){const n=[];for(let r=0;r<e.length;r+=2)n.push({name:e[r],startTime:e[r+1]});return n}return{mark:s,getMarks:i}}function L5(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?rh():{mark(t,e){performance.mark(t,e)},getMarks(){let t=performance.timeOrigin;typeof t!="number"&&(t=(performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart)??0);const e=[{name:"code/timeOrigin",startTime:Math.round(t)}];for(const s of performance.getEntriesByType("mark"))e.push({name:s.name,startTime:Math.round(t+s.startTime)});return e}};if(typeof process=="object"){const t=performance?.timeOrigin;return rh(t)}else return console.trace("perf-util loaded in UNKNOWN environment"),rh()}function A5(t){return t.MonacoPerformanceMarks||(t.MonacoPerformanceMarks=L5()),t.MonacoPerformanceMarks}var jg=A5(globalThis),zi=jg.mark,uE=jg.getMarks,xr;(function(t){t[t.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",t[t.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(xr||(xr={}));var gs;(function(t){t[t.None=0]="None",t[t.Initialized=1]="Initialized",t[t.Closed=2]="Closed"})(gs||(gs={}));var ia=class fv extends T{static{this.a=100}constructor(e,s=Object.create(null)){super(),this.r=e,this.s=s,this.b=this.B(new qc),this.onDidChangeStorage=this.b.event,this.c=gs.None,this.f=new Map,this.g=this.B(new Ii(fv.a)),this.h=new Set,this.j=new Map,this.m=void 0,this.n=[],this.t()}t(){this.B(this.r.onDidChangeItemsExternal(e=>this.u(e)))}u(e){this.b.pause();try{e.changed?.forEach((s,i)=>this.w(i,s)),e.deleted?.forEach(s=>this.w(s,void 0))}finally{this.b.resume()}}w(e,s){if(this.c===gs.Closed)return;let i=!1;St(s)?i=this.f.delete(e):this.f.get(e)!==s&&(this.f.set(e,s),i=!0),i&&this.b.fire({key:e,external:!0})}get items(){return this.f}get size(){return this.f.size}async init(){this.c===gs.None&&(this.c=gs.Initialized,this.s.hint!==xr.STORAGE_DOES_NOT_EXIST&&(this.f=await this.r.getItems()))}get(e,s){const i=this.f.get(e);return St(i)?s:i}getBoolean(e,s){const i=this.get(e);return St(i)?s:i==="true"}getNumber(e,s){const i=this.get(e);return St(i)?s:parseInt(i,10)}getObject(e,s){const i=this.get(e);return St(i)?s:J4(i)}async set(e,s,i=!1){if(this.c===gs.Closed)return;if(St(s))return this.delete(e,i);const n=Be(s)||Array.isArray(s)?G4(s):String(s);if(this.f.get(e)!==n)return this.f.set(e,n),this.j.set(e,n),this.h.delete(e),this.b.fire({key:e,external:i}),this.D()}async delete(e,s=!1){if(!(this.c===gs.Closed||!this.f.delete(e)))return this.h.has(e)||this.h.add(e),this.j.delete(e),this.b.fire({key:e,external:s}),this.D()}async optimize(){if(this.c!==gs.Closed)return await this.flush(0),this.r.optimize()}async close(){return this.m||(this.m=this.y()),this.m}async y(){this.c=gs.Closed;try{await this.D(0)}catch{}await this.r.close(()=>this.f)}get z(){return this.j.size>0||this.h.size>0}async C(){if(!this.z)return;const e={insert:this.j,delete:this.h};return this.h=new Set,this.j=new Map,this.r.updateItems(e).finally(()=>{if(!this.z)for(;this.n.length;)this.n.pop()?.()})}async flush(e){if(!(this.c===gs.Closed||this.m))return this.D(e)}async D(e){return this.s.hint===xr.STORAGE_IN_MEMORY?this.C():this.g.trigger(()=>this.C(),e)}async whenFlushed(){if(this.z)return new Promise(e=>this.n.push(e))}isInMemory(){return this.s.hint===xr.STORAGE_IN_MEMORY}},he=W("IUriIdentityService"),Tg;(function(t){t.Settings="settings",t.Keybindings="keybindings",t.Snippets="snippets",t.Prompts="prompts",t.Tasks="tasks",t.Extensions="extensions",t.GlobalState="globalState",t.Mcp="mcp"})(Tg||(Tg={}));function Mg(t){const e=t;return!!(e&&typeof e=="object"&&typeof e.id=="string"&&typeof e.isDefault=="boolean"&&typeof e.name=="string"&&k.isUri(e.location)&&k.isUri(e.globalStorageHome)&&k.isUri(e.settingsResource)&&k.isUri(e.keybindingsResource)&&k.isUri(e.tasksResource)&&k.isUri(e.snippetsHome)&&k.isUri(e.promptsHome)&&k.isUri(e.extensionsResource)&&k.isUri(e.mcpResource))}var je=W("IUserDataProfilesService");function Yt(t,e){return{id:t.id,isDefault:t.isDefault,name:t.name,icon:t.icon,location:k.revive(t.location).with({scheme:e}),globalStorageHome:k.revive(t.globalStorageHome).with({scheme:e}),settingsResource:k.revive(t.settingsResource).with({scheme:e}),keybindingsResource:k.revive(t.keybindingsResource).with({scheme:e}),tasksResource:k.revive(t.tasksResource).with({scheme:e}),snippetsHome:k.revive(t.snippetsHome).with({scheme:e}),promptsHome:k.revive(t.promptsHome).with({scheme:e}),extensionsResource:k.revive(t.extensionsResource).with({scheme:e}),mcpResource:k.revive(t.mcpResource).with({scheme:e}),cacheHome:k.revive(t.cacheHome).with({scheme:e}),useDefaultFlags:t.useDefaultFlags,isTransient:t.isTransient,workspaces:t.workspaces?.map(s=>k.revive(s))}}function na(t,e,s,i,n,r){return{id:t,name:e,location:s,isDefault:!1,icon:n?.icon,globalStorageHome:r&&n?.useDefaultFlags?.globalState?r.globalStorageHome:_(s,"globalStorage"),settingsResource:r&&n?.useDefaultFlags?.settings?r.settingsResource:_(s,"settings.json"),keybindingsResource:r&&n?.useDefaultFlags?.keybindings?r.keybindingsResource:_(s,"keybindings.json"),tasksResource:r&&n?.useDefaultFlags?.tasks?r.tasksResource:_(s,"tasks.json"),snippetsHome:r&&n?.useDefaultFlags?.snippets?r.snippetsHome:_(s,"snippets"),promptsHome:r&&n?.useDefaultFlags?.prompts?r.promptsHome:_(s,"prompts"),extensionsResource:r&&n?.useDefaultFlags?.extensions?r.extensionsResource:_(s,"extensions.json"),mcpResource:r&&n?.useDefaultFlags?.mcp?r.mcpResource:_(s,"mcp.json"),cacheHome:_(i,t),useDefaultFlags:n?.useDefaultFlags,isTransient:n?.transient,workspaces:n?.workspaces}}var Fg=class extends T{static{this.b="userDataProfiles"}static{this.c="profileAssociations"}get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.C.profiles,...this.r.profiles]}constructor(e,s,i,n){super(),this.s=e,this.t=s,this.u=i,this.y=n,this.g=this.B(new R),this.onDidChangeProfiles=this.g.event,this.h=this.B(new R),this.onWillCreateProfile=this.h.event,this.j=this.B(new R),this.onWillRemoveProfile=this.j.event,this.m=this.B(new R),this.onDidResetWorkspaces=this.m.event,this.n=new Map,this.r={profiles:[],emptyWindows:new Map},this.profilesHome=_(this.s.userRoamingDataHome,"profiles"),this.f=_(this.s.cacheHome,"CachedProfilesData")}init(){this.z=void 0}get C(){if(!this.z){const e=this.D(),s=[e];try{for(const n of this.N()){if(!n.name||!$e(n.name)||!n.location){this.y.warn("Skipping the invalid stored profile",n.location||n.name);continue}s.push(na(tr(n.location),n.name,n.location,this.f,{icon:n.icon,useDefaultFlags:n.useDefaultFlags},e))}}catch(n){this.y.error(n)}const i=new Map;if(s.length)try{const n=this.P();if(n.workspaces)for(const[r,o]of Object.entries(n.workspaces)){const a=k.parse(r),c=s.find(l=>l.id===o);if(c){const l=c.workspaces?c.workspaces.slice(0):[];l.push(a),c.workspaces=l}}if(n.emptyWindows)for(const[r,o]of Object.entries(n.emptyWindows)){const a=s.find(c=>c.id===o);a&&i.set(r,a)}}catch(n){this.y.error(n)}this.z={profiles:s,emptyWindows:i}}return this.z}D(){const e=na("__default__profile__",v(2666,null),this.s.userRoamingDataHome,this.f);return{...e,extensionsResource:this.R()??e.extensionsResource,isDefault:!0}}async createTransientProfile(e){const s="Temp",i=new RegExp(`${ki(s)}\\s(\\d+)`);let n=0;for(const o of this.profiles){const a=i.exec(o.name),c=a?parseInt(a[1]):0;n=c>n?c:n}const r=`${s} ${n+1}`;return this.createProfile(vn(st()).toString(16),r,{transient:!0},e)}async createNamedProfile(e,s,i){return this.createProfile(vn(st()).toString(16),e,s,i)}async createProfile(e,s,i,n){return await this.F(e,s,i,n)}async F(e,s,i,n){if(!$e(s)||!s)throw new Error("Name of the profile is mandatory and must be of type `string`");let r=this.n.get(s);return r||(r=(async()=>{try{if(this.profiles.find(h=>h.id===e||!h.isTransient&&!i?.transient&&h.name===s))throw new Error(`Profile with ${s} name already exists`);const a=n?this.G(n):void 0;k.isUri(a)&&(i={...i,workspaces:[a]});const c=na(e,s,_(this.profilesHome,e),this.f,i,this.defaultProfile);await this.t.createFolder(c.location);const l=[];return this.h.fire({profile:c,join(h){l.push(h)}}),await Ze.settled(l),a&&!k.isUri(a)&&this.L(a,c,!!c.isTransient),this.I([c],[],[]),c}finally{this.n.delete(s)}})(),this.n.set(s,r)),r}async updateProfile(e,s){const i=[];for(const r of this.profiles){let o;if(e.id===r.id)r.isDefault?s.workspaces&&(o=r,o.workspaces=s.workspaces):o=na(r.id,s.name??r.name,r.location,this.f,{icon:s.icon===null?void 0:s.icon??r.icon,transient:s.transient??r.isTransient,useDefaultFlags:s.useDefaultFlags??r.useDefaultFlags,workspaces:s.workspaces??r.workspaces},this.defaultProfile);else if(s.workspaces){const a=r.workspaces?.filter(c=>!s.workspaces?.some(l=>this.u.extUri.isEqual(c,l)));r.workspaces?.length!==a?.length&&(o=r,o.workspaces=a)}o&&i.push(o)}if(!i.length)throw e.isDefault?new Error("Cannot update default profile"):new Error(`Profile '${e.name}' does not exist`);this.I([],[],i);const n=this.profiles.find(r=>r.id===e.id);if(!n)throw new Error(`Profile '${e.name}' was not updated`);return n}async removeProfile(e){if(e.isDefault)throw new Error("Cannot remove default profile");const s=this.profiles.find(n=>n.id===e.id);if(!s)throw new Error(`Profile '${e.name}' does not exist`);const i=[];this.j.fire({profile:s,join(n){i.push(n)}});try{await Promise.allSettled(i)}catch(n){this.y.error(n)}this.I([],[s],[]);try{await this.t.del(s.cacheHome,{recursive:!0})}catch(n){Me(n)!==1&&this.y.error(n)}}async setProfileForWorkspace(e,s){const i=this.profiles.find(r=>r.id===s.id);if(!i)throw new Error(`Profile '${s.name}' does not exist`);const n=this.G(e);if(k.isUri(n)){const r=i.workspaces?[...i.workspaces]:[];r.some(o=>this.u.extUri.isEqual(o,n))||(r.push(n),await this.updateProfile(i,{workspaces:r}))}else this.L(n,i,!1),this.M(this.profiles)}unsetWorkspace(e,s=!1){const i=this.G(e);if(k.isUri(i)){const n=this.getProfileForWorkspace(e);n&&this.updateProfile(n,{workspaces:n.workspaces?.filter(r=>!this.u.extUri.isEqual(r,i))})}else this.L(i,void 0,s),this.M(this.profiles)}async resetWorkspaces(){this.r.emptyWindows.clear(),this.C.emptyWindows.clear();for(const e of this.profiles)e.workspaces=void 0;this.I([],[],this.profiles),this.m.fire()}async cleanUp(){if(await this.t.exists(this.profilesHome)){const e=await this.t.resolve(this.profilesHome);await Promise.all((e.children||[]).filter(s=>s.isDirectory&&this.profiles.every(i=>!this.u.extUri.isEqual(i.location,s.resource))).map(s=>this.t.del(s.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){const e=this.r.profiles.filter(s=>!this.H(s));await Promise.allSettled(e.map(s=>this.removeProfile(s)))}getProfileForWorkspace(e){const s=this.G(e);return k.isUri(s)?this.profiles.find(i=>i.workspaces?.some(n=>this.u.extUri.isEqual(n,s))):this.C.emptyWindows.get(s)??this.r.emptyWindows.get(s)}G(e){return k2(e)?e.uri:R2(e)?e.configPath:e.id}H(e){return!!(e.workspaces?.length||[...this.C.emptyWindows.values()].some(s=>this.u.extUri.isEqual(s.location,e.location))||[...this.r.emptyWindows.values()].some(s=>this.u.extUri.isEqual(s.location,e.location)))}I(e,s,i){const n=[...this.profiles,...e],r=this.r.profiles;this.r.profiles=[];const o=[];for(let a of n){if(s.some(c=>a.id===c.id)){for(const c of[...this.C.emptyWindows.keys()])a.id===this.C.emptyWindows.get(c)?.id&&this.C.emptyWindows.delete(c);continue}if(!a.isDefault){a=i.find(l=>a.id===l.id)??a;const c=r.find(l=>a.id===l.id);if(a.isTransient)this.r.profiles.push(a);else if(c){for(const[l,h]of this.r.emptyWindows.entries())if(a.id===h.id){this.r.emptyWindows.delete(l),this.C.emptyWindows.set(l,a);break}}}a.workspaces?.length===0&&(a.workspaces=void 0),o.push(a)}this.M(o),this.J(e,s,i)}J(e,s,i){this.g.fire({added:e,removed:s,updated:i,all:this.profiles})}L(e,s,i){i=s?.isTransient?!0:i,i?s?this.r.emptyWindows.set(e,s):this.r.emptyWindows.delete(e):(this.r.emptyWindows.delete(e),s?this.C.emptyWindows.set(e,s):this.C.emptyWindows.delete(e))}M(e){const s=[],i={},n={};for(const r of e)if(!r.isTransient&&(r.isDefault||s.push({location:r.location,name:r.name,icon:r.icon,useDefaultFlags:r.useDefaultFlags}),r.workspaces))for(const o of r.workspaces)i[o.toString()]=r.id;for(const[r,o]of this.C.emptyWindows.entries())n[r.toString()]=o.id;this.Q({workspaces:i,emptyWindows:n}),this.O(s),this.z=void 0}N(){return[]}O(e){throw new Error("not implemented")}P(){return{}}Q(e){throw new Error("not implemented")}R(){}};Fg=__decorate([__param(0,ae),__param(1,K),__param(2,he),__param(3,Y)],Fg);var N5="__$__isNewStorageMarker",ra="__$__targetStorageMarker",ne=W("storageService"),_i;(function(t){t[t.NONE=0]="NONE",t[t.SHUTDOWN=1]="SHUTDOWN"})(_i||(_i={}));var Ug;(function(t){t[t.APPLICATION=-1]="APPLICATION",t[t.PROFILE=0]="PROFILE",t[t.WORKSPACE=1]="WORKSPACE"})(Ug||(Ug={}));var Bg;(function(t){t[t.USER=0]="USER",t[t.MACHINE=1]="MACHINE"})(Bg||(Bg={}));function j5(t){const e=t.get(ra);if(e)try{return JSON.parse(e)}catch{}return Object.create(null)}var zg=class dv extends T{static{this.a=60*1e3}constructor(e={flushInterval:dv.a}){super(),this.b=this.B(new qc),this.f=this.B(new qc),this.onDidChangeTarget=this.f.event,this.g=this.B(new R),this.onWillSaveState=this.g.event,this.m=this.B(new hs),this.C=void 0,this.F=void 0,this.H=void 0,this.j=this.B(new fs(()=>this.n(),e.flushInterval))}onDidChangeValue(e,s,i){return L.filter(this.b.event,n=>n.scope===e&&(s===void 0||n.key===s),i)}n(){this.m.value=D1(()=>{this.r()&&this.flush(),this.j.schedule()})}r(){return!0}t(){Xt([this.m,this.j])}initialize(){return this.h||(this.h=(async()=>{zi("code/willInitStorage");try{await this.O()}finally{zi("code/didInitStorage")}this.j.schedule()})()),this.h}u(e,s){const{key:i,external:n}=s;if(i===ra){switch(e){case-1:this.H=void 0;break;case 0:this.F=void 0;break;case 1:this.C=void 0;break}this.f.fire({scope:e})}else this.b.fire({scope:e,key:i,target:this.J(e)[i],external:n})}w(e){this.g.fire({reason:e})}get(e,s,i){return this.P(s)?.get(e,i)}getBoolean(e,s,i){return this.P(s)?.getBoolean(e,i)}getNumber(e,s,i){return this.P(s)?.getNumber(e,i)}getObject(e,s,i){return this.P(s)?.getObject(e,i)}storeAll(e,s){this.y(()=>{for(const i of e)this.store(i.key,i.value,i.scope,i.target,s)})}store(e,s,i,n,r=!1){if(St(s)){this.remove(e,i,r);return}this.y(()=>{this.z(e,i,n),this.P(i)?.set(e,s,r)})}remove(e,s,i=!1){this.y(()=>{this.z(e,s,void 0),this.P(s)?.delete(e,i)})}y(e){this.b.pause(),this.f.pause();try{e()}finally{this.b.resume(),this.f.resume()}}keys(e,s){const i=[],n=this.J(e);for(const r of Object.keys(n))n[r]===s&&i.push(r);return i}z(e,s,i,n=!1){const r=this.J(s);typeof i=="number"?r[e]!==i&&(r[e]=i,this.P(s)?.set(ra,JSON.stringify(r),n)):typeof r[e]=="number"&&(delete r[e],this.P(s)?.set(ra,JSON.stringify(r),n))}get D(){return this.C||(this.C=this.L(1)),this.C}get G(){return this.F||(this.F=this.L(0)),this.F}get I(){return this.H||(this.H=this.L(-1)),this.H}J(e){switch(e){case-1:return this.I;case 0:return this.G;default:return this.D}}L(e){const s=this.P(e);return s?j5(s):Object.create(null)}isNew(e){return this.getBoolean(N5,e)===!0}async flush(e=_i.NONE){this.g.fire({reason:e});const s=this.P(-1),i=this.P(0),n=this.P(1);switch(e){case _i.NONE:await Ze.settled([s?.whenFlushed()??Promise.resolve(),i?.whenFlushed()??Promise.resolve(),n?.whenFlushed()??Promise.resolve()]);break;case _i.SHUTDOWN:await Ze.settled([s?.flush(0)??Promise.resolve(),i?.flush(0)??Promise.resolve(),n?.flush(0)??Promise.resolve()]);break}}async log(){const e=this.P(-1)?.items??new Map,s=this.P(0)?.items??new Map,i=this.P(1)?.items??new Map;return T5(e,s,i,this.Q(-1)??"",this.Q(0)??"",this.Q(1)??"")}async optimize(e){return await this.flush(),this.P(e)?.optimize()}async switch(e,s){return this.w(_i.NONE),Mg(e)?this.R(e,s):this.S(e,s)}M(e,s){return!(e.id===s.id||oa(s)&&oa(e))}N(e,s,i){this.y(()=>{const n=new Set;for(const[r,o]of e)n.add(r),s.get(r)!==o&&this.u(i,{key:r,external:!0});for(const[r]of s.items)n.has(r)||this.u(i,{key:r,external:!0})})}};function oa(t){return t.isDefault||!!t.useDefaultFlags?.globalState}async function T5(t,e,s,i,n,r){const o=m=>{try{return JSON.parse(m)}catch{return m}},a=new Map,c=new Map;t.forEach((m,w)=>{a.set(w,m),c.set(w,o(m))});const l=new Map,h=new Map;e.forEach((m,w)=>{l.set(w,m),h.set(w,o(m))});const u=new Map,f=new Map;s.forEach((m,w)=>{u.set(w,m),f.set(w,o(m))}),console.group(i!==n?`Storage: Application (path: ${i})`:`Storage: Application & Profile (path: ${i}, default profile)`);const p=[];if(a.forEach((m,w)=>{p.push({key:w,value:m})}),console.table(p),console.groupEnd(),console.log(c),i!==n){console.group(`Storage: Profile (path: ${n}, profile specific)`);const m=[];l.forEach((w,b)=>{m.push({key:b,value:w})}),console.table(m),console.groupEnd(),console.log(h)}console.group(`Storage: Workspace (path: ${r})`);const g=[];u.forEach((m,w)=>{g.push({key:w,value:m})}),console.table(g),console.groupEnd(),console.log(f)}var aa=class extends T{constructor(e,s){super(),this.a=new R,this.onDidChangeEnablement=this.a.event,this.b=this.B(new M5(e)),this.B(this.b.onDidChange(i=>this.a.fire({extensions:i,source:"storage"}))),this.B(s.onDidInstallExtensions(i=>i.forEach(({local:n,operation:r})=>{n&&r===4&&this.f(n.identifier)})))}async enableExtension(e,s){return this.f(e)?(this.a.fire({extensions:[e],source:s}),!0):!1}async disableExtension(e,s){return this.c(e)?(this.a.fire({extensions:[e],source:s}),!0):!1}getDisabledExtensions(){return this.h(kl)}async getDisabledExtensionsAsync(){return this.getDisabledExtensions()}c(e){const s=this.getDisabledExtensions();return s.every(i=>!G(i,e))?(s.push(e),this.g(s),!0):!1}f(e){const s=this.getDisabledExtensions();for(let i=0;i<s.length;i++){const n=s[i];if(G(n,e))return s.splice(i,1),this.g(s),!0}return!1}g(e){this.j(kl,e)}h(e){return this.b.get(e,0)}j(e,s){this.b.set(e,s,0)}};aa=__decorate([__param(0,ne),__param(1,Hs)],aa);var M5=class extends T{constructor(t){super(),this.c=t,this.a=Object.create(null),this.b=this.B(new R),this.onDidChange=this.b.event,this.B(t.onDidChangeValue(0,void 0,this.q)(e=>this.f(e)))}get(t,e){let s;return e===0?(St(this.a[t])&&(this.a[t]=this.g(t,e)),s=this.a[t]):s=this.g(t,e),JSON.parse(s)}set(t,e,s){const i=JSON.stringify(e.map(({id:r,uuid:o})=>({id:r,uuid:o})));this.g(t,s)!==i&&(s===0&&(e.length?this.a[t]=i:delete this.a[t]),this.h(t,e.length?i:void 0,s))}f(t){if(!St(this.a[t.key])&&this.g(t.key,t.scope)!==this.a[t.key]){const s=this.get(t.key,t.scope);delete this.a[t.key];const i=this.get(t.key,t.scope),n=s.filter(o=>!i.some(a=>G(o,a))),r=i.filter(o=>!s.some(a=>G(a,o)));(n.length||r.length)&&this.b.fire([...n,...r])}}g(t,e){return this.c.get(t,e,"[]")}h(t,e,s){e?this.c.store(t,e,s,1):this.c.remove(t,s)}},ca={},ue={exports:ca};(function(t,e){if(typeof ca=="object"&&typeof ue=="object")ue.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var s=e();for(var i in s)(typeof ca=="object"?ca:t)[i]=s[i]}})(typeof self<"u"?self:void 0,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(i,n,r){s.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:r})},s.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},s.t=function(i,n){if(1&n&&(i=s(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var o in i)s.d(r,o,function(a){return i[a]}.bind(null,o));return r},s.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return s.d(n,"a",n),n},s.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},s.p="",s(s.s=0)}([function(t,e,s){(function(i){var n;e=t.exports=be,n=typeof i=="object"&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?function(){var y=Array.prototype.slice.call(arguments,0);y.unshift("SEMVER"),console.log.apply(console,y)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var r=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,a=e.re=[],c=e.src=[],l=0,h=l++;c[h]="0|[1-9]\\d*";var u=l++;c[u]="[0-9]+";var f=l++;c[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=l++;c[p]="("+c[h]+")\\.("+c[h]+")\\.("+c[h]+")";var g=l++;c[g]="("+c[u]+")\\.("+c[u]+")\\.("+c[u]+")";var m=l++;c[m]="(?:"+c[h]+"|"+c[f]+")";var w=l++;c[w]="(?:"+c[u]+"|"+c[f]+")";var b=l++;c[b]="(?:-("+c[m]+"(?:\\."+c[m]+")*))";var S=l++;c[S]="(?:-?("+c[w]+"(?:\\."+c[w]+")*))";var $=l++;c[$]="[0-9A-Za-z-]+";var U=l++;c[U]="(?:\\+("+c[$]+"(?:\\."+c[$]+")*))";var q=l++,me="v?"+c[p]+c[b]+"?"+c[U]+"?";c[q]="^"+me+"$";var N="[v=\\s]*"+c[g]+c[S]+"?"+c[U]+"?",E=l++;c[E]="^"+N+"$";var P=l++;c[P]="((?:<|>)?=?)";var z=l++;c[z]=c[u]+"|x|X|\\*";var B=l++;c[B]=c[h]+"|x|X|\\*";var j=l++;c[j]="[v=\\s]*("+c[B]+")(?:\\.("+c[B]+")(?:\\.("+c[B]+")(?:"+c[b]+")?"+c[U]+"?)?)?";var O=l++;c[O]="[v=\\s]*("+c[z]+")(?:\\.("+c[z]+")(?:\\.("+c[z]+")(?:"+c[S]+")?"+c[U]+"?)?)?";var D=l++;c[D]="^"+c[P]+"\\s*"+c[j]+"$";var M=l++;c[M]="^"+c[P]+"\\s*"+c[O]+"$";var F=l++;c[F]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var V=l++;c[V]="(?:~>?)";var ee=l++;c[ee]="(\\s*)"+c[V]+"\\s+",a[ee]=new RegExp(c[ee],"g");var we=l++;c[we]="^"+c[V]+c[j]+"$";var Ge=l++;c[Ge]="^"+c[V]+c[O]+"$";var Je=l++;c[Je]="(?:\\^)";var ts=l++;c[ts]="(\\s*)"+c[Je]+"\\s+",a[ts]=new RegExp(c[ts],"g");var vi=l++;c[vi]="^"+c[Je]+c[j]+"$";var Ks=l++;c[Ks]="^"+c[Je]+c[O]+"$";var en=l++;c[en]="^"+c[P]+"\\s*("+N+")$|^$";var Qs=l++;c[Qs]="^"+c[P]+"\\s*("+me+")$|^$";var yi=l++;c[yi]="(\\s*)"+c[P]+"\\s*("+N+"|"+c[j]+")",a[yi]=new RegExp(c[yi],"g");var no=l++;c[no]="^\\s*("+c[j]+")\\s+-\\s+("+c[j]+")\\s*$";var hd=l++;c[hd]="^\\s*("+c[O]+")\\s+-\\s+("+c[O]+")\\s*$";var ud=l++;c[ud]="(<|>)?=?\\s*\\*";for(var bi=0;bi<35;bi++)n(bi,c[bi]),a[bi]||(a[bi]=new RegExp(c[bi]));function Si(y,x){if(y instanceof be)return y;if(typeof y!="string"||y.length>r||!(x?a[E]:a[q]).test(y))return null;try{return new be(y,x)}catch{return null}}function be(y,x){if(y instanceof be){if(y.loose===x)return y;y=y.version}else if(typeof y!="string")throw new TypeError("Invalid Version: "+y);if(y.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof be))return new be(y,x);n("SemVer",y,x),this.loose=x;var C=y.trim().match(x?a[E]:a[q]);if(!C)throw new TypeError("Invalid Version: "+y);if(this.raw=y,this.major=+C[1],this.minor=+C[2],this.patch=+C[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");C[4]?this.prerelease=C[4].split(".").map(function(H){if(/^[0-9]+$/.test(H)){var X=+H;if(X>=0&&X<o)return X}return H}):this.prerelease=[],this.build=C[5]?C[5].split("."):[],this.format()}e.parse=Si,e.valid=function(y,x){var C=Si(y,x);return C?C.version:null},e.clean=function(y,x){var C=Si(y.trim().replace(/^[=v]+/,""),x);return C?C.version:null},e.SemVer=be,be.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},be.prototype.toString=function(){return this.version},be.prototype.compare=function(y){return n("SemVer.compare",this.version,this.loose,y),y instanceof be||(y=new be(y,this.loose)),this.compareMain(y)||this.comparePre(y)},be.prototype.compareMain=function(y){return y instanceof be||(y=new be(y,this.loose)),tn(this.major,y.major)||tn(this.minor,y.minor)||tn(this.patch,y.patch)},be.prototype.comparePre=function(y){if(y instanceof be||(y=new be(y,this.loose)),this.prerelease.length&&!y.prerelease.length)return-1;if(!this.prerelease.length&&y.prerelease.length)return 1;if(!this.prerelease.length&&!y.prerelease.length)return 0;var x=0;do{var C=this.prerelease[x],H=y.prerelease[x];if(n("prerelease compare",x,C,H),C===void 0&&H===void 0)return 0;if(H===void 0)return 1;if(C===void 0)return-1;if(C!==H)return tn(C,H)}while(++x)},be.prototype.inc=function(y,x){switch(y){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",x);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",x);break;case"prepatch":this.prerelease.length=0,this.inc("patch",x),this.inc("pre",x);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",x),this.inc("pre",x);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var C=this.prerelease.length;--C>=0;)typeof this.prerelease[C]=="number"&&(this.prerelease[C]++,C=-2);C===-1&&this.prerelease.push(0)}x&&(this.prerelease[0]===x?isNaN(this.prerelease[1])&&(this.prerelease=[x,0]):this.prerelease=[x,0]);break;default:throw new Error("invalid increment argument: "+y)}return this.format(),this.raw=this.version,this},e.inc=function(y,x,C,H){typeof C=="string"&&(H=C,C=void 0);try{return new be(y,C).inc(x,H).version}catch{return null}},e.diff=function(y,x){if(xc(y,x))return null;var C=Si(y),H=Si(x);if(C.prerelease.length||H.prerelease.length){for(var X in C)if((X==="major"||X==="minor"||X==="patch")&&C[X]!==H[X])return"pre"+X;return"prerelease"}for(var X in C)if((X==="major"||X==="minor"||X==="patch")&&C[X]!==H[X])return X},e.compareIdentifiers=tn;var fd=/^[0-9]+$/;function tn(y,x){var C=fd.test(y),H=fd.test(x);return C&&H&&(y=+y,x=+x),C&&!H?-1:H&&!C?1:y<x?-1:y>x?1:0}function js(y,x,C){return new be(y,C).compare(new be(x,C))}function ro(y,x,C){return js(y,x,C)>0}function oo(y,x,C){return js(y,x,C)<0}function xc(y,x,C){return js(y,x,C)===0}function dd(y,x,C){return js(y,x,C)!==0}function kc(y,x,C){return js(y,x,C)>=0}function Pc(y,x,C){return js(y,x,C)<=0}function ao(y,x,C,H){var X;switch(x){case"===":typeof y=="object"&&(y=y.version),typeof C=="object"&&(C=C.version),X=y===C;break;case"!==":typeof y=="object"&&(y=y.version),typeof C=="object"&&(C=C.version),X=y!==C;break;case"":case"=":case"==":X=xc(y,C,H);break;case"!=":X=dd(y,C,H);break;case">":X=ro(y,C,H);break;case">=":X=kc(y,C,H);break;case"<":X=oo(y,C,H);break;case"<=":X=Pc(y,C,H);break;default:throw new TypeError("Invalid operator: "+x)}return X}function ss(y,x){if(y instanceof ss){if(y.loose===x)return y;y=y.value}if(!(this instanceof ss))return new ss(y,x);n("comparator",y,x),this.loose=x,this.parse(y),this.semver===Vn?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}e.rcompareIdentifiers=function(y,x){return tn(x,y)},e.major=function(y,x){return new be(y,x).major},e.minor=function(y,x){return new be(y,x).minor},e.patch=function(y,x){return new be(y,x).patch},e.compare=js,e.compareLoose=function(y,x){return js(y,x,!0)},e.rcompare=function(y,x,C){return js(x,y,C)},e.sort=function(y,x){return y.sort(function(C,H){return e.compare(C,H,x)})},e.rsort=function(y,x){return y.sort(function(C,H){return e.rcompare(C,H,x)})},e.gt=ro,e.lt=oo,e.eq=xc,e.neq=dd,e.gte=kc,e.lte=Pc,e.cmp=ao,e.Comparator=ss;var Vn={};function _e(y,x){if(y instanceof _e)return y.loose===x?y:new _e(y.raw,x);if(y instanceof ss)return new _e(y.value,x);if(!(this instanceof _e))return new _e(y,x);if(this.loose=x,this.raw=y,this.set=y.split(/\s*\|\|\s*/).map(function(C){return this.parseRange(C.trim())},this).filter(function(C){return C.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+y);this.format()}function Pt(y){return!y||y.toLowerCase()==="x"||y==="*"}function vv(y,x,C,H,X,ct,Se,Nt,Ke,bt,ws,Qe,gt){return((x=Pt(C)?"":Pt(H)?">="+C+".0.0":Pt(X)?">="+C+"."+H+".0":">="+x)+" "+(Nt=Pt(Ke)?"":Pt(bt)?"<"+(+Ke+1)+".0.0":Pt(ws)?"<"+Ke+"."+(+bt+1)+".0":Qe?"<="+Ke+"."+bt+"."+ws+"-"+Qe:"<="+Nt)).trim()}function yv(y,x){for(var C=0;C<y.length;C++)if(!y[C].test(x))return!1;if(x.prerelease.length){for(C=0;C<y.length;C++)if(n(y[C].semver),y[C].semver!==Vn&&y[C].semver.prerelease.length>0){var H=y[C].semver;if(H.major===x.major&&H.minor===x.minor&&H.patch===x.patch)return!0}return!1}return!0}function co(y,x,C){try{x=new _e(x,C)}catch{return!1}return x.test(y)}function Rc(y,x,C,H){var X,ct,Se,Nt,Ke;switch(y=new be(y,H),x=new _e(x,H),C){case">":X=ro,ct=Pc,Se=oo,Nt=">",Ke=">=";break;case"<":X=oo,ct=kc,Se=ro,Nt="<",Ke="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(co(y,x,H))return!1;for(var bt=0;bt<x.set.length;++bt){var ws=x.set[bt],Qe=null,gt=null;if(ws.forEach(function(jt){jt.semver===Vn&&(jt=new ss(">=0.0.0")),Qe=Qe||jt,gt=gt||jt,X(jt.semver,Qe.semver,H)?Qe=jt:Se(jt.semver,gt.semver,H)&&(gt=jt)}),Qe.operator===Nt||Qe.operator===Ke||(!gt.operator||gt.operator===Nt)&&ct(y,gt.semver)||gt.operator===Ke&&Se(y,gt.semver))return!1}return!0}ss.prototype.parse=function(y){var x=this.loose?a[en]:a[Qs],C=y.match(x);if(!C)throw new TypeError("Invalid comparator: "+y);this.operator=C[1],this.operator==="="&&(this.operator=""),C[2]?this.semver=new be(C[2],this.loose):this.semver=Vn},ss.prototype.toString=function(){return this.value},ss.prototype.test=function(y){return n("Comparator.test",y,this.loose),this.semver===Vn||(typeof y=="string"&&(y=new be(y,this.loose)),ao(y,this.operator,this.semver,this.loose))},ss.prototype.intersects=function(y,x){if(!(y instanceof ss))throw new TypeError("a Comparator is required");var C;if(this.operator==="")return C=new _e(y.value,x),co(this.value,C,x);if(y.operator==="")return C=new _e(this.value,x),co(y.semver,C,x);var H=!(this.operator!==">="&&this.operator!==">"||y.operator!==">="&&y.operator!==">"),X=!(this.operator!=="<="&&this.operator!=="<"||y.operator!=="<="&&y.operator!=="<"),ct=this.semver.version===y.semver.version,Se=!(this.operator!==">="&&this.operator!=="<="||y.operator!==">="&&y.operator!=="<="),Nt=ao(this.semver,"<",y.semver,x)&&(this.operator===">="||this.operator===">")&&(y.operator==="<="||y.operator==="<"),Ke=ao(this.semver,">",y.semver,x)&&(this.operator==="<="||this.operator==="<")&&(y.operator===">="||y.operator===">");return H||X||ct&&Se||Nt||Ke},e.Range=_e,_e.prototype.format=function(){return this.range=this.set.map(function(y){return y.join(" ").trim()}).join("||").trim(),this.range},_e.prototype.toString=function(){return this.range},_e.prototype.parseRange=function(y){var x=this.loose;y=y.trim(),n("range",y,x);var C=x?a[hd]:a[no];y=y.replace(C,vv),n("hyphen replace",y),y=y.replace(a[yi],"$1$2$3"),n("comparator trim",y,a[yi]),y=(y=(y=y.replace(a[ee],"$1~")).replace(a[ts],"$1^")).split(/\s+/).join(" ");var H=x?a[en]:a[Qs],X=y.split(" ").map(function(ct){return function(Se,Nt){return n("comp",Se),Se=function(Ke,bt){return Ke.trim().split(/\s+/).map(function(ws){return function(Qe,gt){n("caret",Qe,gt);var jt=gt?a[Ks]:a[vi];return Qe.replace(jt,function(cs,te,fe,Oe,Ue){var mt;return n("caret",Qe,cs,te,fe,Oe,Ue),Pt(te)?mt="":Pt(fe)?mt=">="+te+".0.0 <"+(+te+1)+".0.0":Pt(Oe)?mt=te==="0"?">="+te+"."+fe+".0 <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+".0 <"+(+te+1)+".0.0":Ue?(n("replaceCaret pr",Ue),Ue.charAt(0)!=="-"&&(Ue="-"+Ue),mt=te==="0"?fe==="0"?">="+te+"."+fe+"."+Oe+Ue+" <"+te+"."+fe+"."+(+Oe+1):">="+te+"."+fe+"."+Oe+Ue+" <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+"."+Oe+Ue+" <"+(+te+1)+".0.0"):(n("no pr"),mt=te==="0"?fe==="0"?">="+te+"."+fe+"."+Oe+" <"+te+"."+fe+"."+(+Oe+1):">="+te+"."+fe+"."+Oe+" <"+te+"."+(+fe+1)+".0":">="+te+"."+fe+"."+Oe+" <"+(+te+1)+".0.0"),n("caret return",mt),mt})}(ws,bt)}).join(" ")}(Se,Nt),n("caret",Se),Se=function(Ke,bt){return Ke.trim().split(/\s+/).map(function(ws){return function(Qe,gt){var jt=gt?a[Ge]:a[we];return Qe.replace(jt,function(cs,te,fe,Oe,Ue){var mt;return n("tilde",Qe,cs,te,fe,Oe,Ue),Pt(te)?mt="":Pt(fe)?mt=">="+te+".0.0 <"+(+te+1)+".0.0":Pt(Oe)?mt=">="+te+"."+fe+".0 <"+te+"."+(+fe+1)+".0":Ue?(n("replaceTilde pr",Ue),Ue.charAt(0)!=="-"&&(Ue="-"+Ue),mt=">="+te+"."+fe+"."+Oe+Ue+" <"+te+"."+(+fe+1)+".0"):mt=">="+te+"."+fe+"."+Oe+" <"+te+"."+(+fe+1)+".0",n("tilde return",mt),mt})}(ws,bt)}).join(" ")}(Se,Nt),n("tildes",Se),Se=function(Ke,bt){return n("replaceXRanges",Ke,bt),Ke.split(/\s+/).map(function(ws){return function(Qe,gt){Qe=Qe.trim();var jt=gt?a[M]:a[D];return Qe.replace(jt,function(cs,te,fe,Oe,Ue,mt){n("xRange",Qe,cs,te,fe,Oe,Ue,mt);var pd=Pt(fe),qn=pd||Pt(Oe),Wn=qn||Pt(Ue);return te==="="&&Wn&&(te=""),pd?cs=te===">"||te==="<"?"<0.0.0":"*":te&&Wn?(qn&&(Oe=0),Wn&&(Ue=0),te===">"?(te=">=",qn?(fe=+fe+1,Oe=0,Ue=0):Wn&&(Oe=+Oe+1,Ue=0)):te==="<="&&(te="<",qn?fe=+fe+1:Oe=+Oe+1),cs=te+fe+"."+Oe+"."+Ue):qn?cs=">="+fe+".0.0 <"+(+fe+1)+".0.0":Wn&&(cs=">="+fe+"."+Oe+".0 <"+fe+"."+(+Oe+1)+".0"),n("xRange return",cs),cs})}(ws,bt)}).join(" ")}(Se,Nt),n("xrange",Se),Se=function(Ke,bt){return n("replaceStars",Ke,bt),Ke.trim().replace(a[ud],"")}(Se,Nt),n("stars",Se),Se}(ct,x)}).join(" ").split(/\s+/);return this.loose&&(X=X.filter(function(ct){return!!ct.match(H)})),X=X.map(function(ct){return new ss(ct,x)})},_e.prototype.intersects=function(y,x){if(!(y instanceof _e))throw new TypeError("a Range is required");return this.set.some(function(C){return C.every(function(H){return y.set.some(function(X){return X.every(function(ct){return H.intersects(ct,x)})})})})},e.toComparators=function(y,x){return new _e(y,x).set.map(function(C){return C.map(function(H){return H.value}).join(" ").trim().split(" ")})},_e.prototype.test=function(y){if(!y)return!1;typeof y=="string"&&(y=new be(y,this.loose));for(var x=0;x<this.set.length;x++)if(yv(this.set[x],y))return!0;return!1},e.satisfies=co,e.maxSatisfying=function(y,x,C){var H=null,X=null;try{var ct=new _e(x,C)}catch{return null}return y.forEach(function(Se){ct.test(Se)&&(H&&X.compare(Se)!==-1||(X=new be(H=Se,C)))}),H},e.minSatisfying=function(y,x,C){var H=null,X=null;try{var ct=new _e(x,C)}catch{return null}return y.forEach(function(Se){ct.test(Se)&&(H&&X.compare(Se)!==1||(X=new be(H=Se,C)))}),H},e.validRange=function(y,x){try{return new _e(y,x).range||"*"}catch{return null}},e.ltr=function(y,x,C){return Rc(y,x,"<",C)},e.gtr=function(y,x,C){return Rc(y,x,">",C)},e.outside=Rc,e.prerelease=function(y,x){var C=Si(y,x);return C&&C.prerelease.length?C.prerelease:null},e.intersects=function(y,x,C){return y=new _e(y,C),x=new _e(x,C),y.intersects(x)},e.coerce=function(y){if(y instanceof be)return y;if(typeof y!="string")return null;var x=y.match(a[F]);return x==null?null:Si((x[1]||"0")+"."+(x[2]||"0")+"."+(x[3]||"0"))}}).call(this,s(1))},function(t,e){var s,i,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(w){if(s===setTimeout)return setTimeout(w,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(w,0);try{return s(w,0)}catch{try{return s.call(null,w,0)}catch{return s.call(this,w,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:r}catch{s=r}try{i=typeof clearTimeout=="function"?clearTimeout:o}catch{i=o}})();var c,l=[],h=!1,u=-1;function f(){h&&c&&(h=!1,c.length?l=c.concat(l):u=-1,l.length&&p())}function p(){if(!h){var w=a(f);h=!0;for(var b=l.length;b;){for(c=l,l=[];++u<b;)c&&c[u].run();u=-1,b=l.length}c=null,h=!1,function(S){if(i===clearTimeout)return clearTimeout(S);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(S);try{i(S)}catch{try{return i.call(null,S)}catch{return i.call(this,S)}}}(w)}}function g(w,b){this.fun=w,this.array=b}function m(){}n.nextTick=function(w){var b=new Array(arguments.length-1);if(arguments.length>1)for(var S=1;S<arguments.length;S++)b[S-1]=arguments[S];l.push(new g(w,b)),l.length!==1||h||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(w){return[]},n.binding=function(w){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(w){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}])});var pE=ue.exports.SEMVER_SPEC_VERSION,gE=ue.exports.parse,F5=ue.exports.valid,mE=ue.exports.coerce,wE=ue.exports.clean,vE=ue.exports.inc,yE=ue.exports.major,bE=ue.exports.minor,SE=ue.exports.patch,EE=ue.exports.prerelease,la=ue.exports.gt,$E=ue.exports.gte,xE=ue.exports.lt,U5=ue.exports.lte,B5=ue.exports.eq,kE=ue.exports.neq,PE=ue.exports.cmp,RE=ue.exports.compare,_g=ue.exports.rcompare,CE=ue.exports.compareIdentifiers,DE=ue.exports.rcompareIdentifiers,IE=ue.exports.compareBuild,OE=ue.exports.sort,LE=ue.exports.rsort,AE=ue.exports.diff,NE=ue.exports.validRange,z5=ue.exports.satisfies,jE=ue.exports.maxSatisfying,TE=ue.exports.minSatisfying,ME=ue.exports.minVersion,FE=ue.exports.gtr,UE=ue.exports.ltr,BE=ue.exports.outside,zE=ue.exports.intersects,_E=ue.exports.SemVer,VE=ue.exports.Comparator,qE=ue.exports.Range,oh="Offline";function Vg(t){return t instanceof _5?!0:t instanceof Error&&t.name===oh&&t.message===oh}var _5=class extends Error{constructor(){super(oh),this.name=this.message}},kr;(function(t){t[t.Ignore=0]="Ignore",t[t.Info=1]="Info",t[t.Warning=2]="Warning",t[t.Error=3]="Error"})(kr||(kr={})),function(t){const e="error",s="warning",i="warn",n="info",r="ignore";function o(c){return c?Pi(e,c)?t.Error:Pi(s,c)||Pi(i,c)?t.Warning:Pi(n,c)?t.Info:t.Ignore:t.Ignore}t.fromValue=o;function a(c){switch(c){case t.Error:return e;case t.Warning:return s;case t.Info:return n;default:return r}}t.toString=a}(kr||(kr={}));var ft=kr,V5={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiSettingsSearch:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts",version:2},authIssuers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authIssuers.d.ts"},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authProviderSpecific:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authProviderSpecific.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},authenticationChallenges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authenticationChallenges.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatEditing:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatEditing.d.ts"},chatOutputRenderer:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatOutputRenderer.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:10},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts",version:4},chatReferenceBinaryData:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceBinaryData.d.ts"},chatReferenceDiagnostic:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatReferenceDiagnostic.d.ts"},chatSessionsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatSessionsProvider.d.ts"},chatStatusItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatStatusItem.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribLanguageModelToolSets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLanguageModelToolSets.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribSecondarySidebar:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSecondarySidebar.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},dataChannels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.dataChannels.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts",version:4},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider2.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts",version:2},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles2.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},idToken:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelCapabilities:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelCapabilities.d.ts"},languageModelDataPart:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelDataPart.d.ts",version:3},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageModelThinkingPart:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelThinkingPart.d.ts",version:1},languageModelToolResultAudience:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelToolResultAudience.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},nativeWindowHandle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.nativeWindowHandle.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},remoteCodingAgents:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.remoteCodingAgents.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmProviderOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmProviderOptions.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},secretStorageKeys:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.secretStorageKeys.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},statusBarItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.statusBarItemTooltip.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskExecutionTerminal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskExecutionTerminal.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},taskProblemMatcherStatus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskProblemMatcherStatus.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalCompletionProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalCompletionProvider.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},terminalShellEnv:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalShellEnv.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textDocumentChangeReason:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textDocumentChangeReason.d.ts"},textEditorDiffInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textEditorDiffInformation.d.ts"},textSearchComplete2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchComplete2.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProvider2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider2.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},toolProgress:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.toolProgress.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},valueSelectionInQuickPick:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.valueSelectionInQuickPick.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},q5=Object.freeze(V5),qg=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,W5=/^-(\d{4})(\d{2})(\d{2})$/;function H5(t){return t=t.trim(),t==="*"||qg.test(t)}function ah(t){if(!H5(t))return null;if(t=t.trim(),t==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const e=t.match(qg);return e?{hasCaret:e[1]==="^",hasGreaterEquals:e[1]===">=",majorBase:e[2]==="x"?0:parseInt(e[2],10),majorMustEqual:e[2]!=="x",minorBase:e[4]==="x"?0:parseInt(e[4],10),minorMustEqual:e[4]!=="x",patchBase:e[6]==="x"?0:parseInt(e[6],10),patchMustEqual:e[6]!=="x",preRelease:e[8]||null}:null}function ch(t){if(!t)return null;const e=t.majorBase,s=t.majorMustEqual,i=t.minorBase;let n=t.minorMustEqual;const r=t.patchBase;let o=t.patchMustEqual;t.hasCaret&&(e===0||(n=!1),o=!1);let a=0;if(t.preRelease){const c=W5.exec(t.preRelease);if(c){const[,l,h,u]=c;a=Date.UTC(Number(l),Number(h)-1,Number(u))}}return{majorBase:e,majorMustEqual:s,minorBase:i,minorMustEqual:n,patchBase:r,patchMustEqual:o,isMinimum:t.hasGreaterEquals,notBefore:a}}function G5(t,e,s){let i;typeof t=="string"?i=ch(ah(t)):i=t;let n;e instanceof Date?n=e.getTime():typeof e=="string"&&(n=new Date(e).getTime());let r;if(typeof s=="string"?r=ch(ah(s)):r=s,!i||!r)return!1;const o=i.majorBase,a=i.minorBase,c=i.patchBase;let l=r.majorBase,h=r.minorBase,u=r.patchBase;const f=r.notBefore;let p=r.majorMustEqual,g=r.minorMustEqual,m=r.patchMustEqual;return r.isMinimum?o>l?!0:o<l?!1:a>h?!0:a<h||n&&n<f?!1:c>=u:(o===1&&l===0&&(!p||!g||!m)&&(l=1,h=0,u=0,p=!0,g=!1,m=!1),o<l?!1:o>l?!p:a<h?!1:a>h?!g:c<u?!1:c>u?!m:!(n&&n<f))}function J5(t,e,s,i,n,r){const o=[];if(typeof i.publisher<"u"&&typeof i.publisher!="string")return o.push([ft.Error,v(2022,null)]),o;if(typeof i.name!="string")return o.push([ft.Error,v(2023,null,"name")]),o;if(typeof i.version!="string")return o.push([ft.Error,v(2024,null,"version")]),o;if(!i.engines)return o.push([ft.Error,v(2025,null,"engines")]),o;if(typeof i.engines.vscode!="string")return o.push([ft.Error,v(2026,null,"engines.vscode")]),o;if(typeof i.extensionDependencies<"u"&&!Hg(i.extensionDependencies))return o.push([ft.Error,v(2027,null,"extensionDependencies")]),o;if(typeof i.activationEvents<"u"){if(!Hg(i.activationEvents))return o.push([ft.Error,v(2028,null,"activationEvents")]),o;if(typeof i.main>"u"&&typeof i.browser>"u")return o.push([ft.Error,v(2029,null,"activationEvents","main","browser")]),o}if(typeof i.extensionKind<"u"&&typeof i.main>"u"&&o.push([ft.Warning,v(2030,null,"extensionKind")]),typeof i.main<"u"){if(typeof i.main!="string")return o.push([ft.Error,v(2031,null,"main")]),o;{const l=_(s,i.main);S1(l,s)||o.push([ft.Warning,v(2032,null,l.path,s.path)])}}if(typeof i.browser<"u"){if(typeof i.browser!="string")return o.push([ft.Error,v(2033,null,"browser")]),o;{const l=_(s,i.browser);S1(l,s)||o.push([ft.Warning,v(2034,null,l.path,s.path)])}}if(!F5(i.version))return o.push([ft.Error,v(2035,null)]),o;const a=[];if(!K5(t,e,i,n,a))for(const l of a)o.push([ft.Error,l]);if(r&&i.enabledApiProposals?.length){const l=[];if(!hh([...i.enabledApiProposals],l))for(const h of l)o.push([ft.Error,h])}return o}function K5(t,e,s,i,n){return i||typeof s.main>"u"&&typeof s.browser>"u"?!0:Wg(t,e,s.engines.vscode,n)}function lh(t,e,s){return t==="*"||Wg(e,s,t)}function hh(t,e){if(t.length===0)return!0;const s=Array.isArray(e)?e:void 0,i=(s?void 0:e)??q5,n=[],r=u5(t);for(const{proposalName:o,version:a}of r){if(!a)continue;i[o]?.version!==a&&n.push(o)}return n.length?(s&&(n.length===1?s.push(v(2036,null,n[0])):s.push(v(2037,null,n.slice(0,n.length-1).map(o=>`'${o}'`).join(", "),n[n.length-1]))),!1):!0}function Wg(t,e,s,i=[]){const n=ch(ah(s));if(!n)return i.push(v(2038,null,s)),!1;if(n.majorBase===0){if(!n.majorMustEqual||!n.minorMustEqual)return i.push(v(2039,null,s)),!1}else if(!n.majorMustEqual)return i.push(v(2040,null,s)),!1;return G5(t,e,n)?!0:(i.push(v(2041,null,t,s)),!1)}function Hg(t){if(!Array.isArray(t))return!1;for(let e=0,s=t.length;e<s;e++)if(typeof t[e]!="string")return!1;return!0}async function In(t,e,s){let i=s&&s.get("storage.serviceMachineId",-1)||null;if(i)return i;try{const r=(await e.readFile(t.serviceMachineIdResource)).value.toString();i=Z2(r)?r:null}catch{i=null}if(!i){i=st();try{await e.writeFile(t.serviceMachineIdResource,A.fromString(i))}catch{}}return s?.store("storage.serviceMachineId",i,-1,1),i}async function Q5(t,e,s,i,n,r,o){const a={"X-Market-Client-Id":`VSCode ${t}`,"User-Agent":`VSCode ${t} (${e.nameShort})`};if(Cg(e,s)&&Ig(i)===3){const c=await In(s,n,r);a["X-Market-User-Id"]=c,a["VSCode-SessionId"]=o.machineId||c}return a}var Gg;(function(t){t.ExtensionQueryService="ExtensionQueryService",t.ExtensionLatestVersionUri="ExtensionLatestVersionUriTemplate",t.ExtensionStatisticsUri="ExtensionStatisticsUriTemplate",t.WebExtensionStatisticsUri="WebExtensionStatisticsUriTemplate",t.PublisherViewUri="PublisherViewUriTemplate",t.ExtensionDetailsViewUri="ExtensionDetailsViewUriTemplate",t.ExtensionRatingViewUri="ExtensionRatingViewUriTemplate",t.ExtensionResourceUri="ExtensionResourceUriTemplate",t.ContactSupportUri="ContactSupportUri"})(Gg||(Gg={}));var Jg;(function(t){t.None="None",t.IncludeVersions="IncludeVersions",t.IncludeFiles="IncludeFiles",t.IncludeCategoryAndTags="IncludeCategoryAndTags",t.IncludeSharedAccounts="IncludeSharedAccounts",t.IncludeVersionProperties="IncludeVersionProperties",t.ExcludeNonValidated="ExcludeNonValidated",t.IncludeInstallationTargets="IncludeInstallationTargets",t.IncludeAssetUri="IncludeAssetUri",t.IncludeStatistics="IncludeStatistics",t.IncludeLatestVersionOnly="IncludeLatestVersionOnly",t.Unpublished="Unpublished",t.IncludeNameConflictInfo="IncludeNameConflictInfo",t.IncludeLatestPrereleaseAndStableVersionOnly="IncludeLatestPrereleaseAndStableVersionOnly"})(Jg||(Jg={}));var Kg;(function(t){t.Available="available",t.RequiresSignIn="requiresSignIn",t.AccessDenied="accessDenied",t.Unavailable="unavailable"})(Kg||(Kg={}));var Pr=W("IExtensionGalleryManifestService");function Vi(t,e){const[s,i]=e.split("/");for(const n of t.resources){const[r,o]=n.type.split("/");if(r===s){if(!i||o===i)return n.id;break}}}var ha=ot?"web":bp(Zn,n1),Rr="X-Market-Search-Activity-Id",uh="Activityid",fh="Server",dh="X-Vss-E2eid",ua=1e4,dt={Icon:"Microsoft.VisualStudio.Services.Icons.Default",Details:"Microsoft.VisualStudio.Services.Content.Details",Changelog:"Microsoft.VisualStudio.Services.Content.Changelog",Manifest:"Microsoft.VisualStudio.Code.Manifest",VSIX:"Microsoft.VisualStudio.Services.VSIXPackage",License:"Microsoft.VisualStudio.Services.Content.License",Repository:"Microsoft.VisualStudio.Services.Links.Source",Signature:"Microsoft.VisualStudio.Services.VsixSignature"},Ps={Dependency:"Microsoft.VisualStudio.Code.ExtensionDependencies",ExtensionPack:"Microsoft.VisualStudio.Code.ExtensionPack",Engine:"Microsoft.VisualStudio.Code.Engine",PreRelease:"Microsoft.VisualStudio.Code.PreRelease",EnabledApiProposals:"Microsoft.VisualStudio.Code.EnabledApiProposals",LocalizedLanguages:"Microsoft.VisualStudio.Code.LocalizedLanguages",WebExtension:"Microsoft.VisualStudio.Code.WebExtension",SponsorLink:"Microsoft.VisualStudio.Code.SponsorLink",SupportLink:"Microsoft.VisualStudio.Services.Links.Support",ExecutesCode:"Microsoft.VisualStudio.Code.ExecutesCode",Private:"PrivateMarketplace"},X5=10,Z5={pageNumber:1,pageSize:X5,sortBy:"NoneOrRelevance",sortOrder:0,flags:[],criteria:[],assetTypes:[]},Qg;(function(t){t[t.Release=0]="Release",t[t.Prerelease=1]="Prerelease",t[t.Latest=2]="Latest"})(Qg||(Qg={}));var fa=class wi{constructor(e=Z5){this.d=e}get pageNumber(){return this.d.pageNumber}get pageSize(){return this.d.pageSize}get sortBy(){return this.d.sortBy}get sortOrder(){return this.d.sortOrder}get flags(){return this.d.flags}get criteria(){return this.d.criteria}get assetTypes(){return this.d.assetTypes}get source(){return this.d.source}get searchText(){const e=this.d.criteria.filter(s=>s.filterType==="SearchText")[0];return e&&e.value?e.value:""}withPage(e,s=this.d.pageSize){return new wi({...this.d,pageNumber:e,pageSize:s})}withFilter(e,...s){const i=[...this.d.criteria,...s.length?s.map(n=>({filterType:e,value:n})):[{filterType:e}]];return new wi({...this.d,criteria:i})}withSortBy(e){return new wi({...this.d,sortBy:e})}withSortOrder(e){return new wi({...this.d,sortOrder:e})}withFlags(...e){return new wi({...this.d,flags:Rt(e)})}withAssetTypes(...e){return new wi({...this.d,assetTypes:e})}withSource(e){return new wi({...this.d,source:e})}};function ph(t,e){const s=(t||[]).filter(i=>i.statisticName===e)[0];return s?s.value:0}function Y5(t){const e="Microsoft.VisualStudio.Code.Translation.";return t.files.filter(i=>i.assetType.indexOf(e)===0).reduce((i,n)=>{const r=Rs(t,n.assetType);return r&&i.push([n.assetType.substring(e.length),r]),i},[])}function e9(t){if(t.properties){const e=t.properties.filter(n=>n.key===dt.Repository),s=new RegExp("((git|ssh|http(s)?)|(git@[\\w.]+))(:(//)?)([\\w.@:/\\-~]+)(.git)(/)?"),i=e.filter(n=>s.test(n.value))[0];return i?{uri:i.value,fallbackUri:i.value}:null}return Rs(t,dt.Repository)}function t9(t){return{uri:`${t.fallbackAssetUri}/${dt.VSIX}?redirect=true${t.targetPlatform?`&targetPlatform=${t.targetPlatform}`:""}`,fallbackUri:`${t.fallbackAssetUri}/${dt.VSIX}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`}}function Rs(t,e){return t.files.filter(i=>i.assetType===e)[0]?{uri:`${t.assetUri}/${e}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`,fallbackUri:`${t.fallbackAssetUri}/${e}${t.targetPlatform?`?targetPlatform=${t.targetPlatform}`:""}`}:null}function Xg(t,e){const s=t.properties?t.properties.filter(n=>n.key===e):[],i=s.length>0&&s[0].value;return i?i.split(",").map(n=>$r(n)):[]}function gh(t){const e=t.properties?t.properties.filter(s=>s.key===Ps.Engine):[];return e.length>0&&e[0].value||""}function Cr(t){const e=t.properties?t.properties.filter(s=>s.key===Ps.PreRelease):[];return e.length>0&&e[0].value==="true"}function Zg(t,e){return e.extensionProperties?.[t.toLowerCase()]?.hasPrereleaseVersion}function s9(t,e){return e.extensionProperties?.[t.toLowerCase()]?.excludeVersionRange}function i9(t){const e=t.properties?t.properties.filter(s=>s.key===Ps.Private):[];return e.length>0&&e[0].value==="true"}function n9(t){const e=t.properties?t.properties.filter(s=>s.key===Ps.ExecutesCode):[];return e.length>0?e[0].value==="true":void 0}function mh(t){const e=t.properties?t.properties.filter(i=>i.key===Ps.EnabledApiProposals):[],s=e.length>0&&e[0].value||"";return s?s.split(","):[]}function r9(t){const e=t.properties?t.properties.filter(i=>i.key===Ps.LocalizedLanguages):[],s=e.length>0&&e[0].value||"";return s?s.split(","):[]}function o9(t){return t.properties?.find(e=>e.key===Ps.SponsorLink)?.value}function a9(t){return t.properties?.find(e=>e.key===Ps.SupportLink)?.value}function c9(t){return t.indexOf("preview")!==-1}function On(t){return t.targetPlatform?g2(t.targetPlatform):"undefined"}function Dr(t){const e=Rt(t.versions.map(On)),s=!!t.tags?.includes(u2),i=e.indexOf("web");return s?i===-1&&e.push("web"):i!==-1&&e.splice(i,1),e}function Yg(t,e){for(let s=0;s<t.length;s++){const i=t[s];if(i.version===t[s-1]?.version){let n=s;if(On(i)===e)for(;n>0&&t[n-1].version===i.version;)n--;n!==s&&(t.splice(s,1),t.splice(n,0,i))}}return t}function e0(t,e,s){t.telemetryData={index:e,querySource:s,queryActivityId:t.queryContext?.[Rr]}}function da(t,e,s,i,n,r){const o=t.versions[0],a={manifest:Rs(e,dt.Manifest),readme:Rs(e,dt.Details),changelog:Rs(e,dt.Changelog),license:Rs(e,dt.License),repository:e9(e),download:t9(e),icon:Rs(e,dt.Icon),signature:Rs(e,dt.Signature),coreTranslations:Y5(e)},c=Vi(i,t.linkType??"ExtensionDetailsViewUriTemplate"),l=Vi(i,t.publisher.linkType??"PublisherViewUriTemplate"),h=Vi(i,t.ratingLinkType??"ExtensionRatingViewUriTemplate"),u=ks(t.publisher.publisherName,t.extensionName);return{type:"gallery",identifier:{id:u,uuid:t.extensionId},name:t.extensionName,version:e.version,displayName:t.displayName,publisherId:t.publisher.publisherId,publisher:t.publisher.publisherName,publisherDisplayName:t.publisher.displayName,publisherDomain:t.publisher.domain?{link:t.publisher.domain,verified:!!t.publisher.isDomainVerified}:void 0,publisherSponsorLink:o9(o),description:t.shortDescription??"",installCount:ph(t.statistics,"install"),rating:ph(t.statistics,"averagerating"),ratingCount:ph(t.statistics,"ratingcount"),categories:t.categories||[],tags:t.tags||[],releaseDate:Date.parse(t.releaseDate),lastUpdated:Date.parse(t.lastUpdated),allTargetPlatforms:s,assets:a,properties:{dependencies:Xg(e,Ps.Dependency),extensionPack:Xg(e,Ps.ExtensionPack),engine:gh(e),enabledApiProposals:mh(e),localizedLanguages:r9(e),targetPlatform:On(e),isPreReleaseVersion:Cr(e),executesCode:n9(e)},hasPreReleaseVersion:Zg(u,n)??Cr(o),hasReleaseVersion:!0,private:i9(o),preview:c9(t.flags),isSigned:!!a.signature,queryContext:r,supportLink:a9(o),detailsLink:c?Zs(c,{publisher:t.publisher.publisherName,name:t.extensionName}):void 0,publisherLink:l?Zs(l,{publisher:t.publisher.publisherName}):void 0,ratingLink:h?Zs(h,{publisher:t.publisher.publisherName,name:t.extensionName}):void 0}}var pa=class{constructor(e,s,i,n,r,o,a,c,l,h,u){this.k=s,this.l=i,this.n=n,this.o=r,this.q=o,this.u=a,this.w=c,this.x=l,this.y=h,this.z=u,this.d=c.extensionsGallery?.controlUrl,this.g=c.extensionsGallery?.extensionUrlTemplate,this.j=c.extensionsEnabledWithApiProposalVersion?.map(f=>f.toLowerCase())??[],this.h=Q5(c.version,c,this.o,this.x,this.u,e,this.q)}isEnabled(){return this.z.extensionGalleryManifestStatus==="available"}async getExtensions(e,s,i){const n=await this.z.getExtensionGalleryManifest();if(!n)throw new Error("No extension gallery service configured.");const r=Q.isCancellationToken(s)?{}:s,o=Q.isCancellationToken(s)?s:i,a=await this.A(n),c=a?await this.C(e,r,a,n,o):await this.B(e,r,n,o),l=c.map(u=>u.identifier.uuid),h=[];for(const u of e)u.uuid&&!l.includes(u.uuid)&&h.push({...u,uuid:void 0});if(h.length){this.q.publicLog2("galleryService:additionalQueryByName",{count:h.length});const u=await this.B(h,r,n,o);c.push(...u)}return c}async A(e){const s=Vi(e,"ExtensionLatestVersionUriTemplate");if(s)return{uri:s,fallback:this.g}}async B(e,s,i,n){const r=[],o=[],a=[],c=[];let l=!0;for(const f of e)f.uuid?o.push(f.uuid):r.push(f.id),f.version?c.push({id:f.id,uuid:f.uuid,version:f.version}):a.push({id:f.id,uuid:f.uuid,includePreRelease:!!f.preRelease}),l=l&&!!f.hasPreRelease&&!f.preRelease;if(!o.length&&!r.length)return[];let h=new fa().withPage(1,e.length);o.length&&(h=h.withFilter("ExtensionId",...o)),r.length&&(h=h.withFilter("ExtensionName",...r)),s.queryAllVersions&&(h=h.withFlags(...h.flags,"IncludeVersions")),s.source&&(h=h.withSource(s.source));const{extensions:u}=await this.H(h,{targetPlatform:s.targetPlatform??ha,includePreRelease:a,versions:c,compatible:!!s.compatible,productVersion:s.productVersion??{version:this.w.version,date:this.w.date},isQueryForReleaseVersionFromPreReleaseVersion:l},i,n);return s.source&&u.forEach((f,p)=>e0(f,p,s.source)),u}async C(e,s,i,n,r){const o=[],a=[],c=[];for(const l of e)wp.test(l.id)&&(l.version?a.push(l):c.push(l));if(await Promise.all(c.map(async l=>{let h;try{if(h=await this.D(l,s,i,n,r),h==="NOT_FOUND"){l.uuid&&a.push(l);return}h&&o.push(h)}catch(u){if(u instanceof Ws)switch(u.code){case"Offline":case"Cancelled":case"Timeout":throw u}this.n.error(`Error while getting the latest version for the extension ${l.id}.`,se(u)),this.q.publicLog2("galleryService:fallbacktoquery",{extension:l.id,preRelease:!!l.preRelease,compatible:!!s.compatible,errorCode:u instanceof Ws?u.code:"Unknown"}),a.push(l)}})),a.length){const l=await this.B(a,s,n,r);o.push(...l)}return o}async D(e,s,i,n,r){const o=await this.N(e,i,r);if(!o)return"NOT_FOUND";const a=Dr(o),c=await this.K(o,{targetPlatform:s.targetPlatform??ha,compatible:!!s.compatible,productVersion:s.productVersion??{version:this.w.version,date:this.w.date},version:e.preRelease?2:0},a);return c?da(o,c,a,n,this.w):null}async getCompatibleExtension(e,s,i,n={version:this.w.version,date:this.w.date}){return Sn(e.allTargetPlatforms,i)?null:await this.isExtensionCompatible(e,s,i)?e:this.y.isAllowed({id:e.identifier.id,publisherDisplayName:e.publisherDisplayName})!==!0?null:(await this.getExtensions([{...e.identifier,preRelease:s,hasPreRelease:e.hasPreReleaseVersion}],{compatible:!0,productVersion:n,queryAllVersions:!0,targetPlatform:i},Q.None))[0]??null}async isExtensionCompatible(e,s,i,n={version:this.w.version,date:this.w.date}){return this.E({id:e.identifier.id,version:e.version,isPreReleaseVersion:e.properties.isPreReleaseVersion,targetPlatform:e.properties.targetPlatform,manifestAsset:e.assets.manifest,engine:e.properties.engine,enabledApiProposals:e.properties.enabledApiProposals},{targetPlatform:i,compatible:!0,productVersion:n,version:s?2:0},e.publisherDisplayName,e.allTargetPlatforms)}async E(e,{targetPlatform:s,compatible:i,productVersion:n,version:r},o,a){const c=Zg(e.id,this.w),l=s9(e.id,this.w);if(e.isPreReleaseVersion&&c===!1||l&&z5(e.version,l))return!1;if($e(r)){if(e.version!==r)return!1}else if((r===0||r===1)&&e.isPreReleaseVersion!==(r===1))return!1;return!(s&&!Sp(e.targetPlatform,a,s)||i&&(this.y.isAllowed({id:e.id,publisherDisplayName:o,version:e.version,prerelease:e.isPreReleaseVersion,targetPlatform:e.targetPlatform})!==!0||!this.F(e.id,e.enabledApiProposals)||!await this.G(e.id,e.version,e.engine,e.manifestAsset,n)))}F(e,s){return!s||!this.j.includes(e.toLowerCase())?!0:hh(s)}async G(e,s,i,n,r){if(!i){if(!n)return this.n.error(`Missing engine and manifest asset for the extension ${e} with version ${s}`),!1;try{this.q.publicLog2("galleryService:engineFallback",{extension:e,extensionVersion:s});const o={"Accept-Encoding":"gzip"},a=await this.Q(e,n,dt.Manifest,s,{headers:o}),c=await ps(a);if(!c)return this.n.error(`Manifest was not found for the extension ${e} with version ${s}`),!1;i=c.engines.vscode}catch(o){return this.n.error(`Error while getting the engine for the version ${s}.`,se(o)),!1}}return lh(i,r.version,r.date)}async query(e,s){const i=await this.z.getExtensionGalleryManifest();if(!i)throw new Error("No extension gallery service configured.");let n=e.text||"";const r=e.pageSize??50;let o=new fa().withPage(1,r);n?(n=n.replace(/\bcategory:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(u,f,p)=>(o=o.withFilter("Category",p||f),"")),n=n.replace(/\btag:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(u,f,p)=>(o=o.withFilter("Tag",p||f),"")),n=n.replace(/\bfeatured(\s+|\b|$)/g,()=>(o=o.withFilter("Featured"),"")),n=n.trim(),n&&(n=n.length<200?n:n.substring(0,200),o=o.withFilter("SearchText",n)),i.capabilities.extensionQuery.sorting?.some(u=>u.name==="NoneOrRelevance")&&(o=o.withSortBy("NoneOrRelevance"))):i.capabilities.extensionQuery.sorting?.some(u=>u.name==="InstallCount")&&(o=o.withSortBy("InstallCount")),e.sortBy&&i.capabilities.extensionQuery.sorting?.some(u=>u.name===e.sortBy)&&(o=o.withSortBy(e.sortBy)),typeof e.sortOrder=="number"&&(o=o.withSortOrder(e.sortOrder)),e.source&&(o=o.withSource(e.source));const a=async(u,f)=>{const{extensions:p,total:g}=await this.H(u,{targetPlatform:ha,compatible:!1,includePreRelease:!!e.includePreRelease,productVersion:e.productVersion??{version:this.w.version,date:this.w.date}},i,f);return p.forEach((m,w)=>e0(m,(u.pageNumber-1)*u.pageSize+w,e.source)),{extensions:p,total:g}},{extensions:c,total:l}=await a(o,s),h=async(u,f)=>{if(f.isCancellationRequested)throw new Ve;const{extensions:p}=await a(o.withPage(u+1),f);return p};return{firstPage:c,total:l,pageSize:o.pageSize,getPage:h}}async H(e,s,i,n){return this.w.quality!=="stable"&&await this.k?.getTreatment("useLatestPrereleaseAndStableVersionFlag")?this.J(e,s,i,n):this.I(e,s,i,n)}async I(e,s,i,n){const r=e.flags;e.flags.includes("IncludeLatestVersionOnly")&&e.flags.includes("IncludeVersions")&&(e=e.withFlags(...e.flags.filter(f=>f!=="IncludeVersions"))),!e.flags.includes("IncludeLatestVersionOnly")&&!e.flags.includes("IncludeVersions")&&(e=e.withFlags(...e.flags,"IncludeLatestVersionOnly")),(s.versions?.length||s.isQueryForReleaseVersionFromPreReleaseVersion)&&(e=e.withFlags(...e.flags.filter(f=>f!=="IncludeLatestVersionOnly"),"IncludeVersions")),e=e.withFlags(...e.flags,"IncludeAssetUri","IncludeCategoryAndTags","IncludeFiles","IncludeStatistics","IncludeVersionProperties");const{galleryExtensions:o,total:a,context:c}=await this.L(e,i,n);if(!e.flags.includes("IncludeLatestVersionOnly")){const f=[];for(const p of o){const g=Dr(p),m={id:ks(p.publisher.publisherName,p.extensionName),uuid:p.extensionId},w=Kt(s.includePreRelease)?s.includePreRelease:!!s.includePreRelease.find(S=>G(S,m))?.includePreRelease,b=await this.K(p,{compatible:s.compatible,targetPlatform:s.targetPlatform,productVersion:s.productVersion,version:s.versions?.find(S=>G(S,m))?.version??(w?2:0)},g);b&&f.push(da(p,b,g,i,this.w,c))}return{extensions:f,total:a}}const h=[],u=new Map;for(let f=0;f<o.length;f++){const p=o[f],g={id:ks(p.publisher.publisherName,p.extensionName),uuid:p.extensionId},m=Kt(s.includePreRelease)?s.includePreRelease:!!s.includePreRelease.find($=>G($,g))?.includePreRelease,w=Dr(p);if(s.compatible&&(Sn(w,s.targetPlatform)||this.y.isAllowed({id:g.id,publisherDisplayName:p.publisher.displayName})!==!0))continue;const b=await this.K(p,{compatible:s.compatible,targetPlatform:s.targetPlatform,productVersion:s.productVersion,version:s.versions?.find($=>G($,g))?.version??(m?2:0)},w),S=b?da(p,b,w,i,this.w,c):null;!S||S.properties.isPreReleaseVersion&&(!m||!S.hasReleaseVersion)||!S.properties.isPreReleaseVersion&&S.properties.targetPlatform!==s.targetPlatform&&S.hasPreReleaseVersion?u.set(p.extensionId,f):h.push([f,S])}if(u.size){const f=new cn,p=new fa().withFlags(...r.filter(m=>m!=="IncludeLatestVersionOnly"),"IncludeVersions").withPage(1,u.size).withFilter("ExtensionId",...u.keys()),{extensions:g}=await this.H(p,s,i,n);this.q.publicLog2("galleryService:additionalQuery",{duration:f.elapsed(),count:u.size});for(const m of g){const w=u.get(m.identifier.uuid);h.push([w,m])}}return{extensions:h.sort((f,p)=>f[0]-p[0]).map(([,f])=>f),total:a}}async J(e,s,i,n){s.versions?.length?e=e.withFlags(...e.flags.filter(l=>l!=="IncludeLatestVersionOnly"&&l!=="IncludeLatestPrereleaseAndStableVersionOnly"),"IncludeVersions"):e.flags.includes("IncludeVersions")||(e=(Kt(s.includePreRelease)?s.includePreRelease:s.includePreRelease.every(({includePreRelease:h})=>h))?e.withFlags(...e.flags.filter(h=>h!=="IncludeLatestPrereleaseAndStableVersionOnly"),"IncludeLatestVersionOnly"):e.withFlags(...e.flags.filter(h=>h!=="IncludeLatestVersionOnly"),"IncludeLatestPrereleaseAndStableVersionOnly")),e.flags.includes("IncludeVersions")&&(e.flags.includes("IncludeLatestVersionOnly")||e.flags.includes("IncludeLatestPrereleaseAndStableVersionOnly"))&&(e=e.withFlags(...e.flags.filter(l=>l!=="IncludeLatestVersionOnly"&&l!=="IncludeLatestPrereleaseAndStableVersionOnly"),"IncludeVersions")),e=e.withFlags(...e.flags,"IncludeAssetUri","IncludeCategoryAndTags","IncludeFiles","IncludeStatistics","IncludeVersionProperties");const{galleryExtensions:r,total:o,context:a}=await this.L(e,i,n),c=[];for(let l=0;l<r.length;l++){const h=r[l],u={id:ks(h.publisher.publisherName,h.extensionName),uuid:h.extensionId},f=Dr(h);if(s.compatible&&(Sn(f,s.targetPlatform)||this.y.isAllowed({id:u.id,publisherDisplayName:h.publisher.displayName})!==!0))continue;const p=s.versions?.find(m=>G(m,u))?.version??((Kt(s.includePreRelease)?s.includePreRelease:s.includePreRelease.find(m=>G(m,u))?.includePreRelease)?2:0),g=await this.K(h,{compatible:s.compatible,targetPlatform:s.targetPlatform,productVersion:s.productVersion,version:p},f);g&&c.push(da(h,g,f,i,this.w,a))}return{extensions:c,total:o}}async K(e,s,i){const n={id:ks(e.publisher.publisherName,e.extensionName),uuid:e.extensionId},r=Yg(e.versions,s.targetPlatform);if(s.compatible&&Sn(i,s.targetPlatform))return null;const o=$e(s.version)?s.version:void 0;for(let a=0;a<r.length;a++){const c=r[a];if(await this.E({id:n.id,version:c.version,isPreReleaseVersion:Cr(c),targetPlatform:On(c),engine:gh(c),manifestAsset:Rs(c,dt.Manifest),enabledApiProposals:mh(c)},s,e.publisher.displayName,i))return c;if(o&&c.version===o)return null}return o||s.compatible?null:e.versions[0]}async L(e,s,i){const n=Vi(s,"ExtensionQueryService");if(!n)throw new Error("No extension gallery query service configured.");e=e.withFlags(...e.flags,"ExcludeNonValidated").withFilter("Target","Microsoft.VisualStudio.Code");const r=s.capabilities.extensionQuery.flags?.find(p=>p.name==="Unpublished");r&&(e=e.withFilter("ExcludeWithFlags",String(r.value)));const o=JSON.stringify({filters:[{criteria:e.criteria.reduce((p,g)=>{const m=s.capabilities.extensionQuery.filtering?.find(w=>w.name===g.filterType);return m&&p.push({filterType:m.value,value:g.value}),p},[]),pageNumber:e.pageNumber,pageSize:e.pageSize,sortBy:s.capabilities.extensionQuery.sorting?.find(p=>p.name===e.sortBy)?.value,sortOrder:e.sortOrder}],assetTypes:e.assetTypes,flags:e.flags.reduce((p,g)=>{const m=s.capabilities.extensionQuery.flags?.find(w=>w.name===g);return m&&(p|=m.value),p},0)}),c={...await this.h,"Content-Type":"application/json",Accept:"application/json;api-version=3.0-preview.1","Accept-Encoding":"gzip","Content-Length":String(o.length)},l=new cn;let h,u,f=0;try{if(h=await this.l.request({type:"POST",url:n,data:o,headers:c},i),h.res.statusCode&&h.res.statusCode>=400&&h.res.statusCode<500)return{galleryExtensions:[],total:f};const p=await ps(h);if(p){const g=p.results[0],m=g.extensions,w=g.resultMetadata&&g.resultMetadata.filter(b=>b.metadataType==="ResultCount")[0];return f=w&&w.metadataItems.filter(b=>b.name==="TotalCount")[0].count||0,{galleryExtensions:m,total:f,context:h.res.headers.activityid?{[Rr]:h.res.headers.activityid}:{}}}return{galleryExtensions:[],total:f}}catch(p){if(Ts(p))throw u="Cancelled",p;{const g=se(p);throw u=Vg(p)?"Offline":g.startsWith("XHR timeout")?"Timeout":"Failed",new Ws(g,u)}}finally{this.q.publicLog2("galleryService:query",{filterTypes:e.criteria.map(p=>p.filterType),flags:e.flags,sortBy:e.sortBy,sortOrder:String(e.sortOrder),pageNumber:String(e.pageNumber),source:e.source,searchTextLength:e.searchText.length,requestBodySize:String(o.length),duration:l.elapsed(),success:!!h&&Cn(h),responseBodySize:h?.res.headers["Content-Length"],statusCode:h?String(h.res.statusCode):void 0,errorCode:u,count:String(f),server:this.M(h?.res.headers,fh),activityId:this.M(h?.res.headers,uh),endToEndId:this.M(h?.res.headers,dh)})}}M(e,s){const i=e?.[s.toLowerCase()],n=Array.isArray(i)?i[0]:i;return n?new ta(n):void 0}async N(e,s,i){const[n,r]=e.id.split(".");let o;try{const a=k.parse(Zs(s.uri,{publisher:n,name:r}));return await this.O(e.id,a,i)}catch(a){if(a instanceof Ws)switch(o=a.code,a.code){case"Offline":case"Cancelled":case"Timeout":case"ClientError":throw a}else o="Unknown";if(!s.fallback)throw a}finally{this.q.publicLog2("galleryService:getmarketplacelatest",{extension:e.id,errorCode:o})}this.n.error(`Error while getting the latest version for the extension ${e.id} from ${s.uri}. Trying the fallback ${s.fallback}`,o);try{const a=k.parse(Zs(s.fallback,{publisher:n,name:r}));return await this.O(e.id,a,i)}catch(a){throw o=a instanceof Ws?a.code:"Unknown",a}finally{this.q.publicLog2("galleryService:fallbacktounpkg",{extension:e.id,errorCode:o})}}async O(e,s,i){let n,r;const o=new cn;try{const c={...await this.h,"Content-Type":"application/json",Accept:"application/json;api-version=7.2-preview","Accept-Encoding":"gzip"};if(n=await this.l.request({type:"GET",url:s.toString(!0),headers:c,timeout:ua},i),n.res.statusCode===404)return r="NotFound",null;if(n.res.statusCode&&n.res.statusCode!==200)throw new Error("Unexpected HTTP response: "+n.res.statusCode);const l=await ps(n);return l||(r="NoData"),l}catch(a){let c;throw Ts(a)?c="Cancelled":Vg(a)?c="Offline":se(a).startsWith("XHR timeout")?c="Timeout":n&&r5(n)?c="ClientError":n&&o5(n)?c="ServerError":c="Failed",r=c,new Ws(a,c)}finally{this.q.publicLog2("galleryService:getLatest",{extension:e,host:s.authority,duration:o.elapsed(),errorCode:r,statusCode:n?.res.statusCode&&n?.res.statusCode!==200?`${n.res.statusCode}`:void 0,server:this.M(n?.res.headers,fh),activityId:this.M(n?.res.headers,uh),endToEndId:this.M(n?.res.headers,dh)})}}async reportStatistic(e,s,i,n){const r=await this.z.getExtensionGalleryManifest();if(!r)return;let o;if(ot){const h=Vi(r,"WebExtensionStatisticsUriTemplate");if(!h)return;o=Zs(h,{publisher:e,name:s,version:i,statTypeValue:n==="install"?"1":"3"})}else{const h=Vi(r,"ExtensionStatisticsUriTemplate");if(!h)return;o=Zs(h,{publisher:e,name:s,version:i,statTypeName:n})}const a=ot?"api-version=6.1-preview.1":"*/*;api-version=4.0-preview.1",l={...await this.h,Accept:a};try{await this.l.request({type:"POST",url:o,headers:l},Q.None)}catch{}}async download(e,s,i){this.n.trace("ExtensionGalleryService#download",e.identifier.id);const n=nh(e),r=new Date().getTime(),o=i===2?"install":i===3?"update":"",a=o?{uri:`${e.assets.download.uri}${k.parse(e.assets.download.uri).query?"&":"?"}${o}=true`,fallbackUri:`${e.assets.download.fallbackUri}${k.parse(e.assets.download.fallbackUri).query?"&":"?"}${o}=true`}:e.assets.download,c=e.queryContext?.[Rr]?{[Rr]:e.queryContext[Rr]}:void 0,l=await this.Q(e.identifier.id,a,dt.VSIX,e.version,c?{headers:c}:void 0);try{await this.u.writeFile(s,l.stream)}catch(h){try{await this.u.del(s)}catch(u){this.n.warn(`Error while deleting the file ${s.toString()}`,se(u))}throw new Ws(se(h),"DownloadFailedWriting")}this.q.publicLog("galleryService:downloadVSIX",{...n,duration:new Date().getTime()-r})}async downloadSignatureArchive(e,s){if(!e.assets.signature)throw new Error("No signature asset found");this.n.trace("ExtensionGalleryService#downloadSignatureArchive",e.identifier.id);const i=await this.Q(e.identifier.id,e.assets.signature,dt.Signature,e.version);try{await this.u.writeFile(s,i.stream)}catch(n){try{await this.u.del(s)}catch(r){this.n.warn(`Error while deleting the file ${s.toString()}`,se(r))}throw new Ws(se(n),"DownloadFailedWriting")}}async getReadme(e,s){if(e.assets.readme){const i=await this.Q(e.identifier.id,e.assets.readme,dt.Details,e.version,{},s);return await xs(i)||""}return""}async getManifest(e,s){if(e.assets.manifest){const i=await this.Q(e.identifier.id,e.assets.manifest,dt.Manifest,e.version,{},s),n=await xs(i);return n?JSON.parse(n):null}return null}async getCoreTranslation(e,s){const i=e.assets.coreTranslations.filter(n=>n[0]===s.toUpperCase())[0];if(i){const n=await this.Q(e.identifier.id,i[1],i[0],e.version),r=await xs(n);return r?JSON.parse(r):null}return null}async getChangelog(e,s){if(e.assets.changelog){const i=await this.Q(e.identifier.id,e.assets.changelog,dt.Changelog,e.version,{},s);return await xs(i)||""}return""}async getAllVersions(e){return this.P(e)}async getAllCompatibleVersions(e,s,i){return this.P(e,{version:s?2:0,targetPlatform:i})}async P(e,s){const i=await this.z.getExtensionGalleryManifest();if(!i)throw new Error("No extension gallery service configured.");let n=new fa().withFlags("IncludeVersions","IncludeCategoryAndTags","IncludeFiles","IncludeVersionProperties").withPage(1,1);e.uuid?n=n.withFilter("ExtensionId",e.uuid):n=n.withFilter("ExtensionName",e.id);const{galleryExtensions:r}=await this.L(n,i,Q.None);if(!r.length)return[];const o=Dr(r[0]);if(s&&Sn(o,s.targetPlatform))return[];const a=[],c={version:this.w.version,date:this.w.date};await Promise.all(r[0].versions.map(async u=>{try{await this.E({id:e.id,version:u.version,isPreReleaseVersion:Cr(u),targetPlatform:On(u),engine:gh(u),manifestAsset:Rs(u,dt.Manifest),enabledApiProposals:mh(u)},{compatible:!!s,productVersion:c,targetPlatform:s?.targetPlatform,version:s?.version??u.version},r[0].publisher.displayName,o)&&a.push(u)}catch{}}));const l=[],h=new Map;for(const u of Yg(a,s?.targetPlatform??ha)){const f=h.get(u.version),p=f!==void 0?l[f]:void 0,g=On(u);p?p.targetPlatforms.push(g):(h.set(u.version,l.length),l.push({version:u.version,date:u.lastUpdated,isPreReleaseVersion:Cr(u),targetPlatforms:[g]}))}return l}async Q(e,s,i,n,r={},o=Q.None){const a=await this.h,c={type:"GET"},l={...a,...r.headers||{}};r={...r,...c,headers:l};const h=s.uri,u=s.fallbackUri,f={...r,url:h,timeout:ua};let p;try{if(p=await this.l.request(f,o),p.res.statusCode===200)return p;const g=await xs(p);throw new Error(`Expected 200, got back ${p.res.statusCode} instead.

${g}`)}catch(g){if(Ts(g))throw g;const m=se(g);this.q.publicLog2("galleryService:cdnFallback",{extension:e,assetType:i,message:m,extensionVersion:n,server:this.M(p?.res.headers,fh),activityId:this.M(p?.res.headers,uh),endToEndId:this.M(p?.res.headers,dh)});const w={...r,url:u,timeout:ua};return this.l.request(w,o)}}async getExtensionsControlManifest(){if(!this.isEnabled())throw new Error("No extension gallery service configured.");if(!this.d)return{malicious:[],deprecated:{},search:[],autoUpdate:{}};const e=await this.l.request({type:"GET",url:this.d,timeout:ua},Q.None);if(e.res.statusCode!==200)throw new Error("Could not get extensions report.");const s=await ps(e),i=[],n={},r=[],o=s?.autoUpdate??{};if(s){for(const a of s.malicious){if(!$e(a))continue;const c=wp.test(a)?{id:a}:a;i.push({extensionOrPublisher:c,learnMoreLink:s.learnMoreLinks?.[a]})}if(s.migrateToPreRelease)for(const[a,c]of Object.entries(s.migrateToPreRelease))(!c.engine||lh(c.engine,this.w.version,this.w.date))&&(n[a.toLowerCase()]={disallowInstall:!0,extension:{id:c.id,displayName:c.displayName,autoMigrate:{storage:!!c.migrateStorage},preRelease:!0}});if(s.deprecated)for(const[a,c]of Object.entries(s.deprecated))c&&(n[a.toLowerCase()]=Kt(c)?{}:c);if(s.search)for(const a of s.search)r.push(a)}return{malicious:i,deprecated:n,search:r,autoUpdate:o}}};pa=__decorate([__param(2,oi),__param(3,Y),__param(4,ae),__param(5,ke),__param(6,K),__param(7,pe),__param(8,ge),__param(9,Mi),__param(10,Pr)],pa);var wh=class extends pa{constructor(e,s,i,n,r,o,a,c,l,h){super(e,void 0,s,i,n,r,o,a,c,l,h)}};wh=__decorate([__param(0,ne),__param(1,oi),__param(2,Y),__param(3,ae),__param(4,ke),__param(5,K),__param(6,pe),__param(7,ge),__param(8,Mi),__param(9,Pr)],wh);var t0=class extends pa{constructor(e,s,i,n,r,o,a,c,l){super(void 0,void 0,e,s,i,n,r,o,a,c,l)}};t0=__decorate([__param(0,oi),__param(1,Y),__param(2,ae),__param(3,ke),__param(4,K),__param(5,pe),__param(6,ge),__param(7,Mi),__param(8,Pr)],t0);var s0=W("IExtensionSignatureVerificationService"),vh=class{constructor(e,s){this.b=e,this.c=s}d(){return this.a||(this.a=this.f()),this.a}async f(){return import("@vscode/vsce-sign")}async verify(e,s,i,n,r){let o;try{o=await this.d()}catch(h){this.b.error("Could not load vsce-sign module",se(h)),this.b.info(`Extension signature verification is not done: ${e}`);return}const a=new Date().getTime();let c;try{this.b.trace(`Verifying extension signature for ${e}...`),c=await o.verify(i,n,this.b.getLevel()===ie.Trace)}catch(h){c={code:Ye.UnknownError,didExecute:!1,output:se(h)}}const l=new Date().getTime()-a;return this.b.info(`Extension signature verification result for ${e}: ${c.code}. ${bd(c.internalCode)?`Internal Code: ${c.internalCode}. `:""}Executed: ${c.didExecute}. Duration: ${l}ms.`),this.b.trace(`Extension signature verification output for ${e}:
${c.output}`),this.c.publicLog2("extensionsignature:verification",{extensionId:e,extensionVersion:s,code:c.code,internalCode:c.internalCode,duration:l,didExecute:c.didExecute,clientTargetPlatform:r}),{code:c.code}}};vh=__decorate([__param(0,Y),__param(1,ke)],vh);var ga=new class{transformIncoming(t){return t}transformOutgoing(t){return t}transformOutgoingURI(t){return t}transformOutgoingScheme(t){return t}};function i0(t,e,s,i){if(!t||i>200)return null;if(typeof t=="object"){if(t.$mid===1)return s?k.revive(e.transformIncoming(t)):e.transformIncoming(t);if(t instanceof A)return null;for(const n in t)if(Object.hasOwnProperty.call(t,n)){const r=i0(t[n],e,s,i+1);r!==null&&(t[n]=r)}}return null}function ma(t,e){const s=i0(t,e,!0,0);return s===null?t:s}var KE=new Uint32Array(10),n0;(function(t){t[t.InitialConsonant=4352]="InitialConsonant",t[t.Vowel=4449]="Vowel",t[t.FinalConsonant=4520]="FinalConsonant",t[t.CompatibilityJamo=12593]="CompatibilityJamo"})(n0||(n0={}));var r0;(function(t){t[t.NUL=0]="NUL",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z"})(r0||(r0={}));var o0;(function(t){t[t.fa=24934]="fa",t[t.fg=26470]="fg",t[t.fq=29030]="fq",t[t.fr=29286]="fr",t[t.ft=29798]="ft",t[t.fv=30310]="fv",t[t.fx=30822]="fx",t[t.hk=27496]="hk",t[t.hl=27752]="hl",t[t.ho=28520]="ho",t[t.ml=27757]="ml",t[t.nj=27246]="nj",t[t.nl=27758]="nl",t[t.np=28782]="np",t[t.qt=29809]="qt",t[t.rt=29810]="rt",t[t.sg=26483]="sg",t[t.sw=30579]="sw"})(o0||(o0={}));var QE=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),XE=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),ZE=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),YE=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function a0(...t){return function(e,s){for(let i=0,n=t.length;i<n;i++){const r=t[i](e,s);if(r)return r}return null}}var e$=l0.bind(void 0,!1),c0=l0.bind(void 0,!0);function l0(t,e,s){if(!s||s.length<e.length)return null;let i;return t?i=Hc(s,e):i=s.indexOf(e)===0,i?e.length>0?[{start:0,end:e.length}]:[]:null}function l9(t,e){const s=e.toLowerCase().indexOf(t.toLowerCase());return s===-1?null:[{start:s,end:s+t.length}]}function h9(t,e){return yh(t.toLowerCase(),e.toLowerCase(),0,0)}function yh(t,e,s,i){if(s===t.length)return[];if(i===e.length)return null;if(t[s]===e[i]){let n=null;return(n=yh(t,e,s+1,i+1))?u0({start:i,end:i+1},n):null}return yh(t,e,s,i+1)}function bh(t){return 97<=t&&t<=122}function wa(t){return 65<=t&&t<=90}function Sh(t){return 48<=t&&t<=57}function u9(t){return t===32||t===9||t===10||t===13}var f9=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(t=>f9.add(t.charCodeAt(0)));function h0(t){return bh(t)||wa(t)||Sh(t)}function u0(t,e){return e.length===0?e=[t]:t.end===e[0].start?e[0].start=t.start:e.unshift(t),e}function f0(t,e){for(let s=e;s<t.length;s++){const i=t.charCodeAt(s);if(wa(i)||Sh(i)||s>0&&!h0(t.charCodeAt(s-1)))return s}return t.length}function Eh(t,e,s,i){if(s===t.length)return[];if(i===e.length)return null;if(t[s]!==e[i].toLowerCase())return null;{let n=null,r=i+1;for(n=Eh(t,e,s+1,i+1);!n&&(r=f0(e,r))<e.length;)n=Eh(t,e,s+1,r),r++;return n===null?null:u0({start:i,end:i+1},n)}}function d9(t){let e=0,s=0,i=0,n=0,r=0;for(let h=0;h<t.length;h++)r=t.charCodeAt(h),wa(r)&&e++,bh(r)&&s++,h0(r)&&i++,Sh(r)&&n++;const o=e/t.length,a=s/t.length,c=i/t.length,l=n/t.length;return{upperPercent:o,lowerPercent:a,alphaPercent:c,numericPercent:l}}function p9(t){const{upperPercent:e,lowerPercent:s}=t;return s===0&&e>.6}function g9(t){const{upperPercent:e,lowerPercent:s,alphaPercent:i,numericPercent:n}=t;return s>.2&&e<.8&&i>.6&&n<.2}function m9(t){let e=0,s=0,i=0,n=0;for(let r=0;r<t.length;r++)i=t.charCodeAt(r),wa(i)&&e++,bh(i)&&s++,u9(i)&&n++;return(e===0||s===0)&&n===0?t.length<=30:e<=5}function d0(t,e){if(!e||(e=e.trim(),e.length===0)||!m9(t))return null;e.length>60&&(e=e.substring(0,60));const s=d9(e);if(!g9(s)){if(!p9(s))return null;e=e.toLowerCase()}let i=null,n=0;for(t=t.toLowerCase();n<e.length&&(i=Eh(t,e,0,n))===null;)n=f0(e,n+1);return i}var t$=a0(c0,d0,l9),s$=a0(c0,d0,h9),i$=new fo(1e4),va=128;function $h(){const t=[],e=[];for(let s=0;s<=va;s++)e[s]=0;for(let s=0;s<=va;s++)t.push(e.slice(0));return t}function p0(t){const e=[];for(let s=0;s<=t;s++)e[s]=0;return e}var n$=p0(2*va),r$=p0(2*va),o$=$h(),a$=$h(),c$=$h(),g0;(function(t){t[t.Diag=1]="Diag",t[t.Left=2]="Left",t[t.LeftLeft=3]="LeftLeft"})(g0||(g0={}));var m0;(function(t){t.Default=[-100,0];function e(s){return!s||s.length===2&&s[0]===-100&&s[1]===0}t.isDefault=e})(m0||(m0={}));var l$=class{static{this.default={boostFullMatch:!0,firstMatchCanBeWeak:!1}}constructor(t,e){this.firstMatchCanBeWeak=t,this.boostFullMatch=e}},w0=Object.create(null);function d(t,e){if($e(e)){const s=w0[e];if(s===void 0)throw new Error(`${t} references an unknown codicon: ${e}`);e=s}return w0[t]=e,{id:t}}var w9={add:d("add",6e4),plus:d("plus",6e4),gistNew:d("gist-new",6e4),repoCreate:d("repo-create",6e4),lightbulb:d("lightbulb",60001),lightBulb:d("light-bulb",60001),repo:d("repo",60002),repoDelete:d("repo-delete",60002),gistFork:d("gist-fork",60003),repoForked:d("repo-forked",60003),gitPullRequest:d("git-pull-request",60004),gitPullRequestAbandoned:d("git-pull-request-abandoned",60004),recordKeys:d("record-keys",60005),keyboard:d("keyboard",60005),tag:d("tag",60006),gitPullRequestLabel:d("git-pull-request-label",60006),tagAdd:d("tag-add",60006),tagRemove:d("tag-remove",60006),person:d("person",60007),personFollow:d("person-follow",60007),personOutline:d("person-outline",60007),personFilled:d("person-filled",60007),gitBranch:d("git-branch",60008),gitBranchCreate:d("git-branch-create",60008),gitBranchDelete:d("git-branch-delete",60008),sourceControl:d("source-control",60008),mirror:d("mirror",60009),mirrorPublic:d("mirror-public",60009),star:d("star",60010),starAdd:d("star-add",60010),starDelete:d("star-delete",60010),starEmpty:d("star-empty",60010),comment:d("comment",60011),commentAdd:d("comment-add",60011),alert:d("alert",60012),warning:d("warning",60012),search:d("search",60013),searchSave:d("search-save",60013),logOut:d("log-out",60014),signOut:d("sign-out",60014),logIn:d("log-in",60015),signIn:d("sign-in",60015),eye:d("eye",60016),eyeUnwatch:d("eye-unwatch",60016),eyeWatch:d("eye-watch",60016),circleFilled:d("circle-filled",60017),primitiveDot:d("primitive-dot",60017),closeDirty:d("close-dirty",60017),debugBreakpoint:d("debug-breakpoint",60017),debugBreakpointDisabled:d("debug-breakpoint-disabled",60017),debugHint:d("debug-hint",60017),terminalDecorationSuccess:d("terminal-decoration-success",60017),primitiveSquare:d("primitive-square",60018),edit:d("edit",60019),pencil:d("pencil",60019),info:d("info",60020),issueOpened:d("issue-opened",60020),gistPrivate:d("gist-private",60021),gitForkPrivate:d("git-fork-private",60021),lock:d("lock",60021),mirrorPrivate:d("mirror-private",60021),close:d("close",60022),removeClose:d("remove-close",60022),x:d("x",60022),repoSync:d("repo-sync",60023),sync:d("sync",60023),clone:d("clone",60024),desktopDownload:d("desktop-download",60024),beaker:d("beaker",60025),microscope:d("microscope",60025),vm:d("vm",60026),deviceDesktop:d("device-desktop",60026),file:d("file",60027),fileText:d("file-text",60027),more:d("more",60028),ellipsis:d("ellipsis",60028),kebabHorizontal:d("kebab-horizontal",60028),mailReply:d("mail-reply",60029),reply:d("reply",60029),organization:d("organization",60030),organizationFilled:d("organization-filled",60030),organizationOutline:d("organization-outline",60030),newFile:d("new-file",60031),fileAdd:d("file-add",60031),newFolder:d("new-folder",60032),fileDirectoryCreate:d("file-directory-create",60032),trash:d("trash",60033),trashcan:d("trashcan",60033),history:d("history",60034),clock:d("clock",60034),folder:d("folder",60035),fileDirectory:d("file-directory",60035),symbolFolder:d("symbol-folder",60035),logoGithub:d("logo-github",60036),markGithub:d("mark-github",60036),github:d("github",60036),terminal:d("terminal",60037),console:d("console",60037),repl:d("repl",60037),zap:d("zap",60038),symbolEvent:d("symbol-event",60038),error:d("error",60039),stop:d("stop",60039),variable:d("variable",60040),symbolVariable:d("symbol-variable",60040),array:d("array",60042),symbolArray:d("symbol-array",60042),symbolModule:d("symbol-module",60043),symbolPackage:d("symbol-package",60043),symbolNamespace:d("symbol-namespace",60043),symbolObject:d("symbol-object",60043),symbolMethod:d("symbol-method",60044),symbolFunction:d("symbol-function",60044),symbolConstructor:d("symbol-constructor",60044),symbolBoolean:d("symbol-boolean",60047),symbolNull:d("symbol-null",60047),symbolNumeric:d("symbol-numeric",60048),symbolNumber:d("symbol-number",60048),symbolStructure:d("symbol-structure",60049),symbolStruct:d("symbol-struct",60049),symbolParameter:d("symbol-parameter",60050),symbolTypeParameter:d("symbol-type-parameter",60050),symbolKey:d("symbol-key",60051),symbolText:d("symbol-text",60051),symbolReference:d("symbol-reference",60052),goToFile:d("go-to-file",60052),symbolEnum:d("symbol-enum",60053),symbolValue:d("symbol-value",60053),symbolRuler:d("symbol-ruler",60054),symbolUnit:d("symbol-unit",60054),activateBreakpoints:d("activate-breakpoints",60055),archive:d("archive",60056),arrowBoth:d("arrow-both",60057),arrowDown:d("arrow-down",60058),arrowLeft:d("arrow-left",60059),arrowRight:d("arrow-right",60060),arrowSmallDown:d("arrow-small-down",60061),arrowSmallLeft:d("arrow-small-left",60062),arrowSmallRight:d("arrow-small-right",60063),arrowSmallUp:d("arrow-small-up",60064),arrowUp:d("arrow-up",60065),bell:d("bell",60066),bold:d("bold",60067),book:d("book",60068),bookmark:d("bookmark",60069),debugBreakpointConditionalUnverified:d("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:d("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:d("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:d("debug-breakpoint-data-unverified",60072),debugBreakpointData:d("debug-breakpoint-data",60073),debugBreakpointDataDisabled:d("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:d("debug-breakpoint-log-unverified",60074),debugBreakpointLog:d("debug-breakpoint-log",60075),debugBreakpointLogDisabled:d("debug-breakpoint-log-disabled",60075),briefcase:d("briefcase",60076),broadcast:d("broadcast",60077),browser:d("browser",60078),bug:d("bug",60079),calendar:d("calendar",60080),caseSensitive:d("case-sensitive",60081),check:d("check",60082),checklist:d("checklist",60083),chevronDown:d("chevron-down",60084),chevronLeft:d("chevron-left",60085),chevronRight:d("chevron-right",60086),chevronUp:d("chevron-up",60087),chromeClose:d("chrome-close",60088),chromeMaximize:d("chrome-maximize",60089),chromeMinimize:d("chrome-minimize",60090),chromeRestore:d("chrome-restore",60091),circleOutline:d("circle-outline",60092),circle:d("circle",60092),debugBreakpointUnverified:d("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:d("terminal-decoration-incomplete",60092),circleSlash:d("circle-slash",60093),circuitBoard:d("circuit-board",60094),clearAll:d("clear-all",60095),clippy:d("clippy",60096),closeAll:d("close-all",60097),cloudDownload:d("cloud-download",60098),cloudUpload:d("cloud-upload",60099),code:d("code",60100),collapseAll:d("collapse-all",60101),colorMode:d("color-mode",60102),commentDiscussion:d("comment-discussion",60103),creditCard:d("credit-card",60105),dash:d("dash",60108),dashboard:d("dashboard",60109),database:d("database",60110),debugContinue:d("debug-continue",60111),debugDisconnect:d("debug-disconnect",60112),debugPause:d("debug-pause",60113),debugRestart:d("debug-restart",60114),debugStart:d("debug-start",60115),debugStepInto:d("debug-step-into",60116),debugStepOut:d("debug-step-out",60117),debugStepOver:d("debug-step-over",60118),debugStop:d("debug-stop",60119),debug:d("debug",60120),deviceCameraVideo:d("device-camera-video",60121),deviceCamera:d("device-camera",60122),deviceMobile:d("device-mobile",60123),diffAdded:d("diff-added",60124),diffIgnored:d("diff-ignored",60125),diffModified:d("diff-modified",60126),diffRemoved:d("diff-removed",60127),diffRenamed:d("diff-renamed",60128),diff:d("diff",60129),diffSidebyside:d("diff-sidebyside",60129),discard:d("discard",60130),editorLayout:d("editor-layout",60131),emptyWindow:d("empty-window",60132),exclude:d("exclude",60133),extensions:d("extensions",60134),eyeClosed:d("eye-closed",60135),fileBinary:d("file-binary",60136),fileCode:d("file-code",60137),fileMedia:d("file-media",60138),filePdf:d("file-pdf",60139),fileSubmodule:d("file-submodule",60140),fileSymlinkDirectory:d("file-symlink-directory",60141),fileSymlinkFile:d("file-symlink-file",60142),fileZip:d("file-zip",60143),files:d("files",60144),filter:d("filter",60145),flame:d("flame",60146),foldDown:d("fold-down",60147),foldUp:d("fold-up",60148),fold:d("fold",60149),folderActive:d("folder-active",60150),folderOpened:d("folder-opened",60151),gear:d("gear",60152),gift:d("gift",60153),gistSecret:d("gist-secret",60154),gist:d("gist",60155),gitCommit:d("git-commit",60156),gitCompare:d("git-compare",60157),compareChanges:d("compare-changes",60157),gitMerge:d("git-merge",60158),githubAction:d("github-action",60159),githubAlt:d("github-alt",60160),globe:d("globe",60161),grabber:d("grabber",60162),graph:d("graph",60163),gripper:d("gripper",60164),heart:d("heart",60165),home:d("home",60166),horizontalRule:d("horizontal-rule",60167),hubot:d("hubot",60168),inbox:d("inbox",60169),issueReopened:d("issue-reopened",60171),issues:d("issues",60172),italic:d("italic",60173),jersey:d("jersey",60174),json:d("json",60175),kebabVertical:d("kebab-vertical",60176),key:d("key",60177),law:d("law",60178),lightbulbAutofix:d("lightbulb-autofix",60179),linkExternal:d("link-external",60180),link:d("link",60181),listOrdered:d("list-ordered",60182),listUnordered:d("list-unordered",60183),liveShare:d("live-share",60184),loading:d("loading",60185),location:d("location",60186),mailRead:d("mail-read",60187),mail:d("mail",60188),markdown:d("markdown",60189),megaphone:d("megaphone",60190),mention:d("mention",60191),milestone:d("milestone",60192),gitPullRequestMilestone:d("git-pull-request-milestone",60192),mortarBoard:d("mortar-board",60193),move:d("move",60194),multipleWindows:d("multiple-windows",60195),mute:d("mute",60196),noNewline:d("no-newline",60197),note:d("note",60198),octoface:d("octoface",60199),openPreview:d("open-preview",60200),package:d("package",60201),paintcan:d("paintcan",60202),pin:d("pin",60203),play:d("play",60204),run:d("run",60204),plug:d("plug",60205),preserveCase:d("preserve-case",60206),preview:d("preview",60207),project:d("project",60208),pulse:d("pulse",60209),question:d("question",60210),quote:d("quote",60211),radioTower:d("radio-tower",60212),reactions:d("reactions",60213),references:d("references",60214),refresh:d("refresh",60215),regex:d("regex",60216),remoteExplorer:d("remote-explorer",60217),remote:d("remote",60218),remove:d("remove",60219),replaceAll:d("replace-all",60220),replace:d("replace",60221),repoClone:d("repo-clone",60222),repoForcePush:d("repo-force-push",60223),repoPull:d("repo-pull",60224),repoPush:d("repo-push",60225),report:d("report",60226),requestChanges:d("request-changes",60227),rocket:d("rocket",60228),rootFolderOpened:d("root-folder-opened",60229),rootFolder:d("root-folder",60230),rss:d("rss",60231),ruby:d("ruby",60232),saveAll:d("save-all",60233),saveAs:d("save-as",60234),save:d("save",60235),screenFull:d("screen-full",60236),screenNormal:d("screen-normal",60237),searchStop:d("search-stop",60238),server:d("server",60240),settingsGear:d("settings-gear",60241),settings:d("settings",60242),shield:d("shield",60243),smiley:d("smiley",60244),sortPrecedence:d("sort-precedence",60245),splitHorizontal:d("split-horizontal",60246),splitVertical:d("split-vertical",60247),squirrel:d("squirrel",60248),starFull:d("star-full",60249),starHalf:d("star-half",60250),symbolClass:d("symbol-class",60251),symbolColor:d("symbol-color",60252),symbolConstant:d("symbol-constant",60253),symbolEnumMember:d("symbol-enum-member",60254),symbolField:d("symbol-field",60255),symbolFile:d("symbol-file",60256),symbolInterface:d("symbol-interface",60257),symbolKeyword:d("symbol-keyword",60258),symbolMisc:d("symbol-misc",60259),symbolOperator:d("symbol-operator",60260),symbolProperty:d("symbol-property",60261),wrench:d("wrench",60261),wrenchSubaction:d("wrench-subaction",60261),symbolSnippet:d("symbol-snippet",60262),tasklist:d("tasklist",60263),telescope:d("telescope",60264),textSize:d("text-size",60265),threeBars:d("three-bars",60266),thumbsdown:d("thumbsdown",60267),thumbsup:d("thumbsup",60268),tools:d("tools",60269),triangleDown:d("triangle-down",60270),triangleLeft:d("triangle-left",60271),triangleRight:d("triangle-right",60272),triangleUp:d("triangle-up",60273),twitter:d("twitter",60274),unfold:d("unfold",60275),unlock:d("unlock",60276),unmute:d("unmute",60277),unverified:d("unverified",60278),verified:d("verified",60279),versions:d("versions",60280),vmActive:d("vm-active",60281),vmOutline:d("vm-outline",60282),vmRunning:d("vm-running",60283),watch:d("watch",60284),whitespace:d("whitespace",60285),wholeWord:d("whole-word",60286),window:d("window",60287),wordWrap:d("word-wrap",60288),zoomIn:d("zoom-in",60289),zoomOut:d("zoom-out",60290),listFilter:d("list-filter",60291),listFlat:d("list-flat",60292),listSelection:d("list-selection",60293),selection:d("selection",60293),listTree:d("list-tree",60294),debugBreakpointFunctionUnverified:d("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:d("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:d("debug-breakpoint-function-disabled",60296),debugStackframeActive:d("debug-stackframe-active",60297),circleSmallFilled:d("circle-small-filled",60298),debugStackframeDot:d("debug-stackframe-dot",60298),terminalDecorationMark:d("terminal-decoration-mark",60298),debugStackframe:d("debug-stackframe",60299),debugStackframeFocused:d("debug-stackframe-focused",60299),debugBreakpointUnsupported:d("debug-breakpoint-unsupported",60300),symbolString:d("symbol-string",60301),debugReverseContinue:d("debug-reverse-continue",60302),debugStepBack:d("debug-step-back",60303),debugRestartFrame:d("debug-restart-frame",60304),debugAlt:d("debug-alt",60305),callIncoming:d("call-incoming",60306),callOutgoing:d("call-outgoing",60307),menu:d("menu",60308),expandAll:d("expand-all",60309),feedback:d("feedback",60310),gitPullRequestReviewer:d("git-pull-request-reviewer",60310),groupByRefType:d("group-by-ref-type",60311),ungroupByRefType:d("ungroup-by-ref-type",60312),account:d("account",60313),gitPullRequestAssignee:d("git-pull-request-assignee",60313),bellDot:d("bell-dot",60314),debugConsole:d("debug-console",60315),library:d("library",60316),output:d("output",60317),runAll:d("run-all",60318),syncIgnored:d("sync-ignored",60319),pinned:d("pinned",60320),githubInverted:d("github-inverted",60321),serverProcess:d("server-process",60322),serverEnvironment:d("server-environment",60323),pass:d("pass",60324),issueClosed:d("issue-closed",60324),stopCircle:d("stop-circle",60325),playCircle:d("play-circle",60326),record:d("record",60327),debugAltSmall:d("debug-alt-small",60328),vmConnect:d("vm-connect",60329),cloud:d("cloud",60330),merge:d("merge",60331),export:d("export",60332),graphLeft:d("graph-left",60333),magnet:d("magnet",60334),notebook:d("notebook",60335),redo:d("redo",60336),checkAll:d("check-all",60337),pinnedDirty:d("pinned-dirty",60338),passFilled:d("pass-filled",60339),circleLargeFilled:d("circle-large-filled",60340),circleLarge:d("circle-large",60341),circleLargeOutline:d("circle-large-outline",60341),combine:d("combine",60342),gather:d("gather",60342),table:d("table",60343),variableGroup:d("variable-group",60344),typeHierarchy:d("type-hierarchy",60345),typeHierarchySub:d("type-hierarchy-sub",60346),typeHierarchySuper:d("type-hierarchy-super",60347),gitPullRequestCreate:d("git-pull-request-create",60348),runAbove:d("run-above",60349),runBelow:d("run-below",60350),notebookTemplate:d("notebook-template",60351),debugRerun:d("debug-rerun",60352),workspaceTrusted:d("workspace-trusted",60353),workspaceUntrusted:d("workspace-untrusted",60354),workspaceUnknown:d("workspace-unknown",60355),terminalCmd:d("terminal-cmd",60356),terminalDebian:d("terminal-debian",60357),terminalLinux:d("terminal-linux",60358),terminalPowershell:d("terminal-powershell",60359),terminalTmux:d("terminal-tmux",60360),terminalUbuntu:d("terminal-ubuntu",60361),terminalBash:d("terminal-bash",60362),arrowSwap:d("arrow-swap",60363),copy:d("copy",60364),personAdd:d("person-add",60365),filterFilled:d("filter-filled",60366),wand:d("wand",60367),debugLineByLine:d("debug-line-by-line",60368),inspect:d("inspect",60369),layers:d("layers",60370),layersDot:d("layers-dot",60371),layersActive:d("layers-active",60372),compass:d("compass",60373),compassDot:d("compass-dot",60374),compassActive:d("compass-active",60375),azure:d("azure",60376),issueDraft:d("issue-draft",60377),gitPullRequestClosed:d("git-pull-request-closed",60378),gitPullRequestDraft:d("git-pull-request-draft",60379),debugAll:d("debug-all",60380),debugCoverage:d("debug-coverage",60381),runErrors:d("run-errors",60382),folderLibrary:d("folder-library",60383),debugContinueSmall:d("debug-continue-small",60384),beakerStop:d("beaker-stop",60385),graphLine:d("graph-line",60386),graphScatter:d("graph-scatter",60387),pieChart:d("pie-chart",60388),bracket:d("bracket",60175),bracketDot:d("bracket-dot",60389),bracketError:d("bracket-error",60390),lockSmall:d("lock-small",60391),azureDevops:d("azure-devops",60392),verifiedFilled:d("verified-filled",60393),newline:d("newline",60394),layout:d("layout",60395),layoutActivitybarLeft:d("layout-activitybar-left",60396),layoutActivitybarRight:d("layout-activitybar-right",60397),layoutPanelLeft:d("layout-panel-left",60398),layoutPanelCenter:d("layout-panel-center",60399),layoutPanelJustify:d("layout-panel-justify",60400),layoutPanelRight:d("layout-panel-right",60401),layoutPanel:d("layout-panel",60402),layoutSidebarLeft:d("layout-sidebar-left",60403),layoutSidebarRight:d("layout-sidebar-right",60404),layoutStatusbar:d("layout-statusbar",60405),layoutMenubar:d("layout-menubar",60406),layoutCentered:d("layout-centered",60407),target:d("target",60408),indent:d("indent",60409),recordSmall:d("record-small",60410),errorSmall:d("error-small",60411),terminalDecorationError:d("terminal-decoration-error",60411),arrowCircleDown:d("arrow-circle-down",60412),arrowCircleLeft:d("arrow-circle-left",60413),arrowCircleRight:d("arrow-circle-right",60414),arrowCircleUp:d("arrow-circle-up",60415),layoutSidebarRightOff:d("layout-sidebar-right-off",60416),layoutPanelOff:d("layout-panel-off",60417),layoutSidebarLeftOff:d("layout-sidebar-left-off",60418),blank:d("blank",60419),heartFilled:d("heart-filled",60420),map:d("map",60421),mapHorizontal:d("map-horizontal",60421),foldHorizontal:d("fold-horizontal",60421),mapFilled:d("map-filled",60422),mapHorizontalFilled:d("map-horizontal-filled",60422),foldHorizontalFilled:d("fold-horizontal-filled",60422),circleSmall:d("circle-small",60423),bellSlash:d("bell-slash",60424),bellSlashDot:d("bell-slash-dot",60425),commentUnresolved:d("comment-unresolved",60426),gitPullRequestGoToChanges:d("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:d("git-pull-request-new-changes",60428),searchFuzzy:d("search-fuzzy",60429),commentDraft:d("comment-draft",60430),send:d("send",60431),sparkle:d("sparkle",60432),insert:d("insert",60433),mic:d("mic",60434),thumbsdownFilled:d("thumbsdown-filled",60435),thumbsupFilled:d("thumbsup-filled",60436),coffee:d("coffee",60437),snake:d("snake",60438),game:d("game",60439),vr:d("vr",60440),chip:d("chip",60441),piano:d("piano",60442),music:d("music",60443),micFilled:d("mic-filled",60444),repoFetch:d("repo-fetch",60445),copilot:d("copilot",60446),lightbulbSparkle:d("lightbulb-sparkle",60447),robot:d("robot",60448),sparkleFilled:d("sparkle-filled",60449),diffSingle:d("diff-single",60450),diffMultiple:d("diff-multiple",60451),surroundWith:d("surround-with",60452),share:d("share",60453),gitStash:d("git-stash",60454),gitStashApply:d("git-stash-apply",60455),gitStashPop:d("git-stash-pop",60456),vscode:d("vscode",60457),vscodeInsiders:d("vscode-insiders",60458),codeOss:d("code-oss",60459),runCoverage:d("run-coverage",60460),runAllCoverage:d("run-all-coverage",60461),coverage:d("coverage",60462),githubProject:d("github-project",60463),mapVertical:d("map-vertical",60464),foldVertical:d("fold-vertical",60464),mapVerticalFilled:d("map-vertical-filled",60465),foldVerticalFilled:d("fold-vertical-filled",60465),goToSearch:d("go-to-search",60466),percentage:d("percentage",60467),sortPercentage:d("sort-percentage",60467),attach:d("attach",60468),goToEditingSession:d("go-to-editing-session",60469),editSession:d("edit-session",60470),codeReview:d("code-review",60471),copilotWarning:d("copilot-warning",60472),python:d("python",60473),copilotLarge:d("copilot-large",60474),copilotWarningLarge:d("copilot-warning-large",60475),keyboardTab:d("keyboard-tab",60476),copilotBlocked:d("copilot-blocked",60477),copilotNotConnected:d("copilot-not-connected",60478),flag:d("flag",60479),lightbulbEmpty:d("lightbulb-empty",60480),symbolMethodArrow:d("symbol-method-arrow",60481),copilotUnavailable:d("copilot-unavailable",60482),repoPinned:d("repo-pinned",60483),keyboardTabAbove:d("keyboard-tab-above",60484),keyboardTabBelow:d("keyboard-tab-below",60485),gitPullRequestDone:d("git-pull-request-done",60486),mcp:d("mcp",60487),extensionsLarge:d("extensions-large",60488),layoutPanelDock:d("layout-panel-dock",60489),layoutSidebarLeftDock:d("layout-sidebar-left-dock",60490),layoutSidebarRightDock:d("layout-sidebar-right-dock",60491),copilotInProgress:d("copilot-in-progress",60492),copilotError:d("copilot-error",60493),copilotSuccess:d("copilot-success",60494),chatSparkle:d("chat-sparkle",60495),searchSparkle:d("search-sparkle",60496),editSparkle:d("edit-sparkle",60497),copilotSnooze:d("copilot-snooze",60498),sendToRemoteAgent:d("send-to-remote-agent",60499),commentDiscussionSparkle:d("comment-discussion-sparkle",60500),chatSparkleWarning:d("chat-sparkle-warning",60501),chatSparkleError:d("chat-sparkle-error",60502)},v9={dialogError:d("dialog-error","error"),dialogWarning:d("dialog-warning","warning"),dialogInfo:d("dialog-info","info"),dialogClose:d("dialog-close","close"),treeItemExpanded:d("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:d("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:d("tree-filter-on-type-off","list-selection"),treeFilterClear:d("tree-filter-clear","close"),treeItemLoading:d("tree-item-loading","loading"),menuSelection:d("menu-selection","check"),menuSubmenu:d("menu-submenu","chevron-right"),menuBarMore:d("menubar-more","more"),scrollbarButtonLeft:d("scrollbar-button-left","triangle-left"),scrollbarButtonRight:d("scrollbar-button-right","triangle-right"),scrollbarButtonUp:d("scrollbar-button-up","triangle-up"),scrollbarButtonDown:d("scrollbar-button-down","triangle-down"),toolBarMore:d("toolbar-more","more"),quickInputBack:d("quick-input-back","arrow-left"),dropDownButton:d("drop-down-button",60084),symbolCustomColor:d("symbol-customcolor",60252),exportIcon:d("export",60332),workspaceUnspecified:d("workspace-unspecified",60355),newLine:d("newline",60394),thumbsDownFilled:d("thumbsdown-filled",60435),thumbsUpFilled:d("thumbsup-filled",60436),gitFetch:d("git-fetch",60445),lightbulbSparkleAutofix:d("lightbulb-sparkle-autofix",60447),debugBreakpointPending:d("debug-breakpoint-pending",60377)},y9={...w9,...v9},xh;(function(t){function e(s){return!!s&&typeof s=="object"&&typeof s.id=="string"}t.isThemeColor=e})(xh||(xh={}));var Ir;(function(t){t.iconNameSegment="[A-Za-z0-9]+",t.iconNameExpression="[A-Za-z0-9-]+",t.iconModifierExpression="~[A-Za-z]+",t.iconNameCharacter="[A-Za-z0-9~-]";const e=new RegExp(`^(${t.iconNameExpression})(${t.iconModifierExpression})?$`);function s(f){const p=e.exec(f.id);if(!p)return s(y9.error);const[,g,m]=p,w=["codicon","codicon-"+g];return m&&w.push("codicon-modifier-"+m.substring(1)),w}t.asClassNameArray=s;function i(f){return s(f).join(" ")}t.asClassName=i;function n(f){return"."+s(f).join(".")}t.asCSSSelector=n;function r(f){return!!f&&typeof f=="object"&&typeof f.id=="string"&&(typeof f.color>"u"||xh.isThemeColor(f.color))}t.isThemeIcon=r;const o=new RegExp(`^\\$\\((${t.iconNameExpression}(?:${t.iconModifierExpression})?)\\)$`);function a(f){const p=o.exec(f);if(!p)return;const[,g]=p;return{id:g}}t.fromString=a;function c(f){return{id:f}}t.fromId=c;function l(f,p){let g=f.id;const m=g.lastIndexOf("~");return m!==-1&&(g=g.substring(0,m)),p&&(g=`${g}~${p}`),{id:g}}t.modify=l;function h(f){const p=f.id.lastIndexOf("~");if(p!==-1)return f.id.substring(p+1)}t.getModifier=h;function u(f,p){return f.id===p.id&&f.color?.id===p.color?.id}t.isEqual=u})(Ir||(Ir={}));var kh=new RegExp(`\\$\\(${Ir.iconNameExpression}(?:${Ir.iconModifierExpression})?\\)`,"g"),b9=new RegExp(`(\\\\)?${kh.source}`,"g");function S9(t){return t.replace(b9,(e,s)=>s?e:`\\${e}`)}var h$=new RegExp(`\\\\${kh.source}`,"g"),u$=new RegExp(`(\\s)?(\\\\)?${kh.source}(\\s)?`,"g"),f$=new RegExp(`\\$\\(${Ir.iconNameCharacter}+\\)`,"g"),v0;(function(t){t[t.Paragraph=0]="Paragraph",t[t.Break=1]="Break"})(v0||(v0={}));var Cs=class pv{static lift(e){const s=new pv(e.value,e);return s.uris=e.uris,s.baseUri=e.baseUri?k.revive(e.baseUri):void 0,s}constructor(e="",s=!1){if(this.value=e,typeof this.value!="string")throw jv("value");typeof s=="boolean"?(this.isTrusted=s,this.supportThemeIcons=!1,this.supportHtml=!1):(this.isTrusted=s.isTrusted??void 0,this.supportThemeIcons=s.supportThemeIcons??!1,this.supportHtml=s.supportHtml??!1)}appendText(e,s=0){return this.value+=E9(this.supportThemeIcons?S9(e):e).replace(/([ \t]+)/g,(i,n)=>"&nbsp;".repeat(n.length)).replace(/\>/gm,"\\>").replace(/\n/g,s===1?`\\
`:`

`),this}appendMarkdown(e){return this.value+=e,this}appendCodeblock(e,s){return this.value+=`
${$9(s,e)}
`,this}appendLink(e,s,i){return this.value+="[",this.value+=this.c(s,"]"),this.value+="](",this.value+=this.c(String(e),")"),i&&(this.value+=` "${this.c(this.c(i,'"'),")")}"`),this.value+=")",this}c(e,s){const i=new RegExp(ki(s),"g");return e.replace(i,(n,r)=>e.charAt(r-1)!=="\\"?`\\${n}`:n)}};function E9(t){return t.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}function $9(t,e){const s=t.match(/^`+/gm)?.reduce((n,r)=>n.length>r.length?n:r).length??0,i=s>=3?s+1:3;return[`${"`".repeat(i)}${e}`,t,`${"`".repeat(i)}`].join(`
`)}var Ph=class extends T{constructor(e,s){super(),this.g=e,this.h=s,this.preferPreReleases=this.g.quality!=="stable"}async canInstall(e){const s=this.h.isAllowed({id:e.identifier.id,publisherDisplayName:e.publisherDisplayName});if(s!==!0)return new Cs(v(1931,null,s.value));if(!await this.j(e)){const i=ot?"https://aka.ms/vscode-web-extensions-guide":"https://aka.ms/vscode-platform-specific-extensions";return new Cs(`${v(1932,null,e.displayName??e.identifier.id,this.g.nameLong,yp(await this.getTargetPlatform()))} [${v(1933,null)}](${i})`)}return!0}async j(e){const s=await this.getTargetPlatform();return e.allTargetPlatforms.some(i=>Sp(i,e.allTargetPlatforms,s))}};Ph=__decorate([__param(0,pe),__param(1,Mi)],Ph);var Rh=class extends Ph{get onInstallExtension(){return this.u.event}get onDidInstallExtensions(){return this.w.event}get onUninstallExtension(){return this.y.event}get onDidUninstallExtension(){return this.z.event}get onDidUpdateExtensionMetadata(){return this.C.event}constructor(e,s,i,n,r,o,a){super(r,o),this.F=e,this.G=s,this.H=i,this.I=n,this.J=a,this.n=0,this.s=new Map,this.t=new Map,this.u=this.B(new R),this.w=this.B(new R),this.y=this.B(new R),this.z=this.B(new R),this.C=this.B(new R),this.D=[],this.B(de(()=>{this.s.forEach(({task:c})=>c.cancel()),this.t.forEach(c=>c.cancel()),this.s.clear(),this.t.clear()}))}async installFromGallery(e,s={}){try{const n=(await this.installGalleryExtensions([{extension:e,options:s}])).find(({identifier:r})=>G(r,e.identifier));if(n?.local)return n?.local;throw n?.error?n.error:new Te(`Unknown error while installing extension ${e.identifier.id}`,"Unknown")}catch(i){throw He(i)}}async installGalleryExtensions(e){if(!this.F.isEnabled())throw new Te(v(1934,null),"NotAllowed");const s=[],i=[];return await Promise.allSettled(e.map(async({extension:n,options:r})=>{try{const o=await this.Q(n,!!r?.installGivenVersion,!!r?.installPreReleaseVersion,r.productVersion??{version:this.g.version,date:this.g.date});i.push({...o,options:r})}catch(o){s.push({identifier:n.identifier,operation:2,source:n,error:o,profileLocation:r.profileLocation??this.$()})}})),i.length&&s.push(...await this.L(i)),s}async uninstall(e,s){return this.I.trace("ExtensionManagementService#uninstall",e.identifier.id),this.uninstallExtensions([{extension:e,options:s}])}async toggleApplicationScope(e,s){if(ih(e.manifest)||e.isBuiltin)return e;if(e.isApplicationScoped){let i=await this.updateMetadata(e,{isApplicationScoped:!1},this.J.defaultProfile.extensionsResource);this.H.extUri.isEqual(s,this.J.defaultProfile.extensionsResource)||(i=await this.cb(e,this.J.defaultProfile.extensionsResource,s));for(const n of this.J.profiles){const r=(await this.getInstalled(1,n.extensionsResource)).find(o=>G(o.identifier,e.identifier));r?this.C.fire({local:r,profileLocation:n.extensionsResource}):this.z.fire({identifier:e.identifier,profileLocation:n.extensionsResource})}return i}else{const i=this.H.extUri.isEqual(s,this.J.defaultProfile.extensionsResource)?await this.updateMetadata(e,{isApplicationScoped:!0},this.J.defaultProfile.extensionsResource):await this.cb(e,s,this.J.defaultProfile.extensionsResource,{isApplicationScoped:!0});return this.w.fire([{identifier:i.identifier,operation:2,local:i,profileLocation:this.J.defaultProfile.extensionsResource,applicationScoped:!0}]),i}}getExtensionsControlManifest(){const e=new Date().getTime();return(!this.m||e-this.n>1e3*60*5)&&(this.m=this.Z(),this.n=e),this.m}registerParticipant(e){this.D.push(e)}async resetPinnedStateForAllUserExtensions(e){try{await this.O(this.J.profiles.map(async s=>{const i=await this.getInstalled(1,s.extensionsResource);await this.O(i.map(async n=>{n.pinned!==e&&await this.updateMetadata(n,{pinned:e},s.extensionsResource)}))}))}catch(s){throw this.I.error("Error while resetting pinned state for all user extensions",se(s)),s}}async L(e){const s=new Map,i=new Map,n=[],r=(c,l)=>`${Wt.create(c).toString()}-${l.toString()}`,o=(c,l,h,u)=>{let f;if(!k.isUri(l)){if(i.has(`${l.identifier.id.toLowerCase()}-${h.profileLocation.toString()}`))return;const m=this.s.get(r(l,h.profileLocation));if(m){if(u&&this.N(u,m.task)){const w=m.task.identifier;this.I.info("Waiting for already requested installing extension",w.id,u.identifier.id,h.profileLocation.toString()),m.waitingTasks.push(u),n.push(L.toPromise(L.filter(this.onDidInstallExtensions,b=>b.some(S=>G(S.identifier,w)))).then(b=>{if(this.I.info("Finished waiting for already requested installing extension",w.id,u.identifier.id,h.profileLocation.toString()),!b.find($=>G($.identifier,w))?.local)throw new Error(`Extension ${w.id} is not installed`)}))}return}f=this.t.get(this.S(l.identifier,h.profileLocation))}const p=this.ab(c,l,h),g=`${ks(c.publisher,c.name)}-${h.profileLocation.toString()}`;i.set(g,{task:p,root:u,uninstallTaskToWaitFor:f}),this.u.fire({identifier:p.identifier,source:l,profileLocation:h.profileLocation}),this.I.info("Installing extension:",p.identifier.id,h),k.isUri(l)||this.s.set(r(l,h.profileLocation),{task:p,waitingTasks:[]})};try{for(const{manifest:l,extension:h,options:u}of e){const f=u.isApplicationScoped||u.isBuiltin||ih(l),p={...u,isApplicationScoped:f,profileLocation:f?this.J.defaultProfile.extensionsResource:u.profileLocation??this.$(),productVersion:u.productVersion??{version:this.g.version,date:this.g.date}},g=k.isUri(h)?void 0:this.s.get(r(h,p.profileLocation));g?(this.I.info("Extension is already requested to install",g.task.identifier.id,p.profileLocation.toString()),n.push(g.task.waitUntilTaskIsFinished())):o(l,h,p,void 0)}await Promise.all([...i.values()].map(async({task:l})=>{if(l.options.donotIncludePackAndDependencies)this.I.info("Installing the extension without checking dependencies and pack",l.identifier.id);else try{let h=this.preferPreReleases;l.options.installPreReleaseVersion?h=!0:!k.isUri(l.source)&&l.source.hasPreReleaseVersion&&(h=!1);const u=await this.getInstalled(void 0,l.options.profileLocation,l.options.productVersion),f=await this.P(l.identifier,l.manifest,h,l.options.productVersion,u),p={...l.options,pinned:!1,installGivenVersion:!1,context:{...l.options.context,[d2]:!0}};for(const{gallery:g,manifest:m}of Rt(f,({gallery:w})=>w.identifier.id)){const w=u.find(b=>G(b.identifier,g.identifier));w&&w.isApplicationScoped===!!p.isApplicationScoped||o(m,g,p,l)}}catch(h){if(k.isUri(l.source))Hn(l.manifest.extensionDependencies)&&this.I.warn("Cannot install dependencies of extension:",l.identifier.id,h.message),Hn(l.manifest.extensionPack)&&this.I.warn("Cannot install packed extensions of extension:",l.identifier.id,h.message);else throw this.I.error("Error while preparing to install dependencies and extension packs of the extension:",l.identifier.id),h}}));const c=await this.M([...i.values()].map(({task:l})=>l));for(const[l,h]of c)o(h.manifest,h.source,{...h.options,profileLocation:l},void 0);await this.O([...i.entries()].map(async([l,{task:h,uninstallTaskToWaitFor:u}])=>{const f=new Date().getTime();let p;try{if(u){this.I.info("Waiting for existing uninstall task to complete before installing",h.identifier.id);try{await u.waitUntilTaskIsFinished(),this.I.info("Finished waiting for uninstall task, proceeding with install",h.identifier.id)}catch(g){this.I.info("Uninstall task failed, proceeding with install anyway",h.identifier.id,se(g))}}p=await h.run(),await this.O(this.D.map(g=>g.postInstall(p,h.source,h.options,Q.None)),"PostInstall")}catch(g){const m=He(g);throw k.isUri(h.source)||Ch(this.G,h.operation===3?"extensionGallery:update":"extensionGallery:install",{extensionData:nh(h.source),error:m,source:h.options.context?.[xl]}),s.set(l,{error:m,identifier:h.identifier,operation:h.operation,source:h.source,context:h.options.context,profileLocation:h.options.profileLocation,applicationScoped:h.options.isApplicationScoped}),this.I.error("Error while installing the extension",h.identifier.id,se(m),h.options.profileLocation.toString()),m}if(!k.isUri(h.source)){const g=h.operation===3,m=g?void 0:(new Date().getTime()-h.source.lastUpdated)/1e3;if(Ch(this.G,g?"extensionGallery:update":"extensionGallery:install",{extensionData:nh(h.source),verificationStatus:h.verificationStatus,duration:new Date().getTime()-f,durationSinceUpdate:m,source:h.options.context?.[xl]}),ot&&h.operation!==3)try{await this.F.reportStatistic(p.manifest.publisher,p.manifest.name,p.manifest.version,"install")}catch{}}s.set(l,{local:p,identifier:h.identifier,operation:h.operation,source:h.source,context:h.options.context,profileLocation:h.options.profileLocation,applicationScoped:p.isApplicationScoped})})),n.length&&await this.O(n)}catch(c){const l=(f,p,g)=>{const m=[];f.manifest.extensionDependencies?.length&&m.push(...f.manifest.extensionDependencies),f.manifest.extensionPack?.length&&m.push(...f.manifest.extensionPack);for(const w of m){if(g.includes(w.toLowerCase()))continue;g.push(w.toLowerCase());const b=s.get(`${w.toLowerCase()}-${p.toString()}`);b?.local&&(g=l(b.local,p,g))}return g},h=f=>({identifier:f.identifier,operation:2,source:f.source,context:f.options.context,profileLocation:f.options.profileLocation,error:c}),u=[];for(const[f,{task:p,root:g}]of i){const m=s.get(f);m?m.local&&g&&!s.get(`${g.identifier.id.toLowerCase()}-${p.options.profileLocation.toString()}`)?.local&&(u.push(this.bb(m.local,{versionOnly:!0,profileLocation:p.options.profileLocation})),s.set(f,h(p))):(p.cancel(),s.set(f,h(p)))}for(const[f,{task:p}]of i){const g=s.get(f);if(!g?.local||p.options.donotIncludePackAndDependencies)continue;l(g.local,p.options.profileLocation,[g.local.identifier.id.toLowerCase()]).slice(1).some(w=>i.has(`${w.toLowerCase()}-${p.options.profileLocation.toString()}`)&&!s.get(`${w.toLowerCase()}-${p.options.profileLocation.toString()}`)?.local)&&(u.push(this.bb(g.local,{versionOnly:!0,profileLocation:p.options.profileLocation})),s.set(f,h(p)))}u.length&&await Promise.allSettled(u.map(async f=>{try{await f.run(),this.I.info("Rollback: Uninstalled extension",f.extension.identifier.id)}catch(p){this.I.warn("Rollback: Error while uninstalling extension",f.extension.identifier.id,se(p))}}))}finally{for(const{task:c}of i.values())c.source&&!k.isUri(c.source)&&this.s.delete(r(c.source,c.options.profileLocation))}const a=[...s.values()];for(const c of a)c.local&&this.I.info("Extension installed successfully:",c.identifier.id,c.profileLocation.toString());return this.w.fire(a),a}async M(e){const s=[],i=new lt;for(const n of e)if(!(n.operation!==3||n.options.isApplicationScoped||n.options.pinned||n.options.installGivenVersion||k.isUri(n.source)))for(const r of this.J.profiles){if(this.H.extUri.isEqual(r.extensionsResource,n.options.profileLocation))continue;let o=i.get(r.extensionsResource);o||(o=await this.getInstalled(1,r.extensionsResource),i.set(r.extensionsResource,o));const a=o.find(c=>G(c.identifier,n.identifier));a&&!a.pinned&&s.push([r.extensionsResource,n])}return s}N(e,s){for(const[,{task:i,waitingTasks:n}]of this.s.entries())if(i===e&&(n.includes(s)||n.some(r=>this.N(r,s)))||i===s&&n[0]&&!this.N(e,n[0]))return!1;return!0}async O(e,s){const i=[],n=[],r=await Promise.allSettled(e);for(const a of r)a.status==="fulfilled"?i.push(a.value):n.push(He(a.reason,s));if(!n.length)return i;if(n.length===1)throw n[0];let o=new Te("","Unknown");for(const a of n)o=new Te(o.message?`${o.message}, ${a.message}`:a.message,a.code!=="Unknown"&&a.code!=="Internal"?a.code:o.code);throw o}async P(e,s,i,n,r){if(!this.F.isEnabled())return[];const o=[],a=[],c=async(l,h)=>{o.push(l);const u=h.extensionDependencies||[],f=[...u];if(h.extensionPack){const p=r.find(g=>G(g.identifier,l));for(const g of h.extensionPack)p&&p.manifest.extensionPack&&p.manifest.extensionPack.some(m=>G({id:m},{id:g}))||f.every(m=>!G({id:m},{id:g}))&&f.push(g)}if(f.length){const p=f.filter(g=>o.every(m=>!G(m,{id:g})));if(p.length){const g=await this.F.getExtensions(p.map(m=>({id:m,preRelease:i})),Q.None);for(const m of g){if(o.find(S=>G(S,m.identifier)))continue;const w=u.some(S=>G({id:S},m.identifier));let b;try{b=await this.Q(m,!1,i,n)}catch(S){if(w)throw S;this.I.info("Skipping the packed extension as it cannot be installed",m.identifier.id,se(S));continue}a.push({gallery:b.extension,manifest:b.manifest}),await c(b.extension.identifier,b.manifest)}}}};return await c(e,s),a}async Q(e,s,i,n){let r;const o=await this.getExtensionsControlManifest();if(I5(e.identifier,o.malicious))throw new Te(v(1935,null,e.identifier.id),"Malicious");const a=o.deprecated[e.identifier.id.toLowerCase()];if(a?.extension?.autoMigrate){if(this.I.info(`The '${e.identifier.id}' extension is deprecated, fetching the compatible '${a.extension.id}' extension instead.`),r=(await this.F.getExtensions([{id:a.extension.id,preRelease:a.extension.preRelease}],{targetPlatform:await this.getTargetPlatform(),compatible:!0,productVersion:n},Q.None))[0],!r)throw new Te(v(1936,null,e.identifier.id,a.extension.id),"Deprecated")}else{if(await this.canInstall(e)!==!0){const l=await this.getTargetPlatform();throw new Te(v(1937,null,e.identifier.id,this.g.nameLong,yp(l)),"IncompatibleTargetPlatform")}if(r=await this.R(e,s,i,n),!r){const l=[];throw hh(e.properties.enabledApiProposals??[],l)?!i&&e.hasPreReleaseVersion&&e.properties.isPreReleaseVersion&&(await this.F.getExtensions([e.identifier],Q.None))[0]?new Te(v(1939,null,e.displayName??e.identifier.id),"ReleaseVersionNotFound"):new Te(v(1940,null,e.identifier.id,this.g.nameLong,this.g.version),"Incompatible"):new Te(v(1938,null,e.displayName??e.identifier.id,l[0]),"IncompatibleApi")}}this.I.info("Getting Manifest...",r.identifier.id);const c=await this.F.getManifest(r,Q.None);if(c===null)throw new Te(`Missing manifest for extension ${r.identifier.id}`,"Invalid");if(c.version!==r.version)throw new Te(`Cannot install '${r.identifier.id}' extension because of version mismatch in Marketplace`,"Invalid");return{extension:r,manifest:c}}async R(e,s,i,n){const r=await this.getTargetPlatform();let o=null;return!s&&e.hasPreReleaseVersion&&e.properties.isPreReleaseVersion!==i&&(o=(await this.F.getExtensions([{...e.identifier,preRelease:i}],{targetPlatform:r,compatible:!0,productVersion:n},Q.None))[0]||null),!o&&await this.F.isExtensionCompatible(e,i,r,n)&&(o=e),o||(s?o=(await this.F.getExtensions([{...e.identifier,version:e.version}],{targetPlatform:r,compatible:!0,productVersion:n},Q.None))[0]||null:o=await this.F.getCompatibleExtension(e,i,r,n)),o}S(e,s,i){return`${e.id.toLowerCase()}${i?`-${i}`:""}@${s.toString()}`}async uninstallExtensions(e){const s=(u,f)=>this.S(u.identifier,f.profileLocation,f.versionOnly?u.manifest.version:void 0),i=(u,f)=>{let p;for(const{task:m}of this.s.values())if(!(m.source instanceof k)&&G(m.identifier,u.identifier)&&this.H.extUri.isEqual(m.options.profileLocation,f.profileLocation)){p=m;break}const g=this.bb(u,f);this.t.set(s(g.extension,f),g),this.I.info("Uninstalling extension from the profile:",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString()),this.y.fire({identifier:u.identifier,profileLocation:f.profileLocation,applicationScoped:u.isApplicationScoped}),r.push({task:g,installTaskToWaitFor:p})},n=(u,f,p)=>{p?this.I.error("Failed to uninstall extension from the profile:",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString(),p.message):this.I.info("Successfully uninstalled extension from the profile",`${u.identifier.id}@${u.manifest.version}`,f.profileLocation.toString()),Ch(this.G,"extensionGallery:uninstall",{extensionData:C5(u),error:p}),this.z.fire({identifier:u.identifier,error:p?.code,profileLocation:f.profileLocation,applicationScoped:u.isApplicationScoped})},r=[],o=[],a=[],c=[],l=new lt,h=async u=>{let f=l.get(u);return f||l.set(u,f=await this.getInstalled(1,u)),f};for(const{extension:u,options:f}of e){const p={...f,profileLocation:u.isApplicationScoped?this.J.defaultProfile.extensionsResource:f?.profileLocation??this.$()},g=this.t.get(s(u,p));if(g?(this.I.info("Extensions is already requested to uninstall",u.identifier.id),a.push(g.waitUntilTaskIsFinished())):i(u,p),p.remove||u.isApplicationScoped){p.remove&&c.push(u);for(const m of this.J.profiles){if(this.H.extUri.isEqual(m.extensionsResource,p.profileLocation))continue;const b=(await h(m.extensionsResource)).find(S=>G(S.identifier,u.identifier));if(b){const S={...p,profileLocation:m.extensionsResource},$=this.t.get(s(b,S));$?(this.I.info("Extensions is already requested to uninstall",b.identifier.id),a.push($.waitUntilTaskIsFinished())):i(b,S)}}}}try{for(const{task:u}of r.slice(0)){const f=await h(u.options.profileLocation);if(u.options.donotIncludePack)this.I.info("Uninstalling the extension without including packed extension",`${u.extension.identifier.id}@${u.extension.manifest.version}`);else{const p=this.X(u.extension,f);for(const g of p)this.t.has(s(g,u.options))?this.I.info("Extensions is already requested to uninstall",g.identifier.id):i(g,u.options)}u.options.donotCheckDependents?this.I.info("Uninstalling the extension without checking dependents",`${u.extension.identifier.id}@${u.extension.manifest.version}`):this.U(r.map(({task:p})=>p.extension),f,u.extension)}await this.O(r.map(async({task:u,installTaskToWaitFor:f})=>{try{if(f){this.I.info("Waiting for existing install task to complete before uninstalling",u.extension.identifier.id);try{await f.waitUntilTaskIsFinished(),this.I.info("Finished waiting for install task, proceeding with uninstall",u.extension.identifier.id)}catch(p){this.I.info("Install task failed, proceeding with uninstall anyway",u.extension.identifier.id,se(p))}}if(await u.run(),await this.O(this.D.map(p=>p.postUninstall(u.extension,u.options,Q.None))),u.extension.identifier.uuid)try{await this.F.reportStatistic(u.extension.manifest.publisher,u.extension.manifest.name,u.extension.manifest.version,"uninstall")}catch{}}catch(p){const g=He(p);throw n(u.extension,u.options,g),g}finally{o.push(u)}})),a.length&&await this.O(a);for(const{task:u}of r)n(u.extension,u.options);c.length&&await this.O(c.map(u=>this.fb(u)))}catch(u){const f=He(u);for(const{task:p}of r){try{p.cancel()}catch{}o.includes(p)||n(p.extension,p.options,f)}throw f}finally{for(const{task:u}of r)this.t.delete(s(u.extension,u.options))||this.I.warn("Uninstallation task is not found in the cache",u.extension.identifier.id)}}U(e,s,i){for(const n of e){const r=this.Y(n,s);if(r.length){const o=r.filter(a=>!e.some(c=>G(c.identifier,a.identifier)));if(o.length)throw new Error(this.W(n,o,i))}}}W(e,s,i){return i===e?s.length===1?v(1941,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name):s.length===2?v(1942,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):v(1943,null,i.manifest.displayName||i.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):s.length===1?v(1944,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name):s.length===2?v(1945,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name):v(1946,null,i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,s[0].manifest.displayName||s[0].manifest.name,s[1].manifest.displayName||s[1].manifest.name)}X(e,s,i=[]){if(i.indexOf(e)!==-1)return[];i.push(e);const n=e.manifest.extensionPack?e.manifest.extensionPack:[];if(n.length){const r=s.filter(a=>!a.isBuiltin&&n.some(c=>G({id:c},a.identifier))),o=[];for(const a of r)o.push(...this.X(a,s,i));return[...r,...o]}return[]}Y(e,s){return s.filter(i=>i.manifest.extensionDependencies&&i.manifest.extensionDependencies.some(n=>G({id:n},e.identifier)))}async Z(){try{return this.I.trace("ExtensionManagementService.updateControlCache"),await this.F.getExtensionsControlManifest()}catch(e){return this.I.trace("ExtensionManagementService.refreshControlCache - failed to get extension control manifest",se(e)),{malicious:[],deprecated:{},search:[]}}}};Rh=__decorate([__param(0,Es),__param(1,ke),__param(2,he),__param(3,Y),__param(4,pe),__param(5,Mi),__param(6,je)],Rh);function He(t,e){if(t instanceof Te)return t;let s;return t instanceof Ws?s=new Te(t.message,t.code==="DownloadFailedWriting"?"DownloadFailedWriting":"Gallery"):s=new Te(t.message,Ts(t)?"Cancelled":e??"Internal"),s.stack=t.stack,s}function Ch(t,e,{extensionData:s,verificationStatus:i,duration:n,error:r,source:o,durationSinceUpdate:a}){t.publicLog(e,{...s,source:o,duration:n,durationSinceUpdate:a,success:!r,errorcode:r?.code,verificationStatus:i===Ye.Success?"Verified":i??"Unverified"})}var y0=class{constructor(){this.d=new sr}async waitUntilTaskIsFinished(){return await this.d.wait(),this.g}run(){return this.g||(this.g=vt(t=>this.h(t))),this.d.open(),this.g}cancel(){this.g||(this.g=vt(t=>new Promise((e,s)=>{const i=t.onCancellationRequested(()=>{i.dispose(),s(new Ve)})})),this.d.open()),this.g.cancel()}};function ms(t,e){return t?k.revive(e?e.transformIncoming(t):t):void 0}function Ln(t,e){return e?e.transformOutgoingURI(t):t}function Or(t,e){e=e||ga;const s=t.manifest;return{...ma({...t,manifest:void 0},e),manifest:s}}function Lr(t,e){return t?.profileLocation?ma(t,e??ga):t}function Ar(t,e){return e?ql(t,s=>s instanceof k?e.transformOutgoingURI(s):void 0):t}var x9=class{constructor(t,e){this.a=t,this.b=e,this.onInstallExtension=L.buffer(t.onInstallExtension,!0),this.onDidInstallExtensions=L.buffer(t.onDidInstallExtensions,!0),this.onUninstallExtension=L.buffer(t.onUninstallExtension,!0),this.onDidUninstallExtension=L.buffer(t.onDidUninstallExtension,!0),this.onDidUpdateExtensionMetadata=L.buffer(t.onDidUpdateExtensionMetadata,!0)}listen(t,e){const s=this.b(t);switch(e){case"onInstallExtension":return L.map(this.onInstallExtension,i=>({...i,profileLocation:i.profileLocation?Ln(i.profileLocation,s):i.profileLocation}));case"onDidInstallExtensions":return L.map(this.onDidInstallExtensions,i=>i.map(n=>({...n,local:n.local?Ar(n.local,s):n.local,profileLocation:n.profileLocation?Ln(n.profileLocation,s):n.profileLocation})));case"onUninstallExtension":return L.map(this.onUninstallExtension,i=>({...i,profileLocation:i.profileLocation?Ln(i.profileLocation,s):i.profileLocation}));case"onDidUninstallExtension":return L.map(this.onDidUninstallExtension,i=>({...i,profileLocation:i.profileLocation?Ln(i.profileLocation,s):i.profileLocation}));case"onDidUpdateExtensionMetadata":return L.map(this.onDidUpdateExtensionMetadata,i=>({local:Ar(i.local,s),profileLocation:Ln(i.profileLocation,s)}))}throw new Error("Invalid listen")}async call(t,e,s){const i=this.b(t);switch(e){case"zip":{const n=Or(s[0],i),r=await this.a.zip(n);return Ln(r,i)}case"install":return this.a.install(ms(s[0],i),Lr(s[1],i));case"installFromLocation":return this.a.installFromLocation(ms(s[0],i),ms(s[1],i));case"installExtensionsFromProfile":return this.a.installExtensionsFromProfile(s[0],ms(s[1],i),ms(s[2],i));case"getManifest":return this.a.getManifest(ms(s[0],i));case"getTargetPlatform":return this.a.getTargetPlatform();case"installFromGallery":return this.a.installFromGallery(s[0],Lr(s[1],i));case"installGalleryExtensions":{const n=s[0];return this.a.installGalleryExtensions(n.map(({extension:r,options:o})=>({extension:r,options:Lr(o,i)??{}})))}case"uninstall":return this.a.uninstall(Or(s[0],i),Lr(s[1],i));case"uninstallExtensions":{const n=s[0];return this.a.uninstallExtensions(n.map(({extension:r,options:o})=>({extension:Or(r,i),options:Lr(o,i)})))}case"getInstalled":return(await this.a.getInstalled(s[0],ms(s[1],i),s[2],s[3])).map(r=>Ar(r,i));case"toggleApplicationScope":{const n=await this.a.toggleApplicationScope(Or(s[0],i),ms(s[1],i));return Ar(n,i)}case"copyExtensions":return this.a.copyExtensions(ms(s[0],i),ms(s[1],i));case"updateMetadata":{const n=await this.a.updateMetadata(Or(s[0],i),s[1],ms(s[2],i));return Ar(n,i)}case"resetPinnedStateForAllUserExtensions":return this.a.resetPinnedStateForAllUserExtensions(s[0]);case"getExtensionsControlManifest":return this.a.getExtensionsControlManifest();case"download":return this.a.download(s[0],s[1],s[2]);case"cleanUp":return this.a.cleanUp()}throw new Error("Invalid call")}},k9=class{constructor(t){this.a=t}listen(t,e){throw new Error("Invalid listen")}call(t,e,s){switch(e){case"getConfigBasedTips":return this.a.getConfigBasedTips(k.revive(s[0]));case"getImportantExecutableBasedTips":return this.a.getImportantExecutableBasedTips();case"getOtherExecutableBasedTips":return this.a.getOtherExecutableBasedTips()}throw new Error("Invalid call")}};import*as P9 from"fs";import{createWriteStream as b0,promises as S0}from"fs";var E0="end of central directory record signature not found",R9=new RegExp(E0),ya=class extends Error{constructor(t,e){let s=e.message;switch(t){case"CorruptZip":s=`Corrupt ZIP: ${s}`;break}super(s),this.type=t,this.cause=e}};function C9(t){const e=t.externalFileAttributes>>16||33188;return[448,56,7].map(s=>e&s).reduce((s,i)=>s+i,e&61440)}function $0(t){if(t instanceof ya)return t;let e;return R9.test(t.message)&&(e="CorruptZip"),new ya(e,t)}function D9(t,e,s,i,n,r){const o=Zt(e),a=J(i,o);if(!a.startsWith(i))return Promise.reject(new Error(v(145,null,e)));const c=J(i,e);let l;return r.onCancellationRequested(()=>{l?.destroy()}),Promise.resolve(S0.mkdir(a,{recursive:!0})).then(()=>new Promise((h,u)=>{if(!r.isCancellationRequested)try{l=b0(c,{mode:s}),l.once("close",()=>h()),l.once("error",u),t.once("error",u),t.pipe(l)}catch(f){u(f)}}))}function I9(t,e,s,i){let n=vt(()=>Promise.resolve()),r=0;const o=i.onCancellationRequested(()=>{n.cancel(),t.close()});return new Promise((a,c)=>{const l=new v4,h=u=>{u.isCancellationRequested||(r++,t.readEntry())};t.once("error",c),t.once("close",()=>n.then(()=>{i.isCancellationRequested||t.entryCount===r?a():c(new ya("Incomplete",new Error(v(146,null,r,t.entryCount))))},c)),t.readEntry(),t.on("entry",u=>{if(i.isCancellationRequested)return;if(!s.sourcePathRegex.test(u.fileName)){h(i);return}const f=u.fileName.replace(s.sourcePathRegex,"");if(/\/$/.test(f)){const m=J(e,f);n=vt(w=>S0.mkdir(m,{recursive:!0}).then(()=>h(w)).then(void 0,c));return}const p=k0(t,u),g=C9(u);n=vt(m=>l.queue(()=>p.then(w=>D9(w,f,g,e,s,m).then(()=>h(m)))).then(null,c))})}).finally(()=>o.dispose())}async function x0(t,e=!1){const{open:s}=await import("yauzl");return new Promise((i,n)=>{s(t,e?{lazyEntries:!0}:void 0,(r,o)=>{r?n($0(r)):i(ls(o))})})}function k0(t,e){return new Promise((s,i)=>{t.openReadStream(e,(n,r)=>{n?i($0(n)):s(ls(r))})})}async function O9(t,e){const{ZipFile:s}=await import("yazl");return new Promise((i,n)=>{const r=new s;e.forEach(a=>{a.contents?r.addBuffer(typeof a.contents=="string"?Buffer.from(a.contents,"utf8"):a.contents,a.path):a.localPath&&r.addFile(a.localPath,a.path)}),r.end();const o=b0(t);r.outputStream.pipe(o),r.outputStream.once("error",n),o.once("error",n),o.once("finish",()=>i(t))})}function L9(t,e,s={},i){const n=new RegExp(s.sourcePath?`^${s.sourcePath}`:"");let r=x0(t,!0);return s.overwrite&&(r=r.then(o=>le.rm(e).then(()=>o))),r.then(o=>I9(o,e,{sourcePathRegex:n},i))}function A9(t,e){return x0(t).then(s=>new Promise((i,n)=>{s.on("entry",r=>{r.fileName===e&&k0(s,r).then(o=>i(o),o=>n(o))}),s.once("close",()=>n(new Error(v(147,null,e))))}))}function P0(t,e){return A9(t,e).then(s=>new Promise((i,n)=>{const r=[];s.once("error",n),s.on("data",o=>r.push(o)),s.on("end",()=>i(Buffer.concat(r)))}))}var R0;(function(t){t.ERROR_PROFILE_NOT_FOUND="ERROR_PROFILE_NOT_FOUND",t.ERROR_INVALID_CONTENT="ERROR_INVALID_CONTENT"})(R0||(R0={}));var ba=class extends Error{constructor(t,e){super(t),this.code=e}},ai=W("IExtensionsProfileScannerService"),Dh=class extends T{constructor(e,s,i,n,r){super(),this.j=e,this.m=s,this.n=i,this.r=n,this.s=r,this.b=this.B(new R),this.onAddExtensions=this.b.event,this.c=this.B(new R),this.onDidAddExtensions=this.c.event,this.f=this.B(new R),this.onRemoveExtensions=this.f.event,this.g=this.B(new R),this.onDidRemoveExtensions=this.g.event,this.h=new lt}scanProfileExtensions(e,s){return this.t(e,void 0,s)}async addExtensionsToProfile(e,s,i){const n=[],r=[];try{return await this.t(s,o=>{const a=[];if(i)a.push(...o);else for(const c of o)e.some(([l])=>G(l.identifier,c.identifier)&&l.manifest.version!==c.version)?n.push(c):a.push(c);for(const[c,l]of e){const h=a.findIndex(f=>G(f.identifier,c.identifier)&&f.version===c.manifest.version),u={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:l};h===-1?(r.push(u),a.push(u)):a.splice(h,1,u)}return r.length&&this.b.fire({extensions:r,profileLocation:s}),n.length&&this.f.fire({extensions:n,profileLocation:s}),a}),r.length&&this.c.fire({extensions:r,profileLocation:s}),n.length&&this.g.fire({extensions:n,profileLocation:s}),r}catch(o){throw r.length&&this.c.fire({extensions:r,error:o,profileLocation:s}),n.length&&this.g.fire({extensions:n,error:o,profileLocation:s}),o}}async updateMetadata(e,s){const i=[];return await this.t(s,n=>{const r=[];for(const o of n){const a=e.find(([c])=>G({id:c.identifier.id},{id:o.identifier.id})&&c.manifest.version===o.version);a&&(o.metadata={...o.metadata,...a[1]},i.push(o)),r.push(o)}return r}),i}async removeExtensionsFromProfile(e,s){const i=[];try{await this.t(s,n=>{const r=[];for(const o of n)e.some(a=>G(o.identifier,a))?i.push(o):r.push(o);return i.length&&this.f.fire({extensions:i,profileLocation:s}),r}),i.length&&this.g.fire({extensions:i,profileLocation:s})}catch(n){throw i.length&&this.g.fire({extensions:i,error:n,profileLocation:s}),n}}async t(e,s,i){return this.D(e).queue(async()=>{let n=[],r;try{const o=await this.m.readFile(e);r=JSON.parse(o.value.toString().trim()||"[]")}catch(o){if(Me(o)!==1)throw o;if(this.r.extUri.isEqual(e,this.n.defaultProfile.extensionsResource)&&(r=await this.C()),!r&&i?.bailOutWhenFileNotFound)throw new ba(se(o),"ERROR_PROFILE_NOT_FOUND")}if(r){Array.isArray(r)||this.u(e);let o=!1;for(const a of r){C0(a)||this.u(e);let c;if($e(a.relativeLocation)&&a.relativeLocation)c=this.y(a.relativeLocation);else if($e(a.location)){this.s.warn(`Extensions profile: Ignoring extension with invalid location: ${a.location}`);continue}else{c=k.revive(a.location);const h=this.w(c);h&&(o=!0,a.relativeLocation=h)}rt(a.metadata?.hasPreReleaseVersion)&&a.metadata?.preRelease&&(o=!0,a.metadata.hasPreReleaseVersion=!0);const l=a.metadata?.id??a.identifier.uuid;n.push({identifier:l?{id:a.identifier.id,uuid:l}:{id:a.identifier.id},location:c,version:a.version,metadata:a.metadata})}o&&await this.m.writeFile(e,A.fromString(JSON.stringify(r)))}if(s){n=s(n);const o=n.map(a=>({identifier:a.identifier,version:a.version,location:a.location.toJSON(),relativeLocation:this.w(a.location),metadata:a.metadata}));await this.m.writeFile(e,A.fromString(JSON.stringify(o)))}return n})}u(e){throw new ba(`Invalid extensions content in ${e.toString()}`,"ERROR_INVALID_CONTENT")}w(e){return this.r.extUri.isEqual(this.r.extUri.dirname(e),this.j)?this.r.extUri.basename(e):void 0}y(e){return this.r.extUri.joinPath(this.j,e)}async C(){return this.z||(this.z=(async()=>{const e=this.r.extUri.joinPath(this.n.defaultProfile.location,"extensions.json"),s=this.r.extUri.joinPath(this.j,".init-default-profile-extensions");let i;try{i=(await this.m.readFile(e)).value.toString()}catch(r){if(Me(r)===1)return;throw r}this.s.info("Migrating extensions from old default profile location",e.toString());let n;try{const r=JSON.parse(i);Array.isArray(r)&&r.every(o=>C0(o))?n=r:this.s.warn("Skipping migrating from old default profile locaiton: Found invalid data",r)}catch(r){this.s.error(r)}if(n)try{await this.m.createFile(this.n.defaultProfile.extensionsResource,A.fromString(JSON.stringify(n)),{overwrite:!1}),this.s.info("Migrated extensions from old default profile location to new location",e.toString(),this.n.defaultProfile.extensionsResource.toString())}catch(r){if(Me(r)===3)this.s.info("Migration from old default profile location to new location is done by another window",e.toString(),this.n.defaultProfile.extensionsResource.toString());else throw r}try{await this.m.del(e)}catch(r){Me(r)!==1&&this.s.error(r)}try{await this.m.del(s)}catch(r){Me(r)!==1&&this.s.error(r)}return n})()),this.z}D(e){let s=this.h.get(e);return s||(s=new un,this.h.set(e,s)),s}};Dh=__decorate([__param(1,K),__param(2,je),__param(3,he),__param(4,Y)],Dh);function C0(t){return Be(t)&&m2(t.identifier)&&(N9(t.location)||$e(t.location)&&t.location)&&(rt(t.relativeLocation)||$e(t.relativeLocation))&&t.version&&$e(t.version)}function N9(t){return t?$e(t.path)&&$e(t.scheme):!1}function Ih(t){switch(t){case 1:return v(116,null);case 2:return v(117,null);case 3:return v(118,null);case 4:return v(119,null);case 5:return v(120,null);case 6:return v(121,null);case 7:return v(122,null);case 8:return v(123,null);case 9:return v(124,null);default:return""}}function j9(t,e,s,i){try{T9(t,e,s,i)}catch(n){t.error(n?.message??n)}return e}function T9(t,e,s,i){const n=(r,o,a)=>{const c=r[o];if($e(c)){const l=c,h=l.length;if(h>1&&l[0]==="%"&&l[h-1]==="%"){const u=l.substr(1,h-2);let f=s[u];f===void 0&&i&&(f=i[u]);const p=typeof f=="string"?f:f?.message,g=i?.[u],m=typeof g=="string"?g:g?.message;if(!p){m||t.warn(`[${e.name}]: ${v(2003,null,u)}`);return}if(a&&(o==="title"||o==="category")&&m&&m!==p){const w={value:p,original:m};r[o]=w}else r[o]=p}}else if(Be(c))for(const l in c)c.hasOwnProperty(l)&&(l==="commands"?n(c,l,!0):n(c,l,a));else if(Array.isArray(c))for(let l=0;l<c.length;l++)n(c,l,a)};for(const r in e)e.hasOwnProperty(r)&&n(e,r)}var Oh;(function(t){function e(s,i){if(s===i)return!0;const n=Object.keys(s),r=new Set;for(const o of Object.keys(i))r.add(o);if(n.length!==r.size)return!1;for(const o of n){if(s[o]!==i[o])return!1;r.delete(o)}return r.size===0}t.equals=e})(Oh||(Oh={}));var Sa=W("IExtensionsScannerService"),Lh=class extends T{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.systemExtensionsLocation=e,this.userExtensionsLocation=s,this.n=i,this.r=r,this.s=o,this.t=a,this.u=c,this.w=l,this.y=h,this.z=u,this.C=f,this.g=this.B(new R),this.onDidChangeCache=this.g.event,this.G=void 0,this.h=this.B(this.C.createInstance($a,n)),this.j=this.B(this.C.createInstance($a,n)),this.m=this.B(this.C.createInstance(Ea)),this.B(this.h.onDidChangeCache(()=>this.g.fire(0))),this.B(this.j.onDidChangeCache(()=>this.g.fire(1)))}F(){return this.D||(this.D=Ng(this.t,this.u)),this.D}async scanAllExtensions(e,s){const[i,n]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(s)]);return this.J(i,n,[],await this.F(),!0)}async scanSystemExtensions(e){const s=[];s.push(this.L(e.language)),s.push(this.M(e.language,!!e.checkControlFile));const[i,n]=await Promise.all(s);return this.I([...i,...n],0,{pickLatest:!1})}async scanUserExtensions(e){this.u.trace("Started scanning user extensions",e.profileLocation);const s=this.z.extUri.isEqual(e.profileLocation,this.r.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,i=await this.O(e.profileLocation,!0,1,e.language,!0,s,e.productVersion??this.Q()),n=e.useCache&&!i.devMode?this.j:this.m;let r;try{r=await n.scanExtensions(i)}catch(o){if(o instanceof ba&&o.code==="ERROR_PROFILE_NOT_FOUND")await this.H(),r=await n.scanExtensions(i);else throw o}return r=await this.I(r,1,{includeInvalid:e.includeInvalid,pickLatest:!0}),this.u.trace("Scanned user extensions:",r.length),r}async scanAllUserExtensions(e={includeInvalid:!0,includeAllVersions:!0}){const s=await this.O(this.userExtensionsLocation,!1,1,void 0,!0,void 0,this.Q()),i=await this.m.scanExtensions(s);return this.I(i,1,{includeAllVersions:e.includeAllVersions,includeInvalid:e.includeInvalid})}async scanExtensionsUnderDevelopment(e,s){if(this.w.isExtensionDevelopment&&this.w.extensionDevelopmentLocationURI){const i=(await Promise.all(this.w.extensionDevelopmentLocationURI.filter(n=>n.scheme===oe.file).map(async n=>{const r=await this.O(n,!1,1,s.language,!1,void 0,this.Q());return(await this.m.scanOneOrMultipleExtensions(r)).map(a=>(a.type=e.find(c=>G(c.identifier,a.identifier))?.type??a.type,this.m.validate(a,r)))}))).flat();return this.I(i,"development",{includeInvalid:s.includeInvalid,pickLatest:!0})}return[]}async scanExistingExtension(e,s,i){const n=await this.O(e,!1,s,i.language,!0,void 0,this.Q()),r=await this.m.scanExtension(n);return!r||!i.includeInvalid&&!r.isValid?null:r}async scanOneOrMultipleExtensions(e,s,i){const n=await this.O(e,!1,s,i.language,!0,void 0,this.Q()),r=await this.m.scanOneOrMultipleExtensions(n);return this.I(r,s,{includeInvalid:i.includeInvalid,pickLatest:!0})}async scanMultipleExtensions(e,s,i){const n=[];return await Promise.all(e.map(async r=>{const o=await this.scanOneOrMultipleExtensions(r,s,i);n.push(...o)})),this.I(n,s,{includeInvalid:i.includeInvalid,pickLatest:!0})}async updateManifestMetadata(e,s){const i=_(e,"package.json"),n=(await this.t.readFile(i)).value.toString(),r=JSON.parse(n);r.__metadata={...r.__metadata,...s},await this.t.writeFile(_(e,"package.json"),A.fromString(JSON.stringify(r,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.s.scanProfileExtensions(this.r.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof ba&&e.code==="ERROR_PROFILE_NOT_FOUND")await this.H();else throw e}}async H(){return this.G||(this.G=(async()=>{try{this.u.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());const e=await this.scanAllUserExtensions({includeInvalid:!0});if(e.length)await this.s.addExtensionsToProfile(e.map(s=>[s,s.metadata]),this.r.defaultProfile.extensionsResource);else try{await this.t.createFile(this.r.defaultProfile.extensionsResource,A.fromString(JSON.stringify([])))}catch(s){Me(s)!==1&&this.u.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),se(s))}this.u.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.u.error(e)}finally{this.G=void 0}})()),this.G}async I(e,s,i={}){return i.includeAllVersions||(e=this.J(s===0?e:void 0,s===1?e:void 0,s==="development"?e:void 0,await this.F(),!!i.pickLatest)),i.includeInvalid||(e=e.filter(n=>n.isValid)),e.sort((n,r)=>{const o=Ct(n.location.fsPath),a=Ct(r.location.fsPath);return o<a?-1:o>a?1:0})}J(e,s,i,n,r){const o=(c,l,h)=>{if(!h){if(c.metadata?.isApplicationScoped&&!l.metadata?.isApplicationScoped)return!1;if(!c.metadata?.isApplicationScoped&&l.metadata?.isApplicationScoped)return!0}if(c.isValid&&!l.isValid)return!1;if(c.isValid===l.isValid){if(r&&la(c.manifest.version,l.manifest.version))return this.u.debug(`Skipping extension ${l.location.path} with lower version ${l.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(B5(c.manifest.version,l.manifest.version)){if(c.type===0)return this.u.debug(`Skipping extension ${l.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===n)return this.u.debug(`Skipping extension ${l.location.path} from different target platform ${l.targetPlatform}`),!1}}return h?this.u.warn(`Overwriting user extension ${c.location.path} with ${l.location.path}.`):this.u.debug(`Overwriting user extension ${c.location.path} with ${l.location.path}.`),!0},a=new l5;return e?.forEach(c=>{const l=a.get(c.identifier.id);(!l||o(l,c,!1))&&a.set(c.identifier.id,c)}),s?.forEach(c=>{const l=a.get(c.identifier.id);if(!l&&e&&c.type===0){this.u.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!l||o(l,c,!1))&&a.set(c.identifier.id,c)}),i?.forEach(c=>{const l=a.get(c.identifier.id);(!l||o(l,c,!0))&&a.set(c.identifier.id,c),a.set(c.identifier.id,c)}),[...a.values()]}async L(e){this.u.trace("Started scanning system extensions");const s=await this.O(this.systemExtensionsLocation,!1,0,e,!0,void 0,this.Q()),n=await(s.devMode?this.m:this.h).scanExtensions(s);return this.u.trace("Scanned system extensions:",n.length),n}async M(e,s){const i=this.w.isBuilt?[]:this.y.builtInExtensions;if(!i?.length)return[];this.u.trace("Started scanning dev system extensions");const n=s?await this.N():{},r=[],o=k.file(Ys(J(ei.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(const c of i){const l=n[c.name]||"marketplace";switch(l){case"disabled":break;case"marketplace":r.push(_(o,c.name));break;default:r.push(k.file(l));break}}const a=await Promise.all(r.map(async c=>this.m.scanExtension(await this.O(c,!1,0,e,!0,void 0,this.Q()))));return this.u.trace("Scanned dev system extensions:",a.length),sn(a)}async N(){try{const e=await this.t.readFile(this.n);return JSON.parse(e.value.toString())}catch{return{}}}async O(e,s,i,n,r,o,a){const c=await this.f(n??bs),l=await this.P(e),h=s&&!this.z.extUri.isEqual(e,this.r.defaultProfile.extensionsResource)?this.r.defaultProfile.extensionsResource:void 0,u=h?await this.P(h):void 0;return new Nr(e,l,h,u,s,o,i,r,a.version,a.date,this.y.commit,!this.w.isBuilt,n,c)}async P(e){try{const s=await this.t.stat(e);if(typeof s.mtime=="number")return s.mtime}catch{}}Q(){return{version:this.y.version,date:this.y.date}}};Lh=__decorate([__param(4,je),__param(5,ai),__param(6,K),__param(7,Y),__param(8,ae),__param(9,pe),__param(10,he),__param(11,is)],Lh);var Nr=class{constructor(t,e,s,i,n,r,o,a,c,l,h,u,f,p){this.location=t,this.mtime=e,this.applicationExtensionslocation=s,this.applicationExtensionslocationMtime=i,this.profile=n,this.profileScanOptions=r,this.type=o,this.validate=a,this.productVersion=c,this.productDate=l,this.productCommit=h,this.devMode=u,this.language=f,this.translations=p}static createNlsConfiguration(t){return{language:t.language,pseudo:t.language==="pseudo",devMode:t.devMode,translations:t.translations}}static equals(t,e){return _s(t.location,e.location)&&t.mtime===e.mtime&&_s(t.applicationExtensionslocation,e.applicationExtensionslocation)&&t.applicationExtensionslocationMtime===e.applicationExtensionslocationMtime&&t.profile===e.profile&&yt(t.profileScanOptions,e.profileScanOptions)&&t.type===e.type&&t.validate===e.validate&&t.productVersion===e.productVersion&&t.productDate===e.productDate&&t.productCommit===e.productCommit&&t.devMode===e.devMode&&t.language===e.language&&Oh.equals(t.translations,e.translations)}},Ea=class extends T{constructor(e,s,i,n,r,o){super(),this.g=e,this.h=s,this.j=i,this.m=r,this.n=o,this.f=n.extensionsEnabledWithApiProposalVersion?.map(a=>a.toLowerCase())??[]}async scanExtensions(e){return e.profile?this.s(e):this.r(e)}async r(e){const s=await this.j.resolve(e.location);if(!s.children?.length)return[];const i=await Promise.all(s.children.map(async n=>{if(!n.isDirectory||e.type===1&&tr(n.resource).indexOf(".")===0)return null;const r=new Nr(n.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(r)}));return sn(i).sort((n,r)=>n.location.path<r.location.path?-1:1)}async s(e){let s=await this.t(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.h.extUri.isEqual(e.location,e.applicationExtensionslocation)){s=s.filter(n=>!n.metadata?.isApplicationScoped);const i=await this.t(e.applicationExtensionslocation,n=>!!n.metadata?.isBuiltin||!!n.metadata?.isApplicationScoped,e);s.push(...i)}return s}async t(e,s,i){const n=await this.g.scanProfileExtensions(e,i.profileScanOptions);if(!n.length)return[];const r=await Promise.all(n.map(async o=>{if(s(o)){const a=new Nr(o.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(a,o)}return null}));return sn(r)}async scanOneOrMultipleExtensions(e){try{if(await this.j.exists(_(e.location,"package.json"))){const s=await this.scanExtension(e);return s?[s]:[]}else return await this.scanExtensions(e)}catch(s){return this.n.error(`Error scanning extensions at ${e.location.path}:`,se(s)),[]}}async scanExtension(e,s){const i=[];let n=!0,r;try{r=await this.u(e.location)}catch(f){if(s){i.push([ft.Error,se(f)]),n=!1;const[p,g]=s.identifier.id.split(".");r={name:g,publisher:p,version:s.version,engines:{vscode:""}}}else return e.type!==0&&this.n.error(f),null}r.publisher||(r.publisher=xg);let o;s?o={...s.metadata,size:r.__metadata?.size}:r.__metadata&&(o={installedTimestamp:r.__metadata.installedTimestamp,size:r.__metadata.size,targetPlatform:r.__metadata.targetPlatform}),delete r.__metadata;const a=ks(r.publisher,r.name),c=o?.id?{id:a,uuid:o.id}:{id:a},l=o?.isSystem?0:e.type,h=l===0||!!o?.isBuiltin;try{r=await this.w(e.location,r,Nr.createNlsConfiguration(e))}catch(f){this.n.warn("Failed to translate manifest",se(f))}let u={type:l,identifier:c,manifest:r,location:e.location,isBuiltin:h,targetPlatform:o?.targetPlatform??"undefined",publisherDisplayName:o?.publisherDisplayName,metadata:o,isValid:n,validations:i,preRelease:!!o?.preRelease};return e.validate&&(u=this.validate(u,e)),r.enabledApiProposals&&(!this.m.isBuilt||this.f.includes(a.toLowerCase()))&&(r.originalEnabledApiProposals=r.enabledApiProposals,r.enabledApiProposals=f5([...r.enabledApiProposals])),u}validate(e,s){let i=e.isValid;const n=this.m.isBuilt&&this.f.includes(e.identifier.id.toLowerCase()),r=J5(s.productVersion,s.productDate,s.location,e.manifest,e.isBuiltin,n);for(const[o,a]of r)o===ft.Error&&(i=!1,this.n.error(this.D(s.location,a)));return e.isValid=i,e.validations=[...e.validations,...r],e}async u(e){const s=_(e,"package.json");let i;try{i=(await this.j.readFile(s)).value.toString()}catch(r){throw Me(r)!==1&&this.n.error(this.D(e,v(2004,null,s.path,r.message))),r}let n;try{n=JSON.parse(i)}catch(r){const o=[];We(i,o);for(const a of o)this.n.error(this.D(e,v(2005,null,s.path,a.offset,a.length,Ih(a.error))));throw r}if(Rn(n)!=="object"){const r=this.D(e,v(2006,null,s.path));throw this.n.error(r),new Error(r)}return n}async w(e,s,i){const n=await this.y(e,s,i);if(n)try{const r=[],o=await this.z(n.default,r);if(r.length>0)return r.forEach(c=>{this.n.error(this.D(e,v(2007,null,n.default?.path,Ih(c.error))))}),s;if(Rn(n)!=="object")return this.n.error(this.D(e,v(2008,null,n.default?.path))),s;const a=n.values||Object.create(null);return j9(this.n,s,a,o)}catch{}return s}async y(e,s,i){const n=_(e,"package.nls.json"),r=(l,h)=>{h.forEach(u=>{this.n.error(this.D(e,v(2009,null,l?.path,Ih(u.error))))})},o=l=>{this.n.error(this.D(e,v(2010,null,l?.path)))},a=`${s.publisher}.${s.name}`,c=i.translations[a];if(c)try{const l=k.file(c),h=(await this.j.readFile(l)).value.toString(),u=[],f=We(h,u);return u.length>0?(r(l,u),{values:void 0,default:n}):Rn(f)!=="object"?(o(l),{values:void 0,default:n}):{values:f.contents?f.contents.package:void 0,default:n}}catch{return{values:void 0,default:n}}else{if(!await this.j.exists(n))return;let h;try{h=await this.C(e,i)}catch{return}if(!h.localized)return{values:void 0,default:h.original};try{const u=(await this.j.readFile(h.localized)).value.toString(),f=[],p=We(u,f);return f.length>0?(r(h.localized,f),{values:void 0,default:h.original}):Rn(p)!=="object"?(o(h.localized),{values:void 0,default:h.original}):{values:p,default:h.original}}catch{return{values:void 0,default:h.original}}}}async z(e,s){if(e)try{const i=(await this.j.readFile(e)).value.toString();return We(i,s)}catch{}}C(e,s){return new Promise((i,n)=>{const r=o=>{const a=_(e,`package.nls.${o}.json`);this.j.exists(a).then(c=>{c&&i({localized:a,original:_(e,"package.nls.json")});const l=o.lastIndexOf("-");l===-1?i({localized:_(e,"package.nls.json"),original:null}):(o=o.substring(0,l),r(o))})};if(s.devMode||s.pseudo||!s.language)return i({localized:_(e,"package.nls.json"),original:null});r(s.language)})}D(e,s){return`[${e.path}]: ${s}`}};Ea=__decorate([__param(0,ai),__param(1,he),__param(2,K),__param(3,pe),__param(4,ae),__param(5,Y)],Ea);var $a=class extends Ea{constructor(e,s,i,n,r,o,a,c){super(i,n,r,o,a,c),this.I=e,this.J=s,this.G=this.B(new Ii(3e3)),this.H=this.B(new R),this.onDidChangeCache=this.H.event}async scanExtensions(e){const s=this.O(e),i=await this.L(s);if(this.F=e,i&&i.input&&Nr.equals(i.input,this.F))return this.n.debug("Using cached extensions scan result",e.type===0?"system":"user",e.location.toString()),this.G.trigger(()=>this.N()),i.result.map(r=>(r.location=k.revive(r.location),r));const n=await super.scanExtensions(e);return await this.M(s,{input:e,result:n}),n}async L(e){try{const s=await this.j.readFile(e),i=JSON.parse(s.value.toString());return{result:i.result,input:fn(i.input)}}catch(s){this.n.debug("Error while reading the extension cache file:",e.path,se(s))}return null}async M(e,s){try{await this.j.writeFile(e,A.fromString(JSON.stringify(s)))}catch(i){this.n.debug("Error while writing the extension cache file:",e.path,se(i))}}async N(){if(!this.F)return;const e=this.O(this.F),s=await this.L(e);if(!s)return;const i=s.result,n=JSON.parse(JSON.stringify(await super.scanExtensions(this.F)));if(!yt(n,i))try{this.n.info("Invalidating Cache",i,n),await this.j.del(e),this.H.fire()}catch(r){this.n.error(r)}}O(e){const s=this.P(e);return this.h.extUri.joinPath(s.cacheHome,e.type===0?c5:$g)}P(e){return e.type===0?this.J.defaultProfile:e.profile?this.h.extUri.isEqual(e.location,this.I.extensionsResource)?this.I:this.J.profiles.find(s=>this.h.extUri.isEqual(e.location,s.extensionsResource))??this.I:this.J.defaultProfile}};$a=__decorate([__param(1,je),__param(2,ai),__param(3,he),__param(4,K),__param(5,pe),__param(6,ae),__param(7,Y)],$a);var M9=class extends Lh{constructor(t,e,s,i,n,r,o,a,c,l,h,u){super(t,e,_(s,".vscode-oss-dev","extensions","control.json"),i,n,r,o,a,c,l,h,u),this.R=(async()=>{if(zd)try{const f=await this.t.readFile(k.file(zd));return JSON.parse(f.value.toString())}catch{}return Object.create(null)})()}f(t){return this.R}};function Ah(t){let e="Extract";return t instanceof ya&&(t.type==="CorruptZip"?e="CorruptZip":t.type==="Incomplete"&&(e="IncompleteZip")),He(t,e)}async function Nh(t){let e;try{e=await P0(t,"extension/package.json")}catch(s){throw Ah(s)}try{return JSON.parse(e.toString("utf8"))}catch{throw new Te(v(2021,null),"Invalid")}}var xa,jh=class extends T{static{xa=this}static{this.c=".sigzip"}constructor(e,s,i,n,r,o,a){super(),this.j=s,this.m=i,this.n=n,this.r=r,this.t=o,this.u=a,this.extensionsDownloadDir=e.extensionsDownloadLocation,this.f=o.extUri.joinPath(e.extensionsDownloadLocation,".trash"),this.g=20,this.h=this.F()}async download(e,s,i,n){await this.h;const r=await this.w(e,s);if(!i)return{location:r,verificationStatus:void 0};if(!e.isSigned)return{location:r,verificationStatus:Ye.NotSigned};let o;try{o=await this.y(e);const a=(await this.n.verify(e.identifier.id,e.version,r.fsPath,o.fsPath,n))?.code;if(a===Ye.PackageIsInvalidZip||a===Ye.SignatureArchiveIsInvalidZip){try{await this.delete(r)}catch(c){this.u.error(c)}throw new Te(E0,"CorruptZip")}return{location:r,verificationStatus:a}}catch(a){try{await this.delete(r)}catch(c){this.u.error(c)}throw a}finally{if(o)try{await this.delete(o)}catch(a){this.u.error(a)}}}async w(e,s){try{const i=_(this.extensionsDownloadDir,this.G(e)),n=await this.C(e,"vsix",async()=>{await this.z(e,i,r=>this.m.download(e,r,s));try{await this.D(i.fsPath,"extension/package.json")}catch(r){try{await this.j.del(i)}catch(o){this.u.warn(`Error while deleting: ${i.path}`,se(o))}throw r}},2);return n>1&&this.r.publicLog2("extensiongallery:downloadvsix:retry",{extensionId:e.identifier.id,attempts:n}),i}catch(i){throw He(i,"Download")}}async y(e){try{const s=_(this.extensionsDownloadDir,`${this.G(e)}${xa.c}`),i=await this.C(e,"sigzip",async()=>{await this.m.downloadSignatureArchive(e,s);try{await this.D(s.fsPath,".signature.p7s")}catch(n){try{await this.j.del(s)}catch(r){this.u.warn(`Error while deleting: ${s.path}`,se(r))}throw n}},2);return i>1&&this.r.publicLog2("extensiongallery:downloadsigzip:retry",{extensionId:e.identifier.id,attempts:i}),s}catch(s){throw He(s,"DownloadSignature")}}async z(e,s,i){if(await this.j.exists(s))return;if(s.scheme!==oe.file){await i(s);return}const n=_(this.extensionsDownloadDir,`.${st()}`);try{await i(n)}catch(r){try{await this.j.del(n)}catch{}throw r}try{await le.rename(n.fsPath,s.fsPath,2*60*1e3)}catch(r){try{await this.j.del(n)}catch{}let o=!1;try{o=await this.j.exists(s)}catch{}if(o)this.u.info("Rename failed because the file was downloaded by another source. So ignoring renaming.",e.identifier.id,s.path);else throw this.u.info(`Rename failed because of ${se(r)}. Deleted the file from downloaded location`,n.path),r}}async C(e,s,i,n){let r=1;for(;;)try{return await i(),r}catch(o){if(r++>n)throw o;this.u.warn(`Failed downloading ${s}. ${se(o)}. Retry again...`,e.identifier.id)}}async D(e,s){try{await P0(e,s)}catch(i){throw Ah(i)}}async delete(e){await this.h;const s=this.t.extUri.relativePath(this.extensionsDownloadDir,e);s?await this.j.move(e,this.t.extUri.joinPath(this.f,s),!0):await this.j.del(e)}async F(){try{if(!await this.j.exists(this.extensionsDownloadDir)){this.u.trace("Extension VSIX downloads cache dir does not exist");return}try{await this.j.del(this.f,{recursive:!0})}catch(s){Me(s)!==1&&this.u.error(s)}const e=await this.j.resolve(this.extensionsDownloadDir,{resolveMetadata:!0});if(e.children){const s=[],i=[],n=[];for(const a of e.children)if(a.name.endsWith(xa.c))n.push(a.resource);else{const c=Wt.parse(a.name);c&&i.push([c,a])}const r=Ag(i,([a])=>a),o=[];for(const a of r)a.sort((c,l)=>_g(c[0].version,l[0].version)),s.push(...a.slice(1).map(c=>c[1].resource)),o.push(a[0][1]);o.sort((a,c)=>a.mtime-c.mtime),s.push(...o.slice(0,Math.max(0,o.length-this.g)).map(a=>a.resource)),s.push(...n),await Ze.settled(s.map(a=>(this.u.trace("Deleting from cache",a.path),this.j.del(a))))}}catch(e){this.u.error(e)}}G(e){return Wt.create(e).toString().toLowerCase()}};jh=xa=__decorate([__param(0,_t),__param(1,K),__param(2,Es),__param(3,s0),__param(4,ke),__param(5,he),__param(6,Y)],jh);import{fork as F9}from"child_process";var Th=class extends T{constructor(e,s){super(),this.b=e,this.f=s,this.a=new P1(5)}async postUninstall(e){const s=this.g(e,"uninstall");s&&(this.f.info(e.identifier.id,e.manifest.version,"Running post uninstall script"),await this.a.queue(async()=>{try{await this.h(s.script,"uninstall",s.args,!0,e),this.f.info("Finished running post uninstall script",e.identifier.id,e.manifest.version)}catch(i){this.f.error("Failed to run post uninstall script",e.identifier.id,e.manifest.version),this.f.error(i)}}));try{await le.rm(this.m(e))}catch(i){this.f.error("Error while removing extension storage path",e.identifier.id),this.f.error(i)}}g(e,s){const i=`vscode:${s}`;if(e.location.scheme===oe.file&&e.manifest&&e.manifest.scripts&&typeof e.manifest.scripts[i]=="string"){const n=e.manifest.scripts[i].split(" ");return n.length<2||n[0]!=="node"||!n[1]?(this.f.warn(e.identifier.id,e.manifest.version,`${i} should be a node script`),null):{script:J(e.location.fsPath,n[1]),args:n.slice(2)||[]}}return null}h(e,s,i,n,r){return new Promise((o,a)=>{const c=this.j(e,s,i,r);let l;const h=u=>{l&&(clearTimeout(l),l=null),u?a(u):o(void 0)};c.on("error",u=>{h(Qt(u)||"Unknown")}),c.on("exit",(u,f)=>{h(u?`post-${s} process exited with code ${u}`:void 0)}),n&&(l=setTimeout(()=>{l=null,c.kill(),a("timed out")},5e3))})}j(e,s,i,n){const r={silent:!0,execArgv:void 0},o=F9(e,[`--type=extension-post-${s}`,...i],r);o.stdout.setEncoding("utf8"),o.stderr.setEncoding("utf8");const a=L.fromNodeEventEmitter(o.stdout,"data"),c=L.fromNodeEventEmitter(o.stderr,"data");this.B(a(u=>this.f.info(n.identifier.id,n.manifest.version,`post-${s}`,u))),this.B(c(u=>this.f.error(n.identifier.id,n.manifest.version,`post-${s}`,u)));const l=L.any(L.map(a,u=>({data:`%c${u}`,format:[""]}),this.q),L.map(c,u=>({data:`%c${u}`,format:["color: red"]}),this.q));return L.debounce(l,(u,f)=>u?{data:u.data+f.data,format:[...u.format,...f.format]}:{data:f.data,format:f.format},100,void 0,void 0,void 0,this.q)(u=>{console.group(n.identifier.id),console.log(u.data,...u.format),console.groupEnd()}),o}m(e){return J(this.b.defaultProfile.globalStorageHome.fsPath,e.identifier.id.toLowerCase())}};Th=__decorate([__param(0,je),__param(1,Y)],Th);var U9=class extends T{constructor(t,e,s,i,n){super(),this.a=t,this.b=e,this.c=s,this.f=n,this.B(i.onDidInstallExtensions(r=>this.g(r))),this.B(i.onDidUninstallExtension(r=>this.h(r)))}g(t){for(const e of t)e.local&&this.invalidate(e.profileLocation)}h(t){t.error||this.invalidate(t.profileLocation)}async invalidate(t){if(t)for(const e of this.a.profiles)this.c.extUri.isEqual(e.extensionsResource,t)&&await this.j(e);else await this.j(this.a.defaultProfile)}async j(t){try{await this.b.del(this.c.extUri.joinPath(t.cacheHome,$g))}catch(e){Me(e)!==1&&this.f.error(e)}}},B9=class extends T{constructor(t,e,s,i,n,r,o){super(),this.f=t,this.g=e,this.h=s,this.j=i,this.m=n,this.n=r,this.r=o,this.a=this.B(new R),this.onDidChangeExtensionsByAnotherSource=this.a.event,this.b=new Map,this.c=this.B(new po),this.s().then(null,a=>o.error("Error while initializing Extensions Watcher",se(a)))}async s(){await this.g.initializeDefaultProfileExtensions(),await this.u(this.h.profiles),this.t(),await this.H()}t(){this.B(this.h.onDidChangeProfiles(t=>this.u(t.added))),this.B(this.j.onAddExtensions(t=>this.w(t))),this.B(this.j.onDidAddExtensions(t=>this.y(t))),this.B(this.j.onRemoveExtensions(t=>this.z(t))),this.B(this.j.onDidRemoveExtensions(t=>this.C(t))),this.B(this.n.onDidFilesChange(t=>this.D(t)))}async u(t){try{t.length&&await Promise.all(t.map(e=>(this.c.set(e.id,Bc(this.n.watch(this.m.extUri.dirname(e.extensionsResource)),this.n.watch(e.extensionsResource))),this.G(e.extensionsResource))))}catch(e){throw this.r.error(e),e}}async w(t){for(const e of t.extensions)this.I(this.L(e.identifier,e.version),t.profileLocation)}async y(t){for(const e of t.extensions){const s=this.L(e.identifier,e.version);t.error?this.J(s,t.profileLocation):this.I(s,t.profileLocation)}}async z(t){for(const e of t.extensions)this.J(this.L(e.identifier,e.version),t.profileLocation)}async C(t){const e=[],s=[];for(const i of t.extensions){const n=this.L(i.identifier,i.version);t.error?this.I(n,t.profileLocation):(this.J(n,t.profileLocation),this.b.has(n)||(this.r.debug("Extension is removed from all profiles",i.identifier.id,i.version),s.push(this.f.scanInstalledExtensionAtLocation(i.location).then(r=>{r?e.push(r):this.r.info("Extension not found at the location",i.location.toString())},r=>this.r.error(r)))))}try{await Promise.all(s),e.length&&await this.H(e)}catch(i){this.r.error(i)}}D(t){for(const e of this.h.profiles)t.contains(e.extensionsResource,0,1)&&this.F(e.extensionsResource)}async F(t){const e=[],s=[],i=await this.j.scanProfileExtensions(t),n=new Set,r=new Set;for(const[o,a]of this.b)a.has(t)&&r.add(o);for(const o of i){const a=this.L(o.identifier,o.version);n.add(a),r.has(a)||(e.push(o.identifier),this.I(a,t))}for(const o of r)if(!n.has(o)){const a=this.M(o);a&&(s.push(a.identifier),this.J(o,t))}(e.length||s.length)&&this.a.fire({added:e.length?{extensions:e,profileLocation:t}:void 0,removed:s.length?{extensions:s,profileLocation:t}:void 0})}async G(t){const e=await this.j.scanProfileExtensions(t);for(const s of e)this.I(this.L(s.identifier,s.version),t)}async H(t){t||(t=(await this.f.scanAllUserInstalledExtensions()).filter(s=>!this.b.has(this.L(s.identifier,s.manifest.version)))),t.length&&await this.f.deleteExtensions(...t)}I(t,e){let s=this.b.get(t);s||this.b.set(t,s=new Mc(i=>this.m.extUri.getComparisonKey(i))),s.add(e)}J(t,e){const s=this.b.get(t);s&&s.delete(e),s?.size||this.b.delete(t)}L(t,e){return`${Dn.toKey(t.id)}@${e}`}M(t){const[e,s]=R5(t);return s?{identifier:{id:e},version:s}:void 0}},Mh=Hs,Fh=".vsctmp",Uh=class extends Rh{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g,m){super(e,s,g,i,f,p,m),this.kb=n,this.lb=r,this.mb=o,this.nb=a,this.ob=c,this.pb=l,this.qb=h,this.rb=u,this.jb=new Map,this.Gb=new Mc;const w=this.B(c.createInstance(Th));this.gb=this.B(c.createInstance(Bh,S=>w.postUninstall(S))),this.hb=this.B(new U9(m,l,g,this,this.I)),this.ib=this.B(c.createInstance(jh));const b=this.B(new B9(this,this.lb,m,o,g,l,i));this.B(b.onDidChangeExtensionsByAnotherSource(S=>this.Fb(S))),this.Hb()}getTargetPlatform(){return this.sb||(this.sb=Ng(this.pb,this.I)),this.sb}async zip(e){this.I.trace("ExtensionManagementService#zip",e.identifier.id);const s=await this.Eb(e),i=await O9(_(this.ib.extensionsDownloadDir,st()).fsPath,s);return k.file(i)}async getManifest(e){const{location:s,cleanup:i}=await this.xb(e),n=Di(s.fsPath);try{return await Nh(n)}finally{await i()}}getInstalled(e,s=this.J.defaultProfile.extensionsResource,i={version:this.g.version,date:this.g.date},n){return this.gb.scanExtensions(e??null,s,i,n)}scanAllUserInstalledExtensions(){return this.gb.scanAllUserExtensions()}scanInstalledExtensionAtLocation(e){return this.gb.scanUserExtensionAtLocation(e)}async install(e,s={}){this.I.trace("ExtensionManagementService#install",e.toString());const{location:i,cleanup:n}=await this.xb(e);try{const r=await Nh(Di(i.fsPath)),o=ks(r.publisher,r.name);if(r.engines&&r.engines.vscode&&!lh(r.engines.vscode,this.g.version,this.g.date))throw new Error(v(2011,null,o,this.g.version));const a=this.h.isAllowed({id:o,version:r.version,publisherDisplayName:void 0});if(a!==!0)throw new Error(v(2012,null,a.value));const l=(await this.L([{manifest:r,extension:i,options:s}])).find(({identifier:h})=>G(h,{id:o}));if(l?.local)return l.local;throw l?.error?l.error:He(new Error(`Unknown error while installing extension ${o}`))}finally{await n()}}async installFromLocation(e,s){this.I.trace("ExtensionManagementService#installFromLocation",e.toString());const i=await this.gb.scanUserExtensionAtLocation(e);if(!i||!i.manifest.name||!i.manifest.version)throw new Error(`Cannot find a valid extension from the location ${e.toString()}`);return await this.Jb([[i,{source:"resource"}]],s),this.I.info("Successfully installed extension",i.identifier.id,s.toString()),i}async installExtensionsFromProfile(e,s,i){this.I.trace("ExtensionManagementService#installExtensionsFromProfile",e,s.toString(),i.toString());const n=(await this.getInstalled(1,s)).filter(r=>e.some(o=>G(o,r.identifier)));if(n.length){const r=await Promise.all(n.map(o=>this.gb.scanMetadata(o,s)));await this.Jb(n.map((o,a)=>[o,r[a]]),i),this.I.info("Successfully installed extensions",n.map(o=>o.identifier.id),i.toString())}return n}async updateMetadata(e,s,i){return this.I.trace("ExtensionManagementService#updateMetadata",e.identifier.id),s.isPreReleaseVersion&&(s.preRelease=!0,s.hasPreReleaseVersion=!0),s.isMachineScoped===!1&&(s.isMachineScoped=void 0),s.isBuiltin===!1&&(s.isBuiltin=void 0),s.pinned===!1&&(s.pinned=void 0),e=await this.gb.updateMetadata(e,s,i),this.hb.invalidate(i),this.C.fire({local:e,profileLocation:i}),e}fb(e){return this.gb.deleteExtension(e,"remove")}cb(e,s,i,n){return this.gb.copyExtension(e,s,i,n)}db(e,s,i,n){return this.gb.moveExtension(e,s,i,n)}eb(e,s){return this.gb.removeExtension(e.identifier,s)}copyExtensions(e,s){return this.gb.copyExtensions(e,s,{version:this.g.version,date:this.g.date})}deleteExtensions(...e){return this.gb.setExtensionsForRemoval(...e)}async cleanUp(){this.I.trace("ExtensionManagementService#cleanUp");try{await this.gb.cleanUp()}catch(e){this.I.error(e)}}async download(e,s,i){const{location:n}=await this.Cb(e,s,!i);return n}async xb(e){if(e.scheme===oe.file)return{location:e,async cleanup(){}};this.I.trace("Downloading extension from",e.toString());const s=_(this.ib.extensionsDownloadDir,st());return await this.nb.download(e,s),this.I.info("Downloaded extension to",s.toString()),{location:s,cleanup:async()=>{try{await this.pb.del(s)}catch(n){this.I.error(n)}}}}$(){return this.J.defaultProfile.extensionsResource}ab(e,s,i){const n=s instanceof k?new Wt({id:ks(e.publisher,e.name)},e.version):Wt.create(s);return this.ob.createInstance(zh,n,e,s,i,(r,o)=>{if(s instanceof k)return this.Db(n,s,i,o);let a=this.jb.get(n.toString());return a||(this.jb.set(n.toString(),a=this.Bb(n,s,r,i,o)),a.finally(()=>this.jb.delete(n.toString()))),a},this.gb)}bb(e,s){return new z9(e,s,this.mb)}async Bb(e,s,i,n,r){const{verificationStatus:o,location:a}=await this.Cb(s,i,!n.donotVerifySignature,n.context?.[p2]);try{if(r.isCancellationRequested)throw new Ve;const c=await Nh(a.fsPath);if(!new Wt(s.identifier,s.version).equals(new Wt({id:ks(c.publisher,c.name)},c.version)))throw new Te(v(2013,null,s.identifier.id),"Invalid");const l=await this.gb.extractUserExtension(e,a.fsPath,!1,r);if(o!==Ye.Success&&this.kb.isBuilt)try{await this.ib.delete(a)}catch(h){this.I.warn("Error while deleting the downloaded file",a.toString(),se(h))}return{local:l,verificationStatus:o}}catch(c){try{await this.ib.delete(a)}catch(l){this.I.warn("Error while deleting the downloaded file",a.toString(),se(l))}throw He(c)}}async Cb(e,s,i,n){if(i){const c=this.qb.getValue(w2);i=Kt(c)?c:!0}const{location:r,verificationStatus:o}=await this.ib.download(e,s,i,n),a=v2(e.private,await this.rb.getExtensionGalleryManifest());if(o!==Ye.Success&&!(o===Ye.NotSigned&&!a)&&i&&this.kb.isBuilt&&await this.getTargetPlatform()!=="linux-armhf"){try{await this.ib.delete(r)}catch(c){this.I.warn("Error while deleting the downloaded file",r.toString(),se(c))}if(!o)throw new Te(v(2014,null),"SignatureVerificationInternal");switch(o){case Ye.PackageIntegrityCheckFailed:case Ye.SignatureIsInvalid:case Ye.SignatureManifestIsInvalid:case Ye.SignatureIntegrityCheckFailed:case Ye.EntryIsMissing:case Ye.EntryIsTampered:case Ye.Untrusted:case Ye.CertificateRevoked:case Ye.SignatureIsNotValid:case Ye.SignatureArchiveHasTooManyEntries:case Ye.NotSigned:throw new Te(v(2015,null,o),"SignatureVerificationFailed")}throw new Te(v(2016,null,o),"SignatureVerificationInternal")}return{location:r,verificationStatus:o}}async Db(e,s,i,n){return{local:await this.gb.extractUserExtension(e,Di(s.fsPath),Kt(i.keepExisting)?!i.keepExisting:!0,n)}}async Eb(e){const s=async n=>{let r=await le.readdir(n);r=r.map(c=>J(n,c));const o=await Promise.all(r.map(c=>P9.promises.stat(c)));let a=Promise.resolve([]);return o.forEach((c,l)=>{const h=r[l];c.isFile()&&(a=a.then(u=>[...u,h])),c.isDirectory()&&(a=a.then(u=>s(h).then(f=>[...u,...f])))}),a};return(await s(e.location.fsPath)).map(n=>({path:`extension/${c1(e.location.fsPath,n)}`,localPath:n}))}async Fb({added:e,removed:s}){if(s){const i=e&&this.H.extUri.isEqual(s.profileLocation,e.profileLocation)?s.extensions.filter(n=>e.extensions.every(r=>!G(r,n))):s.extensions;for(const n of i)this.I.info("Extensions removed from another source",n.id,s.profileLocation.toString()),this.z.fire({identifier:n,profileLocation:s.profileLocation})}if(e){const n=(await this.getInstalled(1,e.profileLocation)).filter(r=>e.extensions.some(o=>G(o,r.identifier)));this.w.fire(n.map(r=>(this.I.info("Extensions added from another source",r.identifier.id,e.profileLocation.toString()),{identifier:r.identifier,local:r,profileLocation:e.profileLocation,operation:1})))}}async Hb(){this.B(this.gb.onExtract(s=>this.Gb.add(s)));const e=await this.pb.resolve(this.lb.userExtensionsLocation);for(const s of e.children??[])s.isDirectory&&this.Gb.add(s.resource);this.B(this.pb.watch(this.lb.userExtensionsLocation)),this.B(this.pb.onDidFilesChange(s=>this.Ib(s)))}async Ib(e){if(!e.affects(this.lb.userExtensionsLocation,1))return;const s=[];for(const i of e.rawAdded){if(this.Gb.has(i)||!this.H.extUri.isEqual(this.H.extUri.dirname(i),this.lb.userExtensionsLocation)||this.H.extUri.isEqual(i,this.H.extUri.joinPath(this.lb.userExtensionsLocation,".obsolete"))||this.H.extUri.basename(i).startsWith(".")||this.H.extUri.basename(i).endsWith(Fh))continue;try{if(!(await this.pb.stat(i)).isDirectory)continue}catch(r){Me(r)!==1&&this.I.error(r);continue}const n=await this.gb.scanUserExtensionAtLocation(i);n&&n.installedTimestamp===void 0&&(this.Gb.add(i),s.push(n))}s.length&&(await this.Jb(s.map(i=>[i,void 0]),this.J.defaultProfile.extensionsResource),this.I.info("Added extensions to default profile from external source",s.map(i=>i.identifier.id)))}async Jb(e,s){const i=e.map(n=>n[0]);await this.gb.unsetExtensionsForRemoval(...i.map(n=>Wt.create(n))),await this.mb.addExtensionsToProfile(e,s),this.w.fire(i.map(n=>({local:n,identifier:n.identifier,operation:1,profileLocation:s})))}};Uh=__decorate([__param(0,Es),__param(1,ke),__param(2,Y),__param(3,_t),__param(4,Sa),__param(5,ai),__param(6,bg),__param(7,is),__param(8,K),__param(9,ge),__param(10,Pr),__param(11,pe),__param(12,Mi),__param(13,he),__param(14,je)],Uh);var Bh=class extends T{constructor(e,s,i,n,r,o,a){super(),this.n=e,this.s=s,this.t=i,this.u=n,this.w=r,this.y=o,this.z=a,this.h=this.B(new R),this.onExtract=this.h.event,this.j=new lt,this.m=new lt,this.c=_(this.t.userExtensionsLocation,".obsolete"),this.g=new un}async cleanUp(){await this.L(),await this.J(),await this.I()}async scanExtensions(e,s,i,n){try{const r=s.with({query:n}),o={includeInvalid:!0,profileLocation:s,productVersion:i,language:n};let a=[];if(e===null||e===0){let c=this.j.get(r);c||(c=this.t.scanAllExtensions({language:n},o).finally(()=>this.j.delete(r)),this.j.set(r,c)),a.push(...await c)}else if(e===1){let c=this.m.get(r);c||(c=this.t.scanUserExtensions(o).finally(()=>this.m.delete(r)),this.m.set(r,c)),a.push(...await c)}return a=e!==null?a.filter(c=>c.type===e):a,await Promise.all(a.map(c=>this.H(c)))}catch(r){throw He(r,"Scanning")}}async scanAllUserExtensions(){try{const e=await this.t.scanAllUserExtensions();return await Promise.all(e.map(s=>this.H(s)))}catch(e){throw He(e,"Scanning")}}async scanUserExtensionAtLocation(e){try{const s=await this.t.scanExistingExtension(e,1,{includeInvalid:!0});if(s)return await this.H(s)}catch(s){this.z.error(s)}return null}async extractUserExtension(e,s,i,n){const r=e.toString(),o=k.file(J(this.t.userExtensionsLocation.fsPath,`.${st()}`)),a=k.file(J(this.t.userExtensionsLocation.fsPath,r));if(await this.s.exists(a)){if(!i)try{return await this.scanLocalExtension(a,1)}catch(c){this.z.warn(`Error while scanning the existing extension at ${a.path}. Deleting the existing extension and extracting it.`,se(c))}try{await this.D(e.id,a,"removeExisting")}catch{throw new Te(v(2017,null,a.fsPath,e.id),"Delete")}}try{if(n.isCancellationRequested)throw new Ve;try{this.z.trace(`Started extracting the extension from ${s} to ${a.fsPath}`),await L9(s,o.fsPath,{sourcePath:"extension",overwrite:!0},n),this.z.info(`Extracted extension to ${a}:`,e.id)}catch(l){throw Ah(l)}const c={installedTimestamp:Date.now(),targetPlatform:e.targetPlatform};try{c.size=await Pl(o,this.s)}catch(l){this.z.warn(`Error while getting the size of the extracted extension : ${o.fsPath}`,se(l))}try{await this.t.updateManifestMetadata(o,c)}catch(l){throw this.y.publicLog2("extension:extract",{extensionId:e.id,code:`${Me(l)}`}),He(l,"UpdateMetadata")}if(n.isCancellationRequested)throw new Ve;try{this.z.trace(`Started renaming the extension from ${o.fsPath} to ${a.fsPath}`),await this.G(o.fsPath,a.fsPath),this.z.info("Renamed to",a.fsPath)}catch(l){if(l.code==="ENOTEMPTY"){this.z.info("Rename failed because extension was installed by another source. So ignoring renaming.",e.id);try{await this.s.del(o,{recursive:!0})}catch{}}else throw this.z.info(`Rename failed because of ${se(l)}. Deleted from extracted location`,o),l}this.h.fire(a)}catch(c){try{await this.s.del(o,{recursive:!0})}catch{}throw c}return this.scanLocalExtension(a,1)}async scanMetadata(e,s){return(await this.C(e,s))?.metadata}async C(e,s){return(await this.u.scanProfileExtensions(s)).find(n=>G(n.identifier,e.identifier))}async updateMetadata(e,s,i){try{await this.u.updateMetadata([[e,s]],i)}catch(n){throw this.y.publicLog2("extension:extract",{extensionId:e.identifier.id,code:`${Me(n)}`,isProfile:!!i}),He(n,"UpdateMetadata")}return this.scanLocalExtension(e.location,e.type,i)}async setExtensionsForRemoval(...e){const s=[];for(const n of e)await this.s.exists(n.location)&&s.push(n);const i=s.map(n=>Wt.create(n));await this.F(n=>i.forEach(r=>{n[r.toString()]=!0,this.z.info("Marked extension as removed",r.toString())}))}async unsetExtensionsForRemoval(...e){try{const s=[];return await this.F(i=>e.forEach(n=>{i[n.toString()]?(s.push(!0),delete i[n.toString()]):s.push(!1)})),s}catch(s){throw He(s,"UnsetRemoved")}}async deleteExtension(e,s){this.w.extUri.isEqualOrParent(e.location,this.t.userExtensionsLocation)&&(await this.D(e.identifier.id,e.location,s),await this.unsetExtensionsForRemoval(Wt.create(e)))}async copyExtension(e,s,i,n){const r=await this.C(e,s),o=await this.C(e,i);if(n={...r?.metadata,...n},o)if(this.w.extUri.isEqual(o.location,e.location))await this.u.updateMetadata([[e,{...o.metadata,...n}]],i);else{const a=await this.scanLocalExtension(o.location,e.type,i);await this.u.removeExtensionsFromProfile([a.identifier],i),await this.u.addExtensionsToProfile([[e,{...o.metadata,...n}]],i)}else await this.u.addExtensionsToProfile([[e,n]],i);return this.scanLocalExtension(e.location,e.type,i)}async moveExtension(e,s,i,n){const r=await this.C(e,s),o=await this.C(e,i);if(n={...r?.metadata,...n},o)if(this.w.extUri.isEqual(o.location,e.location))await this.u.updateMetadata([[e,{...o.metadata,...n}]],i);else{const a=await this.scanLocalExtension(o.location,e.type,i);await this.removeExtension(a.identifier,i),await this.u.addExtensionsToProfile([[e,{...o.metadata,...n}]],i)}else await this.u.addExtensionsToProfile([[e,n]],i),r&&await this.removeExtension(r.identifier,s);return this.scanLocalExtension(e.location,e.type,i)}async removeExtension(e,s){await this.u.removeExtensionsFromProfile([e],s)}async copyExtensions(e,s,i){const n=await this.scanExtensions(1,e,i),r=await Promise.all(n.filter(o=>!o.isApplicationScoped).map(async o=>[o,await this.scanMetadata(o,e)]));await this.u.addExtensionsToProfile(r,s)}async D(e,s,i){this.z.trace(`Deleting ${i} extension from disk`,e,s.fsPath);const n=this.w.extUri.joinPath(this.w.extUri.dirname(s),`${this.w.extUri.basename(s)}.${vn(st()).toString(16)}${Fh}`);await this.G(s.fsPath,n.fsPath),await this.s.del(n,{recursive:!0}),this.z.info(`Deleted ${i} extension from disk`,e,s.fsPath)}F(e){return this.g.queue(async()=>{let s;try{s=(await this.s.readFile(this.c,"utf8")).value.toString()}catch(n){if(Me(n)!==1)throw n}let i={};if(s)try{i=JSON.parse(s)}catch{}if(e)if(e(i),Object.keys(i).length)await this.s.writeFile(this.c,A.fromString(JSON.stringify(i)));else try{await this.s.del(this.c)}catch(n){if(Me(n)!==1)throw n}return i})}async G(e,s){try{await le.rename(e,s,2*60*1e3)}catch(i){throw He(i,"Rename")}}async scanLocalExtension(e,s,i){try{if(i){const r=(await this.t.scanUserExtensions({profileLocation:i})).find(o=>this.w.extUri.isEqual(o.location,e));if(r)return await this.H(r)}else{const n=await this.t.scanExistingExtension(e,s,{includeInvalid:!0});if(n)return await this.H(n)}throw new Te(v(2018,null,e.path),"ScanningExtension")}catch(n){throw He(n,"ScanningExtension")}}async H(e){let s;try{s=await this.s.resolve(e.location)}catch{}let i,n;return s?.children&&(i=s.children.find(({name:r})=>/^readme(\.txt|\.md|)$/i.test(r))?.resource,n=s.children.find(({name:r})=>/^changelog(\.txt|\.md|)$/i.test(r))?.resource),{identifier:e.identifier,type:e.type,isBuiltin:e.isBuiltin||!!e.metadata?.isBuiltin,location:e.location,manifest:e.manifest,targetPlatform:e.targetPlatform,validations:e.validations,isValid:e.isValid,readmeUrl:i,changelogUrl:n,publisherDisplayName:e.metadata?.publisherDisplayName,publisherId:e.metadata?.publisherId||null,isApplicationScoped:!!e.metadata?.isApplicationScoped,isMachineScoped:!!e.metadata?.isMachineScoped,isPreReleaseVersion:!!e.metadata?.isPreReleaseVersion,hasPreReleaseVersion:!!e.metadata?.hasPreReleaseVersion,preRelease:e.preRelease,installedTimestamp:e.metadata?.installedTimestamp,updated:!!e.metadata?.updated,pinned:!!e.metadata?.pinned,private:!!e.metadata?.private,isWorkspaceScoped:!1,source:e.metadata?.source??(e.identifier.uuid?"gallery":"vsix"),size:e.metadata?.size??0}}async I(){const e=await this.t.scanAllUserExtensions();await Promise.all(e.map(async s=>{if(bd(s.metadata?.installedTimestamp)&&rt(s.metadata?.size)){const i=await Pl(s.location,this.s);await this.t.updateManifestMetadata(s.location,{size:i})}}))}async J(){let e;try{e=await this.F()}catch(r){throw He(r,"ReadRemoved")}if(Object.keys(e).length===0){this.z.debug("No extensions are marked as removed.");return}this.z.debug("Deleting extensions marked as removed:",Object.keys(e));const s=await this.scanAllUserExtensions(),i=new Set;for(const r of s)e[Wt.create(r).toString()]||i.add(r.identifier.id.toLowerCase());try{const r=Ag(s,o=>o.identifier);await Ze.settled(r.map(async o=>{const a=o.sort((c,l)=>_g(c.manifest.version,l.manifest.version))[0];i.has(a.identifier.id.toLowerCase())||await this.n(a)}))}catch(r){this.z.error(r)}const n=s.filter(r=>r.installedTimestamp&&e[Wt.create(r).toString()]);await Promise.allSettled(n.map(r=>this.deleteExtension(r,"marked for removal")))}async L(){this.z.trace("ExtensionManagementService#removeTempDeleteFolders");let e;try{e=await this.s.resolve(this.t.userExtensionsLocation)}catch(s){Me(s)!==1&&this.z.error(s);return}if(e?.children)try{await Promise.allSettled(e.children.map(async s=>{if(!(!s.isDirectory||!s.name.endsWith(Fh))){this.z.trace("Deleting the temporarily deleted folder",s.resource.toString());try{await this.s.del(s.resource,{recursive:!0}),this.z.trace("Deleted the temporarily deleted folder",s.resource.toString())}catch(i){Me(i)!==1&&this.z.error(i)}}}))}catch{}}};Bh=__decorate([__param(1,K),__param(2,Sa),__param(3,ai),__param(4,he),__param(5,ke),__param(6,Y)],Bh);var zh=class extends y0{get operation(){return this.options.operation??this.j}get verificationStatus(){return this.k}constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.l=e,this.manifest=s,this.source=i,this.options=n,this.m=r,this.n=o,this.o=a,this.p=c,this.q=l,this.s=h,this.t=u,this.u=f,this.j=2,this.identifier=this.l.identifier}async h(e){const i=(await this.n.scanExtensions(1,this.options.profileLocation,this.options.productVersion)).find(a=>G(a.identifier,this.identifier));i&&(this.j=3);const n={isApplicationScoped:this.options.isApplicationScoped||i?.isApplicationScoped,isMachineScoped:this.options.isMachineScoped||i?.isMachineScoped,isBuiltin:this.options.isBuiltin||i?.isBuiltin,isSystem:i?.type===0?!0:void 0,installedTimestamp:Date.now(),pinned:this.options.installGivenVersion?!0:this.options.pinned??i?.pinned,source:this.source instanceof k?"vsix":"gallery"};let r;if(this.source instanceof k){if(i&&this.l.equals(new Wt(i.identifier,i.manifest.version)))try{await this.n.deleteExtension(i,"existing")}catch{throw new Error(v(2019,null,this.manifest.displayName||this.manifest.name))}const a=await this.w(this.l);if(a)try{await this.n.deleteExtension(a,"existing")}catch{throw new Error(v(2020,null,this.manifest.displayName||this.manifest.name))}}else{if(n.id=this.source.identifier.uuid,n.publisherId=this.source.publisherId,n.publisherDisplayName=this.source.publisherDisplayName,n.targetPlatform=this.source.properties.targetPlatform,n.updated=!!i,n.private=this.source.private,n.isPreReleaseVersion=this.source.properties.isPreReleaseVersion,n.hasPreReleaseVersion=i?.hasPreReleaseVersion||this.source.properties.isPreReleaseVersion,n.preRelease=Kt(this.options.preRelease)?this.options.preRelease:this.options.installPreReleaseVersion||this.source.properties.isPreReleaseVersion||i?.preRelease,i&&i.type!==0&&i.manifest.version===this.source.version)return this.n.updateMetadata(i,n,this.options.profileLocation);r=await this.w(this.l)}if(e.isCancellationRequested)throw He(new Ve);if(!r){const a=await this.m(this.operation,e);r=a.local,this.k=a.verificationStatus}if(this.o.extUri.isEqual(this.q.defaultProfile.extensionsResource,this.options.profileLocation))try{await this.s.initializeDefaultProfileExtensions()}catch(a){throw He(a,"IntializeDefaultProfile")}if(e.isCancellationRequested)throw He(new Ve);try{await this.t.addExtensionsToProfile([[r,n]],this.options.profileLocation,!r.isValid)}catch(a){throw He(a,"AddToProfile")}const o=await this.n.scanLocalExtension(r.location,1,this.options.profileLocation);if(!o)throw new Te("Cannot find the installed extension","InstalledExtensionNotFound");return this.source instanceof k&&this.x(r,e),o}async w(e){const[s]=await this.n.unsetExtensionsForRemoval(e);if(s)return this.u.info("Removed the extension from removed list:",e.id),(await this.n.scanAllUserExtensions()).find(n=>Wt.create(n).equals(e))}async x(e,s){try{let[i]=await this.p.getExtensions([{id:e.identifier.id,version:e.manifest.version}],s);if(i||([i]=await this.p.getExtensions([{id:e.identifier.id}],s)),i){const n={id:i.identifier.uuid,publisherDisplayName:i.publisherDisplayName,publisherId:i.publisherId,isPreReleaseVersion:i.properties.isPreReleaseVersion,hasPreReleaseVersion:e.hasPreReleaseVersion||i.properties.isPreReleaseVersion,preRelease:i.properties.isPreReleaseVersion||this.options.installPreReleaseVersion};await this.n.updateMetadata(e,n,this.options.profileLocation)}}catch{}}};zh=__decorate([__param(6,he),__param(7,Es),__param(8,je),__param(9,Sa),__param(10,ai),__param(11,Y)],zh);var z9=class extends y0{constructor(t,e,s){super(),this.extension=t,this.options=e,this.j=s}h(t){return this.j.removeExtensionsFromProfile([this.extension.identifier],this.options.profileLocation)}},D0;(function(t){t[t.FILE=1]="FILE",t[t.WORKSPACE=2]="WORKSPACE",t[t.EXE=3]="EXE"})(D0||(D0={}));var I0;(function(t){t.Ignored="ignored",t.Cancelled="cancelled",t.TooMany="toomany",t.IncompatibleWindow="incompatibleWindow",t.Accepted="reacted"})(I0||(I0={}));var O0=W("IExtensionRecommendationNotificationService");async function L0(t,e,s,i,n,r){let o;try{await _9(t,e,s,i,n,r)}catch(a){o=a}finally{o&&n.errorTransformer&&(o=n.errorTransformer(o)),typeof o<"u"&&s.error(o),s.end()}}async function _9(t,e,s,i,n,r){_h(r);const o=await t.open(e,{create:!1});try{_h(r);let a=0,c=0,l=n&&typeof n.length=="number"?n.length:void 0,h=A.alloc(Math.min(n.bufferSize,typeof l=="number"?l:n.bufferSize)),u=n&&typeof n.position=="number"?n.position:0,f=0;do c=await t.read(o,u,h.buffer,f,h.byteLength-f),u+=c,f+=c,a+=c,typeof l=="number"&&(l-=c),f===h.byteLength&&(await s.write(i(h)),h=A.alloc(Math.min(n.bufferSize,typeof l=="number"?l:n.bufferSize)),f=0);while(c>0&&(typeof l!="number"||l>0)&&_h(r)&&V9(a,n));if(f>0){let p=f;typeof l=="number"&&(p=Math.min(f,l)),s.write(i(h.slice(0,p)))}}catch(a){throw Ui(a)}finally{await t.close(o)}}function _h(t){if(t.isCancellationRequested)throw ho();return!0}function V9(t,e){if(typeof e?.limits?.size=="number"&&t>e.limits.size)throw $s(v(2089,null),Z.FileTooLarge);return!0}var Vh,qh=class extends T{static{Vh=this}constructor(e){super(),this.b=e,this.a=256*1024,this.c=this.B(new R),this.onDidChangeFileSystemProviderRegistrations=this.c.event,this.f=this.B(new R),this.onWillActivateFileSystemProvider=this.f.event,this.g=this.B(new R),this.onDidChangeFileSystemProviderCapabilities=this.g.event,this.h=new Map,this.r=this.B(new R),this.onDidRunOperation=this.r.event,this.Y=this.B(new R),this.Z=this.B(new R),this.onDidFilesChange=this.Z.event,this.$=this.B(new R),this.onDidWatchError=this.$.event,this.ab=new Map,this.db=this.B(new R1)}registerProvider(e,s){if(this.h.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);zi(`code/registerFilesystem/${e}`);const i=new De;return this.h.set(e,s),this.c.fire({added:!0,scheme:e,provider:s}),i.add(s.onDidChangeFile(n=>{const r=new N2(n,!this.U(s));this.Y.fire(r),r.hasCorrelation()||this.Z.fire(r)})),typeof s.onDidWatchError=="function"&&i.add(s.onDidWatchError(n=>this.$.fire(new Error(n)))),i.add(s.onDidChangeCapabilities(()=>this.g.fire({provider:s,scheme:e}))),de(()=>{this.c.fire({added:!1,scheme:e,provider:s}),this.h.delete(e),Xt(i)})}getProvider(e){return this.h.get(e)}async activateProvider(e){const s=[];this.f.fire({scheme:e,join(i){s.push(i)}}),!this.h.has(e)&&await Ze.settled(s)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.h.has(e.scheme)}hasCapability(e,s){const i=this.h.get(e.scheme);return!!(i&&i.capabilities&s)}listCapabilities(){return nn.map(this.h,([e,s])=>({scheme:e,capabilities:s.capabilities}))}async j(e){if(!p4(e))throw new et(v(2062,null,this.tb(e)),8);await this.activateProvider(e.scheme);const s=this.h.get(e.scheme);if(!s){const i=new Ei;throw i.message=v(2063,null,e.toString()),i}return s}async m(e){const s=await this.j(e);if(ni(s)||rs(s)||Al(s))return s;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async n(e){const s=await this.j(e);if(ni(s)||rs(s))return s;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}async resolve(e,s){try{return await this.s(e,s)}catch(i){throw Ko(i)===Z.FileNotFound?new et(v(2064,null,this.tb(e)),1):Ui(i)}}async s(e,s){const i=await this.j(e),n=this.U(i),r=s?.resolveTo,o=s?.resolveSingleChildDescendants,a=s?.resolveMetadata,c=await i.stat(e);let l;return this.t(i,e,c,void 0,!!a,(h,u)=>(l||(l=En.forUris(()=>!n),l.set(e,!0),r&&l.fill(!0,r)),l.get(h.resource)||l.findSuperstr(h.resource.with({query:null,fragment:null}))?!0:h.isDirectory&&o?u===1:!1))}async t(e,s,i,n,r,o){const{providerExtUri:a}=this.S(e),c={resource:s,name:a.basename(s),isFile:(i.type&Vt.File)!==0,isDirectory:(i.type&Vt.Directory)!==0,isSymbolicLink:(i.type&Vt.SymbolicLink)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&xn.Readonly)||!!(e.capabilities&2048),locked:!!((i.permissions??0)&xn.Locked),etag:Qp({mtime:i.mtime,size:i.size}),children:void 0};if(c.isDirectory&&o(c,n)){try{const l=await e.readdir(s),h=await Ze.settled(l.map(async([u,f])=>{try{const p=a.joinPath(s,u),g=r?await e.stat(p):{type:f};return await this.t(e,p,g,l.length,r,o)}catch(p){return this.b.trace(p),null}}));c.children=sn(h)}catch(l){this.b.trace(l),c.children=[]}return c}return c}async resolveAll(e){return Ze.settled(e.map(async s=>{try{return{stat:await this.s(s.resource,s.options),success:!0}}catch(i){return this.b.trace(i),{stat:void 0,success:!1}}}))}async stat(e){const s=await this.j(e),i=await s.stat(e);return this.t(s,e,i,void 0,!0,()=>!1)}async realpath(e){const s=await this.j(e);if(O2(s)){const i=await s.realpath(e);return e.with({path:i})}}async exists(e){const s=await this.j(e);try{return!!await s.stat(e)}catch{return!1}}async canCreateFile(e,s){try{await this.u(e,s)}catch(i){return i}return!0}async u(e,s){if(!s?.overwrite&&await this.exists(e))throw new et(v(2065,null,this.tb(e)),3,s)}async createFile(e,s=A.fromString(""),i){await this.u(e,i);const n=await this.writeFile(e,s);return this.r.fire(new kn(e,0,n)),n}async writeFile(e,s,i){const n=this.rb(await this.n(e),e),{providerExtUri:r}=this.S(n);let o=i;if(Wp(n)&&!o?.atomic){const a=n.enforceAtomicWriteFile?.(e);a&&(o={...i,atomic:a})}try{let{stat:a,buffer:c}=await this.z(n,e,s,o);a||await this.W(n,r.dirname(e)),c||(c=await this.w(n,s)),!ni(n)||rs(n)&&c instanceof A||rs(n)&&Wp(n)&&o?.atomic?await this.ib(n,e,o,c):await this.eb(n,e,o,c instanceof A?U4(c):c),this.r.fire(new kn(e,4))}catch(a){throw new et(v(2066,null,this.tb(e),Ui(a).toString()),Me(a),o)}return this.resolve(e,{resolveMetadata:!0})}async w(e,s){let i;if(rs(e)&&!(s instanceof A))if(Io(s)){const n=await D4(s,3);n.ended?i=A.concat(n.buffer):i=n}else i=C4(s,n=>A.concat(n),3);else i=s;return i}async z(e,s,i,n){const r=!!n?.unlock;if(r&&!(e.capabilities&8192))throw new Error(v(2067,null,this.tb(s)));if(!!n?.atomic){if(!(e.capabilities&32768))throw new Error(v(2068,null,this.tb(s)));if(!(e.capabilities&2))throw new Error(v(2069,null,this.tb(s)));if(r)throw new Error(v(2070,null,this.tb(s)))}let a;try{a=await e.stat(s)}catch{return Object.create(null)}if((a.type&Vt.Directory)!==0)throw new et(v(2071,null,this.tb(s)),0,n);this.sb(s,a);let c;if(typeof n?.mtime=="number"&&typeof n.etag=="string"&&n.etag!==Fl&&typeof a.mtime=="number"&&typeof a.size=="number"&&n.mtime<a.mtime&&n.etag!==Qp({mtime:n.mtime,size:a.size})){if(c=await this.w(e,i),c instanceof A&&c.byteLength===a.size)try{const{value:l}=await this.readFile(s,{limits:{size:a.size}});if(c.equals(l))return{stat:a,buffer:c}}catch{}throw new et(v(2072,null),3,n)}return{stat:a,buffer:c}}async readFile(e,s,i){const n=await this.m(e);return s?.atomic?this.C(n,e,s,i):this.D(n,e,s,i)}async C(e,s,i,n){return new Promise((r,o)=>{this.db.queueFor(s,async()=>{try{const a=await this.D(e,s,i,n);r(a)}catch(a){o(a)}},this.S(e).providerExtUri)})}async D(e,s,i,n){const r=await this.F(e,s,{...i,preferUnbuffered:!0},n);return{...r,value:await Li(r.value)}}async readFileStream(e,s,i){const n=await this.m(e);return this.F(n,e,s,i)}async F(e,s,i,n){const r=new Ss(n);let o=i;Nl(e)&&e.enforceAtomicReadFile?.(s)&&(o={...i,atomic:!0});const a=this.L(s,o).then(l=>l,l=>{throw r.dispose(!0),l});let c;try{return typeof o?.etag=="string"&&o.etag!==Fl&&await a,o?.atomic&&Nl(e)||!(ni(e)||Al(e))||rs(e)&&o?.preferUnbuffered?c=this.J(e,s,o):Al(e)?c=this.H(e,s,r.token,o):c=this.I(e,s,r.token,o),c.on("end",()=>r.dispose()),c.on("error",()=>r.dispose()),{...await a,value:c}}catch(l){throw c&&await L1(c),this.G(l,s,o)}}G(e,s,i){const n=v(2073,null,this.tb(s),Ui(e).toString());return e instanceof Ml?new Ml(n,e.stat,i):e instanceof Tl?new Tl(n,e.fileOperationResult,e.size,e.options):new et(n,Me(e),i)}H(e,s,i,n=Object.create(null)){const r=e.readFileStream(s,n,i);return A1(r,{data:o=>o instanceof A?o:A.wrap(o),error:o=>this.G(o,s,n)},o=>A.concat(o))}I(e,s,i,n=Object.create(null)){const r=_4();return L0(e,s,r,o=>o,{...n,bufferSize:this.a,errorTransformer:o=>this.G(o,s,n)},i),r}J(e,s,i){const n=nr(r=>A.concat(r));return(async()=>{try{let r;i?.atomic&&Nl(e)?r=await e.readFile(s,{atomic:!0}):r=await e.readFile(s),typeof i?.position=="number"&&(r=r.slice(i.position)),typeof i?.length=="number"&&(r=r.slice(0,i.length)),this.M(s,r.byteLength,i),n.end(A.wrap(r))}catch(r){n.error(r),n.end()}})(),n}async L(e,s){const i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new et(v(2074,null,this.tb(e)),0,s);if(typeof s?.etag=="string"&&s.etag!==Fl&&s.etag===i.etag)throw new Ml(v(2075,null),i,s);return this.M(e,i.size,s),i}M(e,s,i){if(typeof i?.limits?.size=="number"&&s>i.limits.size)throw new Tl(v(2076,null,this.tb(e)),7,s,i)}async canMove(e,s,i){return this.N(e,s,"move",i)}async canCopy(e,s,i){return this.N(e,s,"copy",i)}async N(e,s,i,n){if(e.toString()!==s.toString())try{const r=i==="move"?this.rb(await this.n(e),e):await this.m(e),o=this.rb(await this.n(s),s);await this.R(r,e,o,s,i,n)}catch(r){return r}return!0}async move(e,s,i){const n=this.rb(await this.n(e),e),r=this.rb(await this.n(s),s),o=await this.O(n,e,r,s,"move",!!i),a=await this.resolve(s,{resolveMetadata:!0});return this.r.fire(new kn(e,o==="move"?2:3,a)),a}async copy(e,s,i){const n=await this.m(e),r=this.rb(await this.n(s),s),o=await this.O(n,e,r,s,"copy",!!i),a=await this.resolve(s,{resolveMetadata:!0});return this.r.fire(new kn(e,o==="copy"?3:2,a)),a}async O(e,s,i,n,r,o){if(s.toString()===n.toString())return r;const{exists:a,isSameResourceWithDifferentPathCase:c}=await this.R(e,s,i,n,r,o);if(a&&!c&&o&&await this.del(n,{recursive:!0}),await this.W(i,this.S(i).providerExtUri.dirname(n)),r==="copy"){if(e===i&&Ll(e))await e.copy(s,n,{overwrite:o});else{const l=await this.resolve(s);l.isDirectory?await this.Q(e,l,i,n):await this.P(e,s,i,n)}return r}else return e===i?(await e.rename(s,n,{overwrite:o}),r):(await this.O(e,s,i,n,"copy",o),await this.del(s,{recursive:!0}),"copy")}async P(e,s,i,n){if(ni(e)&&ni(i))return this.kb(e,s,i,n);if(ni(e)&&rs(i))return this.qb(e,s,i,n);if(rs(e)&&ni(i))return this.ob(e,s,i,n);if(rs(e)&&rs(i))return this.mb(e,s,i,n)}async Q(e,s,i,n){await i.mkdir(n),Array.isArray(s.children)&&await Ze.settled(s.children.map(async r=>{const o=this.S(i).providerExtUri.joinPath(n,r.name);return r.isDirectory?this.Q(e,await this.resolve(r.resource),i,o):this.P(e,r.resource,i,o)}))}async R(e,s,i,n,r,o){let a=!1;if(e===i){const{providerExtUri:l,isPathCaseSensitive:h}=this.S(e);if(h||(a=l.isEqual(s,n)),a&&r==="copy")throw new Error(v(2077,null,this.tb(s),this.tb(n)));if(!a&&l.isEqualOrParent(n,s))throw new Error(v(2078,null,this.tb(s),this.tb(n)))}const c=await this.exists(n);if(c&&!a){if(!o)throw new et(v(2079,null,this.tb(s),this.tb(n)),4);if(e===i){const{providerExtUri:l}=this.S(e);if(l.isEqualOrParent(s,n))throw new Error(v(2080,null,this.tb(s),this.tb(n)))}}return{exists:c,isSameResourceWithDifferentPathCase:a}}S(e){const s=this.U(e);return{providerExtUri:s?ve:u4,isPathCaseSensitive:s}}U(e){return!!(e.capabilities&1024)}async createFolder(e){const s=this.rb(await this.j(e),e);await this.W(s,e);const i=await this.resolve(e,{resolveMetadata:!0});return this.r.fire(new kn(e,0,i)),i}async W(e,s){const i=[],{providerExtUri:n}=this.S(e);for(;!n.isEqual(s,n.dirname(s));)try{if(((await e.stat(s)).type&Vt.Directory)===0)throw new Error(v(2081,null,this.tb(s)));break}catch(r){if(Ko(r)!==Z.FileNotFound)throw r;i.push(n.basename(s)),s=n.dirname(s)}for(let r=i.length-1;r>=0;r--){s=n.joinPath(s,i[r]);try{await e.mkdir(s)}catch(o){if(Ko(o)!==Z.FileExists)throw o}}}async canDelete(e,s){try{await this.X(e,s)}catch(i){return i}return!0}async X(e,s){const i=this.rb(await this.j(e),e),n=!!s?.useTrash;if(n&&!(i.capabilities&4096))throw new Error(v(2082,null,this.tb(e)));const r=s?.atomic;if(r&&!(i.capabilities&65536))throw new Error(v(2083,null,this.tb(e)));if(n&&r)throw new Error(v(2084,null,this.tb(e)));let o;try{o=await i.stat(e)}catch{}if(o)this.sb(e,o);else throw new et(v(2085,null,this.tb(e)),1);if(!!!s?.recursive){const c=await this.resolve(e);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error(v(2086,null,this.tb(e)))}return i}async del(e,s){const i=await this.X(e,s);let n=s;if(L2(i)&&!n?.atomic){const c=i.enforceAtomicDelete?.(e);c&&(n={...s,atomic:c})}const r=!!n?.useTrash,o=!!n?.recursive,a=n?.atomic??!1;await i.delete(e,{recursive:o,useTrash:r,atomic:a}),this.r.fire(new kn(e,1))}async cloneFile(e,s){const i=await this.j(e),n=this.rb(await this.n(s),s);if(!(i===n&&this.S(i).providerExtUri.isEqual(e,s)))return i===n&&qp(i)?i.cloneFile(e,s):(await this.W(n,this.S(n).providerExtUri.dirname(s)),i===n&&Ll(i)?this.db.queueFor(e,()=>i.copy(e,s,{overwrite:!0}),this.S(i).providerExtUri):this.db.queueFor(e,()=>this.P(i,e,n,s),this.S(i).providerExtUri))}static{this.bb=0}createWatcher(e,s){return this.watch(e,{...s,correlationId:Vh.bb++})}watch(e,s={recursive:!1,excludes:[]}){const i=new De;let n=!1,r=()=>{n=!0};i.add(de(()=>r())),(async()=>{try{const a=await this.cb(e,s);n?Xt(a):r=()=>Xt(a)}catch(a){this.b.error(a)}})();const o=s.correlationId;if(typeof o=="number"){const a=i.add(new R);return i.add(this.Y.event(l=>{l.correlates(o)&&a.fire(l)})),{onDidChange:a.event,dispose:()=>i.dispose()}}return i}async cb(e,s){const i=await this.j(e),n=vn([this.S(i).providerExtUri.getComparisonKey(e),s]);let r=this.ab.get(n);return r||(r={count:0,disposable:i.watch(e,s)},this.ab.set(n,r)),r.count+=1,de(()=>{r&&(r.count--,r.count===0&&(Xt(r.disposable),this.ab.delete(n)))})}dispose(){super.dispose();for(const[,e]of this.ab)Xt(e.disposable);this.ab.clear()}async eb(e,s,i,n){return this.db.queueFor(s,async()=>{const r=await e.open(s,{create:!0,unlock:i?.unlock??!1});try{Io(n)||el(n)?await this.fb(e,r,n):await this.gb(e,r,n)}catch(o){throw Ui(o)}finally{await e.close(r)}},this.S(e).providerExtUri)}async fb(e,s,i){let n=0,r;if(el(i)){if(i.buffer.length>0){const o=A.concat(i.buffer);await this.hb(e,s,o,o.byteLength,n,0),n+=o.byteLength}if(i.ended)return;r=i.stream}else r=i;return new Promise((o,a)=>{Oo(r,{onData:async c=>{r.pause();try{await this.hb(e,s,c,c.byteLength,n,0)}catch(l){return a(l)}n+=c.byteLength,setTimeout(()=>r.resume())},onError:c=>a(c),onEnd:()=>o()})})}async gb(e,s,i){let n=0,r;for(;(r=i.read())!==null;)await this.hb(e,s,r,r.byteLength,n,0),n+=r.byteLength}async hb(e,s,i,n,r,o){let a=0;for(;a<n;){const c=await e.write(s,r+a,i.buffer,o+a,n-a);a+=c}}async ib(e,s,i,n){return this.db.queueFor(s,()=>this.jb(e,s,i,n),this.S(e).providerExtUri)}async jb(e,s,i,n){let r;n instanceof A?r=n:Io(n)?r=await Li(n):el(n)?r=await B4(n):r=F4(n),await e.writeFile(s,r.buffer,{create:!0,overwrite:!0,unlock:i?.unlock??!1,atomic:i?.atomic??!1})}async kb(e,s,i,n){return this.db.queueFor(n,()=>this.lb(e,s,i,n),this.S(i).providerExtUri)}async lb(e,s,i,n){let r,o;try{r=await e.open(s,{create:!1}),o=await i.open(n,{create:!0,unlock:!1});const a=A.alloc(this.a);let c=0,l=0,h=0;do h=await e.read(r,c,a.buffer,l,a.byteLength-l),await this.hb(i,o,a,h,c,l),c+=h,l+=h,l===a.byteLength&&(l=0);while(h>0)}catch(a){throw Ui(a)}finally{await Ze.settled([typeof r=="number"?e.close(r):Promise.resolve(),typeof o=="number"?i.close(o):Promise.resolve()])}}async mb(e,s,i,n){return this.db.queueFor(n,()=>this.nb(e,s,i,n),this.S(i).providerExtUri)}async nb(e,s,i,n){return i.writeFile(n,await e.readFile(s),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async ob(e,s,i,n){return this.db.queueFor(n,()=>this.pb(e,s,i,n),this.S(i).providerExtUri)}async pb(e,s,i,n){const r=await i.open(n,{create:!0,unlock:!1});try{const o=await e.readFile(s);await this.hb(i,r,A.wrap(o),o.byteLength,0,0)}catch(o){throw Ui(o)}finally{await i.close(r)}}async qb(e,s,i,n){const r=await Li(this.I(e,s,Q.None));await this.ib(i,n,void 0,r)}rb(e,s){if(e.capabilities&2048)throw new et(v(2087,null,this.tb(s)),6);return e}sb(e,s){if((s.permissions??0)&xn.Readonly)throw new et(v(2088,null,this.tb(e)),6)}tb(e){return e.scheme===oe.file?e.fsPath:e.toString(!0)}};qh=Vh=__decorate([__param(0,Y)],qh);import{promises as qi}from"fs";var jr="**",A0="/",ka="[/\\\\]",Pa="[^/\\\\]",q9=/\//g;function N0(t,e){switch(t){case 0:return"";case 1:return`${Pa}*?`;default:return`(?:${ka}|${Pa}+${ka}${e?`|${ka}${Pa}+`:""})*?`}}function j0(t,e){if(!t)return[];const s=[];let i=!1,n=!1,r="";for(const o of t){switch(o){case e:if(!i&&!n){s.push(r),r="";continue}break;case"{":i=!0;break;case"}":i=!1;break;case"[":n=!0;break;case"]":n=!1;break}r+=o}return r&&s.push(r),s}function T0(t){if(!t)return"";let e="";const s=j0(t,A0);if(s.every(i=>i===jr))e=".*";else{let i=!1;s.forEach((n,r)=>{if(n===jr){if(i)return;e+=N0(2,r===s.length-1)}else{let o=!1,a="",c=!1,l="";for(const h of n){if(h!=="}"&&o){a+=h;continue}if(c&&(h!=="]"||!l)){let u;h==="-"?u=h:(h==="^"||h==="!")&&!l?u="^":h===A0?u="":u=ki(h),l+=u;continue}switch(h){case"{":o=!0;continue;case"[":c=!0;continue;case"}":{const f=`(?:${j0(a,",").map(p=>T0(p)).join("|")})`;e+=f,o=!1,a="";break}case"]":{e+="["+l+"]",c=!1,l="";break}case"?":e+=Pa;continue;case"*":e+=N0(1);continue;default:e+=ki(h)}}r<s.length-1&&(s[r+1]!==jr||r+2<s.length)&&(e+=ka)}i=n===jr})}return e}var W9=/^\*\*\/\*\.[\w\.-]+$/,H9=/^\*\*\/([\w\.-]+)\/?$/,G9=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,J9=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,K9=/^\*\*((\/[\w\.-]+)+)\/?$/,Q9=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,M0=new fo(1e4),F0=function(){return!1},Ds=function(){return null};function Wh(t,e){if(!t)return Ds;let s;typeof t!="string"?s=t.pattern:s=t,s=s.trim();const i=`${s}_${!!e.trimForExclusions}`;let n=M0.get(i);if(n)return U0(n,t);let r;return W9.test(s)?n=X9(s.substr(4),s):(r=H9.exec(Hh(s,e)))?n=Z9(r[1],s):(e.trimForExclusions?J9:G9).test(s)?n=Y9(s,e):(r=K9.exec(Hh(s,e)))?n=B0(r[1].substr(1),s,!0):(r=Q9.exec(Hh(s,e)))?n=B0(r[1],s,!1):n=e7(s),M0.set(i,n),U0(n,t)}function U0(t,e){if(typeof e=="string")return t;const s=function(i,n){return er(i,e.base,!wt)?t(Xd(i.substr(e.base.length),Dt),n):null};return s.allBasenames=t.allBasenames,s.allPaths=t.allPaths,s.basenames=t.basenames,s.patterns=t.patterns,s}function Hh(t,e){return e.trimForExclusions&&t.endsWith("/**")?t.substr(0,t.length-2):t}function X9(t,e){return function(s,i){return typeof s=="string"&&s.endsWith(t)?e:null}}function Z9(t,e){const s=`/${t}`,i=`\\${t}`,n=function(o,a){return typeof o!="string"?null:a?a===t?e:null:o===t||o.endsWith(s)||o.endsWith(i)?e:null},r=[t];return n.basenames=r,n.patterns=[e],n.allBasenames=r,n}function Y9(t,e){const s=z0(t.slice(1,-1).split(",").map(a=>Wh(a,e)).filter(a=>a!==Ds),t),i=s.length;if(!i)return Ds;if(i===1)return s[0];const n=function(a,c){for(let l=0,h=s.length;l<h;l++)if(s[l](a,c))return t;return null},r=s.find(a=>!!a.allBasenames);r&&(n.allBasenames=r.allBasenames);const o=s.reduce((a,c)=>c.allPaths?a.concat(c.allPaths):a,[]);return o.length&&(n.allPaths=o),n}function B0(t,e,s){const i=Dt===ye.sep,n=i?t:t.replace(q9,Dt),r=Dt+n,o=ye.sep+t;let a;return s?a=function(c,l){return typeof c=="string"&&(c===n||c.endsWith(r)||!i&&(c===t||c.endsWith(o)))?e:null}:a=function(c,l){return typeof c=="string"&&(c===n||!i&&c===t)?e:null},a.allPaths=[(s?"*/":"./")+t],a}function e7(t){try{const e=new RegExp(`^${T0(t)}$`);return function(s){return e.lastIndex=0,typeof s=="string"&&e.test(s)?t:null}}catch{return Ds}}function t7(t,e={}){if(!t)return F0;if(typeof t=="string"||s7(t)){const s=Wh(t,e);if(s===Ds)return F0;const i=function(n,r){return!!s(n,r)};return s.allBasenames&&(i.allBasenames=s.allBasenames),s.allPaths&&(i.allPaths=s.allPaths),i}return i7(t,e)}function s7(t){const e=t;return e?typeof e.base=="string"&&typeof e.pattern=="string":!1}function i7(t,e){const s=z0(Object.getOwnPropertyNames(t).map(a=>n7(a,t[a],e)).filter(a=>a!==Ds)),i=s.length;if(!i)return Ds;if(!s.some(a=>!!a.requiresSiblings)){if(i===1)return s[0];const a=function(h,u){let f;for(let p=0,g=s.length;p<g;p++){const m=s[p](h,u);if(typeof m=="string")return m;Zc(m)&&(f||(f=[]),f.push(m))}return f?(async()=>{for(const p of f){const g=await p;if(typeof g=="string")return g}return null})():null},c=s.find(h=>!!h.allBasenames);c&&(a.allBasenames=c.allBasenames);const l=s.reduce((h,u)=>u.allPaths?h.concat(u.allPaths):h,[]);return l.length&&(a.allPaths=l),a}const n=function(a,c,l){let h,u;for(let f=0,p=s.length;f<p;f++){const g=s[f];g.requiresSiblings&&l&&(c||(c=Ct(a)),h||(h=c.substr(0,c.length-qy(a).length)));const m=g(a,c,h,l);if(typeof m=="string")return m;Zc(m)&&(u||(u=[]),u.push(m))}return u?(async()=>{for(const f of u){const p=await f;if(typeof p=="string")return p}return null})():null},r=s.find(a=>!!a.allBasenames);r&&(n.allBasenames=r.allBasenames);const o=s.reduce((a,c)=>c.allPaths?a.concat(c.allPaths):a,[]);return o.length&&(n.allPaths=o),n}function n7(t,e,s){if(e===!1)return Ds;const i=Wh(t,s);if(i===Ds)return Ds;if(typeof e=="boolean")return i;if(e){const n=e.when;if(typeof n=="string"){const r=(o,a,c,l)=>{if(!l||!i(o,a))return null;const h=n.replace("$(basename)",()=>c),u=l(h);return Zc(u)?u.then(f=>f?t:null):u?t:null};return r.requiresSiblings=!0,r}}return i}function z0(t,e){const s=t.filter(a=>!!a.basenames);if(s.length<2)return t;const i=s.reduce((a,c)=>{const l=c.basenames;return l?a.concat(l):a},[]);let n;if(e){n=[];for(let a=0,c=i.length;a<c;a++)n.push(e)}else n=s.reduce((a,c)=>{const l=c.patterns;return l?a.concat(l):a},[]);const r=function(a,c){if(typeof a!="string")return null;if(!c){let h;for(h=a.length;h>0;h--){const u=a.charCodeAt(h-1);if(u===47||u===92)break}c=a.substr(h)}const l=i.indexOf(c);return l!==-1?n[l]:null};r.basenames=i,r.patterns=n,r.allBasenames=i;const o=t.filter(a=>!a.basenames);return o.push(r),o}function _0(t,e){return Tt(t,e,(s,i)=>typeof s=="string"&&typeof i=="string"?s===i:typeof s!="string"&&typeof i!="string"?s.base===i.base&&s.pattern===i.pattern:!1)}function V0(t){return typeof t.correlationId=="number"}function r7(t){return t.recursive===!0}var q0=class gv extends T{static{this.a=5}constructor(e,s,i,n){super(),this.h=e,this.j=s,this.m=i,this.n=n,this.c=this.B(new hs),this.f=void 0,this.g=0}s(){const e=new De;this.c.value=e,this.b=this.r(e),this.b.setVerboseLogging(this.m),e.add(this.b.onDidChangeFile(s=>this.h(s))),e.add(this.b.onDidLogMessage(s=>this.j(s))),e.add(this.b.onDidError(s=>this.t(s.error,s.request)))}t(e,s){this.u(e,s)?this.g<gv.a&&this.f?(this.y(`restarting watcher after unexpected error: ${e}`),this.w(this.f)):this.y(`gave up attempting to restart watcher after unexpected error: ${e}`):this.y(e)}u(e,s){return!(!this.n.restartOnError||s||e.indexOf("No space left on device")!==-1||e.indexOf("EMFILE")!==-1)}w(e){this.g++,this.s(),this.watch(e)}async watch(e){this.f=e,await this.b?.watch(e)}async setVerboseLogging(e){this.m=e,await this.b?.setVerboseLogging(e)}y(e){this.j({type:"error",message:`[File Watcher (${this.n.type})] ${e}`})}z(e){this.j({type:"trace",message:`[File Watcher (${this.n.type})] ${e}`})}dispose(){return this.b=void 0,super.dispose()}},o7=class extends q0{constructor(t,e,s){super(t,e,s,{type:"node.js",restartOnError:!1})}},a7=class extends q0{constructor(t,e,s){super(t,e,s,{type:"universal",restartOnError:!0})}};function Gh(t){return t.map(e=>({type:e.type,resource:k.revive(e.resource),cId:e.cId}))}function c7(t){const e=new h7;for(const s of t)e.processEvent(s);return e.coalesce()}function l7(t,e){return typeof e=="string"&&!e.startsWith(jr)&&!a1(e)?{base:t,pattern:e}:e}function W0(t,e){const s=[];for(const i of e)s.push(t7(l7(t,i)));return s}var h7=class{constructor(){this.a=new Set,this.b=new Map}c(t){return wt?t.resource.fsPath:t.resource.fsPath.toLowerCase()}processEvent(t){const e=this.b.get(this.c(t));let s=!1;if(e){const i=e.type,n=t.type;e.resource.fsPath!==t.resource.fsPath&&(t.type===2||t.type===1)?s=!0:i===1&&n===2?(this.b.delete(this.c(t)),this.a.delete(e)):i===2&&n===1?e.type=0:i===1&&n===0||(e.type=n)}else s=!0;s&&(this.a.add(t),this.b.set(this.c(t),t))}coalesce(){const t=[],e=[];return Array.from(this.a).filter(s=>s.type!==2?(t.push(s),!1):!0).sort((s,i)=>s.resource.fsPath.length-i.resource.fsPath.length).filter(s=>e.some(i=>j2(s.resource.fsPath,i,!wt))?!1:(e.push(s.resource.fsPath),!0)).concat(t)}};function u7(t,e){if(typeof e=="number")switch(t.type){case 1:return(e&4)===0;case 2:return(e&8)===0;case 0:return(e&2)===0}return!1}function f7(t){if(typeof t=="number"){const e=[];return t&4&&e.push("Added"),t&8&&e.push("Deleted"),t&2&&e.push("Updated"),e.length===0?"<all>":`[${e.join(", ")}]`}return"<none>"}var d7=class extends T{constructor(t,e){super(),this.a=t,this.b=e,this.c=this.B(new R),this.onDidChangeFile=this.c.event,this.g=this.B(new R),this.onDidWatchError=this.g.event,this.m=[],this.n=this.B(new Ii(this.h(this.m.length))),this.z=[],this.C=this.B(new Ii(this.h(this.z.length)))}watch(t,e){return e.recursive||this.b?.watcher?.forceUniversal?this.r(t,e):this.D(t,e)}h(t){return t>200?500:0}r(t,e){const s=this.s(t,e),i=vd(this.m,s);return this.t(),de(()=>{i(),this.t()})}s(t,e){const s={path:this.M(t),excludes:e.excludes,includes:e.includes,recursive:e.recursive,filter:e.filter,correlationId:e.correlationId};if(r7(s)){const i=this.b?.watcher?.recursive?.usePolling;i===!0?s.pollingInterval=this.b?.watcher?.recursive?.pollingInterval??5e3:Array.isArray(i)&&i.includes(s.path)&&(s.pollingInterval=this.b?.watcher?.recursive?.pollingInterval??5e3)}return s}t(){this.n.trigger(()=>this.u(),this.h(this.m.length)).catch(t=>it(t))}u(){return this.j||(this.j=this.B(this.w(t=>this.c.fire(Gh(t)),t=>this.I(t),this.a.getLevel()===ie.Trace)),this.B(this.a.onDidChangeLogLevel(()=>{this.j?.setVerboseLogging(this.a.getLevel()===ie.Trace)}))),this.j.watch(this.m)}D(t,e){const s={path:this.M(t),excludes:e.excludes,includes:e.includes,recursive:!1,filter:e.filter,correlationId:e.correlationId},i=vd(this.z,s);return this.F(),de(()=>{i(),this.F()})}F(){this.C.trigger(()=>this.G(),this.h(this.z.length)).catch(t=>it(t))}G(){return this.y||(this.y=this.B(this.H(t=>this.c.fire(Gh(t)),t=>this.I(t),this.a.getLevel()===ie.Trace)),this.B(this.a.onDidChangeLogLevel(()=>{this.y?.setVerboseLogging(this.a.getLevel()===ie.Trace)}))),this.y.watch(this.z)}I(t){t.type==="error"&&this.g.fire(t.message),this.J(t)}J(t){this.a[t.type](t.message)}L(t){return Ys(t.fsPath)}M(t){const e=this.L(t);return o4(e)}};import{fork as p7}from"child_process";function g7(t){const e=t;return e&&typeof e.type=="string"&&typeof e.severity=="string"}function m7(t){const e=[];let s;try{const i=JSON.parse(t.arguments),n=i[i.length-1];n&&n.__$stack&&(i.pop(),s=n.__$stack),e.push(...i)}catch{e.push("Unable to log remote console arguments",t.arguments)}return{args:e,stack:s}}function w7(t){if(!t)return t;const e=t.indexOf(`
`);return e===-1?t:t.substring(0,e)}function v7(t,e){const{args:s,stack:i}=m7(t),n=typeof s[0]=="string"&&s.length===1;let r=w7(i);r&&(r=`(${r.trim()})`);let o=[];if(typeof s[0]=="string"?r&&n?o=[`%c[${e}] %c${s[0]} %c${r}`,An("blue"),An(""),An("grey")]:o=[`%c[${e}] %c${s[0]}`,An("blue"),An(""),...s.slice(1)]:o=[`%c[${e}]%`,An("blue"),...s],r&&!n&&o.push(r),typeof console[t.severity]!="function")throw new Error("Unknown console method");console[t.severity].apply(console,o)}function An(t){return`color: ${t}`}import"child_process";import"fs";var H0;(function(t){t[t.stdout=0]="stdout",t[t.stderr=1]="stderr"})(H0||(H0={}));var G0;(function(t){t[t.Success=0]="Success",t[t.Unknown=1]="Unknown",t[t.AccessDenied=2]="AccessDenied",t[t.ProcessNotFound=3]="ProcessNotFound"})(G0||(G0={}));function y7(t){t&&(delete t.DEBUG,wt&&delete t.LD_PRELOAD)}function b7(t=Ne){return t.comspec||"cmd.exe"}function S7(t){let e=[],s=!1;const i=function(n){if(s){e.push(n);return}(!t.send(n,o=>{if(o&&console.error(o),s=!1,e.length>0){const a=e.slice(0);e=[],a.forEach(c=>i(c))}})||Ae)&&(s=!0)};return{send:i}}var J0=class{constructor(t,e){this.i=t,this.j=e,this.c=new Set,this.g=new Map,this.h=new R,this.onDidProcessExit=this.h.event;const s=e&&e.timeout?e.timeout:6e4;this.b=new Yc(s),this.d=null,this.f=null}getChannel(t){const e=this;return{call(s,i,n){return e.k(t,s,i,n)},listen(s,i){return e.l(t,s,i)}}}k(t,e,s,i=Q.None){if(!this.b)return Promise.reject(new Error("disposed"));if(i.isCancellationRequested)return Promise.reject(ho());this.b.cancel();const n=this.n(t),r=vt(c=>n.call(e,s,c)),o=i.onCancellationRequested(()=>r.cancel()),a=de(()=>r.cancel());return this.c.add(a),r.finally(()=>{o.dispose(),this.c.delete(a),this.c.size===0&&this.b&&this.b.trigger(()=>this.o())}),r}l(t,e,s){if(!this.b)return L.None;this.b.cancel();let i;const n=new R({onWillAddFirstListener:()=>{i=this.n(t).listen(e,s)(n.fire,n),this.c.add(i)},onDidRemoveLastListener:()=>{this.c.delete(i),i.dispose(),this.c.size===0&&this.b&&this.b.trigger(()=>this.o())}});return n.event}get m(){if(!this.f){const t=this.j&&this.j.args?this.j.args:[],e=Object.create(null);e.env={...qt(process.env),VSCODE_PARENT_PID:String(process.pid)},this.j&&this.j.env&&(e.env={...e.env,...this.j.env}),this.j&&this.j.freshExecArgv&&(e.execArgv=[]),this.j&&typeof this.j.debug=="number"&&(e.execArgv=["--nolazy","--inspect="+this.j.debug]),this.j&&typeof this.j.debugBrk=="number"&&(e.execArgv=["--nolazy","--inspect-brk="+this.j.debugBrk]),e.execArgv===void 0&&(e.execArgv=process.execArgv.filter(h=>!/^--inspect(-brk)?=/.test(h)).filter(h=>!h.startsWith("--vscode-"))),y7(e.env),this.d=p7(this.i,t,e);const s=new R,n=L.fromNodeEventEmitter(this.d,"message",h=>h)(h=>{if(g7(h)){v7(h,`IPC Library: ${this.j.serverName}`);return}s.fire(A.wrap(Buffer.from(h,"base64")))}),r=this.j.useQueue?S7(this.d):this.d,o=h=>this.d&&this.d.connected&&r.send(h.buffer.toString("base64")),a=s.event,c={send:o,onMessage:a};this.f=new nl(c);const l=()=>this.o();process.once("exit",l),this.d.on("error",h=>console.warn('IPC "'+this.j.serverName+'" errored with '+h)),this.d.on("exit",(h,u)=>{process.removeListener("exit",l),n.dispose(),this.c.forEach(f=>Xt(f)),this.c.clear(),h!==0&&u!=="SIGTERM"&&console.warn('IPC "'+this.j.serverName+'" crashed with exit code '+h+" and signal "+u),this.b?.cancel(),this.o(),this.h.fire({code:h,signal:u})})}return this.f}n(t){let e=this.g.get(t);return e||(e=this.m.getChannel(t),this.g.set(t,e)),e}o(){this.f&&(this.d&&(this.d.kill(),this.d=null),this.f=null,this.g.clear())}dispose(){this.h.dispose(),this.b?.cancel(),this.b=void 0,this.o(),this.c.clear()}},E7=class extends a7{constructor(t,e,s){super(t,e,s),this.s()}r(t){const e=t.add(new J0(ei.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_ESM_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return t.add(e.onDidProcessExit(({code:s,signal:i})=>this.t(`terminated by itself with code ${s}, signal: ${i} (ETERM)`))),$t.toService(Y4(e.getChannel("watcher")))}};import{watchFile as $7,unwatchFile as x7}from"fs";var k7=class extends T{constructor(){super(),this.a=this.B(new R),this.onDidChangeFile=this.a.event,this.b=this.B(new R),this.onDidLogMessage=this.b.event,this.c=this.B(new R),this.f=this.c.event,this.g=new Map,this.h=new Map,this.j=this.B(new po),this.m=new Set,this.n=this.B(new Ii(this.y())),this.r=5007,this.s=new ir,this.R=!1,this.B(this.f(t=>this.z({id:this.u(t),correlationId:this.t(t)?t.correlationId:void 0,path:t.path})))}t(t){return V0(t)}u(t){return this.t(t)?t.correlationId:vn(t)}async watch(t){this.s.isSettled||this.s.complete(),this.s=new ir;try{this.g.clear(),this.h.clear();for(const e of t)this.t(e)?this.g.set(e.correlationId,e):this.h.set(this.u(e),e);for(const[e]of this.j)!this.h.has(e)&&!this.g.has(e)&&(this.j.deleteAndDispose(e),this.m.delete(e));return await this.w(!1)}finally{this.s.complete()}}w(t){const e=[];for(const[s,i]of[...this.h,...this.g])this.j.has(s)||e.push(i);return this.n.trigger(()=>this.N(e),t?this.y():0).catch(s=>it(s))}y(){return 800}isSuspended(t){const e=this.u(t);return this.m.has(e)?"polling":this.j.has(e)}async z(t){if(this.j.has(t.id))return;const e=new De;this.j.set(t.id,e),await this.s.p,!e.isDisposed&&(this.D(t,e),this.w(!0))}C(t){this.j.deleteAndDispose(t.id),this.m.delete(t.id),this.w(!1)}D(t,e){this.F(t,e)?(this.P(`reusing an existing recursive watcher to monitor ${t.path}`),this.m.delete(t.id)):(this.G(t,e),this.m.add(t.id))}F(t,e){const s=this.O?.subscribe(t.path,(i,n)=>{e.isDisposed||(i?this.D(t,e):n?.type===1&&this.H(t))});return s?(e.add(s),!0):!1}G(t,e){let s=!1;const i=(n,r)=>{if(e.isDisposed)return;const o=this.I(n),a=this.I(r),c=s;s=o,!o&&(a||c)&&this.H(t)};this.P(`starting fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{$7(t.path,{persistent:!1,interval:this.r},i)}catch(n){this.Q(`fs.watchFile() failed with error ${n} on path ${t.path} (correlationId: ${t.correlationId})`)}e.add(de(()=>{this.P(`stopping fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{x7(t.path,i)}catch(n){this.Q(`fs.unwatchFile() failed with error ${n} on path ${t.path} (correlationId: ${t.correlationId})`)}}))}H(t){this.P(`detected ${t.path} exists again, resuming watcher (correlationId: ${t.correlationId})`);const e={resource:k.file(t.path),type:1,cId:t.correlationId};this.a.fire([e]),this.J(e,t),this.C(t)}I(t){return t.ctimeMs===0&&t.ino===0}async stop(){this.j.clearAndDisposeAll(),this.m.clear()}J(t,e){if(this.R){const s=` >> normalized ${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`;this.L(s,e)}}L(t,e){this.R&&this.P(`${t}${typeof e.correlationId=="number"?` <${e.correlationId}> `:""}`)}M(t){return`${t.path} (excludes: ${t.excludes.length>0?t.excludes:"<none>"}, includes: ${t.includes&&t.includes.length>0?JSON.stringify(t.includes):"<all>"}, filter: ${f7(t.filter)}, correlationId: ${typeof t.correlationId=="number"?t.correlationId:"<none>"})`}async setVerboseLogging(t){this.R=t}};import{watch as P7,promises as R7}from"fs";var C7=class $c extends T{static{this.a=100}static{this.b=75}get isReusingRecursiveWatcher(){return this.r}get failed(){return this.s}constructor(e,s,i,n,r,o){super(),this.t=e,this.u=s,this.w=i,this.y=n,this.z=r,this.C=o,this.c=this.B(new C1({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},a=>this.w(a))),this.f=this.B(new S4(a=>this.M(a),$c.b)),this.m=new Ss,this.n=new xi(async()=>{let a=this.t.path;try{a=await le.realpath(this.t.path),this.t.path!==a&&this.Q(`correcting a path to watch that seems to be a symbolic link (original: ${this.t.path}, real: ${a})`)}catch{}return a}),this.r=!1,this.s=!1,this.g=W0(this.t.path,this.t.excludes),this.h=this.t.includes?W0(this.t.path,this.t.includes):void 0,this.j=V0(this.t)?this.t.filter:void 0,this.ready=this.D()}async D(){try{const e=await R7.stat(this.t.path);if(this.m.token.isCancellationRequested)return;this.B(await this.G(e.isDirectory()))}catch(e){e.code!=="ENOENT"?this.O(e):this.Q(`ignoring a path for watching who's stat info failed to resolve: ${this.t.path} (error: ${e})`),this.F()}}F(){this.s=!0,this.y?.()}async G(e){const s=new De;return this.H(e,s)?(this.Q(`reusing an existing recursive watcher for ${this.t.path}`),this.r=!0):(this.r=!1,await this.I(e,s)),s}H(e,s){if(e)return!1;const i=k.file(this.t.path),n=this.u?.subscribe(this.t.path,async(r,o)=>{s.isDisposed||(r?await sy(this.G(e),s):o&&(typeof o.cId=="number"||typeof this.t.correlationId=="number")&&this.L({resource:i,type:o.type,cId:this.t.correlationId},!0))});return n?(s.add(n),!0):!1}async I(e,s){const i=await this.n.value;if(this.m.token.isCancellationRequested)return;if(vs&&er(i,"/Volumes/",!0)){this.O(`Refusing to watch ${i} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}const n=new Ss(this.m.token);s.add(de(()=>n.dispose(!0)));const r=new De;s.add(r);try{const o=k.file(this.t.path),a=Ct(i),c=P7(i);r.add(de(()=>{c.removeAllListeners(),c.close()})),this.Q(`Started watching: '${i}'`);const l=new Set;if(e)try{for(const u of await le.readdir(i))l.add(u)}catch(u){this.O(u)}if(n.token.isCancellationRequested)return;const h=new Map;r.add(de(()=>{for(const[,u]of h)u.dispose();h.clear()})),c.on("error",(u,f)=>{n.token.isCancellationRequested||(this.O(`Failed to watch ${i} for changes using fs.watch() (${u}, ${f})`),this.F())}),c.on("change",(u,f)=>{if(n.token.isCancellationRequested)return;this.C&&this.R(`[raw] ["${u}"] ${f}`);let p="";if(f&&(p=f.toString(),vs&&(p=rl(p))),!(!p||u!=="change"&&u!=="rename"))if(e)if(u==="rename"){h.get(p)?.dispose();const g=setTimeout(async()=>{if(h.delete(p),Ro(p,a,!wt)&&!await le.exists(i)){this.J(o);return}if(n.token.isCancellationRequested)return;const m=await this.N(J(i,p));if(n.token.isCancellationRequested)return;let w;m?l.has(p)?w=0:(w=1,l.add(p)):(l.delete(p),w=2),this.L({resource:_(o,p),type:w,cId:this.t.correlationId})},$c.a);h.set(p,de(()=>clearTimeout(g)))}else{let g;l.has(p)?g=0:(g=1,l.add(p)),this.L({resource:_(o,p),type:g,cId:this.t.correlationId})}else if(u==="rename"||!Ro(p,a,!wt)){const g=setTimeout(async()=>{const m=await le.exists(i);n.token.isCancellationRequested||(m?(this.L({resource:o,type:0,cId:this.t.correlationId},!0),r.add(await this.G(!1))):this.J(o))},$c.a);r.clear(),r.add(de(()=>clearTimeout(g)))}else this.L({resource:o,type:0,cId:this.t.correlationId},!0)})}catch(o){if(n.token.isCancellationRequested)return;this.O(`Failed to watch ${i} for changes using fs.watch() (${o.toString()})`),this.F()}}J(e){this.P("Watcher shutdown because watched path got deleted"),this.L({resource:e,type:2,cId:this.t.correlationId},!0),this.f.flush(),this.F()}L(e,s=!1){this.m.token.isCancellationRequested||(this.C&&this.R(`${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`),!s&&this.g.some(i=>i(e.resource.fsPath))?this.C&&this.R(` >> ignored (excluded) ${e.resource.fsPath}`):!s&&this.h&&this.h.length>0&&!this.h.some(i=>i(e.resource.fsPath))?this.C&&this.R(` >> ignored (not included) ${e.resource.fsPath}`):this.f.work(e))}M(e){const s=c7(e),i=[];for(const r of s){if(u7(r,this.j)){this.C&&this.R(` >> ignored (filtered) ${r.resource.fsPath}`);continue}i.push(r)}if(i.length===0)return;if(this.C)for(const r of i)this.R(` >> normalized ${r.type===1?"[ADDED]":r.type===2?"[DELETED]":"[CHANGED]"} ${r.resource.fsPath}`);this.c.work(i)?this.c.pending>0&&this.Q(`started throttling events due to large amount of file change events at once (pending: ${this.c.pending}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.P(`started ignoring events due to too many file change events at once (incoming: ${i.length}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async N(e){if(wt)return le.exists(e);try{const s=Ct(e);return(await le.readdir(Zt(e))).some(n=>n===s)}catch(s){return this.Q(s),!1}}setVerboseLogging(e){this.C=e}O(e){this.m.token.isCancellationRequested||this.z?.({type:"error",message:`[File Watcher (node.js)] ${e}`})}P(e){this.m.token.isCancellationRequested||this.z?.({type:"warn",message:`[File Watcher (node.js)] ${e}`})}Q(e){!this.m.token.isCancellationRequested&&this.C&&this.z?.({type:"trace",message:`[File Watcher (node.js)] ${e}`})}R(e){!this.m.token.isCancellationRequested&&this.C&&this.Q(`${e}${typeof this.t.correlationId=="number"?` <${this.t.correlationId}> `:""}`)}dispose(){this.m.dispose(!0),super.dispose()}},D7=class extends k7{get watchers(){return this.S.values()}constructor(t){super(),this.O=t,this.onDidError=L.None,this.S=new Map,this.U=this.B(new hs)}async N(t){t=this.cb(t);const e=[],s=new Set(Array.from(this.watchers));for(const i of t){const n=this.S.get(this.Z(i));n&&_0(n.request.excludes,i.excludes)&&_0(n.request.includes,i.includes)?s.delete(n):e.push(i)}e.length&&this.P(`Request to start watching: ${e.map(i=>this.M(i)).join(",")}`),s.size&&this.P(`Request to stop watching: ${Array.from(s).map(i=>this.M(i.request)).join(",")}`),this.U.clear();for(const i of s)this.bb(i);this.Y().work(e)}Y(){return this.U.value=new C1({maxWorkChunkSize:100,throttleDelay:100,maxBufferedWork:Number.MAX_VALUE},t=>{for(const e of t)this.ab(e)}),this.U.value}Z(t){return typeof t.correlationId=="number"?t.correlationId:this.$(t.path)}$(t){return wt?t:t.toLowerCase()}ab(t){const e=new C7(t,this.O,i=>this.a.fire(i),()=>this.c.fire(t),i=>this.b.fire(i),this.R),s={request:t,instance:e};this.S.set(this.Z(t),s)}async stop(){await super.stop();for(const t of this.watchers)this.bb(t)}bb(t){this.P("stopping file watcher",t),this.S.delete(this.Z(t.request)),t.instance.dispose()}cb(t){const e=new Map;for(const s of t){let i=e.get(s.correlationId);i||(i=new Map,e.set(s.correlationId,i));const n=this.$(s.path);i.has(n)&&this.P(`ignoring a request for watching who's path is already watched: ${this.M(s)}`),i.set(n,s)}return Array.from(e.values()).map(s=>Array.from(s.values())).flat()}async setVerboseLogging(t){super.setVerboseLogging(t);for(const e of this.watchers)e.instance.setVerboseLogging(t)}P(t,e){this.R&&this.b.fire({type:"trace",message:this.fb(t,e)})}Q(t){this.b.fire({type:"warn",message:this.fb(t)})}fb(t,e){return e?`[File Watcher (node.js)] ${t} (${this.M(e.request)})`:`[File Watcher (node.js)] ${t}`}},I7=class extends o7{constructor(t,e,s){super(t,e,s),this.s()}r(t){return t.add(new D7(void 0))}},O7=class io extends d7{static{this.N=!1}constructor(e,s){super(e,s),this.onDidChangeCapabilities=L.None,this.R=new lt(i=>Xc.getComparisonKey(i)),this.Z=new Map,this.$=new Map,this.ab=new Map}get capabilities(){return this.O||(this.O=516126,wt&&(this.O|=1024)),this.O}async stat(e){try{const{stat:s,symbolicLink:i}=await Bt.stat(this.L(e));return{type:this.Q(s,i),ctime:s.birthtime.getTime(),mtime:s.mtime.getTime(),size:s.size,permissions:(s.mode&128)===0?xn.Locked:void 0}}catch(s){throw this.jb(s)}}async P(e){try{return await this.stat(e)}catch{return}}async realpath(e){const s=this.L(e);return le.realpath(s)}async readdir(e){try{const s=await le.readdir(this.L(e),{withFileTypes:!0}),i=[];return await Promise.all(s.map(async n=>{try{let r;n.isSymbolicLink()?r=(await this.stat(_(e,n.name))).type:r=this.Q(n),i.push([n.name,r])}catch(r){this.a.trace(r)}})),i}catch(s){throw this.jb(s)}}Q(e,s){let i;return s?.dangling?i=Vt.Unknown:e.isFile()?i=Vt.File:e.isDirectory()?i=Vt.Directory:i=Vt.Unknown,s&&(i|=Vt.SymbolicLink),i}async S(e){const s=this.L(e);this.U(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${s})`);let i;for(;i=this.R.get(e);)this.U(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${s})`),await i.wait();const n=new sr;return this.R.set(e,n),this.U(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${s})`),de(()=>{this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${s})`),this.R.get(e)===n&&(this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${s})`),this.R.delete(e)),this.U(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${s})`),n.open()})}async readFile(e,s){let i;try{s?.atomic&&(this.U(`[Disk FileSystemProvider]: atomic read operation started (${this.L(e)})`),i=await this.S(e));const n=this.L(e);return await qi.readFile(n)}catch(n){throw this.jb(n)}finally{i?.dispose()}}U(e){io.N&&this.a.trace(e)}readFileStream(e,s,i){const n=nr(r=>A.concat(r.map(o=>A.wrap(o))).buffer);return L0(this,e,n,r=>r.buffer,{...s,bufferSize:256*1024},i),n}async writeFile(e,s,i){return i?.atomic!==!1&&i?.atomic?.postfix&&await this.W(e)?this.X(e,_(E1(e),`${tr(e)}${i.atomic.postfix}`),s,i):this.Y(e,s,i)}async W(e){try{const s=this.L(e),{symbolicLink:i}=await Bt.stat(s);if(i)return!1}catch{}return!0}async X(e,s,i,n){const r=new De;try{r.add(await this.S(e)),r.add(await this.S(s)),await this.Y(s,i,n,!0);try{await this.rename(s,e,{overwrite:!0})}catch(o){try{await this.delete(s,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw o}}finally{r.dispose()}}async Y(e,s,i,n){let r;try{const o=this.L(e);if(!i.create||!i.overwrite){if(await le.exists(o)){if(!i.overwrite)throw $s(v(2092,null),Z.FileExists)}else if(!i.create)throw $s(v(2093,null),Z.FileNotFound)}r=await this.open(e,{create:!0,unlock:i.unlock},n),await this.write(r,0,s,0,s.byteLength)}catch(o){throw await this.kb(e,o)}finally{typeof r=="number"&&await this.close(r)}}static{this.bb=!0}static configureFlushOnWrite(e){io.bb=e}async open(e,s,i){const n=this.L(e);let r;$n(s)&&!i&&(r=await this.S(e));let o;try{if($n(s)&&s.unlock)try{const{stat:a}=await Bt.stat(n);a.mode&128||await qi.chmod(n,a.mode|128)}catch(a){a.code!=="ENOENT"&&this.a.trace(a)}if(Ae&&$n(s))try{o=await le.open(n,"r+"),await le.ftruncate(o,0)}catch(a){if(a.code!=="ENOENT"&&this.a.trace(a),typeof o=="number"){try{await le.close(o)}catch(c){this.a.trace(c)}o=void 0}}typeof o!="number"&&(o=await le.open(n,$n(s)?"w":"r"))}catch(a){throw r?.dispose(),$n(s)?await this.kb(e,a):this.jb(a)}if(this.Z.set(o,0),$n(s)&&this.ab.set(o,e),r){const a=this.$.get(o);this.U(`[Disk FileSystemProvider]: open() - storing lock for handle ${o} (${n})`),this.$.set(o,r),a&&(this.U(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${o} (${n})`),a.dispose())}return o}async close(e){const s=this.$.get(e);try{if(this.Z.delete(e),this.ab.delete(e)&&io.bb)try{await le.fdatasync(e)}catch(i){io.configureFlushOnWrite(!1),this.a.error(i)}return await le.close(e)}catch(i){throw this.jb(i)}finally{s&&(this.$.get(e)===s&&(this.U(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${e}`),this.$.delete(e)),this.U(`[Disk FileSystemProvider]: close() - disposing lock for handle ${e}`),s.dispose())}}async read(e,s,i,n,r){const o=this.cb(e,s);let a=null;try{a=(await le.read(e,i,n,r,o)).bytesRead}catch(c){throw this.jb(c)}finally{this.db(e,o,a)}return a}cb(e,s){return s===this.Z.get(e)?null:s}db(e,s,i){const n=this.Z.get(e);typeof n=="number"&&(typeof s=="number"||(typeof i=="number"?this.Z.set(e,n+i):this.Z.delete(e)))}async write(e,s,i,n,r){return x4(()=>this.eb(e,s,i,n,r),100,3)}async eb(e,s,i,n,r){const o=this.cb(e,s);let a=null;try{a=(await le.write(e,i,n,r,o)).bytesWritten}catch(c){throw await this.kb(this.ab.get(e),c)}finally{this.db(e,o,a)}return a}async mkdir(e){try{await qi.mkdir(this.L(e))}catch(s){throw this.jb(s)}}async delete(e,s){try{const i=this.L(e);if(s.recursive){let n;s?.atomic!==!1&&s.atomic.postfix&&(n=J(Zt(i),`${Ct(i)}${s.atomic.postfix}`)),await le.rm(i,wn.MOVE,n)}else try{await qi.unlink(i)}catch(n){if(n.code==="EPERM"||n.code==="EISDIR"){let r=!1;try{const{stat:o,symbolicLink:a}=await Bt.stat(i);r=o.isDirectory()&&!a}catch{}if(r)await qi.rmdir(i);else throw n}else throw n}}catch(i){throw this.jb(i)}}async rename(e,s,i){const n=this.L(e),r=this.L(s);if(n!==r)try{await this.fb(e,s,"move",i.overwrite),await le.rename(n,r)}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(v(2094,null,Ct(n),Ct(Zt(r)),o.toString()))),this.jb(o)}}async copy(e,s,i){const n=this.L(e),r=this.L(s);if(n!==r)try{await this.fb(e,s,"copy",i.overwrite),await le.copy(n,r,{preserveSymlinks:!0})}catch(o){throw(o.code==="EINVAL"||o.code==="EBUSY"||o.code==="ENAMETOOLONG")&&(o=new Error(v(2095,null,Ct(n),Ct(Zt(r)),o.toString()))),this.jb(o)}}async fb(e,s,i,n){const r=this.L(e),o=this.L(s);let a=!1;if(!!(this.capabilities&1024)||(a=Ro(r,o,!0)),a){if(i==="copy")throw $s(v(2096,null),Z.FileExists);if(i==="move")return}const l=await this.P(e);if(!l)throw $s(v(2097,null),Z.FileNotFound);const h=await this.P(s);if(h){if(!n)throw $s(v(2098,null),Z.FileExists);(l.type&Vt.File)!==0&&(h.type&Vt.File)!==0||await this.delete(s,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(e,s){return this.gb(e,s,!1)}async gb(e,s,i){const n=this.L(e),r=this.L(s),o=!!(this.capabilities&1024);if(Ro(n,r,!o))return;const a=new De;try{a.add(await this.S(e)),a.add(await this.S(s)),i&&await qi.mkdir(Zt(r),{recursive:!0}),await qi.copyFile(n,r)}catch(c){if(c.code==="ENOENT"&&!i)return this.gb(e,s,!0);throw this.jb(c)}finally{a.dispose()}}w(e,s,i){return new E7(n=>e(n),n=>s(n),i)}H(e,s,i){return new I7(n=>e(n),n=>s(n),i)}jb(e){if(e instanceof jl)return e;let s=e,i;switch(e.code){case"ENOENT":i=Z.FileNotFound;break;case"EISDIR":i=Z.FileIsADirectory;break;case"ENOTDIR":i=Z.FileNotADirectory;break;case"EEXIST":i=Z.FileExists;break;case"EPERM":case"EACCES":i=Z.NoPermissions;break;case"ERR_UNC_HOST_NOT_ALLOWED":s=`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,i=Z.Unknown;break;default:i=Z.Unknown}return $s(s,i)}async kb(e,s){let i=this.jb(s);if(e&&i.code===Z.NoPermissions)try{const{stat:n}=await Bt.stat(this.L(e));n.mode&128||(i=$s(s,Z.FileWriteLocked))}catch(n){this.a.trace(n)}return i}},ce=class{constructor(t,e=[],s=!1){this.ctor=t,this.staticArguments=e,this.supportsDelayedInstantiation=s}},L7=class{constructor(t,e){this.key=t,this.data=e,this.incoming=new Map,this.outgoing=new Map}},K0=class{constructor(t){this.b=t,this.a=new Map}roots(){const t=[];for(const e of this.a.values())e.outgoing.size===0&&t.push(e);return t}insertEdge(t,e){const s=this.lookupOrInsertNode(t),i=this.lookupOrInsertNode(e);s.outgoing.set(i.key,i),i.incoming.set(s.key,s)}removeNode(t){const e=this.b(t);this.a.delete(e);for(const s of this.a.values())s.outgoing.delete(e),s.incoming.delete(e)}lookupOrInsertNode(t){const e=this.b(t);let s=this.a.get(e);return s||(s=new L7(e,t),this.a.set(e,s)),s}lookup(t){return this.a.get(this.b(t))}isEmpty(){return this.a.size===0}toString(){const t=[];for(const[e,s]of this.a)t.push(`${e}
	(-> incoming)[${[...s.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...s.outgoing.keys()].join(",")}]
`);return t.join(`
`)}findCycleSlow(){for(const[t,e]of this.a){const s=new Set([t]),i=this.c(e,s);if(i)return i}}c(t,e){for(const[s,i]of t.outgoing){if(e.has(s))return[...e,s].join(" -> ");e.add(s);const n=this.c(i,e);if(n)return n;e.delete(s)}}},Jh=class{constructor(...t){this.a=new Map;for(const[e,s]of t)this.set(e,s)}set(t,e){const s=this.a.get(t);return this.a.set(t,e),s}has(t){return this.a.has(t)}get(t){return this.a.get(t)}},A7=!1,Q0=class extends Error{constructor(t){super("cyclic dependency between services"),this.message=t.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${t.toString()}`}},N7=class od{constructor(e=new Jh,s=!1,i,n=A7){this.i=e,this.j=s,this.k=i,this.l=n,this.f=!1,this.g=new Set,this.h=new Set,this.t=new Set,this.i.set(is,this),this._globalGraph=n?i?._globalGraph??new K0(r=>r):void 0}dispose(){if(!this.f){this.f=!0,Xt(this.h),this.h.clear();for(const e of this.g)Uc(e)&&e.dispose();this.g.clear()}}m(){if(this.f)throw new Error("InstantiationService has been disposed")}createChild(e,s){this.m();const i=this,n=new class extends od{dispose(){i.h.delete(n),super.dispose()}}(e,this.j,this,this.l);return this.h.add(n),s?.add(n),n}invokeFunction(e,...s){this.m();const i=Kh.traceInvocation(this.l,e);let n=!1;try{return e({get:o=>{if(n)throw Dc("service accessor is only valid during the invocation of its target method");const a=this.s(o,i);if(!a)throw new Error(`[invokeFunction] unknown service '${o}'`);return a},getIfExists:o=>{if(n)throw Dc("service accessor is only valid during the invocation of its target method");return this.s(o,i)}},...s)}finally{n=!0,i.stop()}}createInstance(e,...s){this.m();let i,n;return e instanceof ce?(i=Kh.traceCreation(this.l,e.ctor),n=this.o(e.ctor,e.staticArguments.concat(s),i)):(i=Kh.traceCreation(this.l,e),n=this.o(e,s,i)),i.stop(),n}o(e,s=[],i){const n=ds.getServiceDependencies(e).sort((a,c)=>a.index-c.index),r=[];for(const a of n){const c=this.s(a.id,i);c||this.y(`[createInstance] ${e.name} depends on UNKNOWN service ${a.id}.`,!1),r.push(c)}const o=n.length>0?n[0].index:s.length;if(s.length!==o){console.trace(`[createInstance] First service dependency of ${e.name} at position ${o+1} conflicts with ${s.length} static arguments`);const a=o-s.length;a>0?s=s.concat(new Array(a)):s=s.slice(0,o)}return Reflect.construct(e,s.concat(r))}q(e,s){if(this.i.get(e)instanceof ce)this.i.set(e,s);else if(this.k)this.k.q(e,s);else throw new Error("illegalState - setting UNKNOWN service instance")}r(e){const s=this.i.get(e);return!s&&this.k?this.k.r(e):s}s(e,s){this._globalGraph&&this.c&&this._globalGraph.insertEdge(this.c,String(e));const i=this.r(e);return i instanceof ce?this.u(e,i,s.branch(e,!0)):(s.branch(e,!1),i)}u(e,s,i){if(this.t.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this.t.add(e);try{return this.v(e,s,i)}finally{this.t.delete(e)}}v(e,s,i){const n=new K0(c=>c.id.toString());let r=0;const o=[{id:e,desc:s,_trace:i}],a=new Set;for(;o.length;){const c=o.pop();if(!a.has(String(c.id))){if(a.add(String(c.id)),n.lookupOrInsertNode(c),r++>1e3)throw new Q0(n);for(const l of ds.getServiceDependencies(c.desc.ctor)){const h=this.r(l.id);if(h||this.y(`[createInstance] ${e} depends on ${l.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(c.id),String(l.id)),h instanceof ce){const u={id:l.id,desc:h,_trace:c._trace.branch(l.id,!0)};n.insertEdge(c,u),o.push(u)}}}}for(;;){const c=n.roots();if(c.length===0){if(!n.isEmpty())throw new Q0(n);break}for(const{data:l}of c){if(this.r(l.id)instanceof ce){const u=this.w(l.id,l.desc.ctor,l.desc.staticArguments,l.desc.supportsDelayedInstantiation,l._trace);this.q(l.id,u)}n.removeNode(l)}}return this.r(e)}w(e,s,i=[],n,r){if(this.i.get(e)instanceof ce)return this.x(e,s,i,n,r,this.g);if(this.k)return this.k.w(e,s,i,n,r);throw new Error(`illegalState - creating UNKNOWN service instance ${s.name}`)}x(e,s,i=[],n,r,o){if(n){const a=new od(void 0,this.j,this,this.l);a.c=String(e);const c=new Map,l=new $4(()=>{const h=a.o(s,i,r);for(const[u,f]of c){const p=h[u];if(typeof p=="function")for(const g of f)g.disposable=p.apply(h,g.listener)}return c.clear(),o.add(h),h});return new Proxy(Object.create(null),{get(h,u){if(!l.isInitialized&&typeof u=="string"&&(u.startsWith("onDid")||u.startsWith("onWill"))){let g=c.get(u);return g||(g=new Hd,c.set(u,g)),(w,b,S)=>{if(l.isInitialized)return l.value[u](w,b,S);{const $={listener:[w,b,S],disposable:void 0},U=g.push($);return de(()=>{U(),$.disposable?.dispose()})}}}if(u in h)return h[u];const f=l.value;let p=f[u];return typeof p!="function"||(p=p.bind(f),h[u]=p),p},set(h,u,f){return l.value[u]=f,!0},getPrototypeOf(h){return s.prototype}})}else{const a=this.o(s,i,r);return o.add(a),a}}y(e,s){if(s&&console.warn(e),this.j)throw new Error(e)}},X0;(function(t){t[t.None=0]="None",t[t.Creation=1]="Creation",t[t.Invocation=2]="Invocation",t[t.Branch=3]="Branch"})(X0||(X0={}));var Kh=class As{static{this.all=new Set}static{this.c=new class extends As{constructor(){super(0,null)}stop(){}branch(){return this}}}static traceInvocation(e,s){return e?new As(2,s.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):As.c}static traceCreation(e,s){return e?new As(1,s.name):As.c}static{this.f=0}constructor(e,s){this.type=e,this.name=s,this.g=Date.now(),this.h=[]}branch(e,s){const i=new As(3,e.toString());return this.h.push([e,s,i]),i}stop(){const e=Date.now()-this.g;As.f+=e;let s=!1;function i(r,o){const a=[],c=new Array(r+1).join("	");for(const[l,h,u]of o.h)if(h&&u){s=!0,a.push(`${c}CREATES -> ${l}`);const f=i(r+1,u);f&&a.push(f)}else a.push(`${c}uses -> ${l}`);return a.join(`
`)}const n=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${i(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${As.f.toFixed(2)}ms)`];(e>2||s)&&As.all.add(n.join(`
`))}};import*as j7 from"fs";import{createHash as T7}from"crypto";var Qh=class extends Cl{constructor(e,s,i,n){super(i),this.h=e,this.j=n,this.g=this.B(new Xh(s,n)),this.h.registerParticipant({postInstall:async r=>this.m(r),postUninstall:async r=>this.n(r)})}async getBuiltInExtensionTranslationsUri(e,s){const n=(await this.g.getLanguagePacks())[s];if(!n){this.j.warn(`No language pack found for ${s}`);return}const r=n.translations[e];return r?k.file(r):void 0}async getInstalledLanguages(){const e=await this.g.getLanguagePacks(),s=Object.keys(e).map(i=>{const n=e[i];return{...this.f(i,n.label),extensionId:n.extensions[0].extensionIdentifier.id}});return s.push(this.f("en","English")),s.sort((i,n)=>i.label.localeCompare(n.label)),s}async m(e){e&&e.manifest&&e.manifest.contributes&&e.manifest.contributes.localizations&&e.manifest.contributes.localizations.length&&(this.j.info("Adding language packs from the extension",e.identifier.id),await this.update())}async n(e){const s=await this.g.getLanguagePacks();Object.keys(s).some(i=>s[i]&&s[i].extensions.some(n=>G(n.extensionIdentifier,e.identifier)))&&(this.j.info("Removing language packs from the extension",e.identifier.id),await this.update())}async update(){const[e,s]=await Promise.all([this.g.getLanguagePacks(),this.h.getInstalled()]),i=await this.g.update(s);return!Tt(Object.keys(e),Object.keys(i))}};Qh=__decorate([__param(0,Hs),__param(1,_t),__param(2,Es),__param(3,Y)],Qh);var Xh=class extends T{constructor(e,s){super(),this.j=s,this.c={},this.f=J(e.userDataPath,"languagepacks.json"),this.g=new un}getLanguagePacks(){return this.g.size||!this.h?this.s().then(()=>this.c):Promise.resolve(this.c)}update(e){return this.s(s=>{Object.keys(s).forEach(i=>delete s[i]),this.m(s,...e)}).then(()=>this.c)}m(e,...s){for(const i of s)i&&i.manifest&&i.manifest.contributes&&i.manifest.contributes.localizations&&i.manifest.contributes.localizations.length&&this.n(e,i);Object.keys(e).forEach(i=>this.r(e[i]))}n(e,s){const i=s.identifier,n=s.manifest.contributes&&s.manifest.contributes.localizations?s.manifest.contributes.localizations:[];for(const r of n)if(s.location.scheme===oe.file&&M7(r)){let o=e[r.languageId];o||(o={hash:"",extensions:[],translations:{},label:r.localizedLanguageName??r.languageName},e[r.languageId]=o);const a=o.extensions.filter(c=>G(c.extensionIdentifier,i))[0];a?a.version=s.manifest.version:o.extensions.push({extensionIdentifier:i,version:s.manifest.version});for(const c of r.translations)o.translations[c.id]=J(s.location.fsPath,c.path)}}r(e){if(e){const s=T7("md5");for(const i of e.extensions)s.update(i.extensionIdentifier.uuid||i.extensionIdentifier.id).update(i.version);e.hash=s.digest("hex")}}s(e=()=>null){return this.g.queue(()=>{let s=null;return j7.promises.readFile(this.f,"utf8").then(void 0,i=>i.code==="ENOENT"?Promise.resolve("{}"):Promise.reject(i)).then(i=>{try{return JSON.parse(i)}catch{return{}}}).then(i=>(s=e(i),i)).then(i=>{for(const r of Object.keys(i))i[r]||delete i[r];this.c=i,this.h=!0;const n=JSON.stringify(this.c);return this.j.debug("Writing language packs",n),le.writeFile(this.f,n)}).then(()=>s,i=>this.j.error(i))})}};Xh=__decorate([__param(0,_t),__param(1,Y)],Xh);function M7(t){if(typeof t.languageId!="string"||!Array.isArray(t.translations)||t.translations.length===0)return!1;for(const e of t.translations)if(typeof e.id!="string"||typeof e.path!="string")return!1;return!(t.languageName&&typeof t.languageName!="string"||t.localizedLanguageName&&typeof t.localizedLanguageName!="string")}var F7=class extends Jb{constructor(t,e,s,i,n){super(e,s,i),this.c=t,this.r=n,this.B(n.listen("onDidChangeLogLevel",t)(r=>{_b(r)?super.setLogLevel(r):super.setLogLevel(k.revive(r[0]),r[1])})),this.B(n.listen("onDidChangeVisibility",t)(([r,o])=>super.setVisibility(k.revive(r),o))),this.B(n.listen("onDidChangeLoggers",t)(({added:r,removed:o})=>{for(const a of r)super.registerLogger({...a,resource:k.revive(a.resource)});for(const a of o)super.deregisterLogger(a.resource)}))}createConsoleMainLogger(){return new Hb({log:(t,e)=>{this.r.call("consoleLog",[t,e])}})}registerLogger(t){super.registerLogger(t),this.r.call("registerLogger",[t,this.c])}deregisterLogger(t){super.deregisterLogger(t),this.r.call("deregisterLogger",[t,this.c])}setLogLevel(t,e){super.setLogLevel(t,e),this.r.call("setLogLevel",[t,e])}setVisibility(t,e){super.setVisibility(t,e),this.r.call("setVisibility",[this.s(t),e])}t(t,e,s){return new U7(this.r,t,e,s,this.c)}static setLogLevel(t,e,s){return t.call("setLogLevel",[e,s])}},U7=class extends qb{constructor(t,e,s,i,n){super(i?.logLevel==="always"),this.s=t,this.t=e,this.n=!1,this.r=[],this.setLevel(s),this.s.call("createLogger",[e,i,n]).then(()=>{this.w(this.r),this.n=!0})}m(t,e){const s=[[t,e]];this.n?this.w(s):this.r.push(...s)}w(t){this.s.call("log",[this.t,t])}},Ht,Zh=globalThis.vscode;if(typeof Zh<"u"&&typeof Zh.context<"u"){const t=Zh.context.configuration();if(t)Ht=t.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(Ht=globalThis._VSCODE_PRODUCT_JSON,Ne.VSCODE_DEV&&Object.assign(Ht,{nameShort:`${Ht.nameShort} Dev`,nameLong:`${Ht.nameLong} Dev`,dataFolderName:`${Ht.dataFolderName}-dev`,serverDataFolderName:Ht.serverDataFolderName?`${Ht.serverDataFolderName}-dev`:void 0}),!Ht.version){const t=globalThis._VSCODE_PACKAGE_JSON;Object.assign(Ht,{version:t.version})}}else Ht={},Object.keys(Ht).length===0&&Object.assign(Ht,{version:"1.104.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var ci=Ht,B7=class{constructor(t){this.b=t}listen(t,e){throw new Error(`Event not found: ${e}`)}call(t,e,{eventName:s,data:i}){return this.b.forEach(n=>n.log(s,i)),Promise.resolve(null)}},z7=class{constructor(t){this.b=t}log(t,e){return this.b.call("log",{eventName:t,data:e}).then(void 0,s=>`Failed to log telemetry: ${console.warn(s)}`),Promise.resolve(null)}flush(){return Promise.resolve()}},Ra=class extends T{constructor(e,s,i,n,r){super(),this.b=e;const o=s?"remoteTelemetry":Rg,a=i.getLogger(o);if(a)this.a=this.B(a);else{const l=Dg(r,n)?" (Not Sent)":"";this.a=this.B(i.createLogger(o,{name:v(2277,null,l),group:v5,hidden:!0}))}}flush(){return Promise.resolve()}log(e,s){this.a.trace(`${this.b}telemetry/${e}`,Og(s))}};Ra=__decorate([__param(2,dr),__param(3,ae),__param(4,pe)],Ra);var Ca=class{static{this.IDLE_START_EVENT_NAME="UserIdleStart"}static{this.IDLE_STOP_EVENT_NAME="UserIdleStop"}constructor(e,s,i){this.k=s,this.l=i,this.d={},this.i=new De,this.j=[],this.b=e.appenders,this.c=e.commonProperties??Object.create(null),this.sessionId=this.c.sessionID,this.machineId=this.c["common.machineId"],this.sqmId=this.c["common.sqmId"],this.devDeviceId=this.c["common.devDeviceId"],this.firstSessionDate=this.c["common.firstSessionDate"],this.msftInternal=this.c["common.msftInternal"],this.f=e.piiPaths||[],this.g=3,this.h=!!e.sendErrorTelemetry,this.j=[/(vscode-)?file:\/\/\/.*?\/resources\/app\//gi];for(const n of this.f)this.j.push(new RegExp(ki(n),"gi")),n.indexOf("\\")>=0&&this.j.push(new RegExp(ki(n.replace(/\\/g,"/")),"gi"));this.m(),this.i.add(this.k.onDidChangeConfiguration(n=>{(n.affectsConfiguration(ea)||n.affectsConfiguration(Kl)||n.affectsConfiguration(mg))&&this.m()}))}setExperimentProperty(e,s){this.d[e]=s}m(){let e=Ig(this.k);const s=this.l.enabledTelemetryLevels;if(s){this.h=this.sendErrorTelemetry?s.error:!1;const i=s.usage?3:s.error?2:0;e=Math.min(e,i)}this.g=e}get sendErrorTelemetry(){return this.h}get telemetryLevel(){return this.g}dispose(){this.i.dispose()}n(e,s,i){this.g<s||(i=Zo(i,this.d),i=x5(i,this.j),i=Zo(i,this.c),this.b.forEach(n=>n.log(e,i)))}publicLog(e,s){this.n(e,3,s)}publicLog2(e,s){this.publicLog(e,s)}publicLogError(e,s){this.h&&this.n(e,2,s)}publicLogError2(e,s){this.publicLogError(e,s)}};Ca=__decorate([__param(1,ge),__param(2,pe)],Ca);function _7(){const t=v(2278,null,ci.nameLong),e=ci.privacyStatementUrl?v(2280,null,"https://aka.ms/vscode-telemetry",ci.privacyStatementUrl):v(2279,null,"https://aka.ms/vscode-telemetry"),s=ot?"":v(2281,null),i=v(2282,null),n=v(2283,null),r=v(2284,null),o=v(2285,null),a=`
|       | ${i} | ${n} | ${r} |
|:------|:-------------:|:---------------:|:----------:|
| all   |       \u2713       |        \u2713        |     \u2713      |
| error |       \u2713       |        \u2713        |     -      |
| crash |       \u2713       |        -        |     -      |
| off   |       -       |        -        |     -      |
`,c=v(2286,null);return`
${t} ${e} ${s}

&nbsp;

${o}
${a}

&nbsp;

${c}
`}var V7=Ot.as(ns.Configuration);V7.registerConfiguration({id:e5,order:1,type:"object",title:v(2287,null),properties:{[ea]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[v(2288,null),v(2289,null),v(2290,null),v(2291,null)],markdownDescription:_7(),default:"all",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"],policy:{name:"TelemetryLevel",minimumVersion:"1.99",description:v(2292,null)}},"telemetry.feedback.enabled":{type:"boolean",default:!0,description:v(2293,null),policy:{name:"EnableFeedback",minimumVersion:"1.99"}},[Kl]:{type:"boolean",markdownDescription:ci.privacyStatementUrl?v(2295,null,ci.nameLong,ci.privacyStatementUrl):v(2294,null,ci.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:v(2296,null,`\`#${ea}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}});var Yh=class{constructor(e,s,i,n,r){this.b=e,this.c=s,this.d=i,this.e=n,this.f=r,this.a=new Map}g(e){if(!this.a.has(e.id)){const s=Object.create(null);s["common.vscodemachineid"]=this.c.machineId,s["common.vscodesessionid"]=this.c.sessionId;const i=[e.id,JSON.stringify(s),e.aiKey],r=new J0(ei.asFileUri("bootstrap-fork").fsPath,{serverName:"Debug Telemetry",timeout:1e3*60*5,args:i,env:{ELECTRON_RUN_AS_NODE:1,VSCODE_PIPE_LOGGING:"true",VSCODE_ESM_ENTRYPOINT:"vs/workbench/contrib/debug/node/telemetryApp"}}).getChannel("telemetryAppender"),o=[new z7(r),new Ra(`[${e.id}] `,!1,this.d,this.e,this.f)];this.a.set(e.id,new Ca({appenders:o,sendErrorTelemetry:e.sendErrorTelemetry},this.b,this.f))}return this.a.get(e.id)}publicLog(e,s,i){this.g(e).publicLog(s,i)}publicLogError(e,s,i){this.g(e).publicLogError(s,i)}};Yh=__decorate([__param(0,ge),__param(1,ke),__param(2,dr),__param(3,ae),__param(4,pe)],Yh);var Is,eu=W("IExtensionStorageService"),q7=/^extensionKeys\/([^.]+\..+)@(\d+\.\d+\.\d+(-.*)?)$/,Tr=class extends T{static{Is=this}static{this.a=512*1024}static b(e){return`extensionKeys/${$r(e.id)}@${e.version}`}static c(e){const s=q7.exec(e);if(s&&s[1])return{id:s[1],version:s[2]}}static async removeOutdatedExtensionVersions(e,s){const i=await e.getInstalled(),n=[];for(const[r,o]of Is.f(s)){const a=i.find(c=>G(c.identifier,{id:r}))?.manifest.version;for(const c of o)a!==c&&n.push(Is.b({id:r,version:c}))}for(const r of n)s.remove(r,0)}static f(e){const s=new Map,i=e.keys(0,1);for(const n of i){const r=Is.c(n);if(r){let o=s.get(r.id.toLowerCase());o||s.set(r.id.toLowerCase(),o=[]),o.push(r.version)}}return s}constructor(e,s,i){super(),this.j=e,this.m=s,this.n=i,this.g=this.B(new R),this.onDidChangeExtensionStorageToSync=this.g.event,this.h=Is.f(e),this.B(this.j.onDidChangeValue(0,void 0,this.q)(n=>this.r(n)))}r(e){if(this.h.has(e.key.toLowerCase())){this.g.fire();return}const s=Is.c(e.key);if(s){if(this.j.get(e.key,0)===void 0)this.h.delete(s.id.toLowerCase());else{let i=this.h.get(s.id.toLowerCase());i||this.h.set(s.id.toLowerCase(),i=[]),i.push(s.version),this.g.fire()}return}}s(e){if($e(e))return e;const s=e.manifest?e.manifest.publisher:e.publisher,i=e.manifest?e.manifest.name:e.name;return sa(s,i)}getExtensionState(e,s){const i=this.s(e),n=this.getExtensionStateRaw(e,s);if(n)try{return JSON.parse(n)}catch(r){this.n.error(`[mainThreadStorage] unexpected error parsing storage contents (extensionId: ${i}, global: ${s}): ${r}`)}}getExtensionStateRaw(e,s){const i=this.s(e),n=this.j.get(i,s?0:1);return n&&n?.length>Is.a&&this.n.warn(`[mainThreadStorage] large extension state detected (extensionId: ${i}, global: ${s}): ${n.length/1024}kb. Consider to use 'storageUri' or 'globalStorageUri' to store this data on disk instead.`),n}setExtensionState(e,s,i){const n=this.s(e);s===void 0?this.j.remove(n,i?0:1):this.j.store(n,JSON.stringify(s),i?0:1,1)}setKeysForSync(e,s){this.j.store(Is.b(e),JSON.stringify(s),0,1)}getKeysForSync(e){const s=this.m.extensionSyncedKeys?.[e.id.toLowerCase()],i=this.j.get(Is.b(e),0),n=i?JSON.parse(i):void 0;return n&&s?Rt([...n,...s]):n||s}addToMigrationList(e,s){if(e!==s){const i=this.t.filter(n=>!n.includes(e)&&!n.includes(s));i.push([e,s]),this.t=i}}getSourceExtensionToMigrate(e){const s=this.t.find(([,i])=>e===i);return s?s[0]:void 0}get t(){const e=this.j.get("extensionStorage.migrationList",-1,"[]");try{const s=JSON.parse(e);if(Array.isArray(s))return s}catch{}return[]}set t(e){e.length?this.j.store("extensionStorage.migrationList",JSON.stringify(e),-1,1):this.j.remove("extensionStorage.migrationList",-1)}};Tr=Is=__decorate([__param(0,ne),__param(1,pe),__param(2,Y)],Tr);var Da=W("IIgnoredExtensionsManagementService"),tu=class{constructor(e){this.a=e}hasToNeverSyncExtension(e){return this.b().includes(e.toLowerCase())}hasToAlwaysSyncExtension(e){return this.b().includes(`-${e.toLowerCase()}`)}updateIgnoredExtensions(e,s){let i=[...this.a.getValue("settingsSync.ignoredExtensions")].map(n=>n.toLowerCase());return i=i.filter(n=>n!==e&&n!==`-${e}`),s&&i.push(e.toLowerCase()),this.a.updateValue("settingsSync.ignoredExtensions",i.length?i:void 0,2)}updateSynchronizedExtensions(e,s){let i=[...this.a.getValue("settingsSync.ignoredExtensions")].map(n=>n.toLowerCase());return i=i.filter(n=>n!==e&&n!==`-${e}`),s&&i.push(`-${e.toLowerCase()}`),this.a.updateValue("settingsSync.ignoredExtensions",i.length?i:void 0,2)}getIgnoredExtensions(e){const s=e.filter(o=>o.isMachineScoped).map(o=>o.identifier.id.toLowerCase()),i=this.b().map(o=>o.toLowerCase()),n=[],r=[];if(Array.isArray(i))for(const o of i)o.startsWith("-")?r.push(o.substring(1)):n.push(o);return Rt([...s,...n].filter(o=>!r.includes(o)))}b(){return(this.a.getValue("settingsSync.ignoredExtensions")||[]).map(e=>e.toLowerCase())}};tu=__decorate([__param(0,ge)],tu);function su(){const t=Ot.as(ns.Configuration).getConfigurationProperties();return Object.keys(t).filter(e=>!!t[e].disallowSyncIgnore)}function W7(t=!1){const e=Ot.as(ns.Configuration).getConfigurationProperties(),s=Y0(e,t),i=su();return Rt([...s,...i])}function Z0(t){if(!t.contributes?.configuration)return[];const e=Array.isArray(t.contributes.configuration)?t.contributes.configuration:[t.contributes.configuration];if(!e.length)return[];const s=gp(e);return Y0(s,!1)}function Y0(t,e){const s=new Set;for(const i in t){if(e&&t[i].source)continue;const n=$e(t[i].scope)?h2(t[i].scope):t[i].scope;(t[i].ignoreSync||n===2||n===7)&&s.add(i)}return[...s.values()]}var Ia="settingsSync",iu="settingsSync.keybindingsPerPlatform";function H7(){const t="vscode://schemas/ignoredSettings",e=Ot.as(ns.Configuration);e.registerConfiguration({id:"settingsSync",order:30,title:v(2679,null),type:"object",properties:{[iu]:{type:"boolean",description:v(2680,null),default:!0,scope:1,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredExtensions":{type:"array",markdownDescription:v(2681,null),items:[{type:"string",pattern:mp,errorMessage:v(2682,null)}],default:[],scope:1,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredSettings":{type:"array",description:v(2683,null),default:[],scope:1,$ref:t,additionalProperties:!0,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]}}});const s=Ot.as(El.JSONContribution),i=()=>{const n=su(),r=W7(),o=Object.keys(gr.properties).filter(l=>!r.includes(l)),a=r.filter(l=>!n.includes(l)),c={items:{type:"string",enum:[...o,...a.map(l=>`-${l}`)]}};s.registerSchema(t,c)};return e.onDidUpdateConfiguration(()=>i())}var G7="0",em;(function(t){t.Settings="settings",t.Keybindings="keybindings",t.Snippets="snippets",t.Prompts="prompts",t.Tasks="tasks",t.Mcp="mcp",t.Extensions="extensions",t.GlobalState="globalState",t.Profiles="profiles",t.WorkspaceState="workspaceState"})(em||(em={}));var Nn=["settings","keybindings","snippets","prompts","tasks","extensions","globalState","profiles","mcp"];function tm(t,...e){return t?[t,...e]:e}function sm(t,e,s,i){return i.joinPath(s.userDataSyncHome,...tm(t,e,`lastSync${e}.json`))}function J7(t){return t&&$e(t.session)&&$e(t.ref)&&(Be(t.latest)||t.latest===void 0)&&(Be(t.collections)||t.collections===void 0)}var li=W("IUserDataSyncStoreManagementService"),nt=W("IUserDataSyncStoreService"),xt=W("IUserDataSyncLocalStoreService"),Os="x-operation-id",im="X-Execution-Id";function jn(t){const e={};return e[im]=t,e}var nm;(function(t){t.Unauthorized="Unauthorized",t.Forbidden="Forbidden",t.NotFound="NotFound",t.MethodNotFound="MethodNotFound",t.Conflict="Conflict",t.Gone="Gone",t.PreconditionFailed="PreconditionFailed",t.TooLarge="TooLarge",t.UpgradeRequired="UpgradeRequired",t.PreconditionRequired="PreconditionRequired",t.TooManyRequests="RemoteTooManyRequests",t.TooManyRequestsAndRetryAfter="TooManyRequestsAndRetryAfter",t.RequestFailed="RequestFailed",t.RequestCanceled="RequestCanceled",t.RequestTimeout="RequestTimeout",t.RequestProtocolNotSupported="RequestProtocolNotSupported",t.RequestPathNotEscaped="RequestPathNotEscaped",t.RequestHeadersNotObject="RequestHeadersNotObject",t.NoCollection="NoCollection",t.NoRef="NoRef",t.EmptyResponse="EmptyResponse",t.TurnedOff="TurnedOff",t.SessionExpired="SessionExpired",t.ServiceChanged="ServiceChanged",t.DefaultServiceChanged="DefaultServiceChanged",t.LocalTooManyProfiles="LocalTooManyProfiles",t.LocalTooManyRequests="LocalTooManyRequests",t.LocalPreconditionFailed="LocalPreconditionFailed",t.LocalInvalidContent="LocalInvalidContent",t.LocalError="LocalError",t.IncompatibleLocalContent="IncompatibleLocalContent",t.IncompatibleRemoteContent="IncompatibleRemoteContent",t.Unknown="Unknown"})(nm||(nm={}));var Pe=class extends Error{constructor(t,e,s,i){super(t),this.code=e,this.resource=s,this.operationId=i,this.name=`${this.code} (UserDataSyncError) syncResource:${this.resource||"unknown"} operationId:${this.operationId||"unknown"}`}},Ie=class extends Pe{constructor(t,e,s,i,n){super(t,s,void 0,n),this.url=e,this.serverCode=i}},hi=class extends Pe{constructor(t,e){super(t,e)}};(function(t){function e(s){if(s instanceof t)return s;const i=/^(.+) \(UserDataSyncError\) syncResource:(.+) operationId:(.+)$/.exec(s.name);if(i&&i[1]){const n=i[2]==="unknown"?void 0:i[2],r=i[3]==="unknown"?void 0:i[3];return new t(s.message,i[1],n,r)}return new t(s.message,"Unknown")}t.toUserDataSyncError=e})(Pe||(Pe={}));var rm;(function(t){t.Uninitialized="uninitialized",t.Idle="idle",t.Syncing="syncing",t.HasConflicts="hasConflicts"})(rm||(rm={}));var om;(function(t){t[t.None=0]="None",t[t.Added=1]="Added",t[t.Modified=2]="Modified",t[t.Deleted=3]="Deleted"})(om||(om={}));var am;(function(t){t.Preview="preview",t.Conflict="conflict",t.Accepted="accepted"})(am||(am={}));var ui="sync.store.url.type";function Mr(t){return`sync.enable.${t}`}var pt=W("IUserDataSyncEnablementService"),Oa=W("IUserDataSyncService"),nu=W("IUserDataSyncResourceProviderService"),_$=W("IUserDataAutoSyncService"),La=W("IUserDataSyncUtilService"),Re=W("IUserDataSyncLogService"),cm="userDataSync",I="vscode-userdata-sync",K7="preview",Aa=W("IUserDataSyncAccountService"),ru=class extends T{get account(){return this.a}constructor(e,s){super(),this.g=e,this.h=s,this.b=this.B(new R),this.onDidChangeAccount=this.b.event,this.c=this.B(new R),this.onTokenFailed=this.c.event,this.f=!1,this.B(e.onTokenFailed(i=>{this.h.info("Settings Sync auth token failed",this.account?.authenticationProviderId,this.f,i),this.updateAccount(void 0),i==="Forbidden"?this.c.fire(!0):this.c.fire(this.f),this.f=!0})),this.B(e.onTokenSucceed(()=>this.f=!1))}async updateAccount(e){(e&&this.a?e.token!==this.a.token||e.authenticationProviderId!==this.a.authenticationProviderId:e!==this.a)&&(this.a=e,this.a&&this.g.setAuthToken(this.a.token,this.a.authenticationProviderId),this.b.fire(e))}};ru=__decorate([__param(0,nt),__param(1,Re)],ru);var Q7=60,X7=Q7*60,ou=X7*24,q$=ou*7,W$=ou*30,H$=ou*365;function au(t){return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+"T"+String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")+":"+String(t.getSeconds()).padStart(2,"0")+"."+(t.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var cu=class extends T{constructor(e,s,i,n,r){super(),this.a=e,this.b=s,this.c=i,this.f=n,this.g=r,this.h()}async h(){for(const s of this.g.profiles)for(const i of Nn)try{await this.m(this.j(i,s.isDefault?void 0:s.id))}catch(n){this.f.error(n)}let e;try{e=await this.b.resolve(this.a.userDataSyncHome)}catch(s){Me(s)!==1&&this.f.error(s);return}if(e.children){for(const s of e.children)if(s.isDirectory&&!Nn.includes(s.name)&&!this.g.profiles.some(i=>i.id===s.name))try{this.f.info("Deleting non existing profile from backup",s.resource.path),await this.b.del(s.resource,{recursive:!0})}catch(i){this.f.error(i)}}}async getAllResourceRefs(e,s,i){const n=this.j(e,s,i);try{const r=await this.b.resolve(n);if(r.children)return r.children.filter(a=>a.isFile&&!a.name.startsWith("lastSync")).sort().reverse().map(a=>({ref:a.name,created:this.n(a)}))}catch(r){if(Me(r)!==1)throw r}return[]}async resolveResourceContent(e,s,i,n){const r=this.j(e,i,n),o=_(r,s);try{return(await this.b.readFile(o)).value.toString()}catch(a){return this.f.error(a),null}}async writeResource(e,s,i,n,r){const o=this.j(e,n,r),a=_(o,`${au(i).replace(/-|:|\.\d+Z$/g,"")}.json`);try{await this.b.writeFile(a,A.fromString(s))}catch(c){this.f.error(c)}}j(e,s,i=this.a.userDataSyncHome){return _(i,...s?[s,e]:[e])}async m(e){try{try{if(!await this.b.exists(e))return}catch{return}const s=await this.b.resolve(e);if(s.children){const i=s.children.filter(a=>a.isFile&&/^\d{8}T\d{6}(\.json)?$/.test(a.name)).sort(),n=1e3*60*60*24*(this.c.getValue("sync.localBackupDuration")||30);let r=i.filter(a=>Date.now()-this.n(a)>n);const o=i.length-r.length;o<10&&(r=r.slice(10-o)),await Ze.settled(r.map(async a=>{this.f.info("Deleting from backup",a.resource.path),await this.b.del(a.resource)}))}}catch(s){this.f.error(s)}}n(e){return new Date(parseInt(e.name.substring(0,4)),parseInt(e.name.substring(4,6))-1,parseInt(e.name.substring(6,8)),parseInt(e.name.substring(9,11)),parseInt(e.name.substring(11,13)),parseInt(e.name.substring(13,15))).getTime()}};cu=__decorate([__param(0,ae),__param(1,K),__param(2,ge),__param(3,Re),__param(4,je)],cu);var lu=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list",html:"text/html"}),lm="configurationSync.store",hu="sync.previous.store",uu="sync.donot-make-requests-until",Na="sync.user-session-id",fu="sync.machine-session-id",Z7=100,Y7=1e3*60*5,ja=class extends T{get userDataSyncStore(){return this.b}get c(){return this.h.get(ui,-1)}set c(e){this.h.store(ui,e,-1,ot?0:1)}constructor(e,s,i){super(),this.f=e,this.g=s,this.h=i,this.a=this.B(new R),this.onDidChangeUserDataSyncStore=this.a.event,this.j();const n=this.B(new De);this.B(L.filter(i.onDidChangeValue(-1,ui,n),()=>this.c!==this.userDataSyncStore?.type,n)(()=>this.j()))}j(){this.b=this.m(this.f[lm]),this.a.fire()}m(e){if(e&&(e=ot&&e.web?{...e,...e.web}:e,$e(e.url)&&Be(e.authenticationProviders)&&Object.keys(e.authenticationProviders).every(s=>Array.isArray(e.authenticationProviders[s].scopes)))){const s=e,i=!!s.canSwitch,n=s.url===s.insidersUrl?"insiders":"stable",r=(i?this.c:void 0)||n,o=r==="insiders"?s.insidersUrl:r==="stable"?s.stableUrl:s.url;return{url:k.parse(o),type:r,defaultType:n,defaultUrl:k.parse(s.url),stableUrl:k.parse(s.stableUrl),insidersUrl:k.parse(s.insidersUrl),canSwitch:i,authenticationProviders:Object.keys(s.authenticationProviders).reduce((a,c)=>(a.push({id:c,scopes:s.authenticationProviders[c].scopes}),a),[])}}}};ja=__decorate([__param(0,pe),__param(1,ge),__param(2,ne)],ja);var du=class extends ja{constructor(e,s,i){super(e,s,i);const n=this.h.get(hu,-1);n&&(this.n=JSON.parse(n));const r=this.f[lm];r?this.h.store(hu,JSON.stringify(r),-1,1):this.h.remove(hu,-1)}async switch(e){e!==this.c&&(this.c=e,this.j())}async getPreviousUserDataSyncStore(){return this.m(this.n)}};du=__decorate([__param(0,pe),__param(1,ge),__param(2,ne)],du);var pu=class extends T{get donotMakeRequestsUntil(){return this.j}constructor(e,s,i,n,r,o,a){super(),this.n=i,this.r=n,this.s=a,this.g=this.B(new R),this.onTokenFailed=this.g.event,this.h=this.B(new R),this.onTokenSucceed=this.h.event,this.j=void 0,this.m=this.B(new R),this.onDidChangeDonotMakeRequestsUntil=this.m.event,this.w=void 0,this.t(e),this.c=In(r,o,a).then(c=>{const l={"X-Client-Name":`${s.applicationName}${ot?"-web":""}`,"X-Client-Version":s.version};return s.commit&&(l["X-Client-Commit"]=s.commit),l}),this.f=new e6(Z7,Y7,this.n,this.r),this.u(),this.B(de(()=>{this.w&&(this.w.cancel(),this.w=void 0)}))}setAuthToken(e,s){this.b={token:e,type:s}}t(e){this.a=e?_(e,"v1"):void 0}u(){const e=this.s.getNumber(uu,-1);e&&Date.now()<e&&this.y(new Date(e))}y(e){this.j?.getTime()!==e?.getTime()&&(this.j=e,this.w&&(this.w.cancel(),this.w=void 0),this.j?(this.s.store(uu,this.j.getTime(),-1,1),this.w=vt(s=>Oi(this.j.getTime()-Date.now(),s).then(()=>this.y(void 0))),this.w.then(null,s=>null)):this.s.remove(uu,-1),this.m.fire())}async getAllCollections(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=_(this.a,"collection").toString();e={...e},e["Content-Type"]="application/json";const i=await this.D(s,{type:"GET",headers:e},[],Q.None);return(await ps(i))?.map(({id:n})=>n)||[]}async createCollection(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=_(this.a,"collection").toString();e={...e},e["Content-Type"]=lu.text;const i=await this.D(s,{type:"POST",headers:e},[],Q.None),n=await xs(i);if(!n)throw new Ie("Server did not return the collection id",s,"NoCollection",i.res.statusCode,i.res.headers[Os]);return n}async deleteCollection(e,s={}){if(!this.a)throw new Error("No settings sync store url configured.");const i=e?_(this.a,"collection",e).toString():_(this.a,"collection").toString();s={...s},await this.D(i,{type:"DELETE",headers:s},[],Q.None)}async getAllResourceRefs(e,s){if(!this.a)throw new Error("No settings sync store url configured.");const i=this.z(this.a,s,e),n={},r=await this.D(i.toString(),{type:"GET",headers:n},[],Q.None);return(await ps(r)||[]).map(({url:a,created:c})=>({ref:d4(i,i.with({path:a})),created:c*1e3}))}async resolveResourceContent(e,s,i,n={}){if(!this.a)throw new Error("No settings sync store url configured.");const r=_(this.z(this.a,i,e),s).toString();n={...n},n["Cache-Control"]="no-cache";const o=await this.D(r,{type:"GET",headers:n},[],Q.None);return await xs(o)}async deleteResource(e,s,i){if(!this.a)throw new Error("No settings sync store url configured.");const n=s!==null?_(this.z(this.a,i,e),s).toString():this.z(this.a,i,e).toString(),r={};await this.D(n,{type:"DELETE",headers:r},[],Q.None)}async deleteResources(){if(!this.a)throw new Error("No settings sync store url configured.");const e=_(this.a,"resource").toString(),s={"Content-Type":lu.text};await this.D(e,{type:"DELETE",headers:s},[],Q.None)}async readResource(e,s,i,n={}){if(!this.a)throw new Error("No settings sync store url configured.");const r=_(this.z(this.a,i,e),"latest").toString();n={...n},n["Cache-Control"]="no-cache",s&&(n["If-None-Match"]=s.ref);const o=await this.D(r,{type:"GET",headers:n},[304],Q.None);let a=null;if(o.res.statusCode===304&&(a=s),a===null){const c=o.res.headers.etag;if(!c)throw new Ie("Server did not return the ref",r,"NoRef",o.res.statusCode,o.res.headers[Os]);const l=await xs(o);if(!l&&o.res.statusCode===304)throw new Ie("Empty response",r,"EmptyResponse",o.res.statusCode,o.res.headers[Os]);a={ref:c,content:l}}return a}async writeResource(e,s,i,n,r={}){if(!this.a)throw new Error("No settings sync store url configured.");const o=this.z(this.a,n,e).toString();r={...r},r["Content-Type"]=lu.text,i&&(r["If-Match"]=i);const a=await this.D(o,{type:"POST",data:s,headers:r},[],Q.None),c=a.res.headers.etag;if(!c)throw new Ie("Server did not return the ref",o,"NoRef",a.res.statusCode,a.res.headers[Os]);return c}async manifest(e,s={}){if(!this.a)throw new Error("No settings sync store url configured.");const i=_(this.a,"manifest").toString();s={...s},s["Content-Type"]="application/json",e&&(s["If-None-Match"]=e.ref);const n=await this.D(i,{type:"GET",headers:s},[304],Q.None);let r=null;if(n.res.statusCode===304&&(r=e),!r){const a=n.res.headers.etag;if(!a)throw new Ie("Server did not return the ref",i,"NoRef",n.res.statusCode,n.res.headers[Os]);const c=await xs(n);if(!c&&n.res.statusCode===304)throw new Ie("Empty response",i,"EmptyResponse",n.res.statusCode,n.res.headers[Os]);c&&(r={...JSON.parse(c),ref:a})}const o=this.s.get(Na,-1);return o&&r&&o!==r.session&&this.C(),r===null&&o&&this.C(),r&&this.s.store(Na,r.session,-1,1),r}async clear(){if(!this.a)throw new Error("No settings sync store url configured.");await this.deleteCollection(),await this.deleteResources(),this.C()}async getLatestData(e={}){if(!this.a)throw new Error("No settings sync store url configured.");const s=_(this.a,"download","latest").toString();e={...e},e["Content-Type"]="application/json";const i=await this.D(s,{type:"GET",headers:e},[],Q.None);if(!Cn(i))throw new Ie("Server returned "+i.res.statusCode,s,"EmptyResponse",i.res.statusCode,i.res.headers[Os]);const n=await ps(i);if(!n)return null;const r={};if(n.resources){r.resources={};for(const o in n.resources){const[a]=n.resources[o];r.resources[o]={content:a.content,ref:a.ref}}}if(n.collections){r.collections={};for(const o in n.collections){const a={};r.collections[o]={resources:a};for(const c in n.collections[o].resources){const[l]=n.collections[o].resources[c];a[c]={content:l.content,ref:l.ref}}}}return r}async getActivityData(){if(!this.a)throw new Error("No settings sync store url configured.");const e=_(this.a,"download").toString(),s={},i=await this.D(e,{type:"GET",headers:s},[],Q.None);if(!Cn(i))throw new Ie("Server returned "+i.res.statusCode,e,"EmptyResponse",i.res.statusCode,i.res.headers[Os]);if(Yl(i))throw new Ie("Empty response",e,"EmptyResponse",i.res.statusCode,i.res.headers[Os]);return i.stream}z(e,s,i){return s?_(e,"collection",s,"resource",i):_(e,"resource",i)}C(){this.s.remove(Na,-1),this.s.remove(fu,-1)}async D(e,s,i,n){if(!this.b)throw new Ie("No Auth Token Available",e,"Unauthorized",void 0,void 0);if(this.j&&Date.now()<this.j.getTime())throw new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",void 0,void 0);this.y(void 0);const r=await this.c;s.headers={...s.headers||{},...r,"X-Account-Type":this.b.type,authorization:`Bearer ${this.b.token}`},this.F(s.headers),this.r.trace("Sending request to server",{url:e,type:s.type,headers:{...s.headers,authorization:void 0}});let o;try{o=await this.f.request(e,s,n)}catch(u){if(!(u instanceof Ie)){let f="RequestFailed";const p=se(u).toLowerCase();p.includes("xhr timeout")?f="RequestTimeout":p.includes("protocol")&&p.includes("not supported")?f="RequestProtocolNotSupported":p.includes("request path contains unescaped characters")?f="RequestPathNotEscaped":p.includes("headers must be an object")?f="RequestHeadersNotObject":Ts(u)&&(f="RequestCanceled"),u=new Ie(`Connection refused for the request '${e}'.`,e,f,void 0,void 0)}throw this.r.info("Request failed",e),u}const a=o.res.headers[Os],c={url:e,status:o.res.statusCode,"execution-id":s.headers[im],"operation-id":a},l=Cn(o)||o.res.statusCode&&i.includes(o.res.statusCode);let h="";if(l?this.r.trace("Request succeeded",c):(h=await eh(o)||"",this.r.info("Request failed",c,h)),o.res.statusCode===401||o.res.statusCode===403){if(this.b=void 0,o.res.statusCode===401)throw this.g.fire("Unauthorized"),new Ie(`${s.type} request '${e}' failed because of Unauthorized (401).`,e,"Unauthorized",o.res.statusCode,a);if(o.res.statusCode===403)throw this.g.fire("Forbidden"),new Ie(`${s.type} request '${e}' failed because the access is forbidden (403).`,e,"Forbidden",o.res.statusCode,a)}if(this.h.fire(),o.res.statusCode===404)throw new Ie(`${s.type} request '${e}' failed because the requested resource is not found (404).`,e,"NotFound",o.res.statusCode,a);if(o.res.statusCode===405)throw new Ie(`${s.type} request '${e}' failed because the requested endpoint is not found (405). ${h}`,e,"MethodNotFound",o.res.statusCode,a);if(o.res.statusCode===409)throw new Ie(`${s.type} request '${e}' failed because of Conflict (409). There is new data for this resource. Make the request again with latest data.`,e,"Conflict",o.res.statusCode,a);if(o.res.statusCode===410)throw new Ie(`${s.type} request '${e}' failed because the requested resource is not longer available (410).`,e,"Gone",o.res.statusCode,a);if(o.res.statusCode===412)throw new Ie(`${s.type} request '${e}' failed because of Precondition Failed (412). There is new data for this resource. Make the request again with latest data.`,e,"PreconditionFailed",o.res.statusCode,a);if(o.res.statusCode===413)throw new Ie(`${s.type} request '${e}' failed because of too large payload (413).`,e,"TooLarge",o.res.statusCode,a);if(o.res.statusCode===426)throw new Ie(`${s.type} request '${e}' failed with status Upgrade Required (426). Please upgrade the client and try again.`,e,"UpgradeRequired",o.res.statusCode,a);if(o.res.statusCode===429){const u=o.res.headers["retry-after"];throw u?(this.y(new Date(Date.now()+parseInt(u)*1e3)),new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",o.res.statusCode,a)):new Ie(`${s.type} request '${e}' failed because of too many requests (429).`,e,"RemoteTooManyRequests",o.res.statusCode,a)}if(!l)throw new Ie("Server returned "+o.res.statusCode,e,"Unknown",o.res.statusCode,a);return o}F(e){let s=this.s.get(fu,-1);s===void 0&&(s=st(),this.s.store(fu,s,-1,1)),e["X-Machine-Session-Id"]=s;const i=this.s.get(Na,-1);i!==void 0&&(e["X-User-Session-Id"]=i)}};pu=__decorate([__param(1,pe),__param(2,oi),__param(3,Re),__param(4,ae),__param(5,K),__param(6,ne)],pu);var gu=class extends pu{constructor(e,s,i,n,r,o,a){super(e.userDataSyncStore?.url,s,i,n,r,o,a),this.B(e.onDidChangeUserDataSyncStore(()=>this.t(e.userDataSyncStore?.url)))}};gu=__decorate([__param(0,li),__param(1,pe),__param(2,oi),__param(3,Re),__param(4,ae),__param(5,K),__param(6,ne)],gu);var e6=class{constructor(t,e,s,i){this.c=t,this.d=e,this.f=s,this.g=i,this.a=[],this.b=void 0}request(t,e,s){if(this.h()&&this.i(),e.url=t,this.a.length>=this.c)throw this.g.info("Too many requests",...this.a),new Ie(`Too many requests. Only ${this.c} requests allowed in ${this.d/(1e3*60)} minutes.`,t,"LocalTooManyRequests",void 0,void 0);return this.b=this.b||new Date,this.a.push(t),this.f.request(e,s)}h(){return this.b!==void 0&&new Date().getTime()-this.b.getTime()>this.d}i(){this.a=[],this.b=void 0}},t6=class{constructor(t){this.a=t}listen(t,e){switch(e){case"onDidChangeAccount":return this.a.onDidChangeAccount;case"onTokenFailed":return this.a.onTokenFailed}throw new Error(`[UserDataSyncAccountServiceChannel] Event not found: ${e}`)}call(t,e,s){switch(e){case"_getInitialData":return Promise.resolve(this.a.account);case"updateAccount":return this.a.updateAccount(s)}throw new Error("Invalid call")}},s6=class{constructor(t){this.a=t}listen(t,e){switch(e){case"onDidChangeUserDataSyncStore":return this.a.onDidChangeUserDataSyncStore}throw new Error(`[UserDataSyncStoreManagementServiceChannel] Event not found: ${e}`)}call(t,e,s){switch(e){case"switch":return this.a.switch(s[0]);case"getPreviousUserDataSyncStore":return this.a.getPreviousUserDataSyncStore()}throw new Error("Invalid call")}},hm=class extends ja{constructor(e,s,i,n){super(s,i,n),this.n=e,this.B(this.n.listen("onDidChangeUserDataSyncStore")(()=>this.j()))}async switch(e){return this.n.call("switch",[e])}async getPreviousUserDataSyncStore(){const e=await this.n.call("getPreviousUserDataSyncStore");return this.r(e)}r(e){return{url:k.revive(e.url),type:e.type,defaultUrl:k.revive(e.defaultUrl),insidersUrl:k.revive(e.insidersUrl),stableUrl:k.revive(e.stableUrl),canSwitch:e.canSwitch,authenticationProviders:e.authenticationProviders}}};hm=__decorate([__param(1,pe),__param(2,ge),__param(3,ne)],hm);var mu=class extends pr{constructor(e,s){super(),this.h=this.B(e.createLogger(_(s.logsHome,`${cm}.log`),{id:cm,name:v(2684,null)}))}trace(e,...s){this.h.trace(e,...s)}debug(e,...s){this.h.debug(e,...s)}info(e,...s){this.h.info(e,...s)}warn(e,...s){this.h.warn(e,...s)}error(e,...s){this.h.error(e,...s)}flush(){this.h.flush()}};mu=__decorate([__param(0,dr),__param(1,ae)],mu);var Wi,Ta=W("IUserDataSyncMachinesService"),wu="sync.currentMachineName",i6="Safari",n6="Chrome",r6="Edge",o6="Firefox",a6="Android";function um(){return qd?i6:_c?n6:Wd?r6:Vd?o6:dy?a6:Ud(ot?0:Zn)}var vu=class extends T{static{Wi=this}static{this.a=1}static{this.b="machines"}constructor(e,s,i,n,r,o){super(),this.h=i,this.j=n,this.m=r,this.n=o,this.c=this.B(new R),this.onDidChange=this.c.event,this.g=null,this.f=In(e,s,i)}async getMachines(e){const s=await this.f;return(await this.s(e)).machines.map(n=>({...n,isCurrent:n.id===s}))}async addCurrentMachine(e){const s=await this.f,i=await this.s(e);i.machines.some(({id:n})=>n===s)||(i.machines.push({id:s,name:this.r(i.machines),platform:um()}),await this.t(i))}async removeCurrentMachine(e){const s=await this.f,i=await this.s(e),n=i.machines.filter(({id:r})=>r!==s);n.length!==i.machines.length&&(i.machines=n,await this.t(i))}async renameMachine(e,s,i){const n=await this.s(i),r=n.machines.find(({id:o})=>o===e);if(r){r.name=s,await this.t(n);const o=await this.f;e===o&&this.h.store(wu,s,-1,1)}}async setEnablements(e){const s=await this.s();for(const[i,n]of e){const r=s.machines.find(o=>o.id===i);r&&(r.disabled=n?void 0:!0)}await this.t(s)}r(e){const s=this.h.get(wu,-1);if(s){if(!e.some(o=>o.name===s))return s;this.h.remove(wu,-1)}const i=`${this.n.embedderIdentifier?`${this.n.embedderIdentifier} - `:""}${um()} (${this.n.nameShort})`,n=new RegExp(`${ki(i)}\\s#(\\d+)`);let r=0;for(const o of e){const a=n.exec(o.name),c=a?parseInt(a[1]):0;r=c>r?c:r}return`${i} #${r+1}`}async s(e){this.g=await this.u(e);const s=this.w(this.g);if(s.version!==Wi.a)throw new Error(v(2685,null,this.n.nameLong));return s}async t(e){const s=JSON.stringify(e),i=await this.j.writeResource(Wi.b,s,this.g?.ref||null);this.g={ref:i,content:s},this.c.fire()}async u(e){if(this.g){const s=e&&e.latest?e.latest[Wi.b]:void 0;if(this.g.ref===s)return this.g;if(s===void 0&&this.g.content===null)return this.g}return this.j.readResource(Wi.b,this.g)}w(e){if(e.content!==null)try{return JSON.parse(e.content)}catch(s){this.m.error(s)}return{version:Wi.a,machines:[]}}};vu=Wi=__decorate([__param(0,ae),__param(1,K),__param(2,ne),__param(3,nt),__param(4,Re),__param(5,pe)],vu);var yu="sync.enable",bu=class extends T{constructor(e,s,i){super(),this.c=e,this.f=s,this.g=i,this.a=new R,this.onDidChangeEnablement=this.a.event,this.b=new R,this.onDidChangeResourceEnablement=this.b.event,this.B(e.onDidChangeValue(-1,void 0,this.q)(n=>this.j(n)))}isEnabled(){switch(this.f.sync){case"on":return!0;case"off":return!1}return this.c.getBoolean(yu,-1,!1)}canToggleEnablement(){return this.g.userDataSyncStore!==void 0&&this.f.sync===void 0}setEnablement(e){e&&!this.canToggleEnablement()||this.c.store(yu,e,-1,1)}isResourceEnabled(e,s){const i=this.c.getBoolean(Mr(e),-1);return s=s??e!=="prompts",i??s}isResourceEnablementConfigured(e){return this.c.getBoolean(Mr(e),-1)!==void 0}setResourceEnablement(e,s){if(this.isResourceEnabled(e)!==s){const i=Mr(e);this.h(i,s)}}getResourceSyncStateVersion(e){}h(e,s){this.c.store(e,s,-1,ot?0:1)}j(e){if(yu===e.key){this.a.fire(this.isEnabled());return}const s=Nn.filter(i=>Mr(i)===e.key)[0];if(s){this.b.fire([s,this.isResourceEnabled(s)]);return}}};bu=__decorate([__param(0,ne),__param(1,ae),__param(2,li)],bu);function c6(t){return!!(t&&t.ref!==void 0&&typeof t.ref=="string"&&t.ref!==""&&t.syncData!==void 0&&(t.syncData===null||Fr(t.syncData)))}function Fr(t){return!!(t&&t.version!==void 0&&typeof t.version=="number"&&t.content!==void 0&&typeof t.content=="string"&&(Object.keys(t).length===2||Object.keys(t).length===3&&t.machineId!==void 0&&typeof t.machineId=="string"))}function Ma(t,e){return`${Gc(t)}${e.isDefault?"":` (${e.name})`}`}var fm;(function(t){t.Preview="preview",t.Merge="merge",t.PullOrPush="pull-push"})(fm||(fm={}));var fi=class extends T{get status(){return this.m}get conflicts(){return{...this.syncResource,conflicts:this.s}}constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(),this.syncResource=e,this.collection=s,this.G=i,this.H=n,this.I=r,this.J=o,this.L=a,this.M=c,this.N=l,this.O=h,this.P=u,this.c=null,this.m="idle",this.n=this.B(new R),this.onDidChangeStatus=this.n.event,this.s=[],this.t=this.B(new R),this.onDidChangeConflicts=this.t.event,this.u=this.B(new Ii(50)),this.w=this.B(new R),this.onDidChangeLocal=this.w.event,this.C=!1,this.F={},this.z=`${s?`${s}.`:""}${e.syncResource}.lastSyncUserData`,this.resource=e.syncResource,this.D=Ma(e.syncResource,e.profile),this.h=f.extUri,this.f=this.h.joinPath(n.userDataSyncHome,...tm(e.profile.isDefault?void 0:e.profile.id,e.syncResource)),this.g=this.h.joinPath(this.f,K7),this.y=sm(e.profile.isDefault?void 0:e.profile.id,e.syncResource,n,this.h),this.j=In(n,i,r)}Q(){this.u.trigger(()=>this.R())}async R(){if(this.status==="hasConflicts"){this.O.info(`${this.D}: In conflicts state and local change detected. Syncing again...`);const e=await this.c;this.c=null;const s=await this.X(e.remoteUserData,e.lastSyncUserData,"merge",this.nb());this.S(s)}else{this.O.trace(`${this.D}: Checking for local changes...`);const e=await this.getLastSyncUserData();(e?await this.tb(e):!0)&&this.w.fire()}}S(e){this.m!==e&&(this.m=e,this.n.fire(e))}async sync(e,s=!1,i=this.nb(),n={}){try{if(this.F={...n},this.status==="hasConflicts")return this.O.info(`${this.D}: Skipped synchronizing ${this.resource.toLowerCase()} as there are conflicts.`),this.c;if(this.status==="syncing")return this.O.info(`${this.D}: Skipped synchronizing ${this.resource.toLowerCase()} as it is running already.`),this.c;this.O.trace(`${this.D}: Started synchronizing ${this.resource.toLowerCase()}...`),this.S("syncing");let r="idle";try{const o=await this.getLastSyncUserData(),a=await this.W(e,o);return r=await this.X(a,o,s?"preview":"merge",i),r==="hasConflicts"?this.O.info(`${this.D}: Detected conflicts while synchronizing ${this.resource.toLowerCase()}.`):r==="idle"&&this.O.trace(`${this.D}: Finished synchronizing ${this.resource.toLowerCase()}.`),this.c||null}finally{this.S(r)}}finally{this.F={}}}async apply(e,s={}){try{this.F={...s};const i=await this.$(e);return this.S(i),this.c}finally{this.F={}}}async replace(e){const s=this.jb(e);if(!s)return!1;await this.stop();try{this.O.trace(`${this.D}: Started resetting ${this.resource.toLowerCase()}...`),this.S("syncing");const i=await this.getLastSyncUserData(),n=await this.W(null,i),r=await this.U(n),o=await this.pb({ref:n.ref,syncData:s},i,r,this.nb(),Q.None),a=[];for(const c of o){const l=await this.rb(c,c.remoteResource,void 0,Q.None),{remoteChange:h}=await this.rb(c,c.previewResource,c.remoteContent,Q.None);a.push([c,{...l,remoteChange:h!==0?h:2}])}await this.sb(n,i,a,!1),this.O.info(`${this.D}: Finished resetting ${this.resource.toLowerCase()}.`)}finally{this.S("idle")}return!0}async U(e){const s=await this.j;return!!e.syncData?.machineId&&e.syncData.machineId===s}async W(e,s){return e===null?{ref:G7,syncData:null}:$e(e)?s?.ref===e?s:this.getRemoteUserData(s):this.ib(e)}async X(e,s,i,n){if(e.syncData&&e.syncData.version>this.ob)throw new Pe(v(2667,null,this.resource,this.ob,e.syncData.version),"IncompatibleLocalContent",this.resource);try{return await this.Y(e,s,i,n)}catch(r){if(r instanceof Pe)switch(r.code){case"LocalPreconditionFailed":return this.O.info(`${this.D}: Failed to synchronize ${this.D} as there is a new local version available. Synchronizing again...`),this.X(e,s,i,n);case"Conflict":case"PreconditionFailed":return this.O.info(`${this.D}: Failed to synchronize as there is a new remote version available. Synchronizing again...`),e=await this.getRemoteUserData(null),s=await this.getLastSyncUserData(),this.X(e,s,"merge",n)}throw r}}async Y(e,s,i,n){try{const r=await this.U(e),o=!r&&s===null&&this.fb()!==void 0,a=i==="preview"||i==="merge"&&!o,c=i==="merge"||i==="pull-push";this.c||(this.c=vt(h=>this.db(e,s,r,a,n,h)));let l=await this.c;if(i==="merge"&&o){this.O.info(`${this.D}: Accepting remote because it was synced before and the last sync data is not available.`);for(const h of l.resourcePreviews)l=await this.accept(h.remoteResource)||l}else if(i==="pull-push")for(const h of l.resourcePreviews)h.mergeState!=="accepted"&&(e.ref===s?.ref||r?l=await this.accept(h.localResource)??l:l=await this.accept(h.remoteResource)??l);return this.bb(l.resourcePreviews),l.resourcePreviews.some(({mergeState:h})=>h==="conflict")?"hasConflicts":c?await this.$(!1):"syncing"}catch(r){throw this.c=null,r}}async accept(e,s){return await this.Z(e,async i=>{const n=await this.rb(i,e,s,Q.None);return i.acceptResult=n,i.mergeState="accepted",i.localChange=n.localChange,i.remoteChange=n.remoteChange,i}),this.c}async discard(e){return await this.Z(e,async s=>{const i=await this.qb(s,Q.None);return await this.G.writeFile(s.previewResource,A.fromString(i.content||"")),s.acceptResult=void 0,s.mergeState="preview",s.localChange=i.localChange,s.remoteChange=i.remoteChange,s}),this.c}async Z(e,s){if(!this.c)return;let i=await this.c;const n=i.resourcePreviews.findIndex(({localResource:r,remoteResource:o,previewResource:a})=>this.h.isEqual(r,e)||this.h.isEqual(o,e)||this.h.isEqual(a,e));n!==-1&&(this.c=vt(async r=>{const o=[...i.resourcePreviews];return o[n]=await s(o[n]),{...i,resourcePreviews:o}}),i=await this.c,this.bb(i.resourcePreviews),i.resourcePreviews.some(({mergeState:r})=>r==="conflict")?this.S("hasConflicts"):this.S("syncing"))}async $(e){if(!this.c)return"idle";const s=await this.c;return s.resourcePreviews.some(({mergeState:i})=>i==="conflict")?"hasConflicts":s.resourcePreviews.some(({mergeState:i})=>i!=="accepted")?"syncing":(await this.sb(s.remoteUserData,s.lastSyncUserData,s.resourcePreviews.map(i=>[i,i.acceptResult]),e),this.c=null,await this.ab(),"idle")}async ab(){try{await this.G.del(this.g,{recursive:!0})}catch{}}bb(e){const s=e.filter(({mergeState:i})=>i==="conflict");Tt(this.s,s,(i,n)=>this.h.isEqual(i.previewResource,n.previewResource))||(this.s=s,this.t.fire(this.conflicts))}async hasPreviouslySynced(){const e=await this.getLastSyncUserData();return!!e&&e.syncData!==null}async cb(e){const s=this.c?await this.c:null;if(s)for(const i of s.resourcePreviews){if(this.h.isEqual(i.acceptedResource,e))return i.acceptResult?i.acceptResult.content:null;if(this.h.isEqual(i.remoteResource,e))return i.remoteContent;if(this.h.isEqual(i.localResource,e))return i.localContent;if(this.h.isEqual(i.baseResource,e))return i.baseContent}return null}async resetLocal(){this.I.remove(this.z,-1);try{await this.G.del(this.y)}catch(e){Me(e)!==1&&this.O.error(e)}}async db(e,s,i,n,r,o){const a=await this.pb(e,s,i,r,o),c=[];for(const l of a){const h=l.previewResource.with({scheme:I,authority:"accepted"});if(l.localChange===0&&l.remoteChange===0)c.push({...l,acceptedResource:h,acceptResult:{content:null,localChange:0,remoteChange:0},mergeState:"accepted"});else{const u=n?await this.qb(l,o):void 0;if(o.isCancellationRequested)break;await this.G.writeFile(l.previewResource,A.fromString(u?.content||""));const f=u&&!u.hasConflicts?await this.rb(l,l.previewResource,void 0,o):void 0;c.push({...l,acceptResult:f,mergeState:u?.hasConflicts?"conflict":f?"accepted":"preview",localChange:f?f.localChange:u?u.localChange:l.localChange,remoteChange:f?f.remoteChange:u?u.remoteChange:l.remoteChange})}}return{syncResource:this.resource,profile:this.syncResource.profile,remoteUserData:e,lastSyncUserData:s,resourcePreviews:c,isLastSyncFromCurrentMachine:i}}async getLastSyncUserData(){const e=this.fb();if(!e)return this.O.info(`${this.D}: Last sync data state does not exist.`),null;const s=JSON.parse(e),i=this.M.getResourceSyncStateVersion(this.resource);if(this.C=!!s.version&&!!i&&s.version!==i,this.C)return this.O.info(`${this.D}: Reset last sync state because last sync state version ${s.version} is not compatible with current sync state version ${i}.`),await this.resetLocal(),null;let n,r=1;for(;n===void 0&&r++<6;)try{const o=await this.gb();o&&(o.ref===s.ref?n=o.syncData:this.O.info(`${this.D}: Last sync data stored locally is not same as the last sync state.`));break}catch(o){if(o instanceof et&&o.fileOperationResult===1){this.O.info(`${this.D}: Last sync resource does not exist locally.`);break}else{if(o instanceof Pe)throw o;this.O.error(o,r)}}if(n===void 0)try{const o=await this.J.resolveResourceContent(this.resource,s.ref,this.collection,this.F);n=o===null?null:this.jb(o),await this.hb({ref:s.ref,syncData:n})}catch(o){if(o instanceof Pe&&o.code==="NotFound")this.O.info(`${this.D}: Last sync resource does not exist remotely.`);else throw o}return n===void 0?null:{...s,syncData:n}}async eb(e,s={}){if(s.ref||s.version)throw new Error("Cannot have core properties as additional");const i=this.M.getResourceSyncStateVersion(this.resource),n={ref:e.ref,version:i,...s};this.I.store(this.z,JSON.stringify(n),-1,1),await this.hb(e)}fb(){return this.I.get(this.z,-1)}async gb(){const e=(await this.G.readFile(this.y)).value.toString();try{const s=e?JSON.parse(e):void 0;if(c6(s))return s}catch(s){this.O.error(s)}}async hb(e){await this.G.writeFile(this.y,A.fromString(JSON.stringify(e)))}async getRemoteUserData(e){const s=await this.kb(e);return this.ib(s)}ib({ref:e,content:s}){let i=null;return s!==null&&(i=this.jb(s)),{ref:e,syncData:i}}jb(e){try{const s=JSON.parse(e);if(Fr(s))return s}catch(s){this.O.error(s)}throw new Pe(v(2668,null),"IncompatibleRemoteContent",this.resource)}async kb(e){const s=e?{ref:e.ref,content:e.syncData?JSON.stringify(e.syncData):null}:null;return this.J.readResource(this.resource,s,this.collection,this.F)}async lb(e,s){const i=await this.j,n={version:this.ob,machineId:i,content:e};try{return s=await this.J.writeResource(this.resource,JSON.stringify(n),s,this.collection,this.F),{ref:s,syncData:n}}catch(r){throw r instanceof Pe&&r.code==="TooLarge"&&(r=new Pe(r.message,r.code,this.resource)),r}}async mb(e){const s={version:this.ob,content:e};return this.L.writeResource(this.resource,JSON.stringify(s),new Date,this.syncResource.profile.isDefault?void 0:this.syncResource.profile.id)}async stop(){this.status!=="idle"&&(this.O.trace(`${this.D}: Stopping synchronizing ${this.resource.toLowerCase()}.`),this.c&&(this.c.cancel(),this.c=null),this.bb([]),await this.ab(),this.S("idle"),this.O.info(`${this.D}: Stopped synchronizing ${this.resource.toLowerCase()}.`))}nb(){return this.P.getValue(Ia)}};fi=__decorate([__param(2,K),__param(3,ae),__param(4,ne),__param(5,nt),__param(6,xt),__param(7,pt),__param(8,ke),__param(9,Re),__param(10,ge),__param(11,he)],fi);var Fa=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super(s,i,n,r,o,a,c,l,h,u,f,p),this.r=e,this.B(this.G.watch(this.h.dirname(e))),this.B(this.G.onDidFilesChange(g=>this.xb(g)))}async ub(){try{return await this.G.readFile(this.r)}catch{return null}}async vb(e,s,i){try{s?await this.G.writeFile(this.r,A.fromString(e),i?void 0:s):await this.G.createFile(this.r,A.fromString(e),{overwrite:i})}catch(n){throw n instanceof et&&n.fileOperationResult===1||n instanceof et&&n.fileOperationResult===3?new Pe(n.message,"LocalPreconditionFailed"):n}}async wb(){try{await this.G.del(this.r)}catch(e){if(!(e instanceof et&&e.fileOperationResult===1))throw e}}xb(e){e.contains(this.r)&&this.Q()}};Fa=__decorate([__param(3,K),__param(4,ae),__param(5,ne),__param(6,nt),__param(7,xt),__param(8,pt),__param(9,ke),__param(10,Re),__param(11,ge),__param(12,he)],Fa);var Ua=class extends Fa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e,s,i,n,r,o,a,c,l,h,u,p,g),this.yb=f,this.Ab=void 0}zb(e,s){const i=[],n=We(e,i,{allowEmptyContent:!0,allowTrailingComma:!0});return i.length>0||!rt(n)&&s!==Array.isArray(n)}Bb(){return this.Ab||(this.Ab=this.yb.resolveFormattingOptions(this.r)),this.Ab}};Ua=__decorate([__param(3,K),__param(4,ae),__param(5,ne),__param(6,nt),__param(7,xt),__param(8,pt),__param(9,ke),__param(10,Re),__param(11,La),__param(12,ge),__param(13,he)],Ua);var di=class{constructor(e,s,i,n,r,o,a){this.resource=e,this.g=s,this.h=i,this.j=n,this.k=r,this.l=o,this.d=a.extUri,this.f=sm(void 0,this.resource,i,this.d)}async initialize({ref:e,content:s}){if(!s){this.j.info("Remote content does not exist.",this.resource);return}const i=this.m(s);if(i)try{await this.o({ref:e,syncData:i})}catch(n){this.j.error(n)}}m(e){try{const s=JSON.parse(e);if(Fr(s))return s}catch(s){this.j.error(s)}this.j.info("Cannot parse sync data as it is not compatible with the current version.",this.resource)}async n(e,s={}){if(s.ref||s.version)throw new Error("Cannot have core properties as additional");const i={ref:e.ref,version:void 0,...s};this.l.store(`${this.resource}.lastSyncUserData`,JSON.stringify(i),-1,1),await this.k.writeFile(this.f,A.fromString(JSON.stringify(e)))}};di=__decorate([__param(1,je),__param(2,ae),__param(3,Y),__param(4,K),__param(5,ne),__param(6,he)],di);function Ba(t,e,s,i,n,r){const o=[],a=[],c=[];if(!e){const E=t.filter(({identifier:P})=>n.every(z=>z.toLowerCase()!==P.id.toLowerCase()));return{local:{added:o,removed:a,updated:c},remote:E.length>0?{added:E,updated:[],removed:[],all:E}:null}}t=t.map(Eu),e=e.map(Eu),s=s?s.map(Eu):null;const l=new Map,h=E=>{E.uuid&&l.set(E.id.toLowerCase(),E.uuid)};t.forEach(({identifier:E})=>h(E)),e.forEach(({identifier:E})=>h(E)),s?.forEach(({identifier:E})=>h(E)),i?.forEach(({identifier:E})=>h(E)),r?.forEach(E=>h(E));const u=E=>{const P=E.identifier.uuid||l.get(E.identifier.id.toLowerCase());return P?`uuid:${P}`:`id:${E.identifier.id.toLowerCase()}`},f=(E,P)=>(E.set(u(P),P),E),p=t.reduce(f,new Map),g=e.reduce(f,new Map),m=e.reduce((E,P)=>f(E,qt(P)),new Map),w=s?s.reduce(f,new Map):null,b=i.reduce(f,new Map),S=n.reduce((E,P)=>{const z=l.get(P.toLowerCase());return E.add(z?`uuid:${z}`:`id:${P.toLowerCase()}`)},new Set),$=r?r.reduce((E,{id:P,uuid:z})=>(z=z??l.get(P.toLowerCase()),E.add(z?`uuid:${z}`:`id:${P.toLowerCase()}`)),new Set):null,U=za(p,g,S,!1);if(U.added.size>0||U.removed.size>0||U.updated.size>0){const E=za(w,p,S,!1),P=za(w,g,S,!0),z=(B,j,O,D)=>{let M,F,V;return j.installed?(M=D.pinned,V=D.preRelease,M&&(F=D.version)):(M=O.pinned,V=O.preRelease,M&&(F=O.version)),M===void 0&&(M=j.pinned,M&&(F=j.version)),V===void 0&&(V=j.preRelease),{...D,installed:j.installed||O.installed,pinned:M,preRelease:V,version:F??(O.version&&(!j.installed||la(O.version,j.version))?O.version:j.version),state:l6(j,O,w?.get(B))}};for(const B of P.removed.values()){const j=p.get(B);if(!j)continue;const O=ls(w?.get(B)),D=$&&!$.has(B)&&O.installed;j.installed&&D?a.push(j.identifier):m.set(B,j)}for(const B of P.added.values()){const j=ls(g.get(B)),O=p.get(B);if(O){if(U.updated.has(B)){const D=z(B,O,j,j);dm(O,j,!1,!1)||c.push(Ur(D,B)),m.set(B,D)}}else j.installed&&o.push(Ur(j,B))}for(const B of P.updated.values()){const j=ls(g.get(B)),O=ls(w?.get(B)),D=p.get(B);if(D)if($&&!$.has(B)&&O.installed&&D.installed&&!j.installed)a.push(D.identifier);else{const F=z(B,D,j,j);c.push(Ur(F,B)),m.set(B,F)}else j.installed&&o.push(Ur(j,B))}for(const B of E.added.values())P.added.has(B)||m.set(B,ls(p.get(B)));for(const B of E.updated.values()){if(P.removed.has(B)||P.updated.has(B))continue;const j=ls(p.get(B)),O=ls(g.get(B));m.set(B,z(B,j,O,j))}for(const B of E.removed.values())P.updated.has(B)||P.removed.has(B)||b.has(B)||ls(g.get(B)).installed&&$&&($.has(B)||!ls(w?.get(B)).installed||m.delete(B))}const q=[],me=za(g,m,new Set,!0),N=me.added.size>0||me.updated.size>0||me.removed.size>0;return N&&m.forEach((E,P)=>q.push(Ur(E,P))),{local:{added:o,removed:a,updated:c},remote:N?{added:[...me.added].map(E=>m.get(E)),updated:[...me.updated].map(E=>m.get(E)),removed:[...me.removed].map(E=>g.get(E)),all:q}:null}}function za(t,e,s,i){const n=t?[...t.keys()].filter(l=>!s.has(l)):[],r=[...e.keys()].filter(l=>!s.has(l)),o=r.filter(l=>!n.includes(l)).reduce((l,h)=>(l.add(h),l),new Set),a=n.filter(l=>!r.includes(l)).reduce((l,h)=>(l.add(h),l),new Set),c=new Set;for(const l of n){if(a.has(l))continue;const h=t.get(l),u=e.get(l);(!u||!dm(h,u,i,!0))&&c.add(l)}return{added:o,removed:a,updated:c}}function dm(t,e,s,i){return!(t.disabled!==e.disabled||!!t.isApplicationScoped!=!!e.isApplicationScoped||i&&t.installed!==e.installed||t.installed&&e.installed&&(t.preRelease!==e.preRelease||t.pinned!==e.pinned||e.pinned&&t.version!==e.version)||!h6(t.state,e.state)||s&&t.version!==e.version)}function l6(t,e,s){const i=t.state,n=e.state,r=s?.state;if(!e.version||i&&la(t.version,e.version))return i;if(n&&la(e.version,t.version)||!i)return n;if(!n)return i;const o=qt(i),a=r?Su(r,n):{added:Object.keys(n).reduce((l,h)=>(l.add(h),l),new Set),removed:new Set,updated:new Set},c=r?Su(r,i):{added:Object.keys(i).reduce((l,h)=>(l.add(h),l),new Set),removed:new Set,updated:new Set};for(const l of[...a.added.values(),...a.updated.values()])o[l]=n[l];for(const l of a.removed.values())c.updated.has(l)||delete o[l];return o}function Su(t,e){const s=Object.keys(t),i=Object.keys(e),n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];yt(c,l)||o.add(a)}return{added:n,removed:r,updated:o}}function h6(t={},e={}){const{added:s,removed:i,updated:n}=Su(t,e);return s.size===0&&i.size===0&&n.size===0}function Eu(t){return{...t,disabled:!!t.disabled,installed:!!t.installed}}function Ur(t,e){const s={...t,identifier:{id:t.identifier.id,uuid:e.startsWith("uuid:")?e.substring(5):void 0},preRelease:!!t.preRelease,pinned:!!t.pinned};return t.disabled||delete s.disabled,t.installed||delete s.installed,t.state||delete s.state,t.isApplicationScoped||delete s.isApplicationScoped,s}var Br=W("IUserDataProfileStorageService"),$u=class extends T{constructor(e,s){super(),this.b=s,e&&(this.a=this.B(new po))}async readStorageData(e){return this.withProfileScopedStorageService(e,async s=>this.c(s))}async updateStorageData(e,s,i){return this.withProfileScopedStorageService(e,async n=>this.f(n,s,i))}async withProfileScopedStorageService(e,s){if(this.b.hasScope(e))return s(this.b);let i=this.a?.get(e.id);if(!i){i=new f6(this.g(e)),this.a?.set(e.id,i);try{await i.initialize()}catch(n){throw this.a?.has(e.id)?this.a.deleteAndDispose(e.id):i.dispose(),n}}try{const n=await s(i);return await i.flush(),n}finally{this.a?.has(e.id)||i.dispose()}}c(e){const s=new Map,i=n=>{for(const r of e.keys(0,n))s.set(r,{value:e.get(r,0),target:n})};return i(0),i(1),s}f(e,s,i){e.storeAll(Array.from(s.entries()).map(([n,r])=>({key:n,value:r,scope:0,target:i})),!0)}};$u=__decorate([__param(1,ne)],$u);var u6=class extends $u{constructor(t,e,s,i,n){super(t,i),this.j=e;const r=e.getChannel("profileStorageListener"),o=this.B(new hs);this.h=this.B(new R({onWillAddFirstListener:()=>{o.value=r.listen("onDidChange")(a=>{n.trace("profile storage changes",a),this.h.fire({targetChanges:a.targetChanges.map(c=>Yt(c,s.profilesHome.scheme)),valueChanges:a.valueChanges.map(c=>({...c,profile:Yt(c.profile,s.profilesHome.scheme)}))})})},onDidRemoveLastListener:()=>o.value=void 0})),this.onDidChange=this.h.event}async g(t){const e=this.j.getChannel("storage");return oa(t)?new Ap(e):new Np(e,t)}},f6=class extends zg{constructor(t){super({flushInterval:100}),this.s=t}async O(){const t=await this.s,e=new ia(t);return this.B(e.onDidChangeStorage(s=>{this.u(0,s)})),this.B(de(()=>{e.close(),e.dispose(),Uc(t)&&t.dispose()})),this.c=e,this.c.init()}P(t){return t===0?this.c:void 0}Q(){}async R(){}async S(){}hasScope(){return!1}};async function _a(t,e){const s=JSON.parse(t.content);if(t.version===1||t.version===2){const i=(await e.getInstalled(0)).filter(n=>n.isBuiltin);for(const n of s)t.version===1&&(n.enabled===!1&&(n.disabled=!0),delete n.enabled),t.version===2&&i.every(r=>!G(r.identifier,n.identifier))&&(n.installed=!0)}return s}function d6(t){return JSON.parse(t.content)}function xu(t,e){return t.sort((s,i)=>!s.identifier.uuid&&i.identifier.uuid?-1:s.identifier.uuid&&!i.identifier.uuid?1:So(s.identifier.id,i.identifier.id)),e?Sr(t,{}):JSON.stringify(t)}var ku=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g,m,w,b){super({syncResource:"extensions",profile:e},s,n,i,r,o,a,f,p,h,u,m),this.Bb=c,this.Cb=l,this.Db=b,this.ob=6,this.vb=this.h.joinPath(this.g,"extensions.json"),this.wb=this.vb.with({scheme:I,authority:"base"}),this.xb=this.vb.with({scheme:I,authority:"local"}),this.yb=this.vb.with({scheme:I,authority:"remote"}),this.zb=this.vb.with({scheme:I,authority:"accepted"}),this.Ab=this.Db.createInstance(Va),this.B(L.any(L.filter(this.Bb.onDidInstallExtensions,S=>S.some(({local:$})=>!!$)),L.filter(this.Bb.onDidUninstallExtension,S=>!S.error),L.filter(w.onDidChange,S=>S.valueChanges.some(({profile:$,changes:U})=>this.syncResource.profile.id===$.id&&U.some(q=>q.key===kl))),g.onDidChangeExtensionStorageToSync)(()=>this.Q()))}async pb(e,s){const i=e.syncData?await _a(e.syncData,this.Bb):null,n=s?.skippedExtensions??[],r=s?.builtinExtensions??null,o=s?.syncData?await _a(s.syncData,this.Bb):null,{localExtensions:a,ignoredExtensions:c}=await this.Ab.getLocalExtensions(this.syncResource.profile);i?this.O.trace(`${this.D}: Merging remote extensions with local extensions...`):this.O.trace(`${this.D}: Remote extensions does not exist. Synchronizing extensions for the first time.`);const{local:l,remote:h}=Ba(a,i,o,n,c,r),u={local:l,remote:h,content:this.Gb(a,l.added,l.updated,l.removed),localChange:l.added.length>0||l.removed.length>0||l.updated.length>0?2:0,remoteChange:h!==null?2:0},f=this.Nb(a,!1);return[{skippedExtensions:n,builtinExtensions:r,baseResource:this.wb,baseContent:o?this.Nb(o,!1):f,localResource:this.xb,localContent:f,localExtensions:a,remoteResource:this.yb,remoteExtensions:i,remoteContent:i?this.Nb(i,!1):null,previewResource:this.vb,previewResult:u,localChange:u.localChange,remoteChange:u.remoteChange,acceptedResource:this.zb}]}async tb(e){const s=e.syncData?await _a(e.syncData,this.Bb):null,{localExtensions:i,ignoredExtensions:n}=await this.Ab.getLocalExtensions(this.syncResource.profile),{remote:r}=Ba(i,s,s,e.skippedExtensions||[],n,e.builtinExtensions||[]);return r!==null}Gb(e,s,i,n){const r=[...s,...i],o=new Set,a=c=>{o.add(c.id.toLowerCase()),c.uuid&&o.add(c.uuid)};r.forEach(({identifier:c})=>a(c)),n.forEach(a);for(const c of e)o.has(c.identifier.id.toLowerCase())||c.identifier.uuid&&o.has(c.identifier.uuid)||r.push(c);return this.Nb(r,!1)}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.xb))return this.Jb(e);if(this.h.isEqual(s,this.yb))return this.Kb(e);if(this.h.isEqual(s,this.vb))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async Jb(e){const s=await this.Bb.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.Cb.getIgnoredExtensions(s),n=e.remoteContent?JSON.parse(e.remoteContent):null,r=Ba(e.localExtensions,n,n,e.skippedExtensions,i,e.builtinExtensions),{local:o,remote:a}=r;return{content:e.localContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}async Kb(e){const s=await this.Bb.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.Cb.getIgnoredExtensions(s),n=e.remoteContent?JSON.parse(e.remoteContent):null;if(n!==null){const r=Ba(e.localExtensions,n,e.localExtensions,[],i,e.builtinExtensions),{local:o,remote:a}=r;return{content:e.remoteContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async sb(e,s,i,n){let{skippedExtensions:r,builtinExtensions:o,localExtensions:a}=i[0][0];const{local:c,remote:l,localChange:h,remoteChange:u}=i[0][1];if(h===0&&u===0&&this.O.info(`${this.D}: No changes found during synchronizing extensions.`),h!==0&&(await this.mb(JSON.stringify(a)),r=await this.Ab.updateLocalExtensions(c.added,c.removed,c.updated,r,this.syncResource.profile)),l){this.O.trace(`${this.D}: Updating remote extensions...`);const f=JSON.stringify(l.all);e=await this.lb(f,n?null:e.ref),this.O.info(`${this.D}: Updated remote extensions.${l.added.length?` Added: ${JSON.stringify(l.added.map(p=>p.identifier.id))}.`:""}${l.updated.length?` Updated: ${JSON.stringify(l.updated.map(p=>p.identifier.id))}.`:""}${l.removed.length?` Removed: ${JSON.stringify(l.removed.map(p=>p.identifier.id))}.`:""}`)}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized extensions...`),o=this.Mb(a,o),await this.eb(e,{skippedExtensions:r,builtinExtensions:o}),this.O.info(`${this.D}: Updated last synchronized extensions.${r.length?` Skipped: ${JSON.stringify(r.map(f=>f.identifier.id))}.`:""}`))}Mb(e,s){const i=new Set,n=[];for(const r of e)i.add(r.identifier.id.toLowerCase()),r.installed||n.push(r.identifier);if(s)for(const r of s)i.has(r.id.toLowerCase())||n.push(r);return n}async resolveContent(e){if(this.h.isEqual(this.yb,e)||this.h.isEqual(this.wb,e)||this.h.isEqual(this.xb,e)||this.h.isEqual(this.zb,e)){const s=await this.cb(e);return s&&this.Nb(JSON.parse(s),!0)}return null}Nb(e,s){return xu(e,s)}async hasLocalData(){try{const{localExtensions:e}=await this.Ab.getLocalExtensions(this.syncResource.profile);if(e.some(s=>s.installed||s.disabled))return!0}catch{}return!1}};ku=__decorate([__param(2,ae),__param(3,K),__param(4,ne),__param(5,nt),__param(6,xt),__param(7,Hs),__param(8,Da),__param(9,Re),__param(10,ge),__param(11,pt),__param(12,ke),__param(13,eu),__param(14,he),__param(15,Br),__param(16,is)],ku);var Va=class{constructor(e,s,i,n,r,o){this.a=e,this.b=s,this.c=i,this.d=n,this.f=r,this.g=o}async getLocalExtensions(e){const s=await this.a.getInstalled(void 0,e.extensionsResource),i=this.d.getIgnoredExtensions(s);return{localExtensions:await this.j(e,async(r,o)=>{const a=r.getDisabledExtensions();return s.map(c=>{const{identifier:l,isBuiltin:h,manifest:u,preRelease:f,pinned:p,isApplicationScoped:g}=c,m={identifier:l,preRelease:f,version:u.version,pinned:!!p};g&&!ih(u)&&(m.isApplicationScoped=g),a.some(w=>G(w,l))&&(m.disabled=!0),h||(m.installed=!0);try{const w=o.getKeysForSync({id:l.id,version:u.version});if(w){const b=o.getExtensionState(c,!0)||{};m.state=Object.keys(b).reduce((S,$)=>(w.includes($)&&(S[$]=b[$]),S),{})}}catch(w){this.g.info(`${Ma("extensions",e)}: Error while parsing extension state`,se(w))}return m})}),ignoredExtensions:i}}async updateLocalExtensions(e,s,i,n,r){const o=Ma("extensions",r),a=[],c=new Map,l=[],h=[],u=await this.a.getInstalled(void 0,r.extensionsResource);if((e.length||i.length)&&await this.j(r,async(g,m)=>{await Ze.settled([...e,...i].map(async w=>{const b=u.find(U=>G(U.identifier,w.identifier));if(b&&b.isBuiltin){w.state&&b.manifest.version===w.version&&this.h(w.state,b,b.manifest.version,m),g.getDisabledExtensions().some(q=>G(q,w.identifier))!==!!w.disabled&&(w.disabled?(this.g.trace(`${o}: Disabling extension...`,w.identifier.id),await g.disableExtension(w.identifier),this.g.info(`${o}: Disabled extension`,w.identifier.id)):(this.g.trace(`${o}: Enabling extension...`,w.identifier.id),await g.enableExtension(w.identifier),this.g.info(`${o}: Enabled extension`,w.identifier.id))),l.push(w.identifier);return}const S=w.pinned?w.version:void 0,$=(await this.c.getExtensions([{...w.identifier,version:S,preRelease:S?void 0:w.preRelease}],Q.None))[0];if(w.state&&(b?b.manifest.version===w.version:$)&&this.h(w.state,b||$,b?.manifest.version,m),$)try{g.getDisabledExtensions().some(q=>G(q,w.identifier))!==!!w.disabled&&(w.disabled?(this.g.trace(`${o}: Disabling extension...`,w.identifier.id,$.version),await g.disableExtension($.identifier),this.g.info(`${o}: Disabled extension`,w.identifier.id,$.version)):(this.g.trace(`${o}: Enabling extension...`,w.identifier.id,$.version),await g.enableExtension($.identifier),this.g.info(`${o}: Enabled extension`,w.identifier.id,$.version))),(!b||b.preRelease!==w.preRelease||b.pinned!==w.pinned||S&&b.manifest.version!==S)&&(await this.a.canInstall($)===!0?(a.push({extension:$,options:{isMachineScoped:!1,donotIncludePackAndDependencies:!0,installGivenVersion:w.pinned&&!!w.version,pinned:w.pinned,installPreReleaseVersion:w.preRelease,preRelease:w.preRelease,profileLocation:r.extensionsResource,isApplicationScoped:w.isApplicationScoped,context:{[f2]:!0,[xl]:"settingsSync",[$l]:!0}}}),c.set($.identifier.id.toLowerCase(),w)):(this.g.info(`${o}: Skipped synchronizing extension because it cannot be installed.`,$.displayName||$.identifier.id),h.push(w)))}catch(U){h.push(w),this.g.error(U),this.g.info(`${o}: Skipped synchronizing extension`,$.displayName||$.identifier.id)}else h.push(w),this.g.info(`${o}: Skipped synchronizing extension because the extension is not found.`,w.identifier.id)}))}),s.length){const g=u.filter(({identifier:m,isBuiltin:w})=>!w&&s.some(b=>G(m,b)));await Ze.settled(g.map(async m=>{this.g.trace(`${o}: Uninstalling local extension...`,m.identifier.id),await this.a.uninstall(m,{donotIncludePack:!0,donotCheckDependents:!0,profileLocation:r.extensionsResource}),this.g.info(`${o}: Uninstalled local extension.`,m.identifier.id),l.push(m.identifier)}))}const f=await this.a.installGalleryExtensions(a);for(const{identifier:g,local:m,error:w,source:b}of f){const S=b;if(m)this.g.info(`${o}: Installed extension.`,g.id,S.version),l.push(g);else{const $=c.get(g.id.toLowerCase());$&&(h.push($),this.g.info(`${o}: Skipped synchronizing extension`,S.displayName||S.identifier.id)),w instanceof Te&&["Incompatible","IncompatibleApi","IncompatibleTargetPlatform"].includes(w.code)?this.g.info(`${o}: Skipped synchronizing extension because the compatible extension is not found.`,S.displayName||S.identifier.id):w&&this.g.error(w)}}const p=[];for(const g of n)l.some(m=>G(m,g.identifier))||p.push(g);for(const g of h)p.some(m=>G(m.identifier,g.identifier))||p.push(g);return p}h(e,s,i,n){const r=n.getExtensionState(s,!0)||{},o=i?n.getKeysForSync({id:s.identifier.id,version:i}):void 0;o?o.forEach(a=>{r[a]=e[a]}):Object.keys(e).forEach(a=>r[a]=e[a]),n.setExtensionState(s,r,!0)}async j(e,s){return this.b.withProfileScopedStorageService(e,async i=>{const n=new De,r=n.add(this.f.createChild(new Jh([ne,i]))),o=n.add(r.createInstance(aa)),a=n.add(r.createInstance(Tr));try{return await s(o,a)}finally{n.dispose()}})}};Va=__decorate([__param(0,Hs),__param(1,Br),__param(2,Es),__param(3,Da),__param(4,is),__param(5,Re)],Va);var pm=class extends di{constructor(e,s,i,n,r,o,a,c){super("extensions",n,r,o,i,a,c),this.p=e,this.q=s}async t(e){return e.syncData?await _a(e.syncData,this.p):null}u(e,s){const i=[],n=[],r=[];for(const o of e){if(this.q.hasToNeverSyncExtension(o.identifier.id))continue;const a=s.find(c=>G(c.identifier,o.identifier));a?(i.push(a),o.disabled&&r.push(o.identifier)):o.installed&&(n.push({...o.identifier,preRelease:!!o.preRelease}),o.disabled&&r.push(o.identifier))}return{installedExtensions:i,newExtensions:n,disabledExtensions:r,remoteExtensions:e}}};pm=__decorate([__param(0,Hs),__param(1,Da),__param(2,K),__param(3,je),__param(4,ae),__param(5,Y),__param(6,ne),__param(7,he)],pm);function Gt(t,e,s,i){const n=_l(t,e,s,i)[0];return n&&(t=t.substring(0,n.offset)+n.content+t.substring(n.offset+n.length)),t}function qa(t,e,s,i,n){if(!e)return{remote:{added:Object.keys(t),removed:[],updated:[],all:Object.keys(t).length>0?t:null},local:{added:{},removed:[],updated:{}}};const r=Wa(t,e);if(r.added.size===0&&r.removed.size===0&&r.updated.size===0)return{remote:{added:[],removed:[],updated:[],all:null},local:{added:{},removed:[],updated:{}}};const o=s?Wa(s,e):{added:Object.keys(e).reduce((f,p)=>(f.add(p),f),new Set),removed:new Set,updated:new Set},a=s?Wa(s,t):{added:Object.keys(t).reduce((f,p)=>(f.add(p),f),new Set),removed:new Set,updated:new Set},c={added:{},removed:[],updated:{}},l=qt(e),h=!s;for(const f of a.added.values())f!==ui&&h&&o.added.has(f)||(l[f]=t[f]);for(const f of a.updated.values())l[f]=t[f];for(const f of a.removed.values())i.unregistered.includes(f)||delete l[f];for(const f of o.added.values()){const p=e[f];if(i.machine.includes(f)){n.info(`GlobalState: Skipped adding ${f} in local storage because it is declared as machine scoped.`);continue}if(s&&a.added.has(f))continue;const g=t[f];g&&g.value===p.value||f===ui&&h&&a.added.has(f)||(g?c.updated[f]=p:c.added[f]=p)}for(const f of o.updated.values()){const p=e[f];if(i.machine.includes(f)){n.info(`GlobalState: Skipped updating ${f} in local storage because it is declared as machine scoped.`);continue}if(a.updated.has(f)||a.removed.has(f))continue;const g=t[f];g&&g.value===p.value||(c.updated[f]=p)}for(const f of o.removed.values()){if(i.machine.includes(f)){n.trace(`GlobalState: Skipped removing ${f} in local storage because it is declared as machine scoped.`);continue}a.updated.has(f)||a.removed.has(f)||c.removed.push(f)}const u=Wa(e,l);return{local:c,remote:{added:[...u.added],updated:[...u.updated],removed:[...u.removed],all:u.added.size===0&&u.removed.size===0&&u.updated.size===0?null:l}}}function Wa(t,e){const s=Object.keys(t),i=Object.keys(e),n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];yt(c,l)||o.add(a)}return{added:n,removed:r,updated:o}}var Hi="globalState.argv.",p6=["locale"];function Gi(t,e){const s=t.storage?Object.keys(t.storage).sort():[],i={};return s.forEach(n=>i[n]=t.storage[n]),t.storage=i,e?Sr(t,{}):JSON.stringify(t)}var Pu=1,Ru=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super({syncResource:"globalState",profile:e},s,n,c,f,r,o,l,h,a,u,p),this.Ab=i,this.ob=Pu,this.ub=this.h.joinPath(this.g,"globalState.json"),this.vb=this.ub.with({scheme:I,authority:"base"}),this.wb=this.ub.with({scheme:I,authority:"local"}),this.xb=this.ub.with({scheme:I,authority:"remote"}),this.yb=this.ub.with({scheme:I,authority:"accepted"}),this.zb=g.createInstance(Ha),this.B(n.watch(this.h.dirname(this.H.argvResource))),this.B(L.any(L.filter(n.onDidFilesChange,m=>m.contains(this.H.argvResource)),L.filter(i.onDidChange,m=>!!(m.targetChanges.some(w=>this.syncResource.profile.id===w.id)||m.valueChanges.some(({profile:w,changes:b})=>this.syncResource.profile.id===w.id&&b.some(S=>S.target===0)))))(()=>this.Q()))}async pb(e,s,i){const n=e.syncData?JSON.parse(e.syncData.content):null;s=s===null&&i?e:s;const r=s&&s.syncData?JSON.parse(s.syncData.content):null,o=await this.zb.getLocalGlobalState(this.syncResource.profile);n?this.O.trace(`${this.D}: Merging remote ui state with local ui state...`):this.O.trace(`${this.D}: Remote ui state does not exist. Synchronizing ui state for the first time.`);const a=await this.Ib(r),{local:c,remote:l}=qa(o.storage,n?n.storage:null,r?r.storage:null,a,this.O),h={content:null,local:c,remote:l,localChange:Object.keys(c.added).length>0||Object.keys(c.updated).length>0||c.removed.length>0?2:0,remoteChange:l.all!==null?2:0},u=Gi(o,!1);return[{baseResource:this.vb,baseContent:r?Gi(r,!1):u,localResource:this.wb,localContent:u,localUserData:o,remoteResource:this.xb,remoteContent:n?Gi(n,!1):null,previewResource:this.ub,previewResult:h,localChange:h.localChange,remoteChange:h.remoteChange,acceptedResource:this.yb,storageKeys:a}]}async tb(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(s===null)return!0;const i=await this.zb.getLocalGlobalState(this.syncResource.profile),n=await this.Ib(s),{remote:r}=qa(i.storage,s.storage,s.storage,n,this.O);return r.all!==null}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.wb))return this.Fb(e);if(this.h.isEqual(s,this.xb))return this.Gb(e);if(this.h.isEqual(s,this.ub))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async Fb(e){if(e.remoteContent!==null){const s=JSON.parse(e.remoteContent),{local:i,remote:n}=qa(e.localUserData.storage,s.storage,s.storage,e.storageKeys,this.O);return{content:e.remoteContent,local:i,remote:n,localChange:0,remoteChange:n.all!==null?2:0}}else return{content:e.localContent,local:{added:{},removed:[],updated:{}},remote:{added:Object.keys(e.localUserData.storage),removed:[],updated:[],all:e.localUserData.storage},localChange:0,remoteChange:2}}async Gb(e){if(e.remoteContent!==null){const s=JSON.parse(e.remoteContent),{local:i,remote:n}=qa(e.localUserData.storage,s.storage,e.localUserData.storage,e.storageKeys,this.O);return{content:e.remoteContent,local:i,remote:n,localChange:Object.keys(i.added).length>0||Object.keys(i.updated).length>0||i.removed.length>0?2:0,remoteChange:0}}else return{content:e.remoteContent,local:{added:{},removed:[],updated:{}},remote:{added:[],removed:[],updated:[],all:null},localChange:0,remoteChange:0}}async sb(e,s,i,n){const{localUserData:r}=i[0][0],{local:o,remote:a,localChange:c,remoteChange:l}=i[0][1];if(c===0&&l===0&&this.O.info(`${this.D}: No changes found during synchronizing ui state.`),c!==0&&(this.O.trace(`${this.D}: Updating local ui state...`),await this.mb(JSON.stringify(r)),await this.zb.writeLocalGlobalState(o,this.syncResource.profile),this.O.info(`${this.D}: Updated local ui state`)),l!==0){this.O.trace(`${this.D}: Updating remote ui state...`);const h=JSON.stringify({storage:a.all});e=await this.lb(h,n?null:e.ref),this.O.info(`${this.D}: Updated remote ui state.${a.added.length?` Added: ${a.added}.`:""}${a.updated.length?` Updated: ${a.updated}.`:""}${a.removed.length?` Removed: ${a.removed}.`:""}`)}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized ui state...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized ui state`))}async resolveContent(e){if(this.h.isEqual(this.xb,e)||this.h.isEqual(this.vb,e)||this.h.isEqual(this.wb,e)||this.h.isEqual(this.yb,e)){const s=await this.cb(e);return s&&Gi(JSON.parse(s),!0)}return null}async hasLocalData(){try{const{storage:e}=await this.zb.getLocalGlobalState(this.syncResource.profile);if(Object.keys(e).length>1||e[`${Hi}.locale`]?.value!=="en")return!0}catch{}return!1}async Ib(e){const s=await this.Ab.readStorageData(this.syncResource.profile),i=[],n=[];for(const[a,c]of s)c.target===0?i.push(a):c.target===1&&n.push(a);const r=[...i,...n],o=e?.storage?Object.keys(e.storage).filter(a=>!a.startsWith(Hi)&&!r.includes(a)&&s.get(a)!==void 0):[];if(!ot){const a=[...Nn.map(c=>Mr(c)),ui];o.push(...a),n.push(...a)}return{user:i,machine:n,unregistered:o}}};Ru=__decorate([__param(2,Br),__param(3,K),__param(4,nt),__param(5,xt),__param(6,Re),__param(7,ae),__param(8,pt),__param(9,ke),__param(10,ge),__param(11,ne),__param(12,he),__param(13,is)],Ru);var Ha=class{constructor(e,s,i,n){this.a=e,this.b=s,this.c=i,this.d=n}async getLocalGlobalState(e){const s={};if(e.isDefault){const n=await this.f(),r=We(n);for(const o of p6)r[o]!==void 0&&(s[`${Hi}${o}`]={version:1,value:r[o]})}const i=await this.c.readStorageData(e);for(const[n,r]of i)r.value&&r.target===0&&(s[n]={version:1,value:r.value});return{storage:s}}async f(){try{this.d.debug("GlobalStateSync#getLocalArgvContent",this.b.argvResource);const e=await this.a.readFile(this.b.argvResource);return this.d.debug("GlobalStateSync#getLocalArgvContent - Resolved",this.b.argvResource),e.value.toString()}catch(e){this.d.debug(se(e))}return"{}"}async writeLocalGlobalState({added:e,removed:s,updated:i},n){const r=Ma("globalState",n),o={},a=new Map,c=await this.c.readStorageData(n),l=(h,u)=>{for(const f of h){if(f.startsWith(Hi)){o[f.substring(Hi.length)]=u?u[f].value:void 0;continue}if(u){const p=u[f];p.value!==c.get(f)?.value&&a.set(f,p.value)}else c.get(f)!==void 0&&a.set(f,void 0)}};if(l(Object.keys(e),e),l(Object.keys(i),i),l(s),Object.keys(o).length){this.d.trace(`${r}: Updating locale...`);const h=await this.f();let u=h;for(const f of Object.keys(o))u=Gt(u,[f],o[f],{});h!==u&&(this.d.trace(`${r}: Updating locale...`),await this.a.writeFile(this.b.argvResource,A.fromString(u)),this.d.info(`${r}: Updated locale.`)),this.d.info(`${r}: Updated locale`)}a.size&&(this.d.trace(`${r}: Updating global state...`),await this.c.updateStorageData(n,a,0),this.d.info(`${r}: Updated global state`,[...a.keys()]))}};Ha=__decorate([__param(0,K),__param(1,ae),__param(2,Br),__param(3,Re)],Ha);var gm=class extends di{constructor(e,s,i,n,r,o){super("globalState",i,n,r,s,e,o)}async o(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(!s){this.j.info("Skipping initializing global state because remote global state does not exist.");return}const i={},n={};for(const r of Object.keys(s.storage))r.startsWith(Hi)?i[r.substring(Hi.length)]=s.storage[r].value:this.l.get(r,0)===void 0&&(n[r]=s.storage[r].value);if(Object.keys(i).length){let r="{}";try{r=(await this.k.readFile(this.h.argvResource)).value.toString()}catch{}for(const o of Object.keys(i))r=Gt(r,[o],i[o],{});await this.k.writeFile(this.h.argvResource,A.fromString(r))}if(Object.keys(n).length){const r=[];for(const o of Object.keys(n))r.push({key:o,value:n[o],scope:0,target:0});this.l.storeAll(r,!0)}}};gm=__decorate([__param(0,ne),__param(1,K),__param(2,je),__param(3,ae),__param(4,Re),__param(5,he)],gm);var mm=class{constructor(e,s,i,n,r){this.a=e,this.b=s,this.c=i,this.d=n,this.f=r}getSyncStoreType(e){return this.h(e)?.storage[ui]?.value}async sync(e){const s=jn(st());try{return await this.g(e,s)}catch(i){if(i instanceof Pe)switch(i.code){case"PreconditionFailed":return this.f.info("Failed to synchronize UserDataSyncStoreType as there is a new remote version available. Synchronizing again..."),this.g(e,s)}throw i}}async g(e,s){const i=await this.a.readResource("globalState",null,void 0,s),n=this.h(i)||{storage:{}};n.storage[ui]={value:e,version:Pu};const r=await In(this.c,this.d,this.b),o={version:Pu,machineId:r,content:Gi(n,!1)};await this.a.writeResource("globalState",JSON.stringify(o),i.ref,void 0,s)}h({content:e}){if(!e)return null;const s=JSON.parse(e);if(Fr(s))return s?JSON.parse(s.content):null;throw new Error("Invalid remote data")}};mm=__decorate([__param(1,ne),__param(2,ae),__param(3,K),__param(4,Y)],mm);function zr(t){return We(t)||[]}async function wm(t,e,s,i,n){const r=zr(t),o=zr(e),a=s?zr(s):null,c=[...r,...o,...a||[]].map($=>$.key),l=await n.resolveUserBindings(c),h=g6(r,o,a,l);if(!h.hasLocalForwarded&&!h.hasRemoteForwarded)return{mergeContent:t,hasChanges:!1,hasConflicts:!1};if(!h.hasLocalForwarded&&h.hasRemoteForwarded)return{mergeContent:e,hasChanges:!0,hasConflicts:!1};if(h.hasLocalForwarded&&!h.hasRemoteForwarded)return{mergeContent:t,hasChanges:!0,hasConflicts:!1};const u=Du(r),f=Du(o),p=a?Du(a):null,g=Ou(u,f,l),m=p?Ou(p,u,l):{added:[...u.keys()].reduce(($,U)=>($.add(U),$),new Set),removed:new Set,updated:new Set},w=p?Ou(p,f,l):{added:[...f.keys()].reduce(($,U)=>($.add(U),$),new Set),removed:new Set,updated:new Set},b=vm(g,m,w);let S=t;for(const $ of b.removed.values())b.conflicts.has($)||(S=v6(S,$,i));for(const $ of b.added.values()){if(b.conflicts.has($))continue;const U=f.get($);if(U.some(q=>q.command!==`-${$}`&&h.conflicts.has(l[q.key]))){b.conflicts.add($);continue}S=w6(S,U,i)}for(const $ of b.updated.values()){if(b.conflicts.has($))continue;const U=f.get($);if(U.some(q=>q.command!==`-${$}`&&h.conflicts.has(l[q.key]))){b.conflicts.add($);continue}S=y6(S,$,U,i)}return{mergeContent:S,hasChanges:!0,hasConflicts:b.conflicts.size>0}}function vm(t,e,s){const i=new Set,n=new Set,r=new Set,o=new Set;for(const a of e.removed.values())s.updated.has(a)&&o.add(a);for(const a of s.removed.values())o.has(a)||(e.updated.has(a)?o.add(a):n.add(a));for(const a of e.added.values())o.has(a)||s.added.has(a)&&t.updated.has(a)&&o.add(a);for(const a of s.added.values())o.has(a)||(e.added.has(a)?t.updated.has(a)&&o.add(a):i.add(a));for(const a of e.updated.values())o.has(a)||s.updated.has(a)&&t.updated.has(a)&&o.add(a);for(const a of s.updated.values())o.has(a)||(e.updated.has(a)?t.updated.has(a)&&o.add(a):r.add(a));return{added:i,removed:n,updated:r,conflicts:o}}function g6(t,e,s,i){const n=new Set,r=Cu(t,i),o=Cu(e,i),a=s?Cu(s,i):null,c=Iu(r,o);if(c.added.size===0&&c.removed.size===0&&c.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!1,added:n,removed:n,updated:n,conflicts:n};const l=a?Iu(a,r):{added:[...r.keys()].reduce((m,w)=>(m.add(w),m),new Set),removed:new Set,updated:new Set};if(l.added.size===0&&l.removed.size===0&&l.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!0,added:n,removed:n,updated:n,conflicts:n};const h=a?Iu(a,o):{added:[...o.keys()].reduce((m,w)=>(m.add(w),m),new Set),removed:new Set,updated:new Set};if(h.added.size===0&&h.removed.size===0&&h.updated.size===0)return{hasLocalForwarded:!0,hasRemoteForwarded:!1,added:n,removed:n,updated:n,conflicts:n};const{added:u,removed:f,updated:p,conflicts:g}=vm(c,l,h);return{hasLocalForwarded:!0,hasRemoteForwarded:!0,added:u,removed:f,updated:p,conflicts:g}}function Cu(t,e){const s=new Map;for(const i of t){const n=e[i.key];let r=s.get(n);r||(r=[],s.set(n,r)),r.push(i)}return s}function Du(t){const e=new Map;for(const s of t){const i=s.command[0]==="-"?s.command.substring(1):s.command;let n=e.get(i);n||(n=[],e.set(i,n)),n.push(s)}return e}function Iu(t,e){const s=[...t.keys()],i=[...e.keys()],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t.get(a).map(h=>({...h,key:a})),l=e.get(a).map(h=>({...h,key:a}));Tt(c,l,(h,u)=>Lu(h,u))||o.add(a)}return{added:n,removed:r,updated:o}}function Ou(t,e,s){const i=[...t.keys()],n=[...e.keys()],r=n.filter(c=>!i.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),o=i.filter(c=>!n.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),a=new Set;for(const c of i){if(o.has(c))continue;const l=t.get(c).map(u=>({...u,key:s[u.key]})),h=e.get(c).map(u=>({...u,key:s[u.key]}));m6(l,h)||a.add(c)}return{added:r,removed:o,updated:a}}function m6(t,e){return!(!Tt(t.filter(({command:s})=>s[0]!=="-"),e.filter(({command:s})=>s[0]!=="-"),(s,i)=>Lu(s,i))||!Tt(t.filter(({command:s})=>s[0]==="-"),e.filter(({command:s})=>s[0]==="-"),(s,i)=>Lu(s,i)))}function Lu(t,e){if(t.command!==e.command||t.key!==e.key)return!1;const s=ut.deserialize(t.when),i=ut.deserialize(e.when);return!(s&&!i||!s&&i||s&&i&&!s.equals(i)||!yt(t.args,e.args))}function w6(t,e,s){for(const i of e)t=Gt(t,[-1],i,s);return t}function v6(t,e,s){const i=zr(t);for(let n=i.length-1;n>=0;n--)(i[n].command===e||i[n].command===`-${e}`)&&(t=Gt(t,[n],void 0,s));return t}function y6(t,e,s,i){const n=zr(t),r=n.findIndex(o=>o.command===e||o.command===`-${e}`);for(let o=n.length-1;o>=0;o--)(n[o].command===e||n[o].command===`-${e}`)&&(t=Gt(t,[o],void 0,i));for(let o=s.length-1;o>=0;o--)t=Gt(t,[r],s[o],i);return t}function Ga(t,e,s){try{const i=JSON.parse(t);if(!e)return rt(i.all)?null:i.all;switch(an){case 2:return rt(i.mac)?null:i.mac;case 3:return rt(i.linux)?null:i.linux;case 1:return rt(i.windows)?null:i.windows}}catch(i){return s.error(i),null}}var Au=class extends Ua{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super(e.keybindingsResource,{syncResource:"keybindings",profile:e},s,c,l,h,i,n,a,f,r,u,o,p),this.ob=2,this.Db=this.h.joinPath(this.g,"keybindings.json"),this.Eb=this.Db.with({scheme:I,authority:"base"}),this.Fb=this.Db.with({scheme:I,authority:"local"}),this.Gb=this.Db.with({scheme:I,authority:"remote"}),this.Hb=this.Db.with({scheme:I,authority:"accepted"}),this.B(L.filter(o.onDidChangeConfiguration,g=>g.affectsConfiguration("settingsSync.keybindingsPerPlatform"))(()=>this.Q()))}async pb(e,s,i,n){const r=e.syncData?Ga(e.syncData.content,n.keybindingsPerPlatform??this.Pb(),this.O):null;s=s===null&&i?e:s;const o=s?this.Nb(s):null,a=await this.ub(),c=await this.Bb();let l=null,h=!1,u=!1,f=!1;if(r){let m=a?a.value.toString():"[]";if(m=m||"[]",this.zb(m,!0))throw new Pe(v(2669,null),"LocalInvalidContent",this.resource);if(!o||o!==m||o!==r){this.O.trace(`${this.D}: Merging remote keybindings with local keybindings...`);const w=await wm(m,r,o,c,this.yb);w.hasChanges&&(l=w.mergeContent,f=w.hasConflicts,h=f||w.mergeContent!==m,u=f||w.mergeContent!==r)}}else a&&(this.O.trace(`${this.D}: Remote keybindings does not exist. Synchronizing keybindings for the first time.`),l=a.value.toString(),u=!0);const p={content:f?o:l,localChange:h?a?2:1:0,remoteChange:u?2:0,hasConflicts:f},g=a?a.value.toString():null;return[{fileContent:a,baseResource:this.Eb,baseContent:o,localResource:this.Fb,localContent:g,localChange:p.localChange,remoteResource:this.Gb,remoteContent:r,remoteChange:p.remoteChange,previewResource:this.Db,previewResult:p,acceptedResource:this.Hb}]}async tb(e){const s=this.Nb(e);if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString():"",r=await this.Bb(),o=await wm(n||"[]",s,s,r,this.yb);return o.hasConflicts||o.mergeContent!==s}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqual(s,this.Fb))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.Gb))return{content:e.remoteContent,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.Db))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0];let{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.D}: No changes found during synchronizing keybindings.`),o!==null&&(o=o.trim(),o=o||"[]",this.zb(o,!0)))throw new Pe(v(2670,null),"LocalInvalidContent",this.resource);if(a!==0&&(this.O.trace(`${this.D}: Updating local keybindings...`),r&&await this.mb(this.Ob(r.value.toString())),await this.vb(o||"[]",r,n),this.O.info(`${this.D}: Updated local keybindings`)),c!==0){this.O.trace(`${this.D}: Updating remote keybindings...`);const l=this.Ob(o||"[]",e.syncData?.content);e=await this.lb(l,n?null:e.ref),this.O.info(`${this.D}: Updated remote keybindings`)}try{await this.G.del(this.Db)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized keybindings...`),await this.eb(e,{platformSpecific:this.Pb()}),this.O.info(`${this.D}: Updated last synchronized keybindings`))}async hasLocalData(){try{const e=await this.ub();if(e){const s=We(e.value.toString());if(Hn(s))return!0}}catch(e){if(e.fileOperationResult!==1)return!0}return!1}async resolveContent(e){return this.h.isEqual(this.Gb,e)||this.h.isEqual(this.Eb,e)||this.h.isEqual(this.Fb,e)||this.h.isEqual(this.Hb,e)?this.cb(e):null}Nb(e){return!e.syncData||e.platformSpecific!==void 0&&e.platformSpecific!==this.Pb()?null:Ga(e.syncData.content,this.Pb(),this.O)}Ob(e,s){let i={};try{i=JSON.parse(s||"{}")}catch(n){this.O.error(n)}switch(this.Pb()?delete i.all:i.all=e,an){case 2:i.mac=e;break;case 3:i.linux=e;break;case 1:i.windows=e;break}return JSON.stringify(i)}Pb(){return!!this.P.getValue(iu)}};Au=__decorate([__param(2,nt),__param(3,xt),__param(4,Re),__param(5,ge),__param(6,pt),__param(7,K),__param(8,ae),__param(9,ne),__param(10,La),__param(11,ke),__param(12,he)],Au);var ym=class extends di{constructor(e,s,i,n,r,o){super("keybindings",s,i,n,e,r,o)}async o(e){const s=e.syncData?this.p(e.syncData.content):null;if(!s){this.j.info("Skipping initializing keybindings because remote keybindings does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing keybindings because local keybindings exist.");return}await this.k.writeFile(this.g.defaultProfile.keybindingsResource,A.fromString(s)),await this.n(e)}async i(){try{const e=await this.k.readFile(this.g.defaultProfile.settingsResource),s=We(e.value.toString());return!Hn(s)}catch(e){return e.fileOperationResult===1}}p(e){try{return Ga(e,!0,this.j)}catch(s){return this.j.error(s),null}}};ym=__decorate([__param(0,K),__param(1,je),__param(2,ae),__param(3,Re),__param(4,ne),__param(5,he)],ym);function bm(t,e,s){const i={},n={},r=new Set;if(!e)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:t,updated:{},removed:[]},conflicts:[]};const o=Ja(t,e);if(o.added.size===0&&o.removed.size===0&&o.updated.size===0)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:{},updated:{},removed:[]},conflicts:[]};const a=Ja(s,t),c=Ja(s,e),l={},h={},u=new Set,f=new Set;for(const p of a.removed.values())c.updated.has(p)?i[p]=e[p]:u.add(p);for(const p of c.removed.values())f.has(p)||(a.updated.has(p)?f.add(p):r.add(p));for(const p of a.updated.values())f.has(p)||(c.updated.has(p)?o.updated.has(p)&&f.add(p):h[p]=t[p]);for(const p of c.updated.values())f.has(p)||(a.updated.has(p)?o.updated.has(p)&&f.add(p):t[p]!==void 0&&(n[p]=e[p]));for(const p of a.added.values())f.has(p)||(c.added.has(p)?o.updated.has(p)&&f.add(p):l[p]=t[p]);for(const p of c.added.values())f.has(p)||(a.added.has(p)?o.updated.has(p)&&f.add(p):i[p]=e[p]);return{local:{added:i,removed:[...r.values()],updated:n},remote:{added:l,removed:[...u.values()],updated:h},conflicts:[...f.values()]}}function Ja(t,e){const s=t?Object.keys(t):[],i=e?Object.keys(e):[],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];c!==l&&o.add(a)}return{added:n,removed:r,updated:o}}function b6(t,e){const{added:s,removed:i,updated:n}=Ja(t,e);return s.size===0&&i.size===0&&n.size===0}function Nu(t){return JSON.parse(t.content)}var ju=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f){const p={syncResource:"prompts",profile:e};super(p,s,n,i,r,o,a,h,u,c,l,f),this.ob=1,this.ub=e.promptsHome,this.B(this.G.watch(i.userRoamingDataHome)),this.B(this.G.watch(this.ub)),this.B(L.filter(this.G.onDidFilesChange,g=>g.affects(this.ub))(()=>this.Q()))}async pb(e,s,i){const n=await this.Gb(),r=this.Fb(n),o=e.syncData?this.Eb(e.syncData):null;s=s===null&&i?e:s;const a=s&&s.syncData?this.Eb(s.syncData):null;o?this.O.trace(`${this.D}: Merging remote prompts with local prompts...`):this.O.trace(`${this.D}: Remote prompts does not exist. Synchronizing prompts for the first time.`);const c=bm(r,o,a);return this.Ab(c,n,o||{},a||{})}async tb(e){const s=e.syncData?this.Eb(e.syncData):null;if(s===null)return!0;const i=await this.Gb(),n=this.Fb(i),r=bm(n,s,s);return Object.keys(r.remote.added).length>0||Object.keys(r.remote.updated).length>0||r.remote.removed.length>0||r.conflicts.length>0}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"local"})))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:e.fileContent?e.remoteContent!==null?2:1:3};if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"remote"})))return{content:e.remoteContent,localChange:e.remoteContent!==null?e.fileContent?2:1:3,remoteChange:0};if(this.h.isEqualOrParent(s,this.g))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:i===null?e.fileContent!==null?3:0:2,remoteChange:i===null?e.remoteContent!==null?3:0:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const r=i.map(([o,a])=>({...o,acceptResult:a}));r.every(({localChange:o,remoteChange:a})=>o===0&&a===0)&&this.O.info(`${this.D}: No changes found during synchronizing prompts.`),r.some(({localChange:o})=>o!==0)&&(await this.Bb(r),await this.Cb(r,n)),r.some(({remoteChange:o})=>o!==0)&&(e=await this.Db(r,e,n)),s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized prompts...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized prompts`));for(const{previewResource:o}of r)try{await this.G.del(o)}catch{}}Ab(e,s,i,n){const r=new Map;for(const o of Object.keys(e.local.added)){const a={content:e.local.added[o],hasConflicts:!1,localChange:1,remoteChange:0};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:null,fileContent:null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.local.updated)){const a={content:e.local.updated[o],hasConflicts:!1,localChange:2,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.local.removed){const a={content:null,hasConflicts:!1,localChange:3,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.added)){const a={content:e.remote.added[o],hasConflicts:!1,localChange:0,remoteChange:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.updated)){const a={content:e.remote.updated[o],hasConflicts:!1,localChange:0,remoteChange:2},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.remote.removed){const a={content:null,hasConflicts:!1,localChange:0,remoteChange:3};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:null,localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.conflicts){const a={content:n[o]??null,hasConflicts:!0,localChange:s[o]?2:1,remoteChange:i[o]?2:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(s))if(!r.has(o)){const a={content:s[o]?s[o].value.toString():null,hasConflicts:!1,localChange:0,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}return[...r.values()]}async resolveContent(e){return this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"remote"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"local"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"base"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"accepted"}))?this.cb(e):null}async hasLocalData(){try{const e=await this.Gb();if(Object.keys(e).length)return!0}catch{}return!1}async Bb(e){const s={};for(const i of e)i.fileContent&&(s[this.h.basename(i.localResource)]=i.fileContent);await this.mb(JSON.stringify(this.Fb(s)))}async Cb(e,s){for(const{fileContent:i,acceptResult:n,localResource:r,remoteResource:o,localChange:a}of e)if(a!==0){const c=o?this.h.basename(o):this.h.basename(r),l=this.h.joinPath(this.ub,c);a===3?(this.O.trace(`${this.D}: Deleting prompt...`,this.h.basename(l)),await this.G.del(l),this.O.info(`${this.D}: Deleted prompt`,this.h.basename(l))):a===1?(this.O.trace(`${this.D}: Creating prompt...`,this.h.basename(l)),await this.G.createFile(l,A.fromString(n.content),{overwrite:s}),this.O.info(`${this.D}: Created prompt`,this.h.basename(l))):(this.O.trace(`${this.D}: Updating prompt...`,this.h.basename(l)),await this.G.writeFile(l,A.fromString(n.content),s?void 0:i),this.O.info(`${this.D}: Updated prompt`,this.h.basename(l)))}}async Db(e,s,i){const n=s.syncData?this.Eb(s.syncData):{},r=qt(n);for(const{acceptResult:o,localResource:a,remoteResource:c,remoteChange:l}of e)if(l!==0){const h=a?this.h.basename(a):this.h.basename(c);l===3?delete r[h]:r[h]=o.content}return b6(n,r)||(this.O.trace(`${this.D}: Updating remote prompts...`),s=await this.lb(JSON.stringify(r),i?null:s.ref),this.O.info(`${this.D}: Updated remote prompts`)),s}Eb(e){return Nu(e)}Fb(e){const s={};for(const i of Object.keys(e))s[i]=e[i].value.toString();return s}async Gb(){const e={};let s;try{s=await this.G.resolve(this.ub)}catch(i){if(i instanceof et&&i.fileOperationResult===1)return e;throw i}for(const i of s.children||[]){const n=i.resource,r=n.path;if([".prompt.md",".instructions.md",".chatmode.md"].some(o=>r.endsWith(o))){const o=this.h.relativePath(this.ub,n),a=await this.G.readFile(n);e[o]=a}}return e}};ju=__decorate([__param(2,ae),__param(3,K),__param(4,ne),__param(5,nt),__param(6,xt),__param(7,Re),__param(8,ge),__param(9,pt),__param(10,ke),__param(11,he)],ju);function S6(t,e,s){let i=[];s?i=$6(s):i=E6(e);const n=[],r=[...su()];if(Array.isArray(i))for(const o of i)o.startsWith("-")?r.push(o.substring(1)):n.push(o);return Rt([...t,...n].filter(o=>!r.includes(o)))}function E6(t){let e=t.inspect("settingsSync.ignoredSettings").userValue;return e!==void 0||(e=t.inspect("sync.ignoredSettings").userValue,e!==void 0)?e:t.getValue("settingsSync.ignoredSettings")||[]}function $6(t){const e=We(t);return e?e["settingsSync.ignoredSettings"]||e["sync.ignoredSettings"]||[]:[]}function Gs(t,e,s,i){if(s.length){const n=Mn(e),r=We(e)||{},o=We(t);if(!o)return t;const a=[];for(const c of s){const l=r[c],h=o[c];l===void 0?t=Gt(t,[c],void 0,i):h!==void 0?t=Gt(t,[c],l,i):a.push(_r(c,n))}a.sort((c,l)=>c.startOffset-l.startOffset),a.forEach(c=>t=Fu(c.setting.key,e,t,i))}return t}function Sm(t,e,s,i,n,r){const o=Gs(t,e,i,r),a=s!==o,c=s!==e;if(!a&&!c)return{conflictsSettings:[],localContent:null,remoteContent:null,hasConflicts:!1};if(a&&!c)return{conflictsSettings:[],localContent:null,remoteContent:o,hasConflicts:!1};if(c&&!a)return{conflictsSettings:[],localContent:Gs(e,t,i,r),remoteContent:null,hasConflicts:!1};if(s===null&&Tu(t)){const E=Ka(t,e,i)?null:Gs(e,t,i,r);return{conflictsSettings:[],localContent:E,remoteContent:null,hasConflicts:!1}}let l=t,h=e;const u=We(t),f=We(e),p=s?We(s):null,g=i.reduce((E,P)=>(E.add(P),E),new Set),m=Mu(u,f,g),w=Mu(p,u,g),b=Mu(p,f,g),S=new Map,$=new Set,U=E=>{$.add(E);const P=n.filter(({key:z})=>z===E)[0];P?(l=Gt(l,[E],P.value,r),h=Gt(h,[E],P.value,r)):S.set(E,{key:E,localValue:u[E],remoteValue:f[E]})};for(const E of w.removed.values())b.updated.has(E)?U(E):h=Gt(h,[E],void 0,r);for(const E of b.removed.values())$.has(E)||(w.updated.has(E)?U(E):l=Gt(l,[E],void 0,r));for(const E of w.updated.values())$.has(E)||(b.updated.has(E)?m.updated.has(E)&&U(E):h=Gt(h,[E],u[E],r));for(const E of b.updated.values())$.has(E)||(w.updated.has(E)?m.updated.has(E)&&U(E):l=Gt(l,[E],f[E],r));for(const E of w.added.values())$.has(E)||(b.added.has(E)?m.updated.has(E)&&U(E):h=Fu(E,l,h,r));for(const E of b.added.values())$.has(E)||(w.added.has(E)?m.updated.has(E)&&U(E):l=Fu(E,h,l,r));const q=S.size>0||!Ka(l,h,i),me=q||!Ka(l,t,[]),N=q||!Ka(h,e,[]);return{localContent:me?l:null,remoteContent:N?h:null,conflictsSettings:[...S.values()],hasConflicts:q}}function Ka(t,e,s){if(t===e)return!0;const i=We(t),n=We(e),r=s.reduce((c,l)=>(c.add(l),c),new Set),o=Mn(t).filter(c=>!(c.setting&&r.has(c.setting.key))),a=Mn(e).filter(c=>!(c.setting&&r.has(c.setting.key)));if(o.length!==a.length)return!1;for(let c=0;c<o.length;c++){const l=o[c],h=a[c];if(l.setting&&h.setting){if(l.setting.key!==h.setting.key||!yt(i[l.setting.key],n[l.setting.key]))return!1}else if(!l.setting&&!h.setting){if(l.value!==h.value)return!1}else return!1}return!0}function Tu(t){return t?Mn(t).length===0:!0}function Mu(t,e,s){const i=t?Object.keys(t).filter(c=>!s.has(c)):[],n=Object.keys(e).filter(c=>!s.has(c)),r=n.filter(c=>!i.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),o=i.filter(c=>!n.includes(c)).reduce((c,l)=>(c.add(l),c),new Set),a=new Set;if(t)for(const c of i){if(o.has(c))continue;const l=t[c],h=e[c];yt(l,h)||a.add(c)}return{added:r,removed:o,updated:a}}function Fu(t,e,s,i){const n=We(e),r=Mn(e),o=Mn(s),a=x6(t,r,o);return k6(s,t,n[t],a,o,i)}function x6(t,e,s){const i=e.findIndex(r=>r.setting?.key===t),n=e[i-1];if(n){if(n.setting){const o=_r(n.setting.key,s);if(o)return{index:s.indexOf(o),insertAfter:!0}}else{const o=Uu(i,e);if(o){const a=_r(o.setting.key,s);if(a){const c=Qa(s.indexOf(a),s),l=Tn(e,o,e[i]);if(c){const h=Tn(s,a,c),u=Xa(l,h);return u?{index:s.indexOf(u),insertAfter:!0}:{index:s.indexOf(c),insertAfter:!1}}else{const h=Tn(s,a,s[s.length-1]),u=Xa(l,h);return u?{index:s.indexOf(u),insertAfter:!0}:{index:s.length-1,insertAfter:!0}}}}}const r=e[i+1];if(r)if(r.setting){const o=_r(r.setting.key,s);if(o)return{index:s.indexOf(o),insertAfter:!1}}else{const o=Qa(i,e);if(o){const a=_r(o.setting.key,s);if(a){const c=Uu(s.indexOf(a),s),l=Tn(e,e[i],o);if(c){const h=Tn(s,c,a),u=Xa(l.reverse(),h.reverse());return u?{index:s.indexOf(u),insertAfter:!1}:{index:s.indexOf(c),insertAfter:!0}}else{const h=Tn(s,s[0],a),u=Xa(l.reverse(),h.reverse());return u?{index:s.indexOf(u),insertAfter:!1}:{index:0,insertAfter:!1}}}}}}return{index:s.length-1,insertAfter:!0}}function k6(t,e,s,i,n,r){let o;return i.index===-1?o=_l(t,[e],s,r):o=P6(t,e,s,i,n,r).map(a=>Bi(t,a,r)[0]),ng(t,o)}function P6(t,e,s,i,n,r){const o=`${JSON.stringify(e)}: ${JSON.stringify(s)}`,a=ig(r,t),c=n[i.index];if(i.insertAfter){const l=[];if(c.setting)l.push({offset:c.endOffset,length:0,content:","+o});else{const h=Qa(i.index,n),u=Uu(i.index,n),f=u?.setting?.commaOffset;u&&f===void 0&&l.push({offset:u.endOffset,length:0,content:","});const p=f!==void 0&&f>c.endOffset;l.push({offset:p?f+1:c.endOffset,length:0,content:h?a+o+",":a+o})}return l}else{if(c.setting)return[{offset:c.startOffset,length:0,content:o+","}];const l=(n[i.index-1]&&!n[i.index-1].setting?a:"")+o+(Qa(i.index,n)?",":"")+a;return[{offset:c.startOffset,length:0,content:l}]}}function _r(t,e){return e.filter(s=>s.setting?.key===t)[0]}function Uu(t,e){for(let s=t-1;s>=0;s--)if(e[s].setting)return e[s]}function Qa(t,e){for(let s=t+1;s<e.length;s++)if(e[s].setting)return e[s]}function Tn(t,e,s){const i=t.indexOf(e),n=t.indexOf(s);return t.filter((r,o)=>i<o&&o<n)}function Xa(t,e){if(t.length&&e.length){let s=0;for(;s<e.length&&s<t.length;s++)if(t[s].value!==e[s].value)return e[s-1];return e[s-1]}}function Mn(t){const e=[];let s=-1,i,n;return br(t,{onObjectBegin:o=>{s++},onObjectProperty:(o,a,c)=>{s===0&&(i=a,n=o)},onObjectEnd:(o,a)=>{s--,s===0&&e.push({startOffset:i,endOffset:o+a,value:t.substring(i,o+a),setting:{key:n,commaOffset:void 0}})},onArrayBegin:(o,a)=>{s++},onArrayEnd:(o,a)=>{s--,s===0&&e.push({startOffset:i,endOffset:o+a,value:t.substring(i,o+a),setting:{key:n,commaOffset:void 0}})},onLiteralValue:(o,a,c)=>{s===0&&e.push({startOffset:i,endOffset:a+c,value:t.substring(i,a+c),setting:{key:n,commaOffset:void 0}})},onSeparator:(o,a,c)=>{if(s===0&&o===","){let l=e.length-1;for(;l>=0&&!e[l].setting;l--);const h=e[l];h&&e.splice(l,1,{startOffset:h.startOffset,endOffset:h.endOffset,value:h.value,setting:{key:h.setting.key,commaOffset:a}})}},onComment:(o,a)=>{s===0&&e.push({startOffset:o,endOffset:o+a,value:t.substring(o,o+a)})}}),e}function R6(t){return t&&t.settings&&typeof t.settings=="string"&&Object.keys(t).length===1}function Bu(t){const e=JSON.parse(t);return R6(e)?e:{settings:t}}var Za=class extends Ua{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e.settingsResource,{syncResource:"settings",profile:e},s,i,n,r,o,a,u,f,c,l,h,g),this.Db=e,this.Eb=p,this.ob=2,this.previewResource=this.h.joinPath(this.g,"settings.json"),this.baseResource=this.previewResource.with({scheme:I,authority:"base"}),this.localResource=this.previewResource.with({scheme:I,authority:"local"}),this.remoteResource=this.previewResource.with({scheme:I,authority:"remote"}),this.acceptedResource=this.previewResource.with({scheme:I,authority:"accepted"}),this.Ob=void 0,this.Pb=void 0,this.Qb=void 0}async getRemoteUserDataSyncConfiguration(e){const s=await this.getLastSyncUserData(),i=await this.W(e,s),n=this.Lb(i),r=new Hl(Ia,this.O);return n?.settings&&r.parse(n.settings),r.configurationModel.getValue(Ia)||{}}async pb(e,s,i){const n=await this.ub(),r=await this.Bb(),o=this.Lb(e);s=s===null&&i?e:s;const a=s?this.Lb(s):null,c=await this.Rb();let l=null,h=!1,u=!1,f=!1;if(o){let w=n?n.value.toString().trim():"{}";w=w||"{}",this.Ub(w),this.O.trace(`${this.D}: Merging remote settings with local settings...`);const b=Sm(w,o.settings,a?a.settings:null,c,[],r);l=b.localContent||b.remoteContent,h=b.localContent!==null,u=b.remoteContent!==null,f=b.hasConflicts}else n&&(this.O.trace(`${this.D}: Remote settings does not exist. Synchronizing settings for the first time.`),l=n.value.toString().trim()||"{}",this.Ub(l),u=!0);const p=n?n.value.toString():null,g=a?.settings??null,m={content:f?g:l,localChange:h?2:0,remoteChange:u?2:0,hasConflicts:f};return[{fileContent:n,baseResource:this.baseResource,baseContent:g,localResource:this.localResource,localContent:p,localChange:m.localChange,remoteResource:this.remoteResource,remoteContent:o?o.settings:null,remoteChange:m.remoteChange,previewResource:this.previewResource,previewResult:m,acceptedResource:this.acceptedResource}]}async tb(e){const s=this.Lb(e);if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString().trim():"",r=await this.Rb(),o=await this.Bb();return Sm(n||"{}",s.settings,s.settings,r,[],o).remoteContent!==null}async qb(e,s){const i=await this.Bb(),n=await this.Rb();return{...e.previewResult,content:e.previewResult.content?Gs(e.previewResult.content,"{}",n,i):null}}async rb(e,s,i,n){const r=await this.Bb(),o=await this.Rb();if(this.h.isEqual(s,this.localResource))return{content:e.fileContent?Gs(e.fileContent.value.toString(),"{}",o,r):null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.remoteResource))return{content:e.remoteContent!==null?Gs(e.remoteContent,e.fileContent?e.fileContent.value.toString():"{}",o,r):null,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.previewResource))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i!==null?Gs(i,e.fileContent?e.fileContent.value.toString():"{}",o,r):null,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0];let{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.D}: No changes found during synchronizing settings.`),o=o?o.trim():"{}",o=o||"{}",this.Ub(o),a!==0&&(this.O.trace(`${this.D}: Updating local settings...`),r&&await this.mb(JSON.stringify(this.Nb(r.value.toString()))),await this.vb(o,r,n),await this.P.reloadConfiguration(3),this.O.info(`${this.D}: Updated local settings`)),c!==0){const l=await this.Bb(),h=this.Lb(e),u=await this.Rb(o);o=Gs(o,h?h.settings:"{}",u,l),this.O.trace(`${this.D}: Updating remote settings...`),e=await this.lb(JSON.stringify(this.Nb(o)),n?null:e.ref),this.O.info(`${this.D}: Updated remote settings`)}try{await this.G.del(this.previewResource)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized settings...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized settings`))}async hasLocalData(){try{const e=await this.ub();if(e)return!Tu(e.value.toString())}catch(e){if(e.fileOperationResult!==1)return!0}return!1}async resolveContent(e){return this.h.isEqual(this.remoteResource,e)||this.h.isEqual(this.localResource,e)||this.h.isEqual(this.acceptedResource,e)||this.h.isEqual(this.baseResource,e)?this.cb(e):null}async cb(e){let s=await super.cb(e);if(s){const i=await this.Bb(),n=await this.Rb();s=Gs(s,"{}",n,i)}return s}Lb(e){return e.syncData?this.Mb(e.syncData.content):null}Mb(e){try{return Bu(e)}catch(s){this.O.error(s)}return null}Nb(e){return{settings:e}}async Rb(e){if(this.Ob||(this.Ob=this.yb.resolveDefaultCoreIgnoredSettings()),this.Pb||(this.Pb=this.Sb()),!this.Qb){this.Qb=this.Tb();const i=this.B(L.any(L.filter(this.Eb.onDidInstallExtensions,n=>n.some(({local:r})=>!!r)),L.filter(this.Eb.onDidUninstallExtension,n=>!n.error))(()=>{i.dispose(),this.Qb=void 0}))}const s=(await Promise.all([this.Ob,this.Pb,this.Qb])).flat();return S6(s,this.P,e)}async Sb(){const e=await this.Eb.getInstalled(0);return Rt(e.map(s=>Z0(s.manifest)).flat())}async Tb(){const e=await this.Eb.getInstalled(1,this.Db.extensionsResource);return Rt(e.map(s=>Z0(s.manifest)).flat())}Ub(e){if(this.zb(e,!1))throw new Pe(v(2671,null),"LocalInvalidContent",this.resource)}};Za=__decorate([__param(2,K),__param(3,ae),__param(4,ne),__param(5,nt),__param(6,xt),__param(7,Re),__param(8,La),__param(9,ge),__param(10,pt),__param(11,ke),__param(12,Hs),__param(13,he)],Za);var Em=class extends di{constructor(e,s,i,n,r,o){super("settings",s,i,n,e,r,o)}async o(e){const s=e.syncData?this.p(e.syncData.content):null;if(!s){this.j.info("Skipping initializing settings because remote settings does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing settings because local settings exist.");return}await this.k.writeFile(this.g.defaultProfile.settingsResource,A.fromString(s.settings)),await this.n(e)}async i(){try{const e=await this.k.readFile(this.g.defaultProfile.settingsResource);return Tu(e.value.toString().trim())}catch(e){return e.fileOperationResult===1}}p(e){try{return Bu(e)}catch(s){this.j.error(s)}return null}};Em=__decorate([__param(0,K),__param(1,je),__param(2,ae),__param(3,Re),__param(4,ne),__param(5,he)],Em);function $m(t,e,s){const i={},n={},r=new Set;if(!e)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:t,updated:{},removed:[]},conflicts:[]};const o=Ya(t,e);if(o.added.size===0&&o.removed.size===0&&o.updated.size===0)return{local:{added:i,updated:n,removed:[...r.values()]},remote:{added:{},updated:{},removed:[]},conflicts:[]};const a=Ya(s,t),c=Ya(s,e),l={},h={},u=new Set,f=new Set;for(const p of a.removed.values())c.updated.has(p)?i[p]=e[p]:u.add(p);for(const p of c.removed.values())f.has(p)||(a.updated.has(p)?f.add(p):r.add(p));for(const p of a.updated.values())f.has(p)||(c.updated.has(p)?o.updated.has(p)&&f.add(p):h[p]=t[p]);for(const p of c.updated.values())f.has(p)||(a.updated.has(p)?o.updated.has(p)&&f.add(p):t[p]!==void 0&&(n[p]=e[p]));for(const p of a.added.values())f.has(p)||(c.added.has(p)?o.updated.has(p)&&f.add(p):l[p]=t[p]);for(const p of c.added.values())f.has(p)||(a.added.has(p)?o.updated.has(p)&&f.add(p):i[p]=e[p]);return{local:{added:i,removed:[...r.values()],updated:n},remote:{added:l,removed:[...u.values()],updated:h},conflicts:[...f.values()]}}function Ya(t,e){const s=t?Object.keys(t):[],i=e?Object.keys(e):[],n=i.filter(a=>!s.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),r=s.filter(a=>!i.includes(a)).reduce((a,c)=>(a.add(c),a),new Set),o=new Set;for(const a of s){if(r.has(a))continue;const c=t[a],l=e[a];c!==l&&o.add(a)}return{added:n,removed:r,updated:o}}function C6(t,e){const{added:s,removed:i,updated:n}=Ya(t,e);return s.size===0&&i.size===0&&n.size===0}function zu(t){return JSON.parse(t.content)}var _u=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super({syncResource:"snippets",profile:e},s,n,i,r,o,a,h,u,c,l,f),this.ob=1,this.ub=e.snippetsHome,this.B(this.G.watch(i.userRoamingDataHome)),this.B(this.G.watch(this.ub)),this.B(L.filter(this.G.onDidFilesChange,p=>p.affects(this.ub))(()=>this.Q()))}async pb(e,s,i){const n=await this.Gb(),r=this.Fb(n),o=e.syncData?this.Eb(e.syncData):null;s=s===null&&i?e:s;const a=s&&s.syncData?this.Eb(s.syncData):null;o?this.O.trace(`${this.D}: Merging remote snippets with local snippets...`):this.O.trace(`${this.D}: Remote snippets does not exist. Synchronizing snippets for the first time.`);const c=$m(r,o,a);return this.Ab(c,n,o||{},a||{})}async tb(e){const s=e.syncData?this.Eb(e.syncData):null;if(s===null)return!0;const i=await this.Gb(),n=this.Fb(i),r=$m(n,s,s);return Object.keys(r.remote.added).length>0||Object.keys(r.remote.updated).length>0||r.remote.removed.length>0||r.conflicts.length>0}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"local"})))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:e.fileContent?e.remoteContent!==null?2:1:3};if(this.h.isEqualOrParent(s,this.g.with({scheme:I,authority:"remote"})))return{content:e.remoteContent,localChange:e.remoteContent!==null?e.fileContent?2:1:3,remoteChange:0};if(this.h.isEqualOrParent(s,this.g))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:i===null?e.fileContent!==null?3:0:2,remoteChange:i===null?e.remoteContent!==null?3:0:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const r=i.map(([o,a])=>({...o,acceptResult:a}));r.every(({localChange:o,remoteChange:a})=>o===0&&a===0)&&this.O.info(`${this.D}: No changes found during synchronizing snippets.`),r.some(({localChange:o})=>o!==0)&&(await this.Bb(r),await this.Cb(r,n)),r.some(({remoteChange:o})=>o!==0)&&(e=await this.Db(r,e,n)),s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized snippets...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized snippets`));for(const{previewResource:o}of r)try{await this.G.del(o)}catch{}}Ab(e,s,i,n){const r=new Map;for(const o of Object.keys(e.local.added)){const a={content:e.local.added[o],hasConflicts:!1,localChange:1,remoteChange:0};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:null,fileContent:null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.local.updated)){const a={content:e.local.updated[o],hasConflicts:!1,localChange:2,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.local.removed){const a={content:null,hasConflicts:!1,localChange:3,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.added)){const a={content:e.remote.added[o],hasConflicts:!1,localChange:0,remoteChange:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(e.remote.updated)){const a={content:e.remote.updated[o],hasConflicts:!1,localChange:0,remoteChange:2},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o],localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.remote.removed){const a={content:null,hasConflicts:!1,localChange:0,remoteChange:3};r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:null,localContent:null,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o],previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of e.conflicts){const a={content:n[o]??null,hasConflicts:!0,localChange:s[o]?2:1,remoteChange:i[o]?2:1},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}for(const o of Object.keys(s))if(!r.has(o)){const a={content:s[o]?s[o].value.toString():null,hasConflicts:!1,localChange:0,remoteChange:0},c=s[o]?s[o].value.toString():null;r.set(o,{baseResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"base"}),baseContent:n[o]??null,localResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"local"}),fileContent:s[o]||null,localContent:c,remoteResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"remote"}),remoteContent:i[o]||null,previewResource:this.h.joinPath(this.g,o),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.h.joinPath(this.g,o).with({scheme:I,authority:"accepted"})})}return[...r.values()]}async resolveContent(e){return this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"remote"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"local"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"base"}))||this.h.isEqualOrParent(e,this.g.with({scheme:I,authority:"accepted"}))?this.cb(e):null}async hasLocalData(){try{const e=await this.Gb();if(Object.keys(e).length)return!0}catch{}return!1}async Bb(e){const s={};for(const i of e)i.fileContent&&(s[this.h.basename(i.localResource)]=i.fileContent);await this.mb(JSON.stringify(this.Fb(s)))}async Cb(e,s){for(const{fileContent:i,acceptResult:n,localResource:r,remoteResource:o,localChange:a}of e)if(a!==0){const c=o?this.h.basename(o):this.h.basename(r),l=this.h.joinPath(this.ub,c);a===3?(this.O.trace(`${this.D}: Deleting snippet...`,this.h.basename(l)),await this.G.del(l),this.O.info(`${this.D}: Deleted snippet`,this.h.basename(l))):a===1?(this.O.trace(`${this.D}: Creating snippet...`,this.h.basename(l)),await this.G.createFile(l,A.fromString(n.content),{overwrite:s}),this.O.info(`${this.D}: Created snippet`,this.h.basename(l))):(this.O.trace(`${this.D}: Updating snippet...`,this.h.basename(l)),await this.G.writeFile(l,A.fromString(n.content),s?void 0:i),this.O.info(`${this.D}: Updated snippet`,this.h.basename(l)))}}async Db(e,s,i){const n=s.syncData?this.Eb(s.syncData):{},r=qt(n);for(const{acceptResult:o,localResource:a,remoteResource:c,remoteChange:l}of e)if(l!==0){const h=a?this.h.basename(a):this.h.basename(c);l===3?delete r[h]:r[h]=o.content}return C6(n,r)||(this.O.trace(`${this.D}: Updating remote snippets...`),s=await this.lb(JSON.stringify(r),i?null:s.ref),this.O.info(`${this.D}: Updated remote snippets`)),s}Eb(e){return zu(e)}Fb(e){const s={};for(const i of Object.keys(e))s[i]=e[i].value.toString();return s}async Gb(){const e={};let s;try{s=await this.G.resolve(this.ub)}catch(i){if(i instanceof et&&i.fileOperationResult===1)return e;throw i}for(const i of s.children||[]){const n=i.resource,r=this.h.extname(n);if(r===".json"||r===".code-snippets"){const o=this.h.relativePath(this.ub,n),a=await this.G.readFile(n);e[o]=a}}return e}};_u=__decorate([__param(2,ae),__param(3,K),__param(4,ne),__param(5,nt),__param(6,xt),__param(7,Re),__param(8,ge),__param(9,pt),__param(10,ke),__param(11,he)],_u);var xm=class extends di{constructor(e,s,i,n,r,o){super("snippets",s,i,n,e,r,o)}async o(e){const s=e.syncData?JSON.parse(e.syncData.content):null;if(!s){this.j.info("Skipping initializing snippets because remote snippets does not exist.");return}if(!await this.i()){this.j.info("Skipping initializing snippets because local snippets exist.");return}for(const n of Object.keys(s)){const r=s[n];if(r){const o=this.d.joinPath(this.g.defaultProfile.snippetsHome,n);await this.k.createFile(o,A.fromString(r)),this.j.info("Created snippet",this.d.basename(o))}}await this.n(e)}async i(){try{return!(await this.k.resolve(this.g.defaultProfile.snippetsHome)).children?.length}catch(e){return e.fileOperationResult===1}}};xm=__decorate([__param(0,K),__param(1,je),__param(2,ae),__param(3,Re),__param(4,ne),__param(5,he)],xm);var ec=class extends Fa{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p,g){super(e,s,i,r,o,a,c,l,h,u,f,p,g),this.ob=1,this.zb=this.h.joinPath(this.g,n),this.Ab=this.zb.with({scheme:I,authority:"base"}),this.Bb=this.zb.with({scheme:I,authority:"local"}),this.Cb=this.zb.with({scheme:I,authority:"remote"}),this.Db=this.zb.with({scheme:I,authority:"accepted"})}async pb(e,s,i,n){const r=e.syncData?this.Eb(e.syncData.content):null;s=s===null&&i?e:s;const o=s?.syncData?this.Eb(s.syncData.content):null,a=await this.ub();let c=null,l=!1,h=!1,u=!1;if(e.syncData){const g=a?a.value.toString():null;if(!o||o!==g||o!==r){this.O.trace(`${this.D}: Merging remote ${this.syncResource.syncResource} with local ${this.syncResource.syncResource}...`);const m=this.Lb(g,r,o);c=m.content,u=m.hasConflicts,l=m.hasLocalChanged,h=m.hasRemoteChanged}}else a&&(this.O.trace(`${this.D}: Remote ${this.syncResource.syncResource} does not exist. Synchronizing ${this.syncResource.syncResource} for the first time.`),c=a.value.toString(),h=!0);const f={content:u?o:c,localChange:l?a?2:1:0,remoteChange:h?2:0,hasConflicts:u},p=a?a.value.toString():null;return[{fileContent:a,baseResource:this.Ab,baseContent:o,localResource:this.Bb,localContent:p,localChange:f.localChange,remoteResource:this.Cb,remoteContent:r,remoteChange:f.remoteChange,previewResource:this.zb,previewResult:f,acceptedResource:this.Db}]}async tb(e){const s=e?.syncData?this.Eb(e.syncData.content):null;if(s===null)return!0;const i=await this.ub(),n=i?i.value.toString():null,r=this.Lb(n,s,s);return r.hasLocalChanged||r.hasRemoteChanged}async qb(e,s){return e.previewResult}async rb(e,s,i,n){if(this.h.isEqual(s,this.Bb))return{content:e.fileContent?e.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.h.isEqual(s,this.Cb))return{content:e.remoteContent,localChange:2,remoteChange:0};if(this.h.isEqual(s,this.zb))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${s.toString()}`)}async sb(e,s,i,n){const{fileContent:r}=i[0][0],{content:o,localChange:a,remoteChange:c}=i[0][1];if(a===0&&c===0&&this.O.info(`${this.D}: No changes found during synchronizing ${this.syncResource.syncResource}.`),a!==0&&(this.O.trace(`${this.D}: Updating local ${this.syncResource.syncResource}...`),r&&await this.mb(JSON.stringify(this.Fb(r.value.toString()))),o?await this.vb(o,r,n):await this.wb(),this.O.info(`${this.D}: Updated local ${this.syncResource.syncResource}`)),c!==0){this.O.trace(`${this.D}: Updating remote ${this.syncResource.syncResource}...`);const l=JSON.stringify(this.Fb(o));e=await this.lb(l,n?null:e.ref),this.O.info(`${this.D}: Updated remote ${this.syncResource.syncResource}`)}try{await this.G.del(this.zb)}catch{}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized ${this.syncResource.syncResource}...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized ${this.syncResource.syncResource}`))}async hasLocalData(){return this.G.exists(this.r)}async resolveContent(e){return this.h.isEqual(this.Cb,e)||this.h.isEqual(this.Ab,e)||this.h.isEqual(this.Bb,e)||this.h.isEqual(this.Db,e)?this.cb(e):null}Lb(e,s,i){if(e===null&&s===null&&i===null)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};if(e===s)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};const n=i!==e,r=i!==s;return!n&&!r?{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1}:n&&!r?{content:e,hasRemoteChanged:!0,hasLocalChanged:!1,hasConflicts:!1}:r&&!n?{content:s,hasLocalChanged:!0,hasRemoteChanged:!1,hasConflicts:!1}:{content:e,hasLocalChanged:!0,hasRemoteChanged:!0,hasConflicts:!0}}};ec=__decorate([__param(4,K),__param(5,ae),__param(6,ne),__param(7,nt),__param(8,xt),__param(9,pt),__param(10,ke),__param(11,Re),__param(12,ge),__param(13,he)],ec);function Vu(t,e){try{return JSON.parse(t).tasks??null}catch(s){return e.error(s),null}}var qu=class extends ec{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(e.tasksResource,{syncResource:"tasks",profile:e},s,"tasks.json",c,l,h,i,n,a,u,r,o,f)}Eb(e){return Vu(e,this.O)}Fb(e){return e?{tasks:e}:{}}};qu=__decorate([__param(2,nt),__param(3,xt),__param(4,Re),__param(5,ge),__param(6,pt),__param(7,K),__param(8,ae),__param(9,ne),__param(10,ke),__param(11,he)],qu);var km=class extends di{constructor(e,s,i,n,r,o){super("tasks",s,i,n,e,r,o),this.c=this.g.defaultProfile.tasksResource}async o(e){const s=e.syncData?Vu(e.syncData.content,this.j):null;if(!s){this.j.info("Skipping initializing tasks because remote tasks does not exist.");return}if(!await this.p()){this.j.info("Skipping initializing tasks because local tasks exist.");return}await this.k.writeFile(this.c,A.fromString(s)),await this.n(e)}async p(){return this.k.exists(this.c)}};km=__decorate([__param(0,K),__param(1,je),__param(2,ae),__param(3,Re),__param(4,ne),__param(5,he)],km);function Pm(t,e){try{return JSON.parse(t).mcp??null}catch(s){return e.error(s),null}}var Wu=class extends ec{constructor(e,s,i,n,r,o,a,c,l,h,u,f){super(e.mcpResource,{syncResource:"mcp",profile:e},s,"mcp.json",c,l,h,i,n,a,u,r,o,f)}Eb(e){return Pm(e,this.O)}Fb(e){return e?{mcp:e}:{}}};Wu=__decorate([__param(2,nt),__param(3,xt),__param(4,Re),__param(5,ge),__param(6,pt),__param(7,K),__param(8,ae),__param(9,ne),__param(10,ke),__param(11,he)],Wu);function tc(t,e,s,i){const n={added:[],removed:[],updated:[]};let r={added:[],removed:[],updated:[]};if(!e){const a=t.filter(({id:c})=>!i.includes(c));return a.length?r.added=a:r=null,{local:n,remote:r}}const o=Hu(t,e,i);if(o.added.length>0||o.removed.length>0||o.updated.length>0){const a=Hu(s,t,i),c=Hu(s,e,i);for(const l of c.removed){const h=t.find(u=>u.id===l);h&&n.removed.push(h)}for(const l of c.added){const h=e.find(u=>u.id===l);a.added.includes(l)?o.updated.includes(l)&&n.updated.push(h):n.added.push(h)}for(const l of c.updated)n.updated.push(e.find(h=>h.id===l));for(const l of a.added)c.added.includes(l)||r.added.push(t.find(h=>h.id===l));for(const l of a.updated)c.removed.includes(l)||c.updated.includes(l)||r.updated.push(t.find(h=>h.id===l));for(const l of a.removed){const h=e.find(u=>u.id===l);h&&r.removed.push(h)}}return r.added.length===0&&r.removed.length===0&&r.updated.length===0&&(r=null),{local:n,remote:r}}function Hu(t,e,s){t=t?t.filter(({id:c})=>!s.includes(c)):[],e=e.filter(({id:c})=>!s.includes(c));const i=t.map(({id:c})=>c),n=e.map(({id:c})=>c),r=n.filter(c=>!i.includes(c)),o=i.filter(c=>!n.includes(c)),a=[];for(const{id:c,name:l,icon:h,useDefaultFlags:u}of t){if(o.includes(c))continue;const f=e.find(p=>p.id===c);(!f||f.name!==l||f.icon!==h||!yt(f.useDefaultFlags,u))&&a.push(c)}return{added:r,removed:o,updated:a}}var Vr=class extends fi{constructor(e,s,i,n,r,o,a,c,l,h,u,f,p){super({syncResource:"profiles",profile:e},s,n,r,o,a,c,u,f,l,h,p),this.ub=i,this.ob=2,this.previewResource=this.h.joinPath(this.g,"profiles.json"),this.baseResource=this.previewResource.with({scheme:I,authority:"base"}),this.localResource=this.previewResource.with({scheme:I,authority:"local"}),this.remoteResource=this.previewResource.with({scheme:I,authority:"remote"}),this.acceptedResource=this.previewResource.with({scheme:I,authority:"accepted"}),this.B(i.onDidChangeProfiles(()=>this.Q()))}async getLastSyncedProfiles(){const e=await this.getLastSyncUserData();return e?.syncData?Ji(e.syncData):null}async getRemoteSyncedProfiles(e){const s=await this.getLastSyncUserData(),i=await this.W(e,s);return i?.syncData?Ji(i.syncData):null}async pb(e,s,i){const n=e.syncData?Ji(e.syncData):null,r=s?.syncData?Ji(s.syncData):null,o=this.Cb(),{local:a,remote:c}=tc(o,n,r,[]),l={local:a,remote:c,content:r?this.Db(r):null,localChange:a.added.length>0||a.removed.length>0||a.updated.length>0?2:0,remoteChange:c!==null?2:0},h=Gu(o,!1);return[{baseResource:this.baseResource,baseContent:r?this.Db(r):null,localResource:this.localResource,localContent:h,remoteResource:this.remoteResource,remoteContent:n?this.Db(n):null,remoteProfiles:n,previewResource:this.previewResource,previewResult:l,localChange:l.localChange,remoteChange:l.remoteChange,acceptedResource:this.acceptedResource}]}async tb(e){const s=e?.syncData?Ji(e.syncData):null,i=this.Cb(),{remote:n}=tc(i,s,s,[]);return!!n?.added.length||!!n?.removed.length||!!n?.updated.length}async qb(e,s){return{...e.previewResult,hasConflicts:!1}}async rb(e,s,i,n){if(this.h.isEqual(s,this.localResource))return this.zb(e);if(this.h.isEqual(s,this.remoteResource))return this.Ab(e);if(this.h.isEqual(s,this.previewResource))return e.previewResult;throw new Error(`Invalid Resource: ${s.toString()}`)}async zb(e){const s=this.Cb(),i=tc(s,null,null,[]),{local:n,remote:r}=i;return{content:e.localContent,local:n,remote:r,localChange:n.added.length>0||n.removed.length>0||n.updated.length>0?2:0,remoteChange:r!==null?2:0}}async Ab(e){const s=e.remoteContent?JSON.parse(e.remoteContent):null,i=[],n=[];for(const r of this.Cb()){const o=s?.find(a=>a.id===r.id);o&&(i.push({id:r.id,name:r.name,collection:o.collection}),n.push(r))}if(s!==null){const r=tc(n,s,i,[]),{local:o,remote:a}=r;return{content:e.remoteContent,local:o,remote:a,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:a!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async sb(e,s,i,n){const{local:r,remote:o,localChange:a,remoteChange:c}=i[0][1];a===0&&c===0&&this.O.info(`${this.D}: No changes found during synchronizing profiles.`);const l=i[0][0].remoteProfiles||[];if(l.length+(o?.added.length??0)-(o?.removed.length??0)>20)throw new Pe("Too many profiles to sync. Please remove some profiles and try again.","LocalTooManyProfiles");if(a!==0&&(await this.mb(Gu(this.Cb(),!1)),await Promise.all(r.removed.map(async h=>{this.O.trace(`${this.D}: Removing '${h.name}' profile...`),await this.ub.removeProfile(h),this.O.info(`${this.D}: Removed profile '${h.name}'.`)})),await Promise.all(r.added.map(async h=>{this.O.trace(`${this.D}: Creating '${h.name}' profile...`),await this.ub.createProfile(h.id,h.name,{icon:h.icon,useDefaultFlags:h.useDefaultFlags}),this.O.info(`${this.D}: Created profile '${h.name}'.`)})),await Promise.all(r.updated.map(async h=>{const u=this.ub.profiles.find(f=>f.id===h.id);u?(this.O.trace(`${this.D}: Updating '${h.name}' profile...`),await this.ub.updateProfile(u,{name:h.name,icon:h.icon,useDefaultFlags:h.useDefaultFlags}),this.O.info(`${this.D}: Updated profile '${h.name}'.`)):this.O.info(`${this.D}: Could not find profile with id '${h.id}' to update.`)}))),c!==0){this.O.trace(`${this.D}: Updating remote profiles...`);const h=[],u=l.length+(o?.added.length??0)<=20;if(u)for(const f of o?.added||[]){const p=await this.J.createCollection(this.F);this.O.trace(`${this.D}: Created collection "${p}" for "${f.name}".`),h.push(p),l.push({id:f.id,name:f.name,collection:p,icon:f.icon,useDefaultFlags:f.useDefaultFlags})}else this.O.info(`${this.D}: Could not create remote profiles as there are too many profiles.`);for(const f of o?.removed||[])l.splice(l.findIndex(({id:p})=>f.id===p),1);for(const f of o?.updated||[]){const p=l.find(({id:g})=>f.id===g);p&&l.splice(l.indexOf(p),1,{...p,id:f.id,name:f.name,icon:f.icon,useDefaultFlags:f.useDefaultFlags})}try{e=await this.updateRemoteProfiles(l,n?null:e.ref),this.O.info(`${this.D}: Updated remote profiles.${u&&o?.added.length?` Added: ${JSON.stringify(o.added.map(f=>f.name))}.`:""}${o?.updated.length?` Updated: ${JSON.stringify(o.updated.map(f=>f.name))}.`:""}${o?.removed.length?` Removed: ${JSON.stringify(o.removed.map(f=>f.name))}.`:""}`)}catch(f){if(h.length){this.O.info(`${this.D}: Failed to update remote profiles. Cleaning up added collections...`);for(const p of h)await this.J.deleteCollection(p,this.F)}throw f}for(const f of o?.removed||[])await this.J.deleteCollection(f.collection,this.F)}s?.ref!==e.ref&&(this.O.trace(`${this.D}: Updating last synchronized profiles...`),await this.eb(e),this.O.info(`${this.D}: Updated last synchronized profiles.`))}async updateRemoteProfiles(e,s){return this.lb(this.Db(e),s)}async hasLocalData(){return this.Cb().length>0}async resolveContent(e){if(this.h.isEqual(this.remoteResource,e)||this.h.isEqual(this.baseResource,e)||this.h.isEqual(this.localResource,e)||this.h.isEqual(this.acceptedResource,e)){const s=await this.cb(e);return s&&Sr(JSON.parse(s),{})}return null}Cb(){return this.ub.profiles.filter(e=>!e.isDefault&&!e.isTransient)}Db(e){return JSON.stringify([...e].sort((s,i)=>s.name.localeCompare(i.name)))}};Vr=__decorate([__param(2,je),__param(3,K),__param(4,ae),__param(5,ne),__param(6,nt),__param(7,xt),__param(8,Re),__param(9,ge),__param(10,pt),__param(11,ke),__param(12,he)],Vr);function Gu(t,e){const s=[...t].sort((i,n)=>i.name.localeCompare(n.name)).map(i=>({id:i.id,name:i.name}));return e?Sr(s,{}):JSON.stringify(s)}function Ji(t){return JSON.parse(t.content)}var Ju="sync.lastSyncTime",Ku=class extends T{get status(){return this.f}get conflicts(){return this.j}get lastSyncTime(){return this.t}constructor(e,s,i,n,r,o,a,c,l,h,u){super(),this.C=e,this.D=s,this.F=i,this.G=n,this.H=r,this.I=o,this.J=a,this.L=c,this.M=l,this.N=h,this.O=u,this.f="uninitialized",this.g=this.B(new R),this.onDidChangeStatus=this.g.event,this.h=this.B(new R),this.onDidChangeLocal=this.h.event,this.j=[],this.m=this.B(new R),this.onDidChangeConflicts=this.m.event,this.n=[],this.r=this.B(new R),this.onSyncErrors=this.r.event,this.t=void 0,this.u=this.B(new R),this.onDidChangeLastSyncTime=this.u.event,this.w=this.B(new R),this.onDidResetLocal=this.w.event,this.y=this.B(new R),this.onDidResetRemote=this.y.event,this.z=new Map,this.f=i.userDataSyncStore?"idle":"uninitialized",this.t=this.J.getNumber(Ju,-1,void 0),this.B(de(()=>this.cb())),this.B(new fs(()=>this.W(),5*1e3)).schedule()}async createSyncTask(e,s){this.db(),this.H.info("Sync started.");const i=new Date().getTime(),n=st();try{const c=jn(n);s&&(c["Cache-Control"]="no-cache"),e=await this.D.manifest(e,c)}catch(c){const l=Pe.toUserDataSyncError(c);throw sc(l,n,this.F,this.I),l}const r=!1,o=this;let a;return{manifest:e,async run(){if(r)throw new Error("Can run a task only once");a=vt(c=>o.P(e,!1,n,c)),await a.finally(()=>a=void 0),o.H.info(`Sync done. Took ${new Date().getTime()-i}ms`),o.ab()},stop(){return a?.cancel(),o.U()}}}async createManualSyncTask(){if(this.db(),this.L.isEnabled())throw new Pe("Cannot start manual sync when sync is enabled","LocalError");this.H.info("Sync started.");const e=new Date().getTime(),s=st(),i=jn(s);let n;try{n=await this.D.getLatestData(i)}catch(a){const c=Pe.toUserDataSyncError(a);this.I.publicLog2("sync.download.latest",{code:c.code,serverCode:c instanceof Ie?String(c.serverCode):void 0,url:c instanceof Ie?c.url:void 0,resource:c.resource,executionId:s,service:this.F.userDataSyncStore.url.toString()});try{n=await this.D.manifest(null,i)}catch(l){const h=Pe.toUserDataSyncError(l);throw sc(h,s,this.F,this.I),h}}await this.resetLocal();const r=this,o=new Ss;return{id:s,async merge(){return r.P(n,!0,s,o.token)},async apply(){try{try{await r.R(n,s,o.token)}catch(a){if(Pe.toUserDataSyncError(a).code==="MethodNotFound")r.H.info("Client is making invalid requests. Cleaning up data..."),await r.cleanUpRemoteData(),r.H.info("Applying manual sync again..."),await r.R(n,s,o.token);else throw a}}catch(a){throw r.H.error(a),a}r.H.info(`Sync done. Took ${new Date().getTime()-e}ms`),r.ab()},async stop(){o.cancel(),await r.U(),await r.resetLocal()}}}async P(e,s,i,n){this.n=[];try{this.status!=="hasConflicts"&&this.Z("syncing");const r=this.getOrCreateActiveProfileSynchronizer(this.M.defaultProfile,void 0);this.n.push(...await this.S(r,e,s,i,n));const o=r.enabled.find(a=>a.resource==="profiles");if(o){const a=await o.getLastSyncedProfiles()||[];if(n.isCancellationRequested)return;await this.Q(a,e,s,i,n)}}finally{this.status!=="hasConflicts"&&this.Z("idle"),this.r.fire(this.n)}}async Q(e,s,i,n,r){for(const o of e){if(r.isCancellationRequested)return;const a=this.M.profiles.find(l=>l.id===o.id);if(!a){this.H.error(`Profile with id:${o.id} and name: ${o.name} does not exist locally to sync.`);continue}this.H.info("Syncing profile.",o.name);const c=this.getOrCreateActiveProfileSynchronizer(a,o);this.n.push(...await this.S(c,s,i,n,r))}for(const[o,a]of this.z.entries())this.M.profiles.some(c=>c.id===a[0].profile.id)||(await a[0].resetLocal(),a[1].dispose(),this.z.delete(o))}async R(e,s,i){try{this.Z("syncing");const n=this.bb();for(const l of n){if(i.isCancellationRequested)return;await l.apply(s,i)}const r=n.find(l=>l.profile.isDefault);if(!r)return;const o=r.enabled.find(l=>l.resource==="profiles");if(!o)return;const c=(await o.getRemoteSyncedProfiles(Qu(e,void 0,"profiles")??null)||[]).filter(l=>n.every(h=>h.profile.id!==l.id));c.length&&await this.Q(c,e,!1,s,i)}finally{this.Z("idle")}}async S(e,s,i,n,r){return(await e.sync(s,i,n,r)).map(([a,c])=>({profile:e.profile,syncResource:a,error:c}))}async U(){this.status!=="idle"&&await Promise.allSettled(this.bb().map(e=>e.stop()))}async resolveContent(e){const s=await this.N.resolveContent(e);if(s)return s;for(const i of this.bb())for(const n of i.enabled){const r=await n.resolveContent(e);if(r)return r}return null}async replace(e){this.db();const s=this.N.resolveUserDataSyncResource(e);if(!s)return;const i=await this.resolveContent(e.uri);i&&await this.X(s.profile,async n=>{if(s.syncResource===n.resource)return await n.replace(i),!0})}async accept(e,s,i,n){this.db(),await this.X(e.profile,async r=>{if(e.syncResource===r.resource)return await r.accept(s,i),n&&await r.apply(Kt(n)?!1:n.force,jn(st())),!0})}async hasLocalData(){return!!await this.X(this.M.defaultProfile,async s=>{if(s.resource!=="globalState"&&await s.hasLocalData())return!0})}async hasPreviouslySynced(){return!!await this.X(this.M.defaultProfile,async s=>{if(await s.hasPreviouslySynced())return!0})}async reset(){this.db(),await this.resetRemote(),await this.resetLocal()}async resetRemote(){this.db();try{await this.D.clear(),this.H.info("Cleared data on server")}catch(e){this.H.error(e)}this.y.fire()}async resetLocal(){this.db(),this.t=void 0,this.J.remove(Ju,-1);for(const[e]of this.z.values())try{await e.resetLocal()}catch(s){this.H.error(s)}this.cb(),this.w.fire(),this.H.info("Did reset the local sync state.")}async W(){const e=this.J.keys(-1,1),s=[];for(const n of e){if(!n.endsWith(".lastSyncUserData"))continue;const r=n.split(".");r.length===3&&s.push([n,r[0]])}if(!s.length)return;const i=new De;try{let n=this.z.get(this.M.defaultProfile.id)?.[0];n||(n=i.add(this.G.createInstance(Fn,this.M.defaultProfile,void 0)));const r=n.enabled.find(c=>c.resource==="profiles");if(!r)return;const a=(await r.getLastSyncedProfiles())?.map(c=>c.collection)??[];for(const[c,l]of s)a.includes(l)||(this.H.info(`Removing last sync state for stale profile: ${l}`),this.J.remove(c,-1))}finally{i.dispose()}}async cleanUpRemoteData(){const e=await this.N.getRemoteSyncedProfiles(),s=e.map(o=>o.collection),i=await this.D.getAllCollections(),n=i.filter(o=>!s.includes(o));n.length&&(this.H.info(`Deleting ${n.length} redundant collections on server`),await Promise.allSettled(n.map(o=>this.D.deleteCollection(o))),this.H.info("Deleted redundant collections on server"));const r=e.filter(o=>i.includes(o.collection));if(r.length!==e.length){const o=this.G.createInstance(Vr,this.M.defaultProfile,void 0);try{this.H.info("Resetting the last synced state of profiles"),await o.resetLocal(),this.H.info("Did reset the last synced state of profiles"),this.H.info("Updating remote profiles with invalid collections on server"),await o.updateRemoteProfiles(r,null),this.H.info("Updated remote profiles on server")}finally{o.dispose()}}}async saveRemoteActivityData(e){this.db();const s=await this.D.getActivityData();await this.C.writeFile(e,s)}async extractActivityData(e,s){const i=(await this.C.readFile(e)).value.toString(),n=JSON.parse(i);if(n.resources)for(const r in n.resources)for(const o of n.resources[r])await this.O.writeResource(r,o.content,new Date(o.created*1e3),void 0,s);if(n.collections)for(const r in n.collections)for(const o in n.collections[r].resources)for(const a of n.collections[r].resources?.[o]??[])await this.O.writeResource(o,a.content,new Date(a.created*1e3),r,s)}async X(e,s){const i=new De;try{const n=this.z.get(e.id);if(n){const l=await this.Y(n[0],s,i);return rt(l)?null:l}if(e.isDefault){const l=i.add(this.G.createInstance(Fn,e,void 0)),h=await this.Y(l,s,i);return rt(h)?null:h}const r=i.add(this.G.createInstance(Vr,e,void 0)),o=await this.D.manifest(null),c=(await r.getRemoteSyncedProfiles(o?.latest?.profiles??null)||[]).find(l=>l.id===e.id);if(c){const l=i.add(this.G.createInstance(Fn,e,c.collection)),h=await this.Y(l,s,i);return rt(h)?null:h}return null}finally{i.dispose()}}async Y(e,s,i){const n=[...e.enabled,...e.disabled.reduce((r,o)=>(o!=="workspaceState"&&r.push(i.add(e.createSynchronizer(o))),r),[])];for(const r of n){const o=await s(r);if(!rt(o))return o}}Z(e){const s=this.f;this.f!==e&&(this.f=e,this.g.fire(e),s==="hasConflicts"&&this.ab())}$(){const e=this.bb().map(s=>s.conflicts).flat();Tt(this.j,e,(s,i)=>s.profile.id===i.profile.id&&s.syncResource===i.syncResource&&Tt(s.conflicts,i.conflicts,(n,r)=>_s(n.previewResource,r.previewResource)))||(this.j=e,this.m.fire(e))}ab(){this.status==="idle"&&(this.t=new Date().getTime(),this.J.store(Ju,this.t,-1,1),this.u.fire(this.t))}getOrCreateActiveProfileSynchronizer(e,s){let i=this.z.get(e.id);if(i&&i[0].collection!==s?.collection&&(this.H.error("Profile synchronizer collection does not match with the remote sync profile collection"),i[1].dispose(),i=void 0,this.z.delete(e.id)),!i){const n=new De,r=n.add(this.G.createInstance(Fn,e,s?.collection));n.add(r.onDidChangeStatus(o=>this.Z(o))),n.add(r.onDidChangeConflicts(o=>this.$())),n.add(r.onDidChangeLocal(o=>this.h.fire(o))),this.z.set(e.id,i=[r,n])}return i[0]}bb(){const e=[];for(const[s]of this.z.values())e.push(s);return e}cb(){this.z.forEach(([,e])=>e.dispose()),this.z.clear()}db(){if(!this.F.userDataSyncStore)throw new Error("Not enabled")}};Ku=__decorate([__param(0,K),__param(1,nt),__param(2,li),__param(3,is),__param(4,Re),__param(5,ke),__param(6,ne),__param(7,pt),__param(8,je),__param(9,nu),__param(10,xt)],Ku);var Fn=class extends T{get enabled(){return this.f.sort((e,s)=>e[1]-s[1]).map(([e])=>e)}get disabled(){return Nn.filter(e=>!this.r.isResourceEnabled(e))}get status(){return this.g}get conflicts(){return this.m}constructor(e,s,i,n,r,o,a,c,l){super(),this.profile=e,this.collection=s,this.r=i,this.t=n,this.u=r,this.w=o,this.y=a,this.z=c,this.C=l,this.f=[],this.g="idle",this.h=this.B(new R),this.onDidChangeStatus=this.h.event,this.j=this.B(new R),this.onDidChangeLocal=this.j.event,this.m=[],this.n=this.B(new R),this.onDidChangeConflicts=this.n.event,this.B(i.onDidChangeResourceEnablement(([h,u])=>this.D(h,u))),this.B(de(()=>this.f.splice(0,this.f.length).forEach(([,,h])=>h.dispose())));for(const h of Nn)i.isResourceEnabled(h)&&this.F(h)}D(e,s){s?this.F(e):this.G(e)}F(e){if(this.f.some(([r])=>r.resource===e))return;if(e==="extensions"&&!this.u.isEnabled()){this.z.info("Skipping extensions sync because gallery is not configured");return}if(e==="profiles"&&!this.profile.isDefault||e==="workspaceState")return;if(e!=="profiles"&&this.profile.useDefaultFlags?.[e]){this.z.debug(`Skipping syncing ${e} in ${this.profile.name} because it is already synced by default profile`);return}const s=new De,i=s.add(this.createSynchronizer(e));s.add(i.onDidChangeStatus(()=>this.L())),s.add(i.onDidChangeConflicts(()=>this.M())),s.add(i.onDidChangeLocal(()=>this.j.fire(e)));const n=this.N(e);this.f.push([i,n,s])}G(e){const s=this.f.findIndex(([i])=>i.resource===e);if(s!==-1){const[[i,,n]]=this.f.splice(s,1);n.dispose(),this.L(),i.stop().then(null,r=>this.z.error(r))}}createSynchronizer(e){switch(e){case"settings":return this.t.createInstance(Za,this.profile,this.collection);case"keybindings":return this.t.createInstance(Au,this.profile,this.collection);case"snippets":return this.t.createInstance(_u,this.profile,this.collection);case"prompts":return this.t.createInstance(ju,this.profile,this.collection);case"tasks":return this.t.createInstance(qu,this.profile,this.collection);case"mcp":return this.t.createInstance(Wu,this.profile,this.collection);case"globalState":return this.t.createInstance(Ru,this.profile,this.collection);case"extensions":return this.t.createInstance(ku,this.profile,this.collection);case"profiles":return this.t.createInstance(Vr,this.profile,this.collection)}}async sync(e,s,i,n){if(n.isCancellationRequested)return[];const r=this.enabled;if(!r.length)return[];try{const o=[],a=jn(i),c=s?await this.H(e):this.I();for(const l of r){if(n.isCancellationRequested)return[];if(!this.r.isResourceEnabled(l.resource))return[];try{const h=Qu(e,this.collection,l.resource)??null;await l.sync(h,s,c,a)}catch(h){const u=Pe.toUserDataSyncError(h);if(sc(u,i,this.w,this.y),Rm(h))throw u;this.z.error(h),this.z.error(`${l.resource}: ${Qt(h)}`),o.push([l.resource,u])}}return o}finally{this.L()}}async apply(e,s){const i=jn(e);for(const n of this.enabled){if(s.isCancellationRequested)return;try{await n.apply(!1,i)}catch(r){const o=Pe.toUserDataSyncError(r);if(sc(o,e,this.w,this.y),Rm(r))throw o;this.z.error(r),this.z.error(`${n.resource}: ${Qt(r)}`)}}}async stop(){for(const e of this.enabled)try{e.status!=="idle"&&await e.stop()}catch(s){this.z.error(s)}}async resetLocal(){for(const e of this.enabled)try{await e.resetLocal()}catch(s){this.z.error(`${e.resource}: ${Qt(s)}`),this.z.error(s)}}async H(e){if(!this.profile.isDefault)return{};const s=this.I(),i=this.enabled.find(n=>n instanceof Za);if(i){const n=await i.getRemoteUserDataSyncConfiguration(Qu(e,this.collection,"settings")??null);return{...s,...n}}return s}I(){return this.C.getValue(Ia)}J(e){this.g!==e&&(this.g=e,this.h.fire(e))}L(){return this.M(),this.enabled.some(e=>e.status==="hasConflicts")?this.J("hasConflicts"):this.enabled.some(e=>e.status==="syncing")?this.J("syncing"):this.J("idle")}M(){const e=this.enabled.filter(s=>s.status==="hasConflicts").filter(s=>s.conflicts.conflicts.length>0).map(s=>s.conflicts);Tt(this.m,e,(s,i)=>s.syncResource===i.syncResource&&Tt(s.conflicts,i.conflicts,(n,r)=>_s(n.previewResource,r.previewResource)))||(this.m=e,this.n.fire(e))}N(e){switch(e){case"settings":return 0;case"keybindings":return 1;case"snippets":return 2;case"tasks":return 3;case"mcp":return 4;case"globalState":return 5;case"extensions":return 6;case"prompts":return 7;case"profiles":return 8;case"workspaceState":return 9}}};Fn=__decorate([__param(2,pt),__param(3,is),__param(4,Es),__param(5,li),__param(6,ke),__param(7,Re),__param(8,ge)],Fn);function Rm(t){if(t instanceof Pe)switch(t.code){case"MethodNotFound":case"TooLarge":case"RemoteTooManyRequests":case"TooManyRequestsAndRetryAfter":case"LocalTooManyRequests":case"LocalTooManyProfiles":case"Gone":case"UpgradeRequired":case"IncompatibleRemoteContent":case"IncompatibleLocalContent":return!0}return!1}function sc(t,e,s,i){i.publicLog2("sync/error",{code:t.code,serverCode:t instanceof Ie?String(t.serverCode):void 0,url:t instanceof Ie?t.url:void 0,resource:t.resource,executionId:e,service:s.userDataSyncStore.url.toString()})}function Qu(t,e,s){return J7(t)?e?t?.collections?.[e]?.latest?.[s]:t?.latest?.[s]:e?t?.collections?.[e]?.resources?.[s]:t?.resources?.[s]}function D6(t,e){return{...t,profile:Yt(t.profile,e.profilesHome.scheme)}}function I6(t){return{created:t.created,uri:k.revive(t.uri)}}var O6=class{constructor(t,e,s){this.c=t,this.d=e,this.f=s,this.a=new Map,this.b=new R}listen(t,e){switch(e){case"onDidChangeStatus":return this.c.onDidChangeStatus;case"onDidChangeConflicts":return this.c.onDidChangeConflicts;case"onDidChangeLocal":return this.c.onDidChangeLocal;case"onDidChangeLastSyncTime":return this.c.onDidChangeLastSyncTime;case"onSyncErrors":return this.c.onSyncErrors;case"onDidResetLocal":return this.c.onDidResetLocal;case"onDidResetRemote":return this.c.onDidResetRemote;case"manualSync/onSynchronizeResources":return this.b.event}throw new Error(`[UserDataSyncServiceChannel] Event not found: ${e}`)}async call(t,e,s){try{return await this.g(t,e,s)}catch(i){throw this.f.error(i),i}}async g(t,e,s){switch(e){case"_getInitialData":return Promise.resolve([this.c.status,this.c.conflicts,this.c.lastSyncTime]);case"reset":return this.c.reset();case"resetRemote":return this.c.resetRemote();case"resetLocal":return this.c.resetLocal();case"hasPreviouslySynced":return this.c.hasPreviouslySynced();case"hasLocalData":return this.c.hasLocalData();case"resolveContent":return this.c.resolveContent(k.revive(s[0]));case"accept":return this.c.accept(D6(s[0],this.d),k.revive(s[1]),s[2],s[3]);case"replace":return this.c.replace(I6(s[0]));case"cleanUpRemoteData":return this.c.cleanUpRemoteData();case"getRemoteActivityData":return this.c.saveRemoteActivityData(k.revive(s[0]));case"extractActivityData":return this.c.extractActivityData(k.revive(s[0]),k.revive(s[1]));case"createManualSyncTask":return this.i()}if(e.startsWith("manualSync/")){const i=e.substring(11),n=s[0],r=this.h(n);switch(s=s.slice(1),i){case"merge":return r.merge();case"apply":return r.apply().then(()=>this.a.delete(this.j(r.id)));case"stop":return r.stop().finally(()=>this.a.delete(this.j(r.id)))}}throw new Error("Invalid call")}h(t){const e=this.a.get(this.j(t));if(!e)throw new Error(`Manual sync taks not found: ${t}`);return e}async i(){const t=await this.c.createManualSyncTask();return this.a.set(this.j(t.id),t),t.id}j(t){return`manualSyncTask-${t}`}},Cm=class extends T{get status(){return this.b}get onDidChangeLocal(){return this.a.listen("onDidChangeLocal")}get conflicts(){return this.f}get lastSyncTime(){return this.h}get onDidResetLocal(){return this.a.listen("onDidResetLocal")}get onDidResetRemote(){return this.a.listen("onDidResetRemote")}constructor(e,s){super(),this.n=s,this.b="uninitialized",this.c=this.B(new R),this.onDidChangeStatus=this.c.event,this.f=[],this.g=this.B(new R),this.onDidChangeConflicts=this.g.event,this.h=void 0,this.j=this.B(new R),this.onDidChangeLastSyncTime=this.j.event,this.m=this.B(new R),this.onSyncErrors=this.m.event,this.a={call(i,n,r){return e.call(i,n,r).then(null,o=>{throw Pe.toUserDataSyncError(o)})},listen(i,n){return e.listen(i,n)}},this.a.call("_getInitialData").then(([i,n,r])=>{this.s(i),this.t(n),r&&this.u(r),this.B(this.a.listen("onDidChangeStatus")(o=>this.s(o))),this.B(this.a.listen("onDidChangeLastSyncTime")(o=>this.u(o)))}),this.B(this.a.listen("onDidChangeConflicts")(i=>this.t(i))),this.B(this.a.listen("onSyncErrors")(i=>this.m.fire(i.map(n=>({...n,error:Pe.toUserDataSyncError(n.error)})))))}createSyncTask(){throw new Error("not supported")}async createManualSyncTask(){const e=await this.a.call("createManualSyncTask"),s=this;return new L6(e,{async call(n,r,o){return s.a.call(`manualSync/${n}`,[e,...Array.isArray(r)?r:[r]],o)},listen(){throw new Error("not supported")}})}reset(){return this.a.call("reset")}resetRemote(){return this.a.call("resetRemote")}resetLocal(){return this.a.call("resetLocal")}hasPreviouslySynced(){return this.a.call("hasPreviouslySynced")}hasLocalData(){return this.a.call("hasLocalData")}accept(e,s,i,n){return this.a.call("accept",[e,s,i,n])}resolveContent(e){return this.a.call("resolveContent",[e])}cleanUpRemoteData(){return this.a.call("cleanUpRemoteData")}replace(e){return this.a.call("replace",[e])}saveRemoteActivityData(e){return this.a.call("getRemoteActivityData",[e])}extractActivityData(e,s){return this.a.call("extractActivityData",[e,s])}async s(e){this.b=e,this.c.fire(e)}async t(e){this.f=e.map(s=>({syncResource:s.syncResource,profile:Yt(s.profile,this.n.profilesHome.scheme),conflicts:s.conflicts.map(i=>({...i,baseResource:k.revive(i.baseResource),localResource:k.revive(i.localResource),remoteResource:k.revive(i.remoteResource),previewResource:k.revive(i.previewResource)}))})),this.g.fire(this.f)}u(e){this.h!==e&&(this.h=e,this.j.fire(e))}};Cm=__decorate([__param(1,je)],Cm);var L6=class extends T{constructor(t,e){super(),this.id=t,this.a=e}async merge(){return this.a.call("merge")}async apply(){return this.a.call("apply")}stop(){return this.a.call("stop")}dispose(){this.a.call("dispose"),super.dispose()}},Xu=class extends u6{constructor(e,s,i,n){super(!0,e,s,i,n)}};Xu=__decorate([__param(0,Jo),__param(1,je),__param(2,ne),__param(3,Y)],Xu);var A6=class extends T{constructor({onDidOpenMainWindow:t,onDidFocusMainWindow:e,getActiveWindowId:s}){super(),this.a=this.B(new De),L.latch(L.any(t,e))(this.f,this,this.a),this.b=vt(()=>s()),(async()=>{try{const n=await this.b;this.c=typeof this.c=="number"?this.c:n}catch{}finally{this.b=void 0}})()}f(t){this.b&&(this.b.cancel(),this.b=void 0),this.c=t}async getActiveClientId(){return`window:${this.b?await this.b:this.c}`}},N6="signService",ic=W(N6),j6=class mv{constructor(){this.b=new Map}static{this.a=1}async createNewMessage(e){try{const s=await this.c();if(s){const i=String(mv.a++);return this.b.set(i,s),{id:i,data:s.createNewMessage(e)}}}catch{}return{id:"",data:e}}async validate(e,s){if(!e.id)return!0;const i=this.b.get(e.id);if(!i)return!1;this.b.delete(e.id);try{return i.validate(s)==="ok"}catch{return!1}finally{i.dispose?.()}}async sign(e){try{return await this.d(e)}catch{}return e}},T6=class extends j6{c(){return this.h().then(t=>new t.validator)}d(t){return this.h().then(e=>new e.signer().sign(t))}async h(){const t="vsda",{default:e}=await import(t);return e}},Ix=W("tunnelService"),Dm=W("sharedTunnelsService"),Im;(function(t){t.Http="http",t.Https="https"})(Im||(Im={}));var nc;(function(t){t.ConstantPrivate="constantPrivate",t.Private="private",t.Public="public"})(nc||(nc={}));function M6(t){return!!t.forwardPort}var Om;(function(t){t[t.Notify=1]="Notify",t[t.OpenBrowser=2]="OpenBrowser",t[t.OpenPreview=3]="OpenPreview",t[t.Silent=4]="Silent",t[t.Ignore=5]="Ignore",t[t.OpenBrowserOnce=6]="OpenBrowserOnce"})(Om||(Om={}));function F6(t){if(t.scheme!=="http"&&t.scheme!=="https")return;const e=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(t.authority);if(e)return{address:e[1],port:+e[2]}}var Zu=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function Yu(t){return Zu.indexOf(t)>=0}var ef=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function qr(t){return ef.indexOf(t)>=0}function U6(t,e,s,i){if(s===1)return!1;if(s===2&&qr(e)){const n=/(\d+)\.(\d+)\.(\d+)/g.exec(i);if(n?.length===4&&parseInt(n[1])>=18)return!1}return t<1024}var tf=class extends T{constructor(e,s){super(),this.r=e,this.s=s,this.a=new R,this.onTunnelOpened=this.a.event,this.b=new R,this.onTunnelClosed=this.b.event,this.c=new R,this.onAddedTunnelProvider=this.c.event,this.f=new Map,this.h=!1,this.j=!0,this.m=[],this.n=new Set}get hasTunnelProvider(){return!!this.g}get t(){const e=this.s.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this.g=e,e?(this.c.fire(),{dispose:()=>{this.g=void 0,this.h=!1,this.m=[]}}):(this.h=!1,this.m=[],this.c.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this.h=e.elevation,this.m=e.privacyOptions,this.j=e.protocol}get canChangeProtocol(){return this.j}get canElevate(){return this.h}get canChangePrivacy(){return this.m.length>0}get privacyOptions(){return this.m}get tunnels(){return this.u()}async u(){const e=[],s=Array.from(this.f.values());for(const i of s){const n=Array.from(i.values());for(const r of n){const o=await r.value;o&&typeof o!="string"&&e.push(o)}}return e}async dispose(){super.dispose();for(const e of this.f.values()){for(const{value:s}of e.values())await s.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this.f.clear()}setEnvironmentTunnel(e,s,i,n,r){this.z(e,s,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:s,localAddress:i,privacy:n,protocol:r,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,s){(qr(e)||Yu(e))&&(e=Zu[0]);const i=this.D(e,s);if(i)return++i.refcount,i.value}openTunnel(e,s,i,n,r,o=!1,a,c){this.r.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${s}:${i} on local port ${r}.`);const l=this.g??e;if(!l)return;if(s||(s="localhost"),n||(n=this.t),this.g&&this.n.has(i)){this.r.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}const h=this.F(l,s,i,n,r,o,a,c);return h?h.then(u=>{if(u){if(typeof u=="string")return this.r.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.C(s,i),u}else{this.r.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.C(s,i);return}this.r.trace("ForwardedPorts: (TunnelService) New tunnel established.");const f=this.w(u);return(u.tunnelRemoteHost!==s||u.tunnelRemotePort!==i)&&this.r.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),a&&u.privacy!==a&&this.r.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this.a.fire(f),f}):(this.r.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),h)}w(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.r.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);const s=this.f.get(e.tunnelRemoteHost);if(s){const i=s.get(e.tunnelRemotePort);i&&(i.refcount--,await this.y(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async y(e,s,i){if(i.refcount<=0){this.r.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${s}.`);const n=i.value.then(async r=>{r&&typeof r!="string"&&(await r.dispose(!0),this.b.fire({host:r.tunnelRemoteHost,port:r.tunnelRemotePort}))});return this.f.has(e)&&this.f.get(e).delete(s),n}}async closeTunnel(e,s){this.r.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${s} `);const i=this.f.get(e);if(i&&i.has(s)){const n=i.get(s);n.refcount=0,await this.y(e,s,n)}}z(e,s,i){this.f.has(e)||this.f.set(e,new Map),this.f.get(e).set(s,{refcount:1,value:i})}async C(e,s){const i=this.f.get(e);if(i){const n=i.get(s),r=n?await n.value:void 0;(!r||typeof r=="string")&&i.delete(s),i.size===0&&this.f.delete(e)}}D(e,s){const i=[e];Yu(e)?(i.push(...Zu),i.push(...ef)):qr(e)&&i.push(...ef);const n=i.map(r=>this.f.get(r));for(const r of n){const o=r?.get(s);if(o)return o}}canTunnel(e){return!!F6(e)}G(e,s,i,n,r,o,a){this.r.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${s}:${i} on local port ${n}.`);const c=i;this.n.add(c);const l=n===void 0?i:n,h={elevationRequired:r?this.isPortPrivileged(l):!1},u={remoteAddress:{host:s,port:i},localAddressPort:n,privacy:o,public:o?o!==nc.Private:void 0,protocol:a},f=e.forwardPort(u,h);return f?(this.z(s,i,f),f.finally(()=>{this.r.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this.n.delete(c)})):this.n.delete(c),f}};tf=__decorate([__param(0,Y),__param(1,ge)],tf);import*as B6 from"net";import*as z6 from"os";import*as _6 from"net";var Lm={1:!0,7:!0,9:!0,11:!0,13:!0,15:!0,17:!0,19:!0,20:!0,21:!0,22:!0,23:!0,25:!0,37:!0,42:!0,43:!0,53:!0,69:!0,77:!0,79:!0,87:!0,95:!0,101:!0,102:!0,103:!0,104:!0,109:!0,110:!0,111:!0,113:!0,115:!0,117:!0,119:!0,123:!0,135:!0,137:!0,139:!0,143:!0,161:!0,179:!0,389:!0,427:!0,465:!0,512:!0,513:!0,514:!0,515:!0,526:!0,530:!0,531:!0,532:!0,540:!0,548:!0,554:!0,556:!0,563:!0,587:!0,601:!0,636:!0,989:!0,990:!0,993:!0,995:!0,1719:!0,1720:!0,1723:!0,2049:!0,3659:!0,4045:!0,5060:!0,5061:!0,6e3:!0,6566:!0,6665:!0,6666:!0,6667:!0,6668:!0,6669:!0,6697:!0,10080:!0};function V6(t,e,s,i="127.0.0.1"){let n=!1,r,o=1;const a=_6.createServer({pauseOnConnect:!0});function c(l,h){n||(n=!0,a.removeAllListeners(),a.close(),r&&clearTimeout(r),h(l))}return new Promise(l=>{r=setTimeout(()=>{c(0,l)},s),a.on("listening",()=>{c(t,l)}),a.on("error",h=>{h&&(h.code==="EADDRINUSE"||h.code==="EACCES")&&o<e?(t++,o++,a.listen(t,i)):c(0,l)}),a.on("close",()=>{c(0,l)}),a.listen(t,i)})}import"crypto";import"net";import"os";import"zlib";var Am;(function(t){t.Created="created",t.Read="read",t.Write="write",t.Open="open",t.Error="error",t.Close="close",t.BrowserWebSocketBlobReceived="browserWebSocketBlobReceived",t.NodeEndReceived="nodeEndReceived",t.NodeEndSent="nodeEndSent",t.NodeDrainBegin="nodeDrainBegin",t.NodeDrainEnd="nodeDrainEnd",t.zlibInflateError="zlibInflateError",t.zlibInflateData="zlibInflateData",t.zlibInflateInitialWrite="zlibInflateInitialWrite",t.zlibInflateInitialFlushFired="zlibInflateInitialFlushFired",t.zlibInflateWrite="zlibInflateWrite",t.zlibInflateFlushFired="zlibInflateFlushFired",t.zlibDeflateError="zlibDeflateError",t.zlibDeflateData="zlibDeflateData",t.zlibDeflateWrite="zlibDeflateWrite",t.zlibDeflateFlushFired="zlibDeflateFlushFired",t.WebSocketNodeSocketWrite="webSocketNodeSocketWrite",t.WebSocketNodeSocketPeekedHeader="webSocketNodeSocketPeekedHeader",t.WebSocketNodeSocketReadHeader="webSocketNodeSocketReadHeader",t.WebSocketNodeSocketReadData="webSocketNodeSocketReadData",t.WebSocketNodeSocketUnmaskedData="webSocketNodeSocketUnmaskedData",t.WebSocketNodeSocketDrainBegin="webSocketNodeSocketDrainBegin",t.WebSocketNodeSocketDrainEnd="webSocketNodeSocketDrainEnd",t.ProtocolHeaderRead="protocolHeaderRead",t.ProtocolMessageRead="protocolMessageRead",t.ProtocolHeaderWrite="protocolHeaderWrite",t.ProtocolMessageWrite="protocolMessageWrite",t.ProtocolWrite="protocolWrite"})(Am||(Am={}));var sf;(function(t){t.enableDiagnostics=!1,t.records=[];const e=new WeakMap;let s=0;function i(r,o){if(!e.has(r)){const a=String(++s);e.set(r,a)}return e.get(r)}function n(r,o,a,c){if(!t.enableDiagnostics)return;const l=i(r,o);if(c instanceof A||c instanceof Uint8Array||c instanceof ArrayBuffer||ArrayBuffer.isView(c)){const h=A.alloc(c.byteLength);h.set(c),t.records.push({timestamp:Date.now(),id:l,label:o,type:a,buff:h})}else t.records.push({timestamp:Date.now(),id:l,label:o,type:a,data:c})}t.traceSocketEvent=n})(sf||(sf={}));var Nm;(function(t){t[t.NodeSocketCloseEvent=0]="NodeSocketCloseEvent",t[t.WebSocketCloseEvent=1]="WebSocketCloseEvent"})(Nm||(Nm={}));var nf=null;function pi(){return nf||(nf=A.alloc(0)),nf}var q6=class{get byteLength(){return this.b}constructor(){this.a=[],this.b=0}acceptChunk(t){this.a.push(t),this.b+=t.byteLength}read(t){return this.c(t,!0)}peek(t){return this.c(t,!1)}c(t,e){if(t===0)return pi();if(t>this.b)throw new Error("Cannot read so many bytes!");if(this.a[0].byteLength===t){const r=this.a[0];return e&&(this.a.shift(),this.b-=t),r}if(this.a[0].byteLength>t){const r=this.a[0].slice(0,t);return e&&(this.a[0]=this.a[0].slice(t),this.b-=t),r}const s=A.alloc(t);let i=0,n=0;for(;t>0;){const r=this.a[n];if(r.byteLength>t){const o=r.slice(0,t);s.set(o,i),i+=t,e&&(this.a[n]=r.slice(t),this.b-=t),t-=t}else s.set(r,i),i+=r.byteLength,e?(this.a.shift(),this.b-=r.byteLength):n++,t-=r.byteLength}return s}},jm;(function(t){t[t.None=0]="None",t[t.Regular=1]="Regular",t[t.Control=2]="Control",t[t.Ack=3]="Ack",t[t.Disconnect=5]="Disconnect",t[t.ReplayRequest=6]="ReplayRequest",t[t.Pause=7]="Pause",t[t.Resume=8]="Resume",t[t.KeepAlive=9]="KeepAlive"})(jm||(jm={}));function Tm(t){switch(t){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}var Mm;(function(t){t[t.HeaderLength=13]="HeaderLength",t[t.AcknowledgeTime=2e3]="AcknowledgeTime",t[t.TimeoutTime=2e4]="TimeoutTime",t[t.ReconnectionGraceTime=108e5]="ReconnectionGraceTime",t[t.ReconnectionShortGraceTime=3e5]="ReconnectionShortGraceTime",t[t.KeepAliveSendTime=5e3]="KeepAliveSendTime"})(Mm||(Mm={}));var Ls=class{constructor(t,e,s,i){this.type=t,this.id=e,this.ack=s,this.data=i,this.writtenTime=0}get size(){return this.data.byteLength}},Fm=class extends T{constructor(t){super(),this.f=this.B(new R),this.onMessage=this.f.event,this.g={readHead:!0,readLen:13,messageType:0,id:0,ack:0},this.a=t,this.b=!1,this.c=new q6,this.B(this.a.onData(e=>this.acceptChunk(e))),this.lastReadTime=Date.now()}acceptChunk(t){if(!(!t||t.byteLength===0))for(this.lastReadTime=Date.now(),this.c.acceptChunk(t);this.c.byteLength>=this.g.readLen;){const e=this.c.read(this.g.readLen);if(this.g.readHead)this.g.readHead=!1,this.g.readLen=e.readUInt32BE(9),this.g.messageType=e.readUInt8(0),this.g.id=e.readUInt32BE(1),this.g.ack=e.readUInt32BE(5),this.a.traceSocketEvent("protocolHeaderRead",{messageType:Tm(this.g.messageType),id:this.g.id,ack:this.g.ack,messageSize:this.g.readLen});else{const s=this.g.messageType,i=this.g.id,n=this.g.ack;if(this.g.readHead=!0,this.g.readLen=13,this.g.messageType=0,this.g.id=0,this.g.ack=0,this.a.traceSocketEvent("protocolMessageRead",e),this.f.fire(new Ls(s,i,n,e)),this.b)break}}}readEntireBuffer(){return this.c.read(this.c.byteLength)}dispose(){this.b=!0,super.dispose()}},Um=class{constructor(t){this.k=null,this.a=!1,this.b=!1,this.c=t,this.d=[],this.f=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this.a=!0}drain(){return this.flush(),this.c.drain()}flush(){this.m()}pause(){this.b=!0}resume(){this.b=!1,this.l()}write(t){if(this.a)return;t.writtenTime=Date.now(),this.lastWriteTime=Date.now();const e=A.alloc(13);e.writeUInt8(t.type,0),e.writeUInt32BE(t.id,1),e.writeUInt32BE(t.ack,5),e.writeUInt32BE(t.data.byteLength,9),this.c.traceSocketEvent("protocolHeaderWrite",{messageType:Tm(t.type),id:t.id,ack:t.ack,messageSize:t.data.byteLength}),this.c.traceSocketEvent("protocolMessageWrite",t.data),this.j(e,t.data)}g(t,e){const s=this.f===0;return this.d.push(t,e),this.f+=t.byteLength+e.byteLength,s}h(){const t=A.concat(this.d,this.f);return this.d.length=0,this.f=0,t}j(t,e){this.g(t,e)&&this.l()}l(){this.k||(this.k=setTimeout(()=>{this.k=null,this.m()}))}m(){if(this.f===0||this.b)return;const t=this.h();this.c.traceSocketEvent("protocolWrite",{byteLength:t.byteLength}),this.c.write(t)}},Wr=class{constructor(){this.b=!1,this.c=!1,this.d=[],this.a=new R({onWillAddFirstListener:()=>{this.b=!0,queueMicrotask(()=>this.f())},onDidRemoveLastListener:()=>{this.b=!1}}),this.event=this.a.event}f(){if(!this.c){for(this.c=!0;this.b&&this.d.length>0;)this.a.fire(this.d.shift());this.c=!1}}fire(t){this.b?this.d.length>0?this.d.push(t):this.a.fire(t):this.d.push(t)}flushBuffer(){this.d=[]}},W6=class{constructor(t){this.data=t,this.next=null}},H6=class{constructor(){this.a=null,this.b=null}length(){let t=0,e=this.a;for(;e;)e=e.next,t++;return t}peek(){return this.a?this.a.data:null}toArray(){const t=[];let e=0,s=this.a;for(;s;)t[e++]=s.data,s=s.next;return t}pop(){if(this.a){if(this.a===this.b){this.a=null,this.b=null;return}this.a=this.a.next}}push(t){const e=new W6(t);if(!this.a){this.a=e,this.b=e;return}this.b.next=e,this.b=e}},G6=class Ns{static{this.a=10}static{this.b=null}static getInstance(){return Ns.b||(Ns.b=new Ns),Ns.b}constructor(){this.c=[];const e=Date.now();for(let s=0;s<Ns.a;s++)this.c[s]=e-1e3*s;setInterval(()=>{for(let s=Ns.a;s>=1;s--)this.c[s]=this.c[s-1];this.c[0]=Date.now()},1e3)}d(){const e=Date.now(),s=(1+Ns.a)*1e3;let i=0;for(let n=0;n<Ns.a;n++)e-this.c[n]<=s&&i++;return 1-i/Ns.a}hasHighLoad(){return this.d()>=.5}},J6=class{get unacknowledgedCount(){return this.d-this.f}constructor(t){this.v=new Wr,this.onControlMessage=this.v.event,this.w=new Wr,this.onMessage=this.w.event,this.x=new Wr,this.onDidDispose=this.x.event,this.y=new Wr,this.onSocketClose=this.y.event,this.z=new Wr,this.onSocketTimeout=this.z.event,this.t=t.loadEstimator??G6.getInstance(),this.u=t.sendKeepAlive??!0,this.a=!1,this.c=new H6,this.d=0,this.f=0,this.g=null,this.h=0,this.j=0,this.k=0,this.l=null,this.n=0,this.o=Date.now(),this.s=new De,this.p=t.socket,this.q=this.s.add(new Um(this.p)),this.r=this.s.add(new Fm(this.p)),this.s.add(this.r.onMessage(e=>this.A(e))),this.s.add(this.p.onClose(e=>this.y.fire(e))),t.initialChunk&&this.r.acceptChunk(t.initialChunk),this.u?this.m=setInterval(()=>{this.E()},5e3):this.m=null}dispose(){this.g&&(clearTimeout(this.g),this.g=null),this.l&&(clearTimeout(this.l),this.l=null),this.m&&(clearInterval(this.m),this.m=null),this.s.dispose()}drain(){return this.q.drain()}sendDisconnect(){if(!this.b){this.b=!0;const t=new Ls(5,0,0,pi());this.q.write(t),this.q.flush()}}sendPause(){const t=new Ls(7,0,0,pi());this.q.write(t)}sendResume(){const t=new Ls(8,0,0,pi());this.q.write(t)}pauseSocketWriting(){this.q.pause()}getSocket(){return this.p}getMillisSinceLastIncomingData(){return Date.now()-this.r.lastReadTime}beginAcceptReconnection(t,e){this.a=!0,this.s.dispose(),this.s=new De,this.v.flushBuffer(),this.y.flushBuffer(),this.z.flushBuffer(),this.p.dispose(),this.n=0,this.o=Date.now(),this.p=t,this.q=this.s.add(new Um(this.p)),this.r=this.s.add(new Fm(this.p)),this.s.add(this.r.onMessage(s=>this.A(s))),this.s.add(this.p.onClose(s=>this.y.fire(s))),this.r.acceptChunk(e)}endAcceptReconnection(){this.a=!1,this.j=this.h;const t=new Ls(3,0,this.j,pi());this.q.write(t);const e=this.c.toArray();for(let s=0,i=e.length;s<i;s++)this.q.write(e[s]);this.C()}acceptDisconnect(){this.x.fire()}A(t){if(t.ack>this.f){this.f=t.ack;do{const e=this.c.peek();if(e&&e.id<=t.ack)this.c.pop();else break}while(!0)}switch(t.type){case 0:break;case 1:{if(t.id>this.h)if(t.id!==this.h+1){const e=Date.now();e-this.n>1e4&&(this.n=e,this.q.write(new Ls(6,0,0,pi())))}else this.h=t.id,this.k=Date.now(),this.B(),this.w.fire(t.data);break}case 2:{this.v.fire(t.data);break}case 3:break;case 5:{this.x.fire();break}case 6:{const e=this.c.toArray();for(let s=0,i=e.length;s<i;s++)this.q.write(e[s]);this.C();break}case 7:{this.q.pause();break}case 8:{this.q.resume();break}case 9:break}}readEntireBuffer(){return this.r.readEntireBuffer()}flush(){this.q.flush()}send(t){const e=++this.d;this.j=this.h;const s=new Ls(1,e,this.j,t);this.c.push(s),this.a||(this.q.write(s),this.C())}sendControl(t){const e=new Ls(2,0,0,t);this.q.write(e)}B(){if(this.h<=this.j||this.l)return;const t=Date.now()-this.k;if(t>=2e3){this.D();return}this.l=setTimeout(()=>{this.l=null,this.B()},2e3-t+5)}C(){if(this.d<=this.f||this.g||this.a)return;const t=this.c.peek(),e=Date.now()-t.writtenTime,s=Date.now()-this.r.lastReadTime,i=Date.now()-this.o;if(e>=2e4&&s>=2e4&&i>=2e4&&!this.t.hasHighLoad()){this.o=Date.now(),this.z.fire({unacknowledgedMsgCount:this.c.length(),timeSinceOldestUnacknowledgedMsg:e,timeSinceLastReceivedSomeData:s});return}const n=Math.max(2e4-e,2e4-s,2e4-i,500);this.g=setTimeout(()=>{this.g=null,this.C()},n)}D(){if(this.h<=this.j)return;this.j=this.h;const t=new Ls(3,0,this.j,pi());this.q.write(t)}E(){this.j=this.h;const t=new Ls(9,0,this.j,pi());this.q.write(t)}},K6=3e4,rf=class{traceSocketEvent(t,e){sf.traceSocketEvent(this.socket,this.debugLabel,t,e)}constructor(t,e=""){this.f=!0,this.debugLabel=e,this.socket=t,this.traceSocketEvent("created",{type:"NodeSocket"}),this.a=i=>{if(this.traceSocketEvent("error",{code:i?.code,message:i?.message}),i){if(i.code==="EPIPE")return;it(i)}},this.socket.on("error",this.a);let s;this.b=i=>{this.traceSocketEvent("close",{hadError:i}),this.f=!1,s&&clearTimeout(s)},this.socket.on("close",this.b),this.d=()=>{this.traceSocketEvent("nodeEndReceived"),this.f=!1,s=setTimeout(()=>t.destroy(),K6)},this.socket.on("end",this.d)}dispose(){this.socket.off("error",this.a),this.socket.off("close",this.b),this.socket.off("end",this.d),this.socket.destroy()}onData(t){const e=s=>{this.traceSocketEvent("read",s),t(A.wrap(s))};return this.socket.on("data",e),{dispose:()=>this.socket.off("data",e)}}onClose(t){const e=s=>{t({type:0,hadError:s,error:void 0})};return this.socket.on("close",e),{dispose:()=>this.socket.off("close",e)}}onEnd(t){const e=()=>{t()};return this.socket.on("end",e),{dispose:()=>this.socket.off("end",e)}}write(t){if(!(this.socket.destroyed||!this.f))try{this.traceSocketEvent("write",t),this.socket.write(t.buffer,e=>{if(e){if(e.code==="EPIPE")return;it(e)}})}catch(e){if(e.code==="EPIPE")return;it(e)}}end(){this.traceSocketEvent("nodeEndSent"),this.socket.end()}drain(){return this.traceSocketEvent("nodeDrainBegin"),new Promise((t,e)=>{if(this.socket.bufferSize===0){this.traceSocketEvent("nodeDrainEnd"),t();return}const s=()=>{this.socket.off("close",s),this.socket.off("end",s),this.socket.off("error",s),this.socket.off("timeout",s),this.socket.off("drain",s),this.traceSocketEvent("nodeDrainEnd"),t()};this.socket.on("close",s),this.socket.on("end",s),this.socket.on("error",s),this.socket.on("timeout",s),this.socket.on("drain",s)})}},Bm;(function(t){t[t.MinHeaderByteSize=2]="MinHeaderByteSize",t[t.MaxWebSocketMessageLength=262144]="MaxWebSocketMessageLength"})(Bm||(Bm={}));var zm;(function(t){t[t.PeekHeader=1]="PeekHeader",t[t.ReadHeader=2]="ReadHeader",t[t.ReadBody=3]="ReadBody",t[t.Fin=4]="Fin"})(zm||(zm={}));var _x=process.env.XDG_RUNTIME_DIR,Vx=W("remoteAuthorityResolverService"),_m;(function(t){t[t.WebSocket=0]="WebSocket",t[t.Managed=1]="Managed"})(_m||(_m={}));var gi;(function(t){t.Unknown="Unknown",t.NotAvailable="NotAvailable",t.TemporarilyNotAvailable="TemporarilyNotAvailable",t.NoResolverFound="NoResolverFound",t.InvalidAuthority="InvalidAuthority"})(gi||(gi={}));var of=class Yi extends Ei{static isNotAvailable(e){return e instanceof Yi&&e._code===gi.NotAvailable}static isTemporarilyNotAvailable(e){return e instanceof Yi&&e._code===gi.TemporarilyNotAvailable}static isNoResolverFound(e){return e instanceof Yi&&e._code===gi.NoResolverFound}static isInvalidAuthority(e){return e instanceof Yi&&e._code===gi.InvalidAuthority}static isHandled(e){return e instanceof Yi&&e.isHandled}constructor(e,s=gi.Unknown,i){super(e),this._message=e,this._code=s,this._detail=i,this.isHandled=s===gi.NotAvailable&&i===!0,Object.setPrototypeOf(this,Yi.prototype)}},Q6=30*1e3,Vm;(function(t){t[t.Management=1]="Management",t[t.ExtensionHost=2]="ExtensionHost",t[t.Tunnel=3]="Tunnel"})(Vm||(Vm={}));function af(t){switch(t){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function qm(t){const e=new Ss;return setTimeout(()=>e.cancel(),t),e.token}function X6(t,e){if(t.isCancellationRequested||e.isCancellationRequested)return Q.Cancelled;const s=new Ss;return t.onCancellationRequested(()=>s.cancel()),e.onCancellationRequested(()=>s.cancel()),s.token}var cf=class{get didTimeout(){return this.c==="timedout"}constructor(t){this.c="pending",this.d=new De,{promise:this.promise,resolve:this.f,reject:this.g}=m4(),t.isCancellationRequested?this.h():this.d.add(t.onCancellationRequested(()=>this.h()))}registerDisposable(t){this.c==="pending"?this.d.add(t):t.dispose()}h(){this.c==="pending"&&(this.d.dispose(),this.c="timedout",this.g(this.i()))}i(){const t=new Error("Time limit reached");return t.code="ETIMEDOUT",t.syscall="connect",t}resolve(t){this.c==="pending"&&(this.d.dispose(),this.c="resolved",this.f(t))}reject(t){this.c==="pending"&&(this.d.dispose(),this.c="rejected",this.g(t))}};function Z6(t,e){const s=new cf(e);return s.registerDisposable(t.onControlMessage(i=>{const n=JSON.parse(i.toString()),r=c8(n);r?s.reject(r):s.resolve(n)})),s.promise}function Y6(t,e,s,i,n,r,o,a){const c=new cf(a),l=cn.create(!1);return t.info(`Creating a socket (${o})...`),zi(`code/willCreateSocket/${r}`),e.connect(s,i,n,o).then(h=>{c.didTimeout?(zi(`code/didCreateSocketError/${r}`),t.info(`Creating a socket (${o}) finished after ${l.elapsed()} ms, but this is too late and has timed out already.`),h?.dispose()):(zi(`code/didCreateSocketOK/${r}`),t.info(`Creating a socket (${o}) was successful after ${l.elapsed()} ms.`),c.resolve(h))},h=>{zi(`code/didCreateSocketError/${r}`),t.info(`Creating a socket (${o}) returned an error after ${l.elapsed()} ms.`),t.error(h),c.reject(h)}),c.promise}function lf(t,e){const s=new cf(e);return t.then(i=>{s.didTimeout||s.resolve(i)},i=>{s.didTimeout||s.reject(i)}),s.promise}async function e8(t,e,s,i){const n=Km(t,e);t.logService.trace(`${n} 1/6. invoking socketFactory.connect().`);let r;try{r=await Y6(t.logService,t.remoteSocketFactoryService,t.connectTo,p1.getServerRootPath(),`reconnectionToken=${t.reconnectionToken}&reconnection=${t.reconnectionProtocol?"true":"false"}`,af(e),`renderer-${af(e)}-${t.reconnectionToken}`,i)}catch(h){throw t.logService.error(`${n} socketFactory.connect() failed or timed out. Error:`),t.logService.error(h),h}t.logService.trace(`${n} 2/6. socketFactory.connect() was successful.`);let o,a;t.reconnectionProtocol?(t.reconnectionProtocol.beginAcceptReconnection(r,null),o=t.reconnectionProtocol,a=!1):(o=new J6({socket:r}),a=!0),t.logService.trace(`${n} 3/6. sending AuthRequest control message.`);const c=await lf(t.signService.createNewMessage(st()),i),l={type:"auth",auth:t.connectionToken||"00000000000000000000",data:c.data};o.sendControl(A.fromString(JSON.stringify(l)));try{const h=await Z6(o,X6(i,qm(1e4)));if(h.type!=="sign"||typeof h.data!="string"){const g=new Error("Unexpected handshake message");throw g.code="VSCODE_CONNECTION_ERROR",g}if(t.logService.trace(`${n} 4/6. received SignRequest control message.`),!await lf(t.signService.validate(c,h.signedData),i)){const g=new Error("Refused to connect to unsupported server");throw g.code="VSCODE_CONNECTION_ERROR",g}const f=await lf(t.signService.sign(h.data),i),p={type:"connectionType",commit:t.commit,signedData:f,desiredConnectionType:e};return s&&(p.args=s),t.logService.trace(`${n} 5/6. sending ConnectionTypeRequest control message.`),o.sendControl(A.fromString(JSON.stringify(p))),{protocol:o,ownsProtocol:a}}catch(h){throw h&&h.code==="ETIMEDOUT"&&(t.logService.error(`${n} the handshake timed out. Error:`),t.logService.error(h)),h&&h.code==="VSCODE_CONNECTION_ERROR"&&(t.logService.error(`${n} received error control message when negotiating connection. Error:`),t.logService.error(h)),a&&Jm(o),h}}async function t8(t,e,s){const i=Date.now(),n=Km(t,3),{protocol:r}=await e8(t,3,e,s);return t.logService.trace(`${n} 6/6. handshake finished, connection is up and running after ${u8(i)}!`),r}async function Wm(t,e,s){const{connectTo:i,connectionToken:n}=await t.addressProvider.getAddress();return{commit:t.commit,quality:t.quality,connectTo:i,connectionToken:n,reconnectionToken:e,reconnectionProtocol:s,remoteSocketFactoryService:t.remoteSocketFactoryService,signService:t.signService,logService:t.logService}}async function s8(t,e,s){const i=await Wm(t,st(),null);return await t8(i,{host:e,port:s},Q.None)}function i8(t){return vt(e=>new Promise((s,i)=>{const n=setTimeout(s,t*1e3);e.onCancellationRequested(()=>{clearTimeout(n),s()})}))}var Hm;(function(t){t[t.ConnectionLost=0]="ConnectionLost",t[t.ReconnectionWait=1]="ReconnectionWait",t[t.ReconnectionRunning=2]="ReconnectionRunning",t[t.ReconnectionPermanentFailure=3]="ReconnectionPermanentFailure",t[t.ConnectionGain=4]="ConnectionGain"})(Hm||(Hm={}));var n8=class{constructor(t,e){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.type=0}},r8=class{constructor(t,e,s,i){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.durationSeconds=s,this.c=i,this.type=1}skipWait(){this.c.cancel()}},o8=class{constructor(t,e,s){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.type=2}},Gm=class{constructor(t,e,s){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.type=4}},a8=class{constructor(t,e,s,i){this.reconnectionToken=t,this.millisSinceLastIncomingData=e,this.attempt=s,this.handled=i,this.type=3}},qx=class Js extends T{static triggerPermanentFailure(e,s,i){this._permanentFailure=!0,this.f=e,this.g=s,this.h=i,this.j.forEach(n=>n.D(this.f,this.g,this.h))}static debugTriggerReconnection(){this.j.forEach(e=>e.y())}static debugPauseSocketWriting(){this.j.forEach(e=>e.F())}static{this._permanentFailure=!1}static{this.f=0}static{this.g=0}static{this.h=!1}static{this.j=[]}get n(){return this.c||Js._permanentFailure}constructor(e,s,i,n,r){super(),this.t=e,this.u=s,this.reconnectionToken=i,this.protocol=n,this.w=r,this.m=this.B(new R),this.onDidStateChange=this.m.event,this.c=!1,this.r=!1,this.s=!1,this.m.fire(new Gm(this.reconnectionToken,0,0)),this.B(n.onSocketClose(o=>{const a=rc(this.t,this.reconnectionToken,!0);o?o.type===0?(this.u.logService.info(`${a} received socket close event (hadError: ${o.hadError}).`),o.error&&this.u.logService.error(o.error)):(this.u.logService.info(`${a} received socket close event (wasClean: ${o.wasClean}, code: ${o.code}, reason: ${o.reason}).`),o.event&&this.u.logService.error(o.event)):this.u.logService.info(`${a} received socket close event.`),this.y()})),this.B(n.onSocketTimeout(o=>{const a=rc(this.t,this.reconnectionToken,!0);this.u.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${o.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${o.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${o.timeSinceLastReceivedSomeData}).`),this.y()})),Js.j.push(this),this.B(de(()=>{const o=Js.j.indexOf(this);o>=0&&Js.j.splice(o,1)})),this.n&&this.D(Js.f,Js.g,Js.h)}dispose(){super.dispose(),this.s=!0}async y(){if(!this.r)try{this.r=!0,await this.z()}finally{this.r=!1}}async z(){if(this.n||this.s)return;const e=rc(this.t,this.reconnectionToken,!0);this.u.logService.info(`${e} starting reconnecting loop. You can get more information with the trace log level.`),this.m.fire(new n8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const s=[0,5,5,10,10,10,10,10,30];let i=-1;do{i++;const n=i<s.length?s[i]:s[s.length-1];try{if(n>0){const o=i8(n);this.m.fire(new r8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),n,o)),this.u.logService.info(`${e} waiting for ${n} seconds before reconnecting...`);try{await o}catch{}}if(this.n){this.u.logService.error(`${e} permanent failure occurred while running the reconnecting loop.`);break}this.m.fire(new o8(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1)),this.u.logService.info(`${e} resolving connection...`);const r=await Wm(this.u,this.reconnectionToken,this.protocol);this.u.logService.info(`${e} connecting to ${r.connectTo}...`),await this.G(r,qm(Q6)),this.u.logService.info(`${e} reconnected!`),this.m.fire(new Gm(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1));break}catch(r){if(r.code==="VSCODE_CONNECTION_ERROR"){this.u.logService.error(`${e} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this.u.logService.error(r),this.C(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(i>360){this.u.logService.error(`${e} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`),this.u.logService.error(r),this.C(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(of.isTemporarilyNotAvailable(r)){this.u.logService.info(`${e} A temporarily not available error occurred while trying to reconnect, will try again...`),this.u.logService.trace(r);continue}if((r.code==="ETIMEDOUT"||r.code==="ENETUNREACH"||r.code==="ECONNREFUSED"||r.code==="ECONNRESET")&&r.syscall==="connect"){this.u.logService.info(`${e} A network error occurred while trying to reconnect, will try again...`),this.u.logService.trace(r);continue}if(Ts(r)){this.u.logService.info(`${e} A promise cancelation error occurred while trying to reconnect, will try again...`),this.u.logService.trace(r);continue}if(r instanceof of){this.u.logService.error(`${e} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this.u.logService.error(r),this.C(this.protocol.getMillisSinceLastIncomingData(),i+1,of.isHandled(r));break}this.u.logService.error(`${e} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this.u.logService.error(r),this.C(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}}while(!this.n&&!this.s)}C(e,s,i){this.w?Js.triggerPermanentFailure(e,s,i):this.D(e,s,i)}D(e,s,i){this.m.fire(new a8(this.reconnectionToken,e,s,i)),Jm(this.protocol)}F(){this.protocol.pauseSocketWriting()}};function Jm(t){try{t.acceptDisconnect();const e=t.getSocket();t.dispose(),e.dispose()}catch(e){it(e)}}function c8(t){if(t&&t.type==="error"){const e=new Error(`Connection error: ${t.reason}`);return e.code="VSCODE_CONNECTION_ERROR",e}return null}function l8(t,e){for(;t.length<e;)t+=" ";return t}function h8(t,e){return`[remote-connection][${l8(af(t),13)}][${e.substr(0,5)}\u2026]`}function rc(t,e,s){return`${h8(t,e)}[${s?"reconnect":"initial"}]`}function Km(t,e){return`${rc(e,t.reconnectionToken,!!t.reconnectionProtocol)}[${t.connectTo}]`}function u8(t){return`${Date.now()-t} ms`}var oc=W("remoteSocketFactoryService"),f8=class{constructor(){this.a={}}register(t,e){return this.a[t]??=[],this.a[t].push(e),de(()=>{const s=this.a[t]?.indexOf(e);typeof s=="number"&&s>=0&&this.a[t]?.splice(s,1)})}b(t){return(this.a[t.type]||[]).find(s=>s.supports(t))}connect(t,e,s,i){const n=this.b(t);if(!n)throw new Error(`No socket factory found for ${t}`);return n.connect(t,e,s,i)}};async function d8(t,e,s,i,n){let r;for(let o=3;o&&(r?.dispose(),r=await new p8(t,e,s,i,n).waitForReady(),!(n&&Lm[n]||!Lm[r.tunnelLocalPort]));o--);return r}var p8=class extends T{constructor(t,e,s,i,n){super(),this.m=e,this.n=n,this.privacy=nc.Private,this.j=new Map,this.a=t,this.b=B6.createServer(),this.c=new sr,this.f=()=>this.c.open(),this.b.on("listening",this.f),this.g=r=>this.r(r),this.b.on("connection",this.g),this.h=()=>{},this.b.on("error",this.h),this.tunnelRemotePort=i,this.tunnelRemoteHost=s}async dispose(){super.dispose(),this.b.removeListener("listening",this.f),this.b.removeListener("connection",this.g),this.b.removeListener("error",this.h),this.b.close(),Array.from(this.j.values()).forEach(e=>{e()})}async waitForReady(){const t=this.n??this.tunnelRemotePort,e=qr(this.m)?"0.0.0.0":"127.0.0.1";let s=await V6(t,2,1e3,e),i=null;return this.b.listen(s,this.m),await this.c.wait(),i=this.b.address(),i||(s=0,this.b.listen(s,this.m),await this.c.wait(),i=this.b.address()),this.tunnelLocalPort=i.port,this.localAddress=`${this.tunnelRemoteHost==="127.0.0.1"?"127.0.0.1":"localhost"}:${i.port}`,this}async r(t){t.pause();const e=Yu(this.tunnelRemoteHost)||qr(this.tunnelRemoteHost)?"localhost":this.tunnelRemoteHost,s=await s8(this.a,e,this.tunnelRemotePort),i=s.getSocket(),n=s.readEntireBuffer();s.dispose(),n.byteLength>0&&t.write(n.buffer),t.on("end",()=>{t.localAddress&&this.j.delete(t.localAddress),i.end()}),t.on("close",()=>i.end()),t.on("error",()=>{t.localAddress&&this.j.delete(t.localAddress),i instanceof rf?i.socket.destroy():i.end()}),i instanceof rf?this.t(t,i):this.s(t,i),t.localAddress&&this.j.set(t.localAddress,()=>{t.end(),i.end()})}s(t,e){e.onClose(()=>t.destroy()),e.onEnd(()=>t.end()),e.onData(s=>t.write(s.buffer)),t.on("data",s=>e.write(A.wrap(s))),t.resume()}t(t,e){const s=e.socket;s.on("end",()=>t.end()),s.on("close",()=>t.end()),s.on("error",()=>{t.destroy()}),s.pipe(t),t.pipe(s)}},hf=class extends tf{constructor(e,s,i,n,r){super(s,r),this.H=e,this.I=i,this.J=n}isPortPrivileged(e){return U6(e,this.t,an,z6.release())}F(e,s,i,n,r,o,a,c){const l=this.D(s,i);if(l)return++l.refcount,l.value;if(M6(e))return this.G(e,s,i,r,o,a,c);{this.r.trace(`ForwardedPorts: (TunnelService) Creating tunnel without provider ${s}:${i} on local port ${r}.`);const h={commit:this.J.commit,quality:this.J.quality,addressProvider:e,remoteSocketFactoryService:this.H,signService:this.I,logService:this.r,ipcLogger:null},u=d8(h,n,s,i,r);return this.r.trace("ForwardedPorts: (TunnelService) Tunnel created without provider."),this.z(s,i,u),u}}};hf=__decorate([__param(0,oc),__param(1,Y),__param(2,ic),__param(3,pe),__param(4,ge)],hf);var uf=class extends hf{constructor(e,s,i,n,r){super(e,s,i,n,r)}};uf=__decorate([__param(0,oc),__param(1,Y),__param(2,ic),__param(3,pe),__param(4,ge)],uf);var ff=class extends T{constructor(e,s,i,n,r){super(),this.b=e,this.c=s,this.f=i,this.g=n,this.h=r,this.a=new Map}async openTunnel(e,s,i,n,r,o,a,c,l){if(this.c.trace(`ForwardedPorts: (SharedTunnelService) openTunnel request for ${i}:${n} on local port ${o}.`),!this.a.has(e)){const h=new uf(this.b,this.c,this.g,this.f,this.h);this.B(h),this.a.set(e,h),h.onTunnelClosed(async()=>{(await h.tunnels).length===0&&(h.dispose(),this.a.delete(e))})}return this.a.get(e).openTunnel(s,i,n,r,o,a,c,l)}};ff=__decorate([__param(0,oc),__param(1,Y),__param(2,pe),__param(3,ic),__param(4,ge)],ff);var Qm=W("sharedProcessTunnelService"),g8="sharedProcessTunnel",df,m8=class extends T{constructor(){super(),this.a=null,this.b=null}async getAddress(){return this.a?this.a:(this.b||(this.b=new ir),this.b.p)}setAddress(t){this.a=t,this.b&&(this.b.complete(t),this.b=null)}setTunnel(t){this.B(t)}},pf=class extends T{static{df=this}static{this.a=0}constructor(e,s){super(),this.f=e,this.g=s,this.b=new Map,this.c=new Set}dispose(){super.dispose(),this.b.forEach(e=>e.dispose())}async createTunnel(){return{id:String(++df.a)}}async startTunnel(e,s,i,n,r,o,a){const c=new m8,l=await Promise.resolve(this.f.openTunnel(e,c,i,n,r,o,a));if(!l||typeof l=="string")throw this.g.info(`[SharedProcessTunnelService] Could not create a tunnel to ${i}:${n} (remote).`),c.dispose(),new Error("Could not create tunnel");if(this.c.has(s))throw this.c.delete(s),c.dispose(),await l.dispose(),ho();return c.setTunnel(l),this.b.set(s,c),this.g.info(`[SharedProcessTunnelService] Created tunnel ${s}: ${l.localAddress} (local) to ${i}:${n} (remote).`),{tunnelLocalPort:l.tunnelLocalPort,localAddress:l.localAddress}}async setAddress(e,s){const i=this.b.get(e);i&&i.setAddress(s)}async destroyTunnel(e){const s=this.b.get(e);if(s){this.g.info(`[SharedProcessTunnelService] Disposing tunnel ${e}.`),this.b.delete(e),await s.dispose();return}this.c.add(e)}};pf=df=__decorate([__param(0,Dm),__param(1,Y)],pf);var w8=[],Xm;(function(t){t[t.Eager=0]="Eager",t[t.Delayed=1]="Delayed"})(Xm||(Xm={}));function Zm(t,e,s){e instanceof ce||(e=new ce(e,[],!!s)),w8.push([t,e])}var Ym,gf=class{constructor(t,e,s){this.level=t,this.key=e,this.value=s,this.forward=[]}},Hr=void 0,v8=class _n{constructor(e,s=2**16){this.comparator=e,this[Ym]="SkipList",this.d=0,this.f=0,this.c=Math.max(1,Math.log2(s)|0),this.e=new gf(this.c,Hr,Hr)}get size(){return this.f}clear(){this.e=new gf(this.c,Hr,Hr),this.f=0}has(e){return!!_n.g(this,e,this.comparator)}get(e){return _n.g(this,e,this.comparator)?.value}set(e,s){return _n.h(this,e,s,this.comparator)&&(this.f+=1),this}delete(e){const s=_n.k(this,e,this.comparator);return s&&(this.f-=1),s}forEach(e,s){let i=this.e.forward[0];for(;i;)e.call(s,i.value,i.key,this),i=i.forward[0]}[(Ym=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let e=this.e.forward[0];for(;e;)yield[e.key,e.value],e=e.forward[0]}*keys(){let e=this.e.forward[0];for(;e;)yield e.key,e=e.forward[0]}*values(){let e=this.e.forward[0];for(;e;)yield e.value,e=e.forward[0]}toString(){let e="[SkipList]:",s=this.e.forward[0];for(;s;)e+=`node(${s.key}, ${s.value}, lvl:${s.level})`,s=s.forward[0];return e}static g(e,s,i){let n=e.e;for(let r=e.d-1;r>=0;r--)for(;n.forward[r]&&i(n.forward[r].key,s)<0;)n=n.forward[r];if(n=n.forward[0],n&&i(n.key,s)===0)return n}static h(e,s,i,n){const r=[];let o=e.e;for(let a=e.d-1;a>=0;a--){for(;o.forward[a]&&n(o.forward[a].key,s)<0;)o=o.forward[a];r[a]=o}if(o=o.forward[0],o&&n(o.key,s)===0)return o.value=i,!1;{const a=_n.j(e);if(a>e.d){for(let c=e.d;c<a;c++)r[c]=e.e;e.d=a}o=new gf(a,s,i);for(let c=0;c<a;c++)o.forward[c]=r[c].forward[c],r[c].forward[c]=o;return!0}}static j(e,s=.5){let i=1;for(;Math.random()<s&&i<e.c;)i+=1;return i}static k(e,s,i){const n=[];let r=e.e;for(let o=e.d-1;o>=0;o--){for(;r.forward[o]&&i(r.forward[o].key,s)<0;)r=r.forward[o];n[o]=r}if(r=r.forward[0],!r||i(r.key,s)!==0)return!1;for(let o=0;o<e.d&&n[o].forward[o]===r;o++)n[o].forward[o]=r.forward[o];for(;e.d>0&&e.e.forward[e.d-1]===Hr;)e.d-=1;return!0}},ew=class ad{static{this._clock=0}constructor(e){this.uri=e,this.time=ad._clock++}touch(){return this.time=ad._clock++,this}},ac=class{constructor(e){this.g=e,this.c=new De,this.f=2**16;const s=new Map,i=n=>{let r=s.get(n.scheme);return r===void 0&&(r=e.hasProvider(n)&&!this.g.hasCapability(n,1024),s.set(n.scheme,r)),r};this.c.add(L.any(e.onDidChangeFileSystemProviderRegistrations,e.onDidChangeFileSystemProviderCapabilities)(n=>{s.delete(n.scheme)})),this.extUri=new Co(i),this.d=new v8((n,r)=>this.extUri.compare(n,r,!0),this.f)}dispose(){this.c.dispose(),this.d.clear()}asCanonicalUri(e){this.g.hasProvider(e)&&(e=f4(e));const s=this.d.get(e);return s?s.touch().uri.with({fragment:e.fragment}):(this.d.set(e,new ew(e)),this.h(),e)}h(){if(this.d.size<this.f)return;const e=[...this.d.entries()].sort((i,n)=>i[1].time<n[1].time?1:i[1].time>n[1].time?-1:0);ew._clock=0,this.d.clear();const s=this.f*.5;for(let i=0;i<s;i++)this.d.set(e[i][0],e[i][1].touch())}};ac=__decorate([__param(0,K)],ac),Zm(he,ac,1);var y8=class extends T{constructor(t,e,s,i,n,r){super(),this.f=t,this.g=e,this.h=s,this.j=i,this.m=n,this.n=r,this.capabilities=this.g.capabilities,this.onDidChangeCapabilities=this.g.onDidChangeCapabilities,this.a=this.B(new R),this.onDidChangeFile=this.a.event,this.b=En.forUris(()=>!(this.capabilities&1024)),this.c=new Mc(o=>this.m.extUri.getComparisonKey(this.t(o))),this.r(),this.B(i.onDidChangeProfiles(()=>this.r())),this.B(this.g.onDidChangeFile(o=>this.s(o)))}r(){this.c.clear();for(const t of this.j.profiles)this.c.add(t.settingsResource),this.c.add(t.keybindingsResource),this.c.add(t.tasksResource),this.c.add(t.extensionsResource)}open(t,e){return this.g.open(this.t(t),e)}close(t){return this.g.close(t)}read(t,e,s,i,n){return this.g.read(t,e,s,i,n)}write(t,e,s,i,n){return this.g.write(t,e,s,i,n)}watch(t,e){this.b.set(t,t);const s=this.g.watch(this.t(t),e);return de(()=>{this.b.delete(t),s.dispose()})}stat(t){return this.g.stat(this.t(t))}mkdir(t){return this.g.mkdir(this.t(t))}rename(t,e,s){return this.g.rename(this.t(t),this.t(e),s)}readFile(t,e){return this.g.readFile(this.t(t),e)}readFileStream(t,e,s){return this.g.readFileStream(this.t(t),e,s)}readdir(t){return this.g.readdir(this.t(t))}enforceAtomicReadFile(t){return this.c.has(t)}writeFile(t,e,s){return this.g.writeFile(this.t(t),e,s)}enforceAtomicWriteFile(t){return this.c.has(t)?{postfix:".vsctmp"}:!1}delete(t,e){return this.g.delete(this.t(t),e)}copy(t,e,s){if(Ll(this.g))return this.g.copy(this.t(t),this.t(e),s);throw new Error("copy not supported")}cloneFile(t,e){if(qp(this.g))return this.g.cloneFile(this.t(t),this.t(e));throw new Error("clone not supported")}s(t){const e=[];for(const s of t){if(s.resource.scheme!==this.f)continue;const i=this.u(s.resource);this.b.findSubstr(i)&&e.push({resource:i,type:s.type,cId:s.cId})}e.length&&(this.n.debug("User data changed"),this.a.fire(e))}t(t){return t.with({scheme:this.f})}u(t){return t.with({scheme:this.h})}},b8="localFilesystem",S8=class extends T{constructor(t,e){super(),this.a=t,this.b=e,this.onDidChangeCapabilities=L.None,this.f=this.B(new R),this.onDidChangeFile=this.f.event,this.g=this.B(new R),this.onDidWatchError=this.g.event,this.h=st(),this.j()}get capabilities(){return this.c||(this.c=516126,this.b.pathCaseSensitive&&(this.c|=1024),this.b.trash&&(this.c|=4096)),this.c}stat(t){return this.a.call("stat",[t])}realpath(t){return this.a.call("realpath",[t])}readdir(t){return this.a.call("readdir",[t])}async readFile(t,e){const{buffer:s}=await this.a.call("readFile",[t,e]);return s}readFileStream(t,e,s){const i=nr(r=>A.concat(r.map(o=>A.wrap(o))).buffer),n=new De;return n.add(this.a.listen("readFileStream",[t,e])(r=>{if(r instanceof A)i.write(r.buffer);else{if(r==="end")i.end();else{let o;if(r instanceof Error)o=r;else{const a=r;o=$s(a.message??Qt(a),a.code??Z.Unknown)}i.error(o),i.end()}n.dispose()}})),n.add(s.onCancellationRequested(()=>{i.error(ho()),i.end(),n.dispose()})),i}writeFile(t,e,s){return this.a.call("writeFile",[t,A.wrap(e),s])}open(t,e){return this.a.call("open",[t,e])}close(t){return this.a.call("close",[t])}async read(t,e,s,i,n){const[r,o]=await this.a.call("read",[t,e,n]);return s.set(r.buffer.slice(0,o),i),o}write(t,e,s,i,n){return this.a.call("write",[t,e,A.wrap(s),i,n])}mkdir(t){return this.a.call("mkdir",[t])}delete(t,e){return this.a.call("delete",[t,e])}rename(t,e,s){return this.a.call("rename",[t,e,s])}copy(t,e,s){return this.a.call("copy",[t,e,s])}cloneFile(t,e){return this.a.call("cloneFile",[t,e])}j(){this.B(this.a.listen("fileChange",[this.h])(t=>{if(Array.isArray(t)){const e=t;this.f.fire(Gh(e))}else{const e=t;this.g.fire(e)}}))}watch(t,e){const s=st();return this.a.call("watch",[this.h,s,t,e]),de(()=>this.a.call("unwatch",[this.h,s]))}},E8=class{constructor(){this.a=new Map}async startProfiling(t){const s=await(await import("v8-inspect-profiler")).startProfiling({host:t.host,port:t.port,checkForPaused:!0}),i=st();return this.a.set(i,s),i}async stopProfiling(t){const e=this.a.get(t);if(!e)throw new Error(`UNKNOWN session '${t}'`);const s=await e.stop();return this.a.delete(t),s.profile}},tw=W("IV8InspectProfilingService"),sw;(function(t){function e(i){return!!(i.samples&&i.timeDeltas)}t.isValidProfile=e;function s(i,n="noAbsolutePaths"){for(const r of i.nodes)r.callFrame&&r.callFrame.url&&(a1(r.callFrame.url)||/^\w[\w\d+.-]*:\/\/\/?/.test(r.callFrame.url))&&(r.callFrame.url=J(n,Ct(r.callFrame.url)));return i}t.rewriteAbsolutePaths=s})(sw||(sw={}));var mf=class extends M9{constructor(e,s,i,n,r,o,a,c){super(k.file(r.builtinExtensionsPath),k.file(r.extensionsPath),r.userHome,e.defaultProfile,e,s,i,n,r,o,a,c)}};mf=__decorate([__param(0,je),__param(1,ai),__param(2,K),__param(3,Y),__param(4,_t),__param(5,pe),__param(6,he),__param(7,is)],mf);var $8=class extends V2{constructor(t,e){super(),this.a=e;for(const s in t){const{definition:i,value:n}=t[s];this.policyDefinitions[s]=i,n!==void 0&&this.f.set(s,n)}this.a.listen("onDidChange")(s=>{for(const i in s){const n=s[i];n===null?this.f.delete(i):this.f.set(i,n)}this.g.fire(Object.keys(s))})}async h(t){const e=await this.a.call("updatePolicyDefinitions",t);for(const s in e)this.f.set(s,e[s])}},x8=class extends T{get defaultProfile(){return this.profiles[0]}get profiles(){return this.a}constructor(t,e,s){super(),this.profilesHome=e,this.c=s,this.a=[],this.b=this.B(new R),this.onDidChangeProfiles=this.b.event,this.a=t.map(i=>Yt(i,this.profilesHome.scheme)),this.B(this.c.listen("onDidChangeProfiles")(i=>{const n=i.added.map(a=>Yt(a,this.profilesHome.scheme)),r=i.removed.map(a=>Yt(a,this.profilesHome.scheme)),o=i.updated.map(a=>Yt(a,this.profilesHome.scheme));this.a=i.all.map(a=>Yt(a,this.profilesHome.scheme)),this.b.fire({added:n,removed:r,updated:o,all:this.profiles})})),this.onDidResetWorkspaces=this.c.listen("onDidResetWorkspaces")}async createNamedProfile(t,e,s){const i=await this.c.call("createNamedProfile",[t,e,s]);return Yt(i,this.profilesHome.scheme)}async createProfile(t,e,s,i){const n=await this.c.call("createProfile",[t,e,s,i]);return Yt(n,this.profilesHome.scheme)}async createTransientProfile(t){const e=await this.c.call("createTransientProfile",[t]);return Yt(e,this.profilesHome.scheme)}async setProfileForWorkspace(t,e){await this.c.call("setProfileForWorkspace",[t,e])}removeProfile(t){return this.c.call("removeProfile",[t])}async updateProfile(t,e){const s=await this.c.call("updateProfile",[t,e]);return Yt(s,this.profilesHome.scheme)}resetWorkspaces(){return this.c.call("resetWorkspaces")}cleanUp(){return this.c.call("cleanUp")}cleanUpTransientProfiles(){return this.c.call("cleanUpTransientProfiles")}},k8=!1,P8=class{constructor(t,e,s){this.id=t,this.dependencies=e,this.callback=s}},Ki;(function(t){t[t.Uninitialized=1]="Uninitialized",t[t.InitializedInternal=2]="InitializedInternal",t[t.InitializedExternal=3]="InitializedExternal"})(Ki||(Ki={}));var R8=class wv{static{this.INSTANCE=new wv}constructor(){this.a=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope",this.b=typeof document=="object",this.c=[],this.d=Ki.Uninitialized}g(){if(this.d===Ki.Uninitialized){if(globalThis.define){this.d=Ki.InitializedExternal;return}}else return;this.d=Ki.InitializedInternal,globalThis.define=(e,s,i)=>{typeof e!="string"&&(i=s,s=e,e=null),(typeof s!="object"||!Array.isArray(s))&&(i=s,s=null),this.c.push(new P8(e,s,i))},globalThis.define.amd=!0,this.b?this.f=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){if(e.startsWith(window.location.origin)||e.startsWith(`${oe.vscodeFileResource}://${g1}`))return e;throw new Error(`[trusted_script_src] Invalid script url: ${e}`)}}):this.a&&(this.f=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){return e}}))}async load(e){if(this.g(),this.d===Ki.InitializedExternal)return new Promise(o=>{const a=st();globalThis.define(a,[e],function(c){o(c)})});const s=await(this.a?this.i(e):this.b?this.h(e):this.j(e));if(!s){console.warn(`Did not receive a define call from script ${e}`);return}const i={},n=[],r=[];if(Array.isArray(s.dependencies))for(const o of s.dependencies)o==="exports"?n.push(i):r.push(o);if(r.length>0)throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${r.join(", ")}`);return typeof s.callback=="function"?s.callback(...n)??i:s.callback}h(e){return new Promise((s,i)=>{const n=document.createElement("script");n.setAttribute("async","async"),n.setAttribute("type","text/javascript");const r=()=>{n.removeEventListener("load",o),n.removeEventListener("error",a)},o=c=>{r(),s(this.c.pop())},a=c=>{r(),i(c)};n.addEventListener("load",o),n.addEventListener("error",a),this.f&&(e=this.f.createScriptURL(e)),n.setAttribute("src",e),window.document.getElementsByTagName("head")[0].appendChild(n)})}async i(e){return this.f&&(e=this.f.createScriptURL(e)),await import(e),this.c.pop()}async j(e){try{const s=(await import("fs")).default,i=(await import("vm")).default,n=(await import("module")).default,r=k.parse(e).fsPath,o=s.readFileSync(r).toString(),a=n.wrap(o.replace(/^#!.*/,""));return new i.Script(a).runInThisContext().apply(),this.c.pop()}catch(s){throw s}}},wf=new Map;async function iw(t,e,s){s===void 0&&(s=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);const i=e?`${t}/${e}`:t;if(wf.has(i))return wf.get(i);let n;if(/^\w[\w\d+.-]*:\/\//.test(i))n=i;else{const c=`${k8&&s&&!ot?i4:s4}/${i}`;n=ei.asBrowserUri(c).toString(!0)}const r=R8.INSTANCE.load(n);return wf.set(i,r),r}var nw="https://mobile.events.data.microsoft.com/OneCollector/1.0",C8="https://mobile.events.data.microsoft.com/ping";async function D8(t,e,s){const i=ot?await iw("@microsoft/1ds-core-js","bundle/ms.core.min.js"):await import("@microsoft/1ds-core-js"),n=ot?await iw("@microsoft/1ds-post-js","bundle/ms.post.min.js"):await import("@microsoft/1ds-post-js"),r=new i.AppInsightsCore,o=new n.PostChannel,a={instrumentationKey:t,endpointUrl:nw,loggingLevelTelemetry:0,loggingLevelConsole:0,disableCookiesUsage:!0,disableDbgExt:!0,disableInstrumentationKeyValidation:!0,channels:[[o]]};if(s){a.extensionConfig={};const c={alwaysUseXhrOverride:!0,ignoreMc1Ms0CookieProcessing:!0,httpXHROverride:s};a.extensionConfig[o.identifier]=c}return r.initialize(a,[]),r.addTelemetryInitializer(c=>{c.ext=c.ext??{},c.ext.web=c.ext.web??{},c.ext.web.consentDetails='{"GPC_DataSharingOptIn":false}',e&&(c.ext.utc=c.ext.utc??{},c.ext.utc.flags=8462029)}),r}var I8=class{constructor(t,e,s,i,n){this.e=t,this.f=e,this.g=s,this.h=n,this.c=nw,this.d=C8,this.g||(this.g={}),typeof i=="function"?this.a=i():this.a=i,this.b=null}i(t){if(this.a){if(typeof this.a!="string"){t(this.a);return}this.b||(this.b=D8(this.a,this.e,this.h)),this.b.then(e=>{t(e)},e=>{it(e),console.error(e)})}}log(t,e){if(!this.a)return;e=Zo(e,this.g),e=Og(e);const s=this.f+"/"+t;try{this.i(i=>{i.pluginVersionString=e?.properties.version??"Unknown",i.track({name:s,baseData:{name:s,properties:e?.properties,measurements:e?.measurements}})})}catch{}}flush(){return this.a?new Promise(t=>{this.i(e=>{e.unload(!0,()=>{this.a=void 0,t(void 0)})})}):Promise.resolve(void 0)}};async function O8(t,e){const s=await e.request(t,Q.None),i=(await Li(s.stream)).toString(),n=s.res.statusCode??200;return{headers:s.res.headers,statusCode:n,responseData:i}}async function L8(t){const e=await import("https"),s={method:t.type,headers:t.headers};return new Promise((n,r)=>{const o=e.request(t.url??"",s,a=>{a.on("data",function(c){n({headers:a.headers,statusCode:a.statusCode??200,responseData:c.toString()})}),a.on("error",function(c){r(c)})});o.write(t.data,a=>{a&&r(a)}),o.end()})}async function A8(t,e,s){const i=typeof e.data=="string"?e.data:new TextDecoder().decode(e.data),n={type:"POST",headers:{...e.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(e.data).toString()},url:e.urlString,data:i};try{const r=t?await O8(n,t):await L8(n);s(r.statusCode,r.headers,r.responseData)}catch{s(0,{})}}var N8=class extends I8{constructor(t,e,s,i,n){const r={sendPOST:(o,a)=>{A8(t,o,a)}};super(e,s,i,n,r)}},vf=class extends T{constructor(e){super(),this.B(new fs(()=>{e.cleanUp()},10*1e3)).schedule()}};vf=__decorate([__param(0,je)],vf);var rw=W("IRemoteTunnelService"),cc={active:!1},kt;(function(t){t.disconnected=e=>({type:"disconnected",onTokenFailed:e}),t.connected=(e,s)=>({type:"connected",info:e,serviceInstallFailed:s}),t.connecting=e=>({type:"connecting",progress:e}),t.uninitialized={type:"uninitialized"}})(kt||(kt={}));var ow="remote.tunnels.access",aw=ow+".hostNameOverride",cw=ow+".preventSleep",lw="remoteTunnelService",j8=v(2250,null),Jt,yf=class{static{Jt=this}static{this.a="not-existing-resource"}static{this.b="remote-backup"}static{this.c="local-backup"}constructor(e,s,i,n,r,o,a,c,l,h){this.e=e,this.f=s,this.g=i,this.h=r,this.i=o,this.j=a,this.k=c,this.l=l,this.n=h,this.d=n.extUri}async getRemoteSyncedProfiles(){const e=await this.e.readResource("profiles",null,void 0);if(e.content){const s=this.N(e.content,"profiles");return Ji(s)}return[]}async getLocalSyncedProfiles(e){const s=await this.f.getAllResourceRefs("profiles",void 0,e);if(s.length){const i=await this.f.resolveResourceContent("profiles",s[0].ref,void 0,e);if(i){const n=this.N(i,"profiles");return Ji(n)}}return[]}async getLocalSyncedMachines(e){const s=await this.f.getAllResourceRefs("machines",void 0,e);if(s.length){const i=await this.f.resolveResourceContent("machines",s[0].ref,void 0,e);if(i)return JSON.parse(i).machines.map(r=>({...r,isCurrent:!1}))}return[]}async getRemoteSyncResourceHandles(e,s){return(await this.e.getAllResourceRefs(e,s?.collection)).map(({created:n,ref:r})=>({created:n,uri:this.L({remote:!0,syncResource:e,profile:s?.id??this.k.defaultProfile.id,location:void 0,collection:s?.collection,ref:r,node:void 0})}))}async getLocalSyncResourceHandles(e,s,i){return(await this.f.getAllResourceRefs(e,s?.collection,i)).map(({created:r,ref:o})=>({created:r,uri:this.L({remote:!1,syncResource:e,profile:s?.id??this.k.defaultProfile.id,collection:s?.collection,ref:o,node:void 0,location:i})}))}resolveUserDataSyncResource({uri:e}){const s=this.M(e),i=s?this.k.profiles.find(n=>n.id===s.profile):void 0;return s&&i?{profile:i,syncResource:s?.syncResource}:void 0}async getAssociatedResources({uri:e}){const s=this.M(e);if(!s)return[];const i=this.k.profiles.find(n=>n.id===s.profile);switch(s.syncResource){case"settings":return this.s(e,i);case"keybindings":return this.u(e,i);case"tasks":return this.w(e,i);case"mcp":return this.P(e,i);case"snippets":return this.y(e,i);case"prompts":return this.A(e,i);case"globalState":return this.F(e,i);case"extensions":return this.C(e,i);case"profiles":return this.I(e,i);case"workspaceState":return[]}}async getMachineId({uri:e}){const s=this.M(e);if(s){if(s.remote){if(s.ref){const{content:i}=await this.O(s.syncResource,s.ref,s.collection);if(i)return this.N(i,s.syncResource)?.machineId}return}if(s.location){if(s.ref){const i=await this.f.resolveResourceContent(s.syncResource,s.ref,s.collection,s.location);if(i)return this.N(i,s.syncResource)?.machineId}return}return In(this.h,this.j,this.i)}}async resolveContent(e){const s=this.M(e);if(!s||s.node===Jt.a)return null;if(s.ref){const i=await this.o(s.remote,s.syncResource,s.collection,s.ref,s.location);return s.node&&i?this.q(s.syncResource,i,s.node):i}return!s.remote&&!s.node?this.r(s.syncResource,s.profile):null}async o(e,s,i,n,r){if(e){const{content:o}=await this.O(s,n,i);return o}return this.f.resolveResourceContent(s,n,i,r)}q(e,s,i){const n=this.N(s,e);switch(e){case"settings":return this.t(n,i);case"keybindings":return this.v(n,i);case"tasks":return this.x(n,i);case"mcp":return this.Q(n,i);case"snippets":return this.z(n,i);case"prompts":return this.B(n,i);case"globalState":return this.G(n,i);case"extensions":return this.D(n,i);case"profiles":return this.J(n,i);case"workspaceState":return null}}async r(e,s){const i=this.k.profiles.find(n=>n.id===s);if(!i)return null;switch(e){case"globalState":return this.H(i);case"extensions":return this.E(i);case"profiles":return this.K(i);case"settings":return null;case"keybindings":return null;case"tasks":return null;case"mcp":return null;case"snippets":return null;case"prompts":return null;case"workspaceState":return null}}s(e,s){const i=this.d.joinPath(e,"settings.json"),n=s?s.settingsResource:this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}t(e,s){switch(s){case"settings.json":return Bu(e.content).settings}return null}u(e,s){const i=this.d.joinPath(e,"keybindings.json"),n=s?s.keybindingsResource:this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}v(e,s){switch(s){case"keybindings.json":return Ga(e.content,!!this.l.getValue(iu),this.g)}return null}w(e,s){const i=this.d.joinPath(e,"tasks.json"),n=s?s.tasksResource:this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}x(e,s){switch(s){case"tasks.json":return Vu(e.content,this.g)}return null}async y(e,s){const i=await this.resolveContent(e);if(i){const n=this.N(i,"snippets");if(n){const r=zu(n),o=[];for(const a of Object.keys(r)){const c=this.d.joinPath(e,a),l=s?this.d.joinPath(s.snippetsHome,a):this.d.joinPath(e,Jt.a);o.push({resource:c,comparableResource:l})}return o}}return[]}z(e,s){return zu(e)[s]||null}async A(e,s){const i=await this.resolveContent(e);if(i){const n=this.N(i,"prompts");if(n){const r=Nu(n),o=[];for(const a of Object.keys(r)){const c=this.d.joinPath(e,a),l=s?this.d.joinPath(s.promptsHome,a):this.d.joinPath(e,Jt.a);o.push({resource:c,comparableResource:l})}return o}}return[]}B(e,s){return Nu(e)[s]||null}C(e,s){const i=this.d.joinPath(e,"extensions.json"),n=s?this.L({remote:!1,syncResource:"extensions",profile:s.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}D(e,s){switch(s){case"extensions.json":return xu(d6(e),!0)}return null}async E(e){const{localExtensions:s}=await this.n.createInstance(Va).getLocalExtensions(e);return xu(s,!0)}F(e,s){const i=this.d.joinPath(e,"globalState.json"),n=s?this.L({remote:!1,syncResource:"globalState",profile:s.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}G(e,s){switch(s){case"globalState.json":return Gi(JSON.parse(e.content),!0)}return null}async H(e){const s=await this.n.createInstance(Ha).getLocalGlobalState(e);return Gi(s,!0)}I(e,s){const i=this.d.joinPath(e,"profiles.json"),n=this.L({remote:!1,syncResource:"profiles",profile:this.k.defaultProfile.id,location:void 0,collection:void 0,ref:void 0,node:void 0});return[{resource:i,comparableResource:n}]}J(e,s){switch(s){case"profiles.json":return Sr(JSON.parse(e.content),{})}return null}async K(e){return Gu(this.k.profiles.filter(s=>!s.isDefault&&!s.isTransient),!0)}L(e){const s=e.remote?Jt.b:Jt.c,i=[];return e.location&&(i.push(`scheme:${e.location.scheme}`),i.push(`authority:${e.location.authority}`),i.push(Dy(e.location.path,"/"))),i.push(`syncResource:${e.syncResource}`),i.push(`profile:${e.profile}`),e.collection&&i.push(`collection:${e.collection}`),e.ref&&i.push(`ref:${e.ref}`),e.node&&i.push(e.node),this.d.joinPath(k.from({scheme:I,authority:s,path:"/",query:e.location?.query,fragment:e.location?.fragment}),...i)}M(e){if(e.scheme!==I)return;const s=[];for(;e.path!=="/";)s.unshift(this.d.basename(e)),e=this.d.dirname(e);if(s.length<2)return;const i=e.authority===Jt.b;let n,r;const o=[];let a,c,l,h,u;for(;s.length;){const f=s.shift();f.startsWith("scheme:")?n=f.substring(7):f.startsWith("authority:")?r=f.substring(10):f.startsWith("syncResource:")?a=f.substring(13):f.startsWith("profile:")?c=f.substring(8):f.startsWith("collection:")?l=f.substring(11):f.startsWith("ref:")?h=f.substring(4):a?u=f:o.push(f)}return{remote:i,syncResource:a,profile:c,collection:l,ref:h,node:u,location:n&&r!==void 0?this.d.joinPath(k.from({scheme:n,authority:r,query:e.query,fragment:e.fragment,path:"/"}),...o):void 0}}N(e,s){try{const i=JSON.parse(e);if(Fr(i))return i}catch(i){this.g.error(i)}throw new Pe(v(2686,null),"IncompatibleRemoteContent",s)}async O(e,s,i){const n=await this.e.resolveResourceContent(e,s,i);return{ref:s,content:n}}P(e,s){const i=this.d.joinPath(e,"mcp.json"),n=s?s.mcpResource:this.d.joinPath(e,Jt.a);return[{resource:i,comparableResource:n}]}Q(e,s){switch(s){case"mcp.json":return Pm(e.content,this.g)}return null}};yf=Jt=__decorate([__param(0,nt),__param(1,xt),__param(2,Re),__param(3,he),__param(4,ae),__param(5,ne),__param(6,K),__param(7,je),__param(8,ge),__param(9,is)],yf);async function T8(t,e,s,i,n){try{const r=await t.getExtensionsControlManifest();if(!r.deprecated)return;const o=await t.getInstalled(1);for(const[a,c]of Object.entries(r.deprecated)){if(!c?.extension)continue;const{id:l,autoMigrate:h,preRelease:u}=c.extension;if(!h)continue;const f=o.find(g=>G(g.identifier,{id:a}));if(!f)continue;const p=(await e.getExtensions([{id:l,preRelease:u}],{targetPlatform:await t.getTargetPlatform(),compatible:!0},Q.None))[0];if(!p){n.info(`Skipping migrating '${f.identifier.id}' extension because, the comaptible target '${l}' extension is not found`);continue}try{n.info(`Migrating '${f.identifier.id}' extension to '${l}' extension...`);const g=!i.getDisabledExtensions().some(w=>G(w,f.identifier));await t.uninstall(f),n.info(`Uninstalled the unsupported extension '${f.identifier.id}'`);let m=o.find(w=>G(w.identifier,{id:l}));(!m||!m.isPreReleaseVersion&&g)&&(m=await t.installFromGallery(p,{installPreReleaseVersion:!0,isMachineScoped:f.isMachineScoped,operation:4,context:{[$l]:!0}}),n.info(`Installed the pre-release extension '${m.identifier.id}'`),g||(await i.disableExtension(m.identifier),n.info(`Disabled the pre-release extension '${m.identifier.id}' because the unsupported extension '${f.identifier.id}' is disabled`)),h.storage&&(s.addToMigrationList(sa(f.manifest.publisher,f.manifest.name),sa(m.manifest.publisher,m.manifest.name)),n.info("Added pre-release extension to the storage migration list"))),n.info(`Migrated '${f.identifier.id}' extension to '${l}' extension.`)}catch(g){n.error(g)}}if(r.autoUpdate)for(const[a,c]of Object.entries(r.autoUpdate))try{const l=o.find(u=>G(u.identifier,{id:a})&&U5(u.manifest.version,c));if(!l)continue;const h=(await e.getExtensions([{id:a,preRelease:l.preRelease}],{targetPlatform:await t.getTargetPlatform(),compatible:!0},Q.None))[0];if(!h){n.info(`Skipping updating '${l.identifier.id}' extension because, the compatible target '${a}' extension is not found`);continue}await t.installFromGallery(h,{installPreReleaseVersion:l.preRelease,isMachineScoped:l.isMachineScoped,operation:3,context:{[$l]:!0}}),n.info(`Autoupdated '${l.identifier.id}' extension to '${h.version}' extension.`)}catch(l){n.error(l)}}catch(r){n.error(r)}}var bf=class extends T{constructor(e,s,i,n,r,o){super(),e.cleanUp(),T8(e,s,i,n,o),Tr.removeOutdatedExtensionVersions(e,r)}};bf=__decorate([__param(0,Mh),__param(1,Es),__param(2,eu),__param(3,Dp),__param(4,ne),__param(5,Y)],bf);var hw=class extends T{constructor(t,e=[]){super(),this.a=new Gb([t,...e]),this.B(t.onDidChangeLogLevel(s=>this.setLevel(s)))}get onDidChangeLogLevel(){return this.a.onDidChangeLogLevel}setLevel(t){this.a.setLevel(t)}getLevel(){return this.a.getLevel()}trace(t,...e){this.a.trace(t,...e)}debug(t,...e){this.a.debug(t,...e)}info(t,...e){this.a.info(t,...e)}warn(t,...e){this.a.warn(t,...e)}error(t,...e){this.a.error(t,...e)}flush(){this.a.flush()}},uw=W("sharedProcessLifecycleService"),Sf=class extends T{constructor(e){super(),this.b=e,this.a=this.B(new R),this.onWillShutdown=this.a.event}fireOnWillShutdown(){this.b.trace("Lifecycle#onWillShutdown.fire()"),this.a.fire()}};Sf=__decorate([__param(0,Y)],Sf);import{spawn as fw}from"child_process";import{hostname as M8,homedir as F8}from"os";import{Transform as U8}from"stream";var dw=class extends U8{constructor(t){if(super(),typeof t=="number")this.b=t,this.c=1;else{const e=Buffer.isBuffer(t)?t:Buffer.from(t);this.b=e.length===1?e[0]:e,this.c=e.length}}_transform(t,e,s){this.a?this.a=Buffer.concat([this.a,t]):this.a=t;let i=0;for(;i<this.a.length;){const n=typeof this.b=="number"?this.a.indexOf(this.b,i):N1(this.a,this.b,i);if(n===-1)break;this.push(this.a.slice(i,n+this.c)),i=n+this.c}this.a=i===this.a.length?void 0:this.a.slice(i),s()}_flush(t){this.a&&this.push(this.a),t()}},B8=[aw,cw],Ef="remoteTunnelSession",$f="remoteTunnelIsService",xf=class extends T{constructor(e,s,i,n,r,o,a){super(),this.y=e,this.z=s,this.C=i,this.D=o,this.F=a,this.f=new R,this.onDidTokenFailed=this.f.event,this.g=new R,this.onDidChangeTunnelStatus=this.g.event,this.h=new R,this.onDidChangeMode=this.h.event,this.n=cc,this.w=!1,this.I=(c,l)=>{l?this.j.error(c):this.j.info(c)},this.j=this.B(n.createLogger(_(i.logsHome,`${lw}.log`),{id:lw,name:j8})),this.t=new Yc(100),this.B(this.j.onDidChangeLogLevel(c=>this.j.info("Log level changed to "+To(c)))),this.B(r.onWillShutdown(()=>{this.r?.cancel(),this.r=void 0,this.dispose()})),this.B(o.onDidChangeConfiguration(c=>{B8.some(l=>c.affectsConfiguration(l))&&this.t.trigger(()=>this.L())})),this.n=this.R(),this.s=kt.uninitialized}async getTunnelStatus(){return this.s}G(e){this.s=e,this.g.fire(e)}H(e){pw(this.n,e)||(this.n=e,this.S(e),this.h.fire(this.n),e.active?(this.j.info(`Session updated: ${e.session.accountLabel} (${e.session.providerId}) (service=${e.asService})`),e.session.token&&this.j.info(`Session token updated: ${e.session.accountLabel} (${e.session.providerId})`)):this.j.info("Session reset"))}getMode(){return Promise.resolve(this.n)}async initialize(e){if(this.w)return this.s;this.w=!0,this.H(e);try{await this.t.trigger(()=>this.L())}catch(s){this.j.error(s)}return this.s}J(){if(!this.u){let e;vs?e=this.C.appRoot:e=Zt(Zt(this.C.appRoot)),this.u=J(e,"bin",`${this.z.tunnelApplicationName}${Ae?".exe":""}`)}return this.u}async startTunnel(e){if(pw(this.n,e)&&this.s.type!=="disconnected")return this.s;this.H(e);try{await this.t.trigger(()=>this.L())}catch(s){this.j.error(s)}return this.s}async stopTunnel(){if(this.r&&(this.r.cancel(),this.r=void 0),this.n.active){const e=this.n.asService;this.H(cc);try{e&&this.O("uninstallService",["service","uninstall"])}catch(s){this.j.error(s)}}try{await this.O("stop",["kill"])}catch(e){this.j.error(e)}this.G(kt.disconnected())}async L(){this.y.publicLog2("remoteTunnel.enablement",{enabled:this.n.active,service:this.n.active&&this.n.asService}),this.r&&(this.r.cancel(),this.r=void 0);let e="",s=!1;const i=(l,h)=>{h?this.j.error(l):e+=l,!this.C.isBuilt&&l.startsWith("   Compiling")&&this.G(kt.connecting(v(2251,null)))},n=this.O("status",["status"],i);this.r=n;try{if(await n,this.r!==n)return;let l;try{l=JSON.parse(e.trim().split(`
`).find(h=>h.startsWith("{")))}catch{this.j.error(`Could not parse status output: ${JSON.stringify(e.trim())}`),this.G(kt.disconnected());return}if(s=l.service_installed,this.j.info(l.tunnel?"Other tunnel running, attaching...":"No other tunnel running"),!l.tunnel&&!this.n.active){this.G(kt.disconnected());return}}catch(l){this.j.error(l),this.G(kt.disconnected());return}finally{this.r===n&&(this.r=void 0)}const r=this.n.active?this.n.session:void 0;if(r&&r.token){const l=r.token;this.G(kt.connecting(v(2252,null,r.accountLabel,r.providerId)));const h=(f,p)=>{f=f.replaceAll(l,"*".repeat(4)),i(f,p)},u=this.O("login",["user","login","--provider",r.providerId,"--log",To(this.j.getLevel())],h,{VSCODE_CLI_ACCESS_TOKEN:l});this.r=u;try{if(await u,this.r!==u)return}catch(f){this.j.error(f),this.r=void 0,this.f.fire(r),this.G(kt.disconnected(r));return}}const o=this.Q();o?this.G(kt.connecting(v(2253,null,o))):this.G(kt.connecting(v(2254,null)));const a=["--accept-server-license-terms","--log",To(this.j.getLevel())];o?a.push("--name",o):a.push("--random-name");let c=!1;return this.n.active&&this.n.asService&&!s&&(c=await this.M(a)===!1),this.N(r,a,c)}async M(e){let s;try{s=await this.O("serviceInstall",["service","install",...e])}catch(i){this.j.error(i),s=1}if(s!==0){const i=v(2255,null);return this.j.warn(i),this.G(kt.connecting(i)),!1}return!0}async N(e,s,i){s.push("--parent-process-id",String(process.pid)),this.P()&&s.push("--no-sleep");let n=!1;const r=this.O("tunnel",s,(o,a)=>{a?this.j.error(o):this.j.info(o),o.includes("Connected to an existing tunnel process")&&(n=!0);const c=o.match(/Open this link in your browser (https:\/\/([^\/\s]+)\/([^\/\s]+)\/([^\/\s]+))/);if(c){const l={link:c[1],domain:c[2],tunnelName:c[4],isAttached:n};this.G(kt.connected(l,i))}else o.match(/error refreshing token/)&&(r.cancel(),this.f.fire(e),this.G(kt.disconnected(e)))});this.r=r,r.finally(()=>{r===this.r&&(this.j.info("tunnel process terminated"),this.r=void 0,this.n=cc,this.G(kt.disconnected()))})}O(e,s,i=this.I,n){return vt(r=>new Promise((o,a)=>{r.isCancellationRequested&&o(-1);let c;const l=["ignore","pipe","pipe"];if(r.onCancellationRequested(()=>{c&&(this.j.info(`${e} terminating(${c.pid})`),c.kill())}),!this.C.isBuilt)i(`Building tunnel CLI from sources and run
`,!1),i(`${e} Spawning: cargo run -- tunnel ${s.join(" ")}
`,!1),c=fw("cargo",["run","--","tunnel",...s],{cwd:J(this.C.appRoot,"cli"),stdio:l,env:{...process.env,RUST_BACKTRACE:"1",...n}});else{i(`Running tunnel CLI
`,!1);const h=this.J();i(`${e} Spawning: ${h} tunnel ${s.join(" ")}
`,!1),c=fw(h,["tunnel",...s],{cwd:F8(),stdio:l,env:{...process.env,...n}})}c.stdout.pipe(new dw(`
`)).on("data",h=>{if(c){const u=h.toString();i(u,!1)}}),c.stderr.pipe(new dw(`
`)).on("data",h=>{if(c){const u=h.toString();i(u,!0)}}),c.on("exit",h=>{c&&(i(`${e} exit(${c.pid}): + ${h} `,!1),c=void 0,o(h||0))}),c.on("error",h=>{c&&(i(`${e} error(${c.pid}): + ${h} `,!0),c=void 0,a())})}))}async getTunnelName(){return this.Q()}P(){return!!this.D.getValue(cw)}Q(){let e=this.D.getValue(aw)||M8();return e=e.replace(/^-+/g,"").replace(/[^\w-]/g,"").substring(0,20),e||void 0}R(){try{const e=this.F.get(Ef,-1),s=this.F.getBoolean($f,-1,!1);if(e){const i=JSON.parse(e);if(i&&$e(i.accountLabel)&&$e(i.sessionId)&&$e(i.providerId))return{active:!0,session:i,asService:s};this.j.error("Problems restoring session from storage, invalid format",i)}}catch(e){this.j.error("Problems restoring session from storage",e)}return cc}S(e){if(e.active){const s={providerId:e.session.providerId,sessionId:e.session.sessionId,accountLabel:e.session.accountLabel};this.F.store(Ef,JSON.stringify(s),-1,1),this.F.store($f,e.asService,-1,1)}else this.F.remove(Ef,-1),this.F.remove($f,-1)}};xf=__decorate([__param(0,ke),__param(1,pe),__param(2,_t),__param(3,dr),__param(4,uw),__param(5,ge),__param(6,ne)],xf);function z8(t,e){return t&&e?t.sessionId===e.sessionId&&t.providerId===e.providerId&&t.token===e.token:t===e}var pw=(t,e)=>t.active!==e.active?!1:t.active&&e.active?t.asService===e.asService&&z8(t.session,e.session):!0,kf=class extends Dh{constructor(e,s,i,n,r){super(k.file(e.extensionsPath),s,i,n,r)}};kf=__decorate([__param(0,_t),__param(1,K),__param(2,je),__param(3,he),__param(4,Y)],kf);var _8=class{constructor(t){this.a=t}get ignoredRecommendations(){throw new Error("not supported")}promptImportantExtensionsInstallNotification(t){return this.a.call("promptImportantExtensionsInstallNotification",[t])}promptWorkspaceRecommendations(t){throw new Error("not supported")}hasToIgnoreRecommendationNotifications(){throw new Error("not supported")}},Pf=class{constructor(e,s){return this.windowId=e,$t.toService(s.getChannel("nativeHost"),{context:e,properties:(()=>{const i=new Map;return i.set("windowId",e),i})()})}};Pf=__decorate([__param(1,Jo)],Pf);var Rf="sync.disableMachineEventually",Cf="sync.sessionId",Df="sync.storeUrl",If="sync.productQuality",Of=class extends T{get n(){const e=this.H.get(Df,-1);return e?k.parse(e):void 0}set n(e){e?this.H.store(Df,e.toString(),-1,1):this.H.remove(Df,-1)}get s(){return this.H.get(If,-1)}set s(e){e?this.H.store(If,e,-1,1):this.H.remove(If,-1)}constructor(e,s,i,n,r,o,a,c,l,h){super(),this.u=s,this.w=i,this.y=n,this.z=r,this.C=o,this.D=a,this.F=c,this.G=l,this.H=h,this.a=this.B(new hs),this.b=0,this.c=void 0,this.g=!1,this.h=this.B(new R),this.onError=this.h.event,this.S=[],this.f=this.B(new Ii(this.U())),this.j=this.n,this.n=s.userDataSyncStore?.url,this.r=this.s,this.s=e.quality,this.n&&(this.C.info("[AutoSync] Using settings sync service",this.n.toString()),this.B(s.onDidChangeUserDataSyncStore(()=>{_s(this.n,s.userDataSyncStore?.url)||(this.j=this.n,this.n=s.userDataSyncStore?.url,this.n&&this.C.info("[AutoSync] Using settings sync service",this.n.toString()))})),this.y.isEnabled()?this.C.info("[AutoSync] Enabled."):this.C.info("[AutoSync] Disabled."),this.I(),this.Q()&&this.P(),this.B(a.onDidChangeAccount(()=>this.I())),this.B(i.onDidChangeDonotMakeRequestsUntil(()=>this.I())),this.B(r.onDidChangeLocal(u=>this.triggerSync([u]))),this.B(L.filter(this.y.onDidChangeResourceEnablement,([,u])=>u)(()=>this.triggerSync(["resourceEnablement"]))),this.B(this.u.onDidChangeUserDataSyncStore(()=>this.triggerSync(["userDataSyncStoreChanged"]))))}I(){const{enabled:e,message:s}=this.L();e?this.a.value===void 0&&(this.a.value=new V8(this.j,1e3*60*5,this.u,this.w,this.z,this.G,this.C,this.F,this.H),this.a.value.register(this.a.value.onDidStartSync(()=>this.c=new Date().getTime())),this.a.value.register(this.a.value.onDidFinishSync(i=>this.O(i))),this.J()&&this.a.value.start()):(this.f.cancel(),this.a.value!==void 0?(s&&this.C.info(s),this.a.clear()):s&&this.y.isEnabled()&&this.C.info(s))}J(){return!0}L(){return this.y.isEnabled()?this.D.account?this.w.donotMakeRequestsUntil?{enabled:!1,message:`[AutoSync] Suspended until ${au(this.w.donotMakeRequestsUntil)} because server is not accepting requests until then.`}:this.g?{enabled:!1,message:"[AutoSync] Suspended until restart."}:{enabled:!0}:{enabled:!1,message:"[AutoSync] Suspended until auth token is available."}:{enabled:!1,message:"[AutoSync] Disabled."}}async turnOn(){this.R(),this.j=this.n,this.M(!0)}async turnOff(e,s,i){try{this.D.account&&!i&&await this.G.removeCurrentMachine(),this.M(!1),this.H.remove(Cf,-1),e?await this.z.reset():await this.z.resetLocal()}catch(n){if(this.C.error(n),s)this.M(!1);else throw n}}M(e){this.y.isEnabled()!==e&&(this.y.setEnablement(e),this.I())}N(){return!!this.r&&!!this.s&&this.r!==this.s}async O(e){if(this.C.debug("[AutoSync] Sync Finished"),!e){this.b=0;return}const s=Pe.toUserDataSyncError(e);s.code==="SessionExpired"?(await this.turnOff(!1,!0),this.C.info("[AutoSync] Turned off sync because current session is expired")):s.code==="TurnedOff"?(await this.turnOff(!1,!0),this.C.info("[AutoSync] Turned off sync because sync is turned off in the cloud")):s.code==="LocalTooManyRequests"?(this.g=!0,this.C.info("[AutoSync] Suspended sync because of making too many requests to server"),this.I()):s.code==="RemoteTooManyRequests"?(await this.turnOff(!1,!0,!0),this.P(),this.C.info("[AutoSync] Turned off sync because of making too many requests to server")):s.code==="MethodNotFound"?(await this.turnOff(!1,!0),this.C.info("[AutoSync] Turned off sync because current client is making requests to server that are not supported")):s.code==="UpgradeRequired"||s.code==="Gone"?(await this.turnOff(!1,!0,!0),this.P(),this.C.info("[AutoSync] Turned off sync because current client is not compatible with server. Requires client upgrade.")):s.code==="IncompatibleLocalContent"?(await this.turnOff(!1,!0),this.C.info(`[AutoSync] Turned off sync because server has ${s.resource} content with newer version than of client. Requires client upgrade.`)):s.code==="IncompatibleRemoteContent"?(await this.turnOff(!1,!0),this.C.info(`[AutoSync] Turned off sync because server has ${s.resource} content with older version than of client. Requires server reset.`)):s.code==="ServiceChanged"||s.code==="DefaultServiceChanged"?ot&&s.code==="DefaultServiceChanged"&&!this.N()?(await this.turnOff(!1,!0),this.C.info("[AutoSync] Turned off sync because default sync service is changed.")):(await this.turnOff(!1,!0,!0),await this.turnOn(),this.C.info("[AutoSync] Sync Service changed. Turned off auto sync, reset local state and turned on auto sync.")):(this.C.error(s),this.b++),this.h.fire(s)}async P(){this.H.store(Rf,!0,-1,1),await Oi(1e3*60*10),this.Q()&&(this.R(),!this.y.isEnabled()&&this.D.account&&await this.G.removeCurrentMachine())}Q(){return this.H.getBoolean(Rf,-1,!1)}R(){this.H.remove(Rf,-1)}async triggerSync(e,s){if(this.a.value===void 0)return this.f.cancel();if(s?.skipIfSyncedRecently&&this.c&&new Date().getTime()-this.c<1e4){this.C.debug("[AutoSync] Skipping because sync was triggered recently.",e);return}return this.S.push(...e),this.f.trigger(async()=>{this.C.trace("[AutoSync] Activity sources",...this.S),this.S=[],this.a.value&&await this.a.value.sync("Activity",!!s?.disableCache)},this.b?Math.min(this.U()*this.b,6e4):s?.immediately?0:this.U())}U(){return this.c&&new Date().getTime()-this.c>1e4?(this.C.debug("[AutoSync] Sync immediately because last sync was triggered more than 10 seconds ago."),0):3e3}};Of=__decorate([__param(0,pe),__param(1,li),__param(2,nt),__param(3,pt),__param(4,Oa),__param(5,Re),__param(6,Aa),__param(7,ke),__param(8,Ta),__param(9,ne)],Of);var V8=class cd extends T{static{this.a="Interval"}constructor(e,s,i,n,r,o,a,c,l){super(),this.m=e,this.n=s,this.r=i,this.s=n,this.u=r,this.w=o,this.y=a,this.z=c,this.C=l,this.b=this.B(new hs),this.c=this.B(new R),this.onDidStartSync=this.c.event,this.f=this.B(new R),this.onDidFinishSync=this.f.event,this.g=null}start(){this.B(this.onDidFinishSync(()=>this.D())),this.B(de(()=>{this.j&&(this.j.cancel(),this.y.info("[AutoSync] Cancelled sync that is in progress"),this.j=void 0),this.h?.stop(),this.y.info("[AutoSync] Stopped")})),this.sync(cd.a,!1)}D(){this.b.value=hn(()=>{this.sync(cd.a,!1),this.b.value=void 0},this.n)}sync(e,s){const i=vt(async n=>{if(this.j)try{this.y.debug("[AutoSync] Waiting until sync is finished."),await this.j}catch(r){if(Ts(r))return}return this.H(e,s,n)});return this.j=i,this.j.finally(()=>this.j=void 0),this.j}F(){return this.m!==void 0&&!_s(this.m,this.r.userDataSyncStore?.url)}async G(){const e=await this.r.getPreviousUserDataSyncStore(),s=this.r.userDataSyncStore;return!!s&&!!e&&(!_s(s.defaultUrl,e.defaultUrl)||!_s(s.insidersUrl,e.insidersUrl)||!_s(s.stableUrl,e.stableUrl))}async H(e,s,i){this.y.info(`[AutoSync] Triggered by ${e}`),this.c.fire();let n;try{await this.I(s,i)}catch(r){if(this.y.error(r),n=r,Pe.toUserDataSyncError(r).code==="MethodNotFound")try{this.y.info("[AutoSync] Client is making invalid requests. Cleaning up data..."),await this.u.cleanUpRemoteData(),this.y.info("[AutoSync] Retrying sync..."),await this.I(s,i),n=void 0}catch(o){this.y.error(o),n=o}}this.f.fire(n)}async I(e,s){if(this.h=await this.u.createSyncTask(this.g,e),s.isCancellationRequested)return;if(this.g=this.h.manifest,this.g===null&&await this.u.hasPreviouslySynced())throw this.F()?await this.G()?new hi(v(2672,null),"DefaultServiceChanged"):new hi(v(2673,null),"ServiceChanged"):new hi(v(2674,null),"TurnedOff");const i=this.C.get(Cf,-1);if(i&&this.g&&i!==this.g.session)throw this.F()?await this.G()?new hi(v(2675,null),"DefaultServiceChanged"):new hi(v(2676,null),"ServiceChanged"):new hi(v(2677,null),"SessionExpired");const n=await this.w.getMachines(this.g||void 0);if(s.isCancellationRequested)return;const r=n.find(a=>a.isCurrent);if(r?.disabled)throw new hi(v(2678,null),"TurnedOff");const o=new Date().getTime();if(await this.h.run(),this.z.publicLog2("settingsSync:sync",{duration:new Date().getTime()-o}),this.g===null)try{this.g=await this.s.manifest(null)}catch(a){throw new hi(Qt(a),a instanceof Pe?a.code:"Unknown")}this.g&&this.g.session!==i&&this.C.store(Cf,this.g.session,-1,1),!s.isCancellationRequested&&(r||await this.w.addCurrentMachine(this.g||void 0))}register(e){return super.B(e)}},Lf=class extends Of{constructor(e,s,i,n,r,o,a,c,l,h,u){super(e,s,i,n,r,a,c,l,h,u),this.B(L.debounce(L.any(L.map(o.onDidFocusMainWindow,()=>"windowFocus"),L.map(o.onDidOpenMainWindow,()=>"windowOpen")),(f,p)=>f?[...f,p]:[p],1e3)(f=>this.triggerSync(f,{skipIfSyncedRecently:!0})))}};Lf=__decorate([__param(0,pe),__param(1,li),__param(2,nt),__param(3,pt),__param(4,Oa),__param(5,Go),__param(6,Re),__param(7,Aa),__param(8,ke),__param(9,Ta),__param(10,ne)],Lf);var Af=class extends T{constructor(e,s){super(),this.b=e,this.c=s,this.a=new Map,this.c.configBasedExtensionTips&&Object.entries(this.c.configBasedExtensionTips).forEach(([,i])=>this.a.set(i.configPath,i))}getConfigBasedTips(e){return this.f(e)}async getImportantExecutableBasedTips(){return[]}async getOtherExecutableBasedTips(){return[]}async f(e){const s=[];for(const[i,n]of this.a)if(!(n.configScheme&&n.configScheme!==e.scheme))try{const r=(await this.b.readFile(_(e,i))).value.toString();for(const[o,a]of Object.entries(n.recommendations))(!a.contentPattern||new RegExp(a.contentPattern,"mig").test(r))&&s.push({extensionId:o,extensionName:a.name,configName:n.configName,important:!!a.important,isExtensionPack:!!a.isExtensionPack,whenNotInstalled:a.whenNotInstalled})}catch{}return s}};Af=__decorate([__param(0,K),__param(1,pe)],Af);var gw="extensionTips/promptedExecutableTips",mw="extensionTips/lastPromptedMediumImpExeTime",q8=class extends Af{constructor(t,e,s,i,n,r,o,a){super(o,a),this.r=t,this.s=e,this.t=s,this.u=i,this.w=n,this.z=r,this.g=new Map,this.h=new Map,this.j=new Map,this.m=new Map,this.n=new Map,a.exeBasedExtensionTips&&Object.entries(a.exeBasedExtensionTips).forEach(([c,l])=>{const h=[],u=[],f=[];Object.entries(l.recommendations).forEach(([p,g])=>{g.important?l.important?h.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack}):u.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack}):f.push({extensionId:p,extensionName:g.name,isExtensionPack:!!g.isExtensionPack})}),h.length&&this.g.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:h}),u.length&&this.h.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:u}),f.length&&this.j.set(c,{exeFriendlyName:l.friendlyName,windowsPath:l.windowsPath,recommendations:f})}),hn(async()=>{await this.C(),this.F(),this.G()},3e3,this.q)}async getImportantExecutableBasedTips(){const t=await this.O(this.g),e=await this.O(this.h);return[...t,...e]}getOtherExecutableBasedTips(){return this.O(this.j)}async C(){const t=await this.O(this.g),e=await this.O(this.h),s=await this.u.getInstalled();this.m=this.D(t,s),this.n=this.D(e,s)}D(t,e){const s=new Map;t.forEach(a=>s.set(a.extensionId.toLowerCase(),a));const{installed:i,uninstalled:n}=this.N([...s.keys()],e);for(const a of i){const c=s.get(a);c&&this.t.publicLog2("exeExtensionRecommendations:alreadyInstalled",{extensionId:a,exeName:c.exeName})}for(const a of n){const c=s.get(a);c&&this.t.publicLog2("exeExtensionRecommendations:notInstalled",{extensionId:a,exeName:c.exeName})}const r=this.L(),o=new Map;for(const a of n){const c=s.get(a);if(c&&(!r[c.exeName]||!r[c.exeName].includes(c.extensionId))){let l=o.get(c.exeName);l||(l=[],o.set(c.exeName,l)),l.push(c)}}return o}F(){if(this.m.size===0)return;const[t,e]=[...this.m.entries()][0];this.H(e).then(s=>{switch(s){case"reacted":this.M(e[0].exeName,e);break;case"ignored":this.m.delete(t);break;case"incompatibleWindow":{const i=L.once(L.latch(L.any(this.s.onDidOpenMainWindow,this.s.onDidFocusMainWindow)));this.B(i(()=>this.F()));break}case"toomany":{const i=this.B(new hs);i.value=hn(()=>{i.dispose(),this.F()},60*60*1e3);break}}})}G(){if(this.n.size===0)return;const t=this.I(),e=Date.now()-t,s=7*24*60*60*1e3;if(e<s){const r=this.B(new hs);r.value=hn(()=>{r.dispose(),this.G()},s-e);return}const[i,n]=[...this.n.entries()][0];this.H(n).then(r=>{switch(r){case"reacted":{this.J(Date.now()),this.n.delete(i),this.M(n[0].exeName,n);const o=this.B(new hs);o.value=hn(()=>{o.dispose(),this.G()},s);break}case"ignored":this.n.delete(i),this.G();break;case"incompatibleWindow":{const o=L.once(L.latch(L.any(this.s.onDidOpenMainWindow,this.s.onDidFocusMainWindow)));this.B(o(()=>this.G()));break}case"toomany":{const o=this.B(new hs);o.value=hn(()=>{o.dispose(),this.G()},60*60*1e3);break}}})}async H(t){const e=await this.u.getInstalled(1),s=t.filter(i=>!i.whenNotInstalled||i.whenNotInstalled.every(n=>e.every(r=>!G(r.identifier,{id:n})))).map(({extensionId:i})=>i.toLowerCase());return this.z.promptImportantExtensionsInstallNotification({extensions:s,source:3,name:t[0].exeFriendlyName,searchValue:`@exe:"${t[0].exeName}"`})}I(){let t=this.w.getNumber(mw,-1);return t||(t=Date.now(),this.J(t)),t}J(t){this.w.store(mw,t,-1,1)}L(){return JSON.parse(this.w.get(gw,-1,"{}"))}M(t,e){const s=this.L();s[t]=e.map(({extensionId:i})=>i.toLowerCase()),this.w.store(gw,JSON.stringify(s),-1,0)}N(t,e){const s=[],i=[],n=e.reduce((r,o)=>(r.add(o.identifier.id.toLowerCase()),r),new Set);return t.forEach(r=>{n.has(r.toLowerCase())?s.push(r):i.push(r)}),{installed:s,uninstalled:i}}async O(t){const e=[],s=new Map;for(const i of t.keys()){const n=t.get(i);if(!n||!Hn(n.recommendations))continue;const r=[];Ae?n.windowsPath&&r.push(n.windowsPath.replace("%USERPROFILE%",()=>Ne.USERPROFILE).replace("%ProgramFiles(x86)%",()=>Ne["ProgramFiles(x86)"]).replace("%ProgramFiles%",()=>Ne.ProgramFiles).replace("%APPDATA%",()=>Ne.APPDATA).replace("%WINDIR%",()=>Ne.WINDIR)):(r.push(J("/usr/local/bin",i)),r.push(J("/usr/bin",i)),r.push(J(this.r.fsPath,i)));for(const o of r){let a=s.get(o);if(a===void 0&&(a=await this.b.exists(k.file(o)),s.set(o,a)),a)for(const{extensionId:c,extensionName:l,isExtensionPack:h,whenNotInstalled:u}of n.recommendations)e.push({extensionId:c,extensionName:l,isExtensionPack:h,exeName:i,exeFriendlyName:n.exeFriendlyName,windowsPath:n.windowsPath,whenNotInstalled:u})}}return e}},Nf=class extends q8{constructor(e,s,i,n,r,o,a,c){super(e.userHome,r,s,i,n,o,a,c)}};Nf=__decorate([__param(0,_t),__param(1,ke),__param(2,Hs),__param(3,ne),__param(4,Go),__param(5,O0),__param(6,K),__param(7,pe)],Nf);var W8=class extends zg{constructor(t,e,s,i){super(),this.ab=s,this.bb=i,this.W=this.B(new De),this.Z=this.B(new De),this.c=e.defaultProfile,this.s=this.cb(),this.U=e.currentProfile,this.X=this.db(this.U),this.Y=t?.id,this.$=this.eb(t)}cb(){const t=this.B(new Ap(this.ab.getChannel("storage"))),e=this.B(new ia(t));return this.B(e.onDidChangeStorage(s=>this.u(-1,s))),e}db(t){this.W.clear(),this.U=t;let e;if(oa(t))e=this.s;else{const s=this.W.add(new Np(this.ab.getChannel("storage"),t));e=this.W.add(new ia(s))}return this.W.add(e.onDidChangeStorage(s=>this.u(0,s))),e}eb(t){this.Z.clear(),this.Y=t?.id;let e;if(t){const s=this.Z.add(new b2(this.ab.getChannel("storage"),t));e=this.Z.add(new ia(s)),this.Z.add(e.onDidChangeStorage(i=>this.u(1,i)))}return e}async O(){await Ze.settled([this.s.init(),this.X.init(),this.$?.init()??Promise.resolve()])}P(t){switch(t){case-1:return this.s;case 0:return this.X;default:return this.$}}Q(t){switch(t){case-1:return this.c.globalStorageHome.with({scheme:oe.file}).fsPath;case 0:return this.U?.globalStorageHome.with({scheme:oe.file}).fsPath;default:return this.Y?`${_(this.bb.workspaceStorageHome,this.Y,"state.vscdb").with({scheme:oe.file}).fsPath}`:void 0}}async close(){this.t(),this.w(_i.SHUTDOWN),await Ze.settled([this.s.close(),this.X.close(),this.$?.close()??Promise.resolve()])}async R(t){if(!this.M(this.U,t))return;const e=this.X,s=e.items;e!==this.s&&await e.close(),this.X=this.db(t),await this.X.init(),this.N(s,this.X,0)}async S(t,e){const s=this.$,i=s?.items??new Map;await s?.close(),this.$=this.eb(t),await this.$.init(),this.N(i,this.$,1)}hasScope(t){return Mg(t)?this.U.id===t.id:this.Y===t.id}};import*as H8 from"net";var G8=(t,e,s)=>{const i=new Uint8Array(16);for(let o=0;o<16;o++)i[o]=Math.round(Math.random()*256);const n=W4(A.wrap(i));return[`GET ws://localhost${t}?${e}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${n}`].join(`\r
`)+`\r
\r
`},uk=A.fromString(`\r
\r
`),J8=new class{supports(t){return!0}connect({host:t,port:e},s,i,n){return new Promise((r,o)=>{const a=H8.createConnection({host:t,port:e},()=>{a.removeListener("error",o),a.write(G8(s,i,n));const c=l=>{l.toString().indexOf(`\r
\r
`)>=0&&(a.off("data",c),r(new rf(a,n)))};a.on("data",c)});a.setNoDelay(!0),a.once("error",o)})}};import{homedir as K8,tmpdir as Q8}from"os";var ww=/^([^.]+\..+)[:=](.+)$/,Ce=class{get appRoot(){return Zt(ei.asFileUri("").fsPath)}get userHome(){return k.file(this.b.homeDir)}get userDataPath(){return this.b.userDataDir}get appSettingsHome(){return k.file(J(this.userDataPath,"User"))}get tmpDir(){return k.file(this.b.tmpDir)}get cacheHome(){return k.file(this.userDataPath)}get stateResource(){return _(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome.with({scheme:oe.vscodeUserData})}get userDataSyncHome(){return _(this.appSettingsHome,"sync")}get logsHome(){if(!this.args.logsPath){const t=au(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=J(this.userDataPath,"logs",t)}return k.file(this.args.logsPath)}get sync(){return this.args.sync}get workspaceStorageHome(){return _(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return _(this.appSettingsHome,"History")}get keyboardLayoutResource(){return _(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){const t=Ne.VSCODE_PORTABLE;return t?k.file(J(t,"argv.json")):_(this.userHome,this.c.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return k.file(J(this.userDataPath,"Workspaces"))}get builtinExtensionsPath(){const t=this.args["builtin-extensions-dir"];return t?Di(t):Ys(J(ei.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){const t=this.args["extensions-download-dir"];return t?k.file(Di(t)):k.file(J(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){const t=this.args["extensions-dir"];if(t)return Di(t);const e=Ne.VSCODE_EXTENSIONS;if(e)return e;const s=Ne.VSCODE_PORTABLE;return s?J(s,"extensions"):_(this.userHome,this.c.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){const t=this.args.extensionDevelopmentPath;if(Array.isArray(t))return t.map(e=>/^[^:/?#]+?:\/\//.test(e)?k.parse(e):k.file(Ys(e)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(t=>t==="ui"||t==="workspace"||t==="web"?t:"workspace")}get extensionTestsLocationURI(){const t=this.args.extensionTestsPath;if(t)return/^[^:/?#]+?:\/\//.test(t)?k.parse(t):k.file(Ys(t))}get disableExtensions(){if(this.args["disable-extensions"])return!0;const t=this.args["disable-extension"];if(t){if(typeof t=="string")return[t];if(Array.isArray(t)&&t.length>0)return t}return!1}get debugExtensionHost(){return X8(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!Ne.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(t=>!ww.test(t))}get extensionLogLevel(){const t=[];for(const e of this.args.log||[]){const s=ww.exec(e);s&&s[1]&&s[2]&&t.push([s[1],s[2]])}return t.length?t:void 0}get serviceMachineIdResource(){return _(k.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableExperiments(){return!!this.args["disable-experiments"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get useInMemorySecretStorage(){return!!this.args["use-inmemory-secretstorage"]}get policyFile(){if(this.args["__enable-file-policy"]){const t=Ne.VSCODE_PORTABLE;return t?k.file(J(t,"policy.json")):_(this.userHome,this.c.dataFolderName,"policy.json")}}get editSessionId(){return this.args.editSessionId}get continueOn(){return this.args.continueOn}set continueOn(t){this.args.continueOn=t}get args(){return this.a}get isSimulation(){return Ne.SIMULATION==="1"}constructor(t,e,s){this.a=t,this.b=e,this.c=s}};__decorate([xe],Ce.prototype,"appRoot",null),__decorate([xe],Ce.prototype,"userHome",null),__decorate([xe],Ce.prototype,"userDataPath",null),__decorate([xe],Ce.prototype,"appSettingsHome",null),__decorate([xe],Ce.prototype,"tmpDir",null),__decorate([xe],Ce.prototype,"cacheHome",null),__decorate([xe],Ce.prototype,"stateResource",null),__decorate([xe],Ce.prototype,"userRoamingDataHome",null),__decorate([xe],Ce.prototype,"userDataSyncHome",null),__decorate([xe],Ce.prototype,"sync",null),__decorate([xe],Ce.prototype,"workspaceStorageHome",null),__decorate([xe],Ce.prototype,"localHistoryHome",null),__decorate([xe],Ce.prototype,"keyboardLayoutResource",null),__decorate([xe],Ce.prototype,"argvResource",null),__decorate([xe],Ce.prototype,"isExtensionDevelopment",null),__decorate([xe],Ce.prototype,"untitledWorkspacesHome",null),__decorate([xe],Ce.prototype,"builtinExtensionsPath",null),__decorate([xe],Ce.prototype,"extensionsPath",null),__decorate([xe],Ce.prototype,"extensionDevelopmentLocationURI",null),__decorate([xe],Ce.prototype,"extensionDevelopmentKind",null),__decorate([xe],Ce.prototype,"extensionTestsLocationURI",null),__decorate([xe],Ce.prototype,"debugExtensionHost",null),__decorate([xe],Ce.prototype,"logLevel",null),__decorate([xe],Ce.prototype,"extensionLogLevel",null),__decorate([xe],Ce.prototype,"serviceMachineIdResource",null),__decorate([xe],Ce.prototype,"disableTelemetry",null),__decorate([xe],Ce.prototype,"disableExperiments",null),__decorate([xe],Ce.prototype,"disableWorkspaceTrust",null),__decorate([xe],Ce.prototype,"useInMemorySecretStorage",null),__decorate([xe],Ce.prototype,"policyFile",null);function X8(t,e){return Z8(t["inspect-extensions"],t["inspect-brk-extensions"],5870,e,t.debugId,t.extensionEnvironment)}function Z8(t,e,s,i,n,r){const a=Number(e||t)||(i?null:s),c=a?!!e:!1;let l;if(r)try{l=JSON.parse(r)}catch{}return{port:a,break:c,debugId:n,env:l}}import{homedir as vw}from"os";import{resolve as Y8,isAbsolute as e3,join as Un}from"path";var t3=process.env.VSCODE_CWD||process.cwd();function s3(t,e){const s=i3(t,e),i=[s];return e3(s)||i.unshift(t3),Y8(...i)}function i3(t,e){process.env.VSCODE_DEV&&(e="code-oss-dev");const s=process.env.VSCODE_PORTABLE;if(s)return Un(s,"user-data");let i=process.env.VSCODE_APPDATA;if(i)return Un(i,e);const n=t["user-data-dir"];if(n)return n;switch(process.platform){case"win32":if(i=process.env.APPDATA,!i){const r=process.env.USERPROFILE;if(typeof r!="string")throw new Error("Windows: Unexpected undefined %USERPROFILE% environment variable");i=Un(r,"AppData","Roaming")}break;case"darwin":i=Un(vw(),"Library","Application Support");break;case"linux":i=process.env.XDG_CONFIG_HOME||Un(vw(),".config");break;default:throw new Error("Platform not supported")}return Un(i,e)}var n3=class extends Ce{constructor(t,e){super(t,{homeDir:K8(),tmpDir:Q8(),userDataDir:s3(t,e.nameShort)},e)}},jf={exit:"vscode:electron-main->shared-process=exit",ipcReady:"vscode:shared-process->electron-main=ipc-ready",initDone:"vscode:shared-process->electron-main=init-done"},r3={request:"vscode:createSharedProcessRawConnection",response:"vscode:createSharedProcessRawConnectionResult"};import{constants as o3,promises as a3}from"fs";import{createInterface as c3}from"readline";async function l3(t){if(vs||Ae)return;let e;for(const s of["/etc/os-release","/usr/lib/os-release","/etc/lsb-release"])try{e=await a3.open(s,o3.R_OK);break}catch{}if(!e){t("Unable to retrieve release information from known identifier paths.");return}try{const s=new Set(["ID","DISTRIB_ID","ID_LIKE","VERSION_ID","DISTRIB_RELEASE"]),i={id:"unknown"};for await(const n of c3({input:e.createReadStream(),crlfDelay:1/0})){if(!n.includes("="))continue;const r=n.split("=")[0].toUpperCase().trim();if(s.has(r)){const o=n.split("=")[1].replace(/"/g,"").toLowerCase().trim();r==="ID"||r==="DISTRIB_ID"?i.id=o:r==="ID_LIKE"?i.id_like=o:(r==="VERSION_ID"||r==="DISTRIB_RELEASE")&&(i.version_id=o)}}return i}catch(s){t(s)}}var Fe;(function(t){t.UNKNOWN="UNKNOWN",t.CINNAMON="CINNAMON",t.DEEPIN="DEEPIN",t.GNOME="GNOME",t.KDE3="KDE3",t.KDE4="KDE4",t.KDE5="KDE5",t.KDE6="KDE6",t.PANTHEON="PANTHEON",t.UNITY="UNITY",t.XFCE="XFCE",t.UKUI="UKUI",t.LXQT="LXQT"})(Fe||(Fe={}));var h3="XDG_CURRENT_DESKTOP",Tf="KDE_SESSION_VERSION";function u3(){const t=Ne[h3];if(t){const s=t.split(":").map(i=>i.trim()).filter(i=>i.length>0);for(const i of s)switch(i){case"Unity":{const n=Ne.DESKTOP_SESSION;return n&&n.includes("gnome-fallback")?Fe.GNOME:Fe.UNITY}case"Deepin":return Fe.DEEPIN;case"GNOME":return Fe.GNOME;case"X-Cinnamon":return Fe.CINNAMON;case"KDE":{const n=Ne[Tf];return n==="5"?Fe.KDE5:n==="6"?Fe.KDE6:Fe.KDE4}case"Pantheon":return Fe.PANTHEON;case"XFCE":return Fe.XFCE;case"UKUI":return Fe.UKUI;case"LXQt":return Fe.LXQT}}const e=Ne.DESKTOP_SESSION;if(e)switch(e){case"deepin":return Fe.DEEPIN;case"gnome":case"mate":return Fe.GNOME;case"kde4":case"kde-plasma":return Fe.KDE4;case"kde":return Tf in Ne?Fe.KDE4:Fe.KDE3;case"xfce":case"xubuntu":return Fe.XFCE;case"ukui":return Fe.UKUI}return"GNOME_DESKTOP_SESSION_ID"in Ne?Fe.GNOME:"KDE_FULL_SESSION"in Ne?Tf in Ne?Fe.KDE4:Fe.KDE3:Fe.UNKNOWN}import{constants as f3,promises as d3}from"fs";var p3="XDG_SESSION_TYPE",g3="WAYLAND_DISPLAY",m3="XDG_RUNTIME_DIR",yw;(function(t){t.Wayland="wayland",t.XWayland="xwayland",t.X11="x11",t.Unknown="unknown"})(yw||(yw={}));async function w3(t){const e=Ne[p3];if(e)return e==="wayland"||e==="x11"?e:"unknown";if(Ne[g3]){const i=Ne[m3];if(i){const n=J(i,"wayland-0");try{return await d3.access(n,f3.R_OK),"wayland"}catch(r){return t(r),"unknown"}}else return"unknown"}else return"x11"}function v3(t,e){if(e)switch(e){case"auto":return t;case"x11":return t==="wayland"?"xwayland":"x11";case"wayland":return"wayland";default:return"unknown"}else return t==="wayland"?"xwayland":"x11"}import{net as y3}from"electron";import{parse as bw}from"url";import{spawn as b3}from"child_process";import{userInfo as S3}from"os";import*as Sw from"os";var Ew=/^\d+$/,E3=/^Microsoft.PowerShell_.*/,$3=/^Microsoft.PowerShellPreview_.*/,$w;(function(t){t[t.x64=0]="x64",t[t.x86=1]="x86",t[t.ARM=2]="ARM"})($w||($w={}));var Gr;switch(process.arch){case"ia32":Gr=1;break;case"arm":case"arm64":Gr=2;break;default:Gr=0;break}var Bn;process.env.PROCESSOR_ARCHITEW6432?Bn=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?Bn=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?Bn=1:Bn=0;var Jr=class{constructor(t,e,s){this.exePath=t,this.displayName=e,this.a=s}async exists(){return this.a===void 0&&(this.a=await Bt.existsFile(this.exePath)),this.a}};function x3({useAlternateBitness:t=!1}={}){return t?Gr===0?process.env["ProgramFiles(x86)"]||null:Bn===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function lc({useAlternateBitness:t=!1,findPreview:e=!1}={}){const s=x3({useAlternateBitness:t});if(!s)return null;const i=J(s,"PowerShell");if(!await Bt.existsDirectory(i))return null;let n=-1,r=null;for(const c of await le.readdir(i)){let l=-1;if(e){const u=c.indexOf("-");if(u<0)continue;const f=c.substring(0,u);if(!Ew.test(f)||c.substring(u+1)!=="preview")continue;l=parseInt(f,10)}else{if(!Ew.test(c))continue;l=parseInt(c,10)}if(l<=n)continue;const h=J(i,c,"pwsh.exe");await Bt.existsFile(h)&&(r=h,n=l)}if(!r)return null;const o=s.includes("x86")?" (x86)":"",a=e?" Preview":"";return new Jr(r,`PowerShell${a}${o}`,!0)}async function xw({findPreview:t}={}){if(!process.env.LOCALAPPDATA)return null;const e=J(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await Bt.existsDirectory(e))return null;const{pwshMsixDirRegex:s,pwshMsixName:i}=t?{pwshMsixDirRegex:$3,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:E3,pwshMsixName:"PowerShell (Store)"};for(const n of await le.readdir(e))if(s.test(n)){const r=J(e,n,"pwsh.exe");return new Jr(r,i)}return null}function k3(){const t=J(Sw.homedir(),".dotnet","tools","pwsh.exe");return new Jr(t,".NET Core PowerShell Global Tool")}function P3(){const t=J(Sw.homedir(),"scoop","apps"),e=J(t,"pwsh","current","pwsh.exe");return new Jr(e,"PowerShell (Scoop)")}function R3(){const t=J(process.env.windir,Gr===1&&Bn!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new Jr(t,"Windows PowerShell",!0)}async function*C3(){let t=await lc();t&&(yield t),t=await lc({useAlternateBitness:!0}),t&&(yield t),t=await xw(),t&&(yield t),t=k3(),t&&(yield t),t=await lc({findPreview:!0}),t&&(yield t),t=await xw({findPreview:!0}),t&&(yield t),t=await lc({useAlternateBitness:!0,findPreview:!0}),t&&(yield t),t=await P3(),t&&(yield t),t=R3(),t&&(yield t)}async function*D3(){for await(const t of C3())await t.exists()&&(yield t)}async function I3(){for await(const t of D3())return t;return null}async function O3(t,e){return t===1?Ae?A3():b7(e):L3(t,e)}var Mf=null;function L3(t,e){if(wt&&t===2||vs&&t===3)return"/bin/bash";if(!Mf){let s;if(Ae)s="/bin/bash";else{if(s=e.SHELL,!s)try{s=S3().shell}catch{}s||(s="sh"),s==="/bin/false"&&(s="/bin/bash")}Mf=s}return Mf}var Ff=null;async function A3(){return Ff||(Ff=(await I3()).exePath),Ff}import"assert";var xk=Cv(Dv(),1),kk={o:v(1866,null),e:v(1867,null),t:v(1868,null),m:v(1869,null)},Pk={chat:{type:"subcommand",description:"Pass in a prompt to run in a chat session in the current working directory.",options:{_:{type:"string[]",description:v(1870,null)},mode:{type:"string",cat:"o",alias:"m",args:"mode",description:v(1871,null)},"add-file":{type:"string[]",cat:"o",alias:"a",args:"path",description:v(1872,null)},maximize:{type:"boolean",cat:"o",description:v(1873,null)},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:v(1874,null)},"new-window":{type:"boolean",cat:"o",alias:"n",description:v(1875,null)},help:{type:"boolean",alias:"h",description:v(1876,null)}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:v(1877,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel.",options:{"cli-data-dir":{type:"string",args:"dir",description:v(1878,null)},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:v(1879,null)},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:v(1880,null)},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:v(1881,null)},remove:{type:"boolean",cat:"o",args:"folder",description:v(1882,null)},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:v(1883,null)},"new-window":{type:"boolean",cat:"o",alias:"n",description:v(1884,null)},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:v(1885,null)},wait:{type:"boolean",cat:"o",alias:"w",description:v(1886,null)},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:v(1887,null)},"user-data-dir":{type:"string",cat:"o",args:"dir",description:v(1888,null)},profile:{type:"string",cat:"o",args:"profileName",description:v(1889,null)},help:{type:"boolean",cat:"o",alias:"h",description:v(1890,null)},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:v(1891,null)},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:v(1892,null)},"show-versions":{type:"boolean",cat:"e",description:v(1893,null)},category:{type:"string",allowEmptyValue:!0,cat:"e",description:v(1894,null),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:v(1895,null)},"pre-release":{type:"boolean",cat:"e",description:v(1896,null)},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:v(1897,null)},"update-extensions":{type:"boolean",cat:"e",description:v(1898,null)},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:v(1899,null)},"add-mcp":{type:"string[]",cat:"m",args:"json",description:v(1900,null)},version:{type:"boolean",cat:"t",alias:"v",description:v(1901,null)},verbose:{type:"boolean",cat:"t",global:!0,description:v(1902,null)},log:{type:"string[]",cat:"t",args:"level",global:!0,description:v(1903,null)},status:{type:"boolean",alias:"s",cat:"t",description:v(1904,null)},"prof-startup":{type:"boolean",cat:"t",description:v(1905,null)},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:v(1906,null)},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:v(1907,null)},sync:{type:"string",cat:"t",description:v(1908,null),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:v(1909,null)},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:v(1910,null)},"disable-lcd-text":{type:"boolean",cat:"t",description:v(1911,null)},"disable-gpu":{type:"boolean",cat:"t",description:v(1912,null)},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:v(1913,null)},sandbox:{type:"boolean"},"locate-shell-integration-path":{type:"string",cat:"t",args:["shell"],description:v(1914,null)},telemetry:{type:"boolean",cat:"t",description:v(1915,null)},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},transient:{type:"boolean"},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},"do-not-include-pack-dependencies":{type:"boolean"},trace:{type:"boolean"},"trace-memory-infra":{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"enable-coi":{type:"boolean"},"unresponsive-sample-interval":{type:"string"},"unresponsive-sample-period":{type:"string"},"enable-rdp-display-tracking":{type:"boolean"},"disable-layout-restore":{type:"boolean"},"disable-experiments":{type:"boolean"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},"xdg-portal-required-version":{type:"string"},_:{type:"string[]"}};function kw(t){return t.VSCODE_CLI==="1"}function N3(t,e,s){return Math.min(Math.max(t,e),s)}var Uf=void 0;async function j3(t,e,s,i){return s["force-disable-user-env"]?(e.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):Ae?(e.trace("resolveShellEnv(): skipped (Windows)"),{}):kw(i)&&!s["force-user-env"]?(e.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):(kw(i)?e.trace("resolveShellEnv(): running (--force-user-env)"):e.trace("resolveShellEnv(): running (macOS/Linux)"),Uf||(Uf=Ze.withAsyncBody(async(n,r)=>{const o=new Ss;let a=1e4;const c=t.getValue("application.shellEnvironmentResolutionTimeout");typeof c=="number"&&(a=N3(c,1,120)*1e3);const l=setTimeout(()=>{o.dispose(!0),r(new Error(v(2274,null)))},a);try{n(await T3(e,o.token))}catch(h){!Ts(h)&&!o.token.isCancellationRequested?r(new Error(v(2275,null,Qt(h)))):n({})}finally{clearTimeout(l),o.dispose()}})),Uf)}async function T3(t,e){const s=process.env.ELECTRON_RUN_AS_NODE;t.trace("getUnixShellEnvironment#runAsNode",s);const i=process.env.ELECTRON_NO_ATTACH_CONSOLE;t.trace("getUnixShellEnvironment#noAttach",i);const n=st().replace(/-/g,"").substr(0,12),r=new RegExp(n+"({.*})"+n),o={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};t.trace("getUnixShellEnvironment#env",o);const a=await O3(an,o);return t.trace("getUnixShellEnvironment#shell",a),new Promise((c,l)=>{if(e.isCancellationRequested)return l(new Ve);const h=Ct(a);let u,f;const p="";/^(?:pwsh|powershell)(?:-preview)?$/.test(h)?(u=`& '${process.execPath}' ${p} -p '''${n}'' + JSON.stringify(process.env) + ''${n}'''`,f=["-Login","-Command"]):h==="nu"?(u=`^'${process.execPath}' ${p} -p '"${n}" + JSON.stringify(process.env) + "${n}"'`,f=["-i","-l","-c"]):h==="xonsh"?(u=`import os, json; print("${n}", json.dumps(dict(os.environ)), "${n}")`,f=["-i","-l","-c"]):(u=`'${process.execPath}' ${p} -p '"${n}" + JSON.stringify(process.env) + "${n}"'`,h==="tcsh"||h==="csh"?f=["-ic"]:f=["-i","-l","-c"]),t.trace("getUnixShellEnvironment#spawn",JSON.stringify(f),u);const g=b3(a,[...f,u],{detached:!0,stdio:["ignore","pipe","pipe"],env:o});e.onCancellationRequested(()=>(g.kill(),l(new Ve))),g.on("error",b=>{t.error("getUnixShellEnvironment#errorChildProcess",Qt(b)),l(b)});const m=[];g.stdout.on("data",b=>m.push(b));const w=[];g.stderr.on("data",b=>w.push(b)),g.on("close",(b,S)=>{const $=Buffer.concat(m).toString("utf8");t.trace("getUnixShellEnvironment#raw",$);const U=Buffer.concat(w).toString("utf8");if(U.trim()&&t.trace("getUnixShellEnvironment#stderr",U),b||S)return l(new Error(v(2276,null,b,S)));const q=r.exec($),me=q?q[1]:"{}";try{const N=JSON.parse(me);s?N.ELECTRON_RUN_AS_NODE=s:delete N.ELECTRON_RUN_AS_NODE,i?N.ELECTRON_NO_ATTACH_CONSOLE=i:delete N.ELECTRON_NO_ATTACH_CONSOLE,delete N.VSCODE_RESOLVING_ENVIRONMENT,delete N.XDG_RUNTIME_DIR,t.trace("getUnixShellEnvironment#result",N),c(N)}catch(N){t.error("getUnixShellEnvironment#errorCaught",Qt(N)),l(N)}})})}import{parse as Pw}from"url";function M3(t,e){return t.protocol==="http:"?e.HTTP_PROXY||e.http_proxy||null:t.protocol==="https:"&&(e.HTTPS_PROXY||e.https_proxy||e.HTTP_PROXY||e.http_proxy)||null}async function F3(t,e,s={}){const i=Pw(t),n=s.proxyUrl||M3(i,e);if(!n)return null;const r=Pw(n);if(!/^https?:$/.test(r.protocol||""))return null;const o={host:r.hostname||"",port:(r.port?+r.port:0)||(r.protocol==="https"?443:80),auth:r.auth,rejectUnauthorized:Kt(s.strictSSL)?s.strictSSL:!0};if(i.protocol==="http:"){const{default:a}=await import("http-proxy-agent");return new a.HttpProxyAgent(n,o)}else{const{default:a}=await import("https-proxy-agent");return new a.HttpsProxyAgent(n,o)}}import{createGunzip as U3}from"zlib";var Bf=class extends n5{constructor(e,s,i,n){super(n),this.m=e,this.n=s,this.r=i,this.s(),this.B(s.onDidChangeConfiguration(r=>{r.affectsConfiguration("http")&&this.s()}))}s(){this.f=this.t("http.proxy"),this.g=!!this.t("http.proxyStrictSSL"),this.h=this.t("http.proxyAuthorization")}async request(e,s){const{f:i,g:n}=this;let r;try{r=await j3(this.n,this.b,this.r.args,process.env)}catch(c){this.j||(this.j=!0,this.b.error("resolving shell environment failed",se(c)))}const o={...process.env,...r},a=e.agent?e.agent:await F3(e.url||"",o,{proxyUrl:i,strictSSL:n});return e.agent=a,e.strictSSL=n,this.h&&(e.headers={...e.headers||{},"Proxy-Authorization":this.h}),this.c(e,()=>Rw(e,s))}async resolveProxy(e){}async lookupAuthorization(e){}async lookupKerberosAuthorization(e){try{const s=this.t("http.proxyKerberosServicePrincipal");return"Negotiate "+await B3(e,s,this.b,"RequestService#lookupKerberosAuthorization")}catch(s){this.b.debug("RequestService#lookupKerberosAuthorization Kerberos authentication failed",s);return}}async loadCertificates(){return(await import("@vscode/proxy-agent")).loadSystemCertificates({log:this.b})}t(e){if(this.m==="remote")return this.n.getValue(e);const s=this.n.inspect(e);return s.userLocalValue||s.defaultValue}};Bf=__decorate([__param(1,ge),__param(2,_t),__param(3,Y)],Bf);async function B3(t,e,s,i){const n=await import("kerberos"),r=n.default||n,o=new URL(t),a=e||(process.platform==="win32"?`HTTP/${o.hostname}`:`HTTP@${o.hostname}`);return s.debug(`${i} Kerberos authentication lookup`,`proxyURL:${o}`,`spn:${a}`),(await r.initializeClient(a)).step("")}async function z3(t){return(bw(t.url).protocol==="https:"?await import("https"):await import("http")).request}async function Rw(t,e){return Ze.withAsyncBody(async(s,i)=>{const n=bw(t.url),r=t.getRawRequest?t.getRawRequest(t):await z3(t),o={hostname:n.hostname,port:n.port?parseInt(n.port):n.protocol==="https:"?443:80,protocol:n.protocol,path:n.path,method:t.type||"GET",headers:t.headers,agent:t.agent,rejectUnauthorized:Kt(t.strictSSL)?t.strictSSL:!0};t.user&&t.password&&(o.auth=t.user+":"+t.password),t.disableCache&&(o.cache="no-store");const a=r(o,c=>{const l=Nc(t.followRedirects)?t.followRedirects:3;if(c.statusCode&&c.statusCode>=300&&c.statusCode<400&&l>0&&c.headers.location)Rw({...t,url:c.headers.location,followRedirects:l-1},e).then(s,i);else{let h=c;!t.isChromiumNetwork&&c.headers["content-encoding"]==="gzip"&&(h=c.pipe(U3())),s({res:c,stream:z4(h)})}});if(a.on("error",i),t.timeout)if(t.isChromiumNetwork){const c=setTimeout(()=>{a.abort(),i(new Error(`Request timeout after ${t.timeout}ms`))},t.timeout);a.on("response",()=>clearTimeout(c)),a.on("error",()=>clearTimeout(c)),a.on("abort",()=>clearTimeout(c))}else a.setTimeout(t.timeout);t.isChromiumNetwork&&a.removeHeader("Content-Length"),t.data&&typeof t.data=="string"&&a.write(t.data),a.end(),e.onCancellationRequested(()=>{a.abort(),i(new Ve)})})}function _3(t){return y3.request}var zf=class extends Bf{constructor(e,s,i){super("local",e,s,i)}request(e,s){return super.request({...e||{},getRawRequest:_3,isChromiumNetwork:!0},s)}};zf=__decorate([__param(0,ge),__param(1,_t),__param(2,Y)],zf);var _f="initializing-default-extensions",Vf=class extends T{constructor(e,s,i,n,r){super(),this.a=e,this.b=s,this.c=n,this.f=r,Ae&&i.getBoolean(_f,-1,!0)&&(i.store(_f,!0,-1,1),this.g().then(()=>i.store(_f,!1,-1,1)))}async g(){const e=this.h();let s;try{if(s=await this.c.resolve(e),!s.children){this.f.debug("There are no default extensions to initialize",e.toString());return}}catch(n){if(Me(n)===1){this.f.debug("There are no default extensions to initialize",e.toString());return}this.f.error("Error initializing extensions",n);return}const i=s.children.filter(n=>n.name.toLowerCase().endsWith(".vsix"));if(i.length===0){this.f.debug("There are no default extensions to initialize",e.toString());return}this.f.info("Initializing default extensions",e.toString()),await Promise.all(i.map(async n=>{this.f.info("Installing default extension",n.resource.toString());try{await this.b.install(n.resource,{donotIncludePackAndDependencies:!0,keepExisting:!1}),this.f.info("Default extension installed",n.resource.toString())}catch(r){this.f.error("Error installing default extension",n.resource.toString(),se(r))}})),this.f.info("Default extensions initialized",e.toString())}h(){return k.file(J(Zt(Zt(this.a.appRoot)),"bootstrap","extensions"))}};Vf=__decorate([__param(0,_t),__param(1,Mh),__param(2,ne),__param(3,K),__param(4,Y)],Vf);function V3(t){return t.type==="gallery"}function q3(t){return t.type===1||t.type===0}var W3=/^(?<version>\d+\.\d+\.\d+(-.*)?)(@(?<platform>.+))?$/,qf=class extends T{get allowedExtensionsConfigValue(){return this.b}constructor(e,s){super(),this.f=s,this.c=this.B(new R),this.onDidChangeAllowedExtensionsConfigValue=this.c.event,this.a=e.extensionPublisherOrgs?.map(i=>i.toLowerCase())??[],this.b=this.g(),this.B(this.f.onDidChangeConfiguration(i=>{i.affectsConfiguration(Wo)&&(this.b=this.g(),this.c.fire())}))}g(){const e=this.f.getValue(Wo);if(!Be(e)||Array.isArray(e))return;const s=Object.entries(e).map(([i,n])=>[i.toLowerCase(),n]);if(!(s.length===1&&s[0][0]==="*"&&s[0][1]===!0))return Object.fromEntries(s)}isAllowed(e){if(!this.b)return!0;let s,i,n,r,o,a;V3(e)?(s=e.identifier.id.toLowerCase(),i=e.version,r=e.properties.isPreReleaseVersion,o=e.publisher.toLowerCase(),a=e.publisherDisplayName.toLowerCase(),n=e.properties.targetPlatform):q3(e)?(s=e.identifier.id.toLowerCase(),i=e.manifest.version,r=e.preRelease,o=e.manifest.publisher.toLowerCase(),a=e.publisherDisplayName?.toLowerCase(),n=e.targetPlatform):(s=e.id.toLowerCase(),i=e.version??"*",n=e.targetPlatform??"universal",r=e.prerelease??!1,o=e.id.substring(0,e.id.indexOf(".")).toLowerCase(),a=e.publisherDisplayName?.toLowerCase());const c=k.parse(`command:workbench.action.openSettings?${encodeURIComponent(JSON.stringify({query:`@id:${Wo}`}))}`).toString(),l=this.b[s],h=new Cs(v(1947,null,c));if(!rt(l))return Kt(l)?l?!0:h:l==="stable"&&r?new Cs(v(1948,null,c)):i!=="*"&&Array.isArray(l)&&!l.some(p=>{const g=W3.exec(p);if(g&&g.groups){const{platform:m,version:w}=g.groups;return!(w!==i||n!=="universal"&&m&&n!==m)}return!1})?new Cs(v(1949,null,i,c)):!0;const u=a&&this.a.includes(a)?a:o,f=this.b[u];return rt(f)?this.b["*"]===!0?!0:h:Kt(f)?f?!0:new Cs(v(1950,null,u,c)):f==="stable"&&r?new Cs(v(1951,null,u,c)):!0}};qf=__decorate([__param(0,pe),__param(1,ge)],qf);var Wf=class extends T{get extensionGalleryManifestStatus(){return this.a.extensionsGallery?.serviceUrl?"available":"unavailable"}constructor(e){super(),this.a=e,this.onDidChangeExtensionGalleryManifest=L.None,this.onDidChangeExtensionGalleryManifestStatus=L.None}async getExtensionGalleryManifest(){const e=this.a.extensionsGallery;if(!e?.serviceUrl)return null;const s=[{id:`${e.serviceUrl}/extensionquery`,type:"ExtensionQueryService"},{id:`${e.serviceUrl}/vscode/{publisher}/{name}/latest`,type:"ExtensionLatestVersionUriTemplate"},{id:`${e.serviceUrl}/publishers/{publisher}/extensions/{name}/{version}/stats?statType={statTypeName}`,type:"ExtensionStatisticsUriTemplate"},{id:`${e.serviceUrl}/itemName/{publisher}.{name}/version/{version}/statType/{statTypeValue}/vscodewebextension`,type:"WebExtensionStatisticsUriTemplate"}];return e.publisherUrl&&s.push({id:`${e.publisherUrl}/{publisher}`,type:"PublisherViewUriTemplate"}),e.itemUrl&&(s.push({id:`${e.itemUrl}?itemName={publisher}.{name}`,type:"ExtensionDetailsViewUriTemplate"}),s.push({id:`${e.itemUrl}?itemName={publisher}.{name}&ssr=false#review-details`,type:"ExtensionRatingViewUriTemplate"})),e.resourceUrlTemplate&&s.push({id:e.resourceUrlTemplate,type:"ExtensionResourceUriTemplate"}),{version:"",resources:s,capabilities:{extensionQuery:{filtering:[{name:"Tag",value:1},{name:"ExtensionId",value:4},{name:"Category",value:5},{name:"ExtensionName",value:7},{name:"Target",value:8},{name:"Featured",value:9},{name:"SearchText",value:10},{name:"ExcludeWithFlags",value:12}],sorting:[{name:"NoneOrRelevance",value:0},{name:"LastUpdatedDate",value:1},{name:"Title",value:2},{name:"PublisherName",value:3},{name:"InstallCount",value:4},{name:"AverageRating",value:6},{name:"PublishedDate",value:10},{name:"WeightedRating",value:12}],flags:[{name:"None",value:0},{name:"IncludeVersions",value:1},{name:"IncludeFiles",value:2},{name:"IncludeCategoryAndTags",value:4},{name:"IncludeSharedAccounts",value:8},{name:"IncludeVersionProperties",value:16},{name:"ExcludeNonValidated",value:32},{name:"IncludeInstallationTargets",value:64},{name:"IncludeAssetUri",value:128},{name:"IncludeStatistics",value:256},{name:"IncludeLatestVersionOnly",value:512},{name:"Unpublished",value:4096},{name:"IncludeNameConflictInfo",value:32768},{name:"IncludeLatestPrereleaseAndStableVersionOnly",value:65536}]},signing:{allPublicRepositorySigned:!0}}}}};Wf=__decorate([__param(0,pe)],Wf);var Hf=class extends Wf{get extensionGalleryManifestStatus(){return this.f?"available":"unavailable"}constructor(e,s){super(s),this.b=this.B(new R),this.onDidChangeExtensionGalleryManifest=this.b.event,this.c=this.B(new R),this.onDidChangeExtensionGalleryManifestStatus=this.c.event,this.g=new sr,e.registerChannel("extensionGalleryManifest",{listen:()=>L.None,call:async(i,n,r)=>{switch(n){case"setExtensionGalleryManifest":return Promise.resolve(this.h(r[0]))}throw new Error("Invalid call")}})}async getExtensionGalleryManifest(){return await this.g.wait(),this.f??null}h(e){this.f=e,this.b.fire(e),this.c.fire(this.extensionGalleryManifestStatus),this.g.open()}};Hf=__decorate([__param(1,pe)],Hf);var jk=W("IWebContentExtractorService"),Cw=W("ISharedWebContentExtractorService"),H3=class{async readImage(t,e){if(!e.isCancellationRequested)try{const s=await fetch(t.toString(!0),{headers:{Accept:"image/*","User-Agent":"Mozilla/5.0"}}),i=s.headers.get("content-type");return!s.ok||!i?.startsWith("image/")||!/(webp|jpg|jpeg|gif|png|bmp)$/i.test(i)?void 0:A.wrap(await s.bytes())}catch(s){console.log(s);return}}},Dw;(function(t){t.NODE="npm",t.PYTHON="pypi",t.DOCKER="docker-hub",t.NUGET="nuget",t.REMOTE="remote",t.MCPB="mcpb"})(Dw||(Dw={}));var Iw;(function(t){t.Active="active",t.Deprecated="deprecated"})(Iw||(Iw={}));var hc=W("IMcpGalleryService"),Ow=W("IMcpManagementService"),uc=W("IAllowedMcpServersService"),Gf="chat.mcp.access",Lw;(function(t){t.Never="never",t.OnlyNew="onlyNew",t.NewAndOutdated="newAndOutdated"})(Lw||(Lw={}));var Aw;(function(t){t.None="none",t.Registry="registry",t.All="all"})(Aw||(Aw={}));var Kr=W("IMcpResourceScannerService"),fc=class extends T{constructor(e,s){super(),this.b=e,this.c=s,this.a=new lt}async scanMcpServers(e,s){return this.f(e,s)}async addMcpServers(e,s,i){await this.f(s,i,n=>{let r=n.inputs??[];const o=n.servers??{};for(const{name:a,config:c,inputs:l}of e)if(o[a]=c,l){const h=new Set(r.map(f=>f.id)),u=l.filter(f=>!h.has(f.id));r=[...r,...u]}return{servers:o,inputs:r}})}async removeMcpServers(e,s,i){await this.f(s,i,n=>{for(const r of e)n.servers?.[r]&&delete n.servers[r];return n})}async f(e,s,i){return this.s(e).queue(async()=>{s=s??2;let n={};try{const r=await this.b.readFile(e),o=[],a=We(r.value.toString(),o,{allowTrailingComma:!0,allowEmptyContent:!0})||{};if(o.length>0)throw new Error("Failed to parse scanned MCP servers: "+o.join(", "));if(s===2)n=this.m(a);else if(s===6)n=this.n(a);else if(s===5){const c=a;c.settings?.mcp&&(n=this.n(c.settings?.mcp))}}catch(r){if(Me(r)!==1)throw r}return i&&(n=i(n??{}),s===2?await this.g(e,n):s===6?await this.h(e,n):s===5?await this.j(e,n):Bv(s,`Invalid Target: ${Zb(s)}`)),n})}async g(e,s){s.servers&&Object.keys(s.servers).length>0||s.inputs&&s.inputs.length>0?await this.b.writeFile(e,A.fromString(JSON.stringify(s,null,"	"))):await this.b.del(e)}async h(e,s){await this.b.writeFile(e,A.fromString(JSON.stringify(s,null,"	")))}async j(e,s){let i;try{const n=await this.b.readFile(e),r=[];if(i=We(n.value.toString(),r,{allowTrailingComma:!0,allowEmptyContent:!0}),r.length>0)throw new Error("Failed to parse scanned MCP servers: "+r.join(", "))}catch(n){if(Me(n)!==1)throw n;i={settings:{}}}i.settings||(i.settings={}),i.settings.mcp=s,await this.b.writeFile(e,A.fromString(JSON.stringify(i,null,"	")))}m(e){const s={inputs:e.inputs},i=Object.entries(e.servers??{});if(i.length>0){s.servers={};for(const[n,r]of i)s.servers[n]=this.r(r)}return s}n(e){const s={inputs:e.inputs},i=Object.entries(e.servers??{});if(i.length>0){s.servers={};for(const[n,r]of i)s.servers[n]=this.r(r)}return s}r(e){let s;if(e.config){const i=e;s={...i.config,version:i.version,gallery:i.gallery}}else s=e;return(s.type===void 0||s.type!=="http"&&s.type!=="stdio")&&(s.type=s.command?"stdio":"http"),s}s(e){let s=this.a.get(e);return s||(s=new un,this.a.set(e,s)),s}};fc=__decorate([__param(0,K),__param(1,he)],fc),Zm(Kr,fc,1);var Nw=class extends T{getMcpServerConfigurationFromManifest(t,e){let s;const i=[];if(e==="remote"&&t.remotes?.length){const n={};for(const r of t.remotes[0].headers??[]){const o=r.variables?this.b(r.variables):[];let a=r.value;for(const c of o)a=a.replace(`{${c.id}}`,`\${input:${c.id}}`);n[r.name]=a,o.length&&i.push(...o)}s={type:"http",url:t.remotes[0].url,headers:Object.keys(n).length?n:void 0}}else{const n=t.packages?.find(a=>a.registry_type===e)??t.packages?.[0];if(!n)throw new Error("No server package found");const r=[],o={};n.registry_type==="docker-hub"&&(r.push("run"),r.push("-i"),r.push("--rm"));for(const a of n.runtime_arguments??[]){const c=a.variables?this.b(a.variables):[];if(a.type==="positional"){let l=a.value;if(l)for(const h of c)l=l.replace(`{${h.id}}`,`\${input:${h.id}}`);r.push(l??a.value_hint)}else if(a.type==="named"&&(r.push(a.name),a.value)){let l=a.value;for(const h of c)l=l.replace(`{${h.id}}`,`\${input:${h.id}}`);r.push(l)}c.length&&i.push(...c)}for(const a of n.environment_variables??[]){const c=a.variables?this.b(a.variables):[];let l=a.value;for(const h of c)l=l.replace(`{${h.id}}`,`\${input:${h.id}}`);o[a.name]=l,c.length&&i.push(...c),n.registry_type==="docker-hub"&&(r.push("-e"),r.push(a.name))}n.registry_type==="npm"?r.push(n.version?`${n.identifier}@${n.version}`:n.identifier):n.registry_type==="pypi"?r.push(n.version?`${n.identifier}==${n.version}`:n.identifier):n.registry_type==="docker-hub"?r.push(n.version?`${n.identifier}:${n.version}`:n.identifier):n.registry_type==="nuget"&&(r.push(n.version?`${n.identifier}@${n.version}`:n.identifier),r.push("--yes"),n.package_arguments?.length&&r.push("--"));for(const a of n.package_arguments??[]){const c=a.variables?this.b(a.variables):[];if(a.type==="positional"){let l=a.value;if(l)for(const h of c)l=l.replace(`{${h.id}}`,`\${input:${h.id}}`);r.push(l??a.value_hint)}else if(a.type==="named"&&(r.push(a.name),a.value)){let l=a.value;for(const h of c)l=l.replace(`{${h.id}}`,`\${input:${h.id}}`);r.push(l)}c.length&&i.push(...c)}s={type:"stdio",command:this.a(n.registry_type),args:r.length?r:void 0,env:Object.keys(o).length?o:void 0}}return{config:s,inputs:i.length?i:void 0}}a(t){switch(t){case"npm":return"npx";case"docker-hub":return"docker";case"pypi":return"uvx";case"nuget":return"dnx"}return t}b(t){const e=[];for(const[s,i]of Object.entries(t))e.push({id:s,type:i.choices?"pickString":"promptString",description:i.description??"",password:!!i.is_secret,default:i.default,options:i.choices});return e}},Jf=class extends Nw{get onDidInstallMcpServers(){return this.j.event}get onDidUpdateMcpServers(){return this.m.event}get onUninstallMcpServer(){return this.n.event}get onDidUninstallMcpServer(){return this.r.event}constructor(e,s,i,n,r,o,a){super(),this.t=e,this.u=s,this.w=i,this.y=n,this.z=r,this.C=o,this.D=a,this.g=new Map,this.h=this.B(new R),this.onInstallMcpServer=this.h.event,this.j=this.B(new R),this.m=this.B(new R),this.n=this.B(new R),this.r=this.B(new R),this.f=this.B(new fs(()=>this.I(),50))}F(){return this.c||(this.c=(async()=>{try{this.g=await this.G()}finally{this.H()}})()),this.c}async G(){this.C.trace("AbstractMcpResourceManagementService#populateLocalServers",this.t.toString());const e=new Map;try{const s=await this.D.scanMcpServers(this.t,this.u);s.servers&&await Promise.allSettled(Object.entries(s.servers).map(async([i,n])=>{const r=await this.J(i,n);e.set(i,r)}))}catch(s){throw this.C.debug("Could not read user MCP servers:",s),s}return e}H(){this.B(this.y.watch(this.t)),this.B(this.y.onDidFilesChange(e=>{e.affects(this.t)&&this.f.schedule()}))}async I(){try{const e=await this.G(),s=[],i=[],n=[...this.g.keys()].filter(r=>!e.has(r));for(const r of n)this.g.delete(r);for(const[r,o]of e){const a=this.g.get(r);a?yt(a,o)||(i.push(o),this.g.set(r,o)):(s.push(o),this.g.set(r,o))}for(const r of n)this.g.delete(r),this.r.fire({name:r,mcpResource:this.t});i.length&&this.m.fire(i.map(r=>({name:r.name,local:r,mcpResource:this.t}))),s.length&&this.j.fire(s.map(r=>({name:r.name,local:r,mcpResource:this.t})))}catch(e){this.C.error("Failed to load installed MCP servers:",e)}}async getInstalled(){return await this.F(),Array.from(this.g.values())}async J(e,s){let i=await this.L(e,s);return i||(i={name:e,version:s.version,galleryUrl:$e(s.gallery)?s.gallery:void 0}),{name:e,config:s,mcpResource:this.t,version:i.version,location:i.location,displayName:i.displayName,description:i.description,publisher:i.publisher,publisherDisplayName:i.publisherDisplayName,galleryUrl:i.galleryUrl,repositoryUrl:i.repositoryUrl,readmeUrl:i.readmeUrl,icon:i.icon,codicon:i.codicon,manifest:i.manifest,source:s.gallery?"gallery":"local"}}async install(e,s){this.C.trace("MCP Management Service: install",e.name),this.h.fire({name:e.name,mcpResource:this.t});try{await this.D.addMcpServers([e],this.t,this.u),await this.I();const i=this.g.get(e.name);if(!i)throw new Error(`Failed to install MCP server: ${e.name}`);return i}catch(i){throw this.j.fire([{name:e.name,error:i,mcpResource:this.t}]),i}}async uninstall(e,s){this.C.trace("MCP Management Service: uninstall",e.name),this.n.fire({name:e.name,mcpResource:this.t});try{if(!(await this.D.scanMcpServers(this.t,this.u)).servers)return;await this.D.removeMcpServers([e.name],this.t,this.u),e.location&&await this.y.del(k.revive(e.location),{recursive:!0}),await this.I()}catch(i){throw this.r.fire({name:e.name,error:i,mcpResource:this.t}),i}}};Jf=__decorate([__param(2,hc),__param(3,K),__param(4,he),__param(5,Y),__param(6,Kr)],Jf);var dc=class extends Jf{constructor(e,s,i,n,r,o,a){super(e,2,s,i,n,r,o),this.N=n.extUri.joinPath(a.userRoamingDataHome,"mcp")}async installFromGallery(e,s){throw new Error("Not supported")}async updateMetadata(e,s){await this.O(s),await this.I();const i=(await this.getInstalled()).find(n=>n.name===e.name);if(!i)throw new Error(`Failed to find MCP server: ${e.name}`);return i}async O(e){const s=await this.w.getMcpServerConfiguration(e,Q.None),i=this.Q(e.name,e.version),n=this.z.extUri.joinPath(i,"manifest.json"),r={id:e.id,galleryUrl:e.url,name:e.name,displayName:e.displayName,description:e.description,version:e.version,publisher:e.publisher,publisherDisplayName:e.publisherDisplayName,repositoryUrl:e.repositoryUrl,licenseUrl:e.license,icon:e.icon,codicon:e.codicon,manifest:s};if(await this.y.writeFile(n,A.fromString(JSON.stringify(r))),e.readmeUrl||e.readme){const o=e.readme?e.readme:await this.w.getReadme(e,Q.None);await this.y.writeFile(this.z.extUri.joinPath(i,"README.md"),A.fromString(o))}return s}async L(e,s){let i,n,r;if(s.gallery){n=this.Q(e,s.version);const o=this.z.extUri.joinPath(n,"manifest.json");try{const a=await this.y.readFile(o);i=JSON.parse(a.value.toString()),i.location=n,r=this.z.extUri.joinPath(n,"README.md"),await this.y.exists(r)||(r=void 0),i.readmeUrl=r}catch(a){this.C.error("MCP Management Service: failed to read manifest",n.toString(),a)}}return i}Q(e,s){return e=e.replace("/","."),this.z.extUri.joinPath(this.N,s?`${e}-${s}`:e)}M(e,s){throw new Error("Method not supported.")}};dc=__decorate([__param(1,hc),__param(2,K),__param(3,he),__param(4,Y),__param(5,Kr),__param(6,ae)],dc);var pc=class extends Nw{constructor(e){super(),this.c=e}canInstall(e){const s=this.c.isAllowed(e);return s!==!0?new Cs(v(2155,null,s.value)):!0}};pc=__decorate([__param(0,uc)],pc);var Kf=class extends pc{constructor(e,s,i){super(e),this.r=s,this.t=i,this.f=this.B(new R),this.onInstallMcpServer=this.f.event,this.g=this.B(new R),this.onDidInstallMcpServers=this.g.event,this.h=this.B(new R),this.onDidUpdateMcpServers=this.h.event,this.j=this.B(new R),this.onUninstallMcpServer=this.j.event,this.m=this.B(new R),this.onDidUninstallMcpServer=this.m.event,this.n=new lt}u(e){let s=this.n.get(e);if(!s){const i=new De,n=i.add(this.w(e));i.add(n.onInstallMcpServer(r=>this.f.fire(r))),i.add(n.onDidInstallMcpServers(r=>this.g.fire(r))),i.add(n.onDidUpdateMcpServers(r=>this.h.fire(r))),i.add(n.onUninstallMcpServer(r=>this.j.fire(r))),i.add(n.onDidUninstallMcpServer(r=>this.m.fire(r))),this.n.set(e,s={service:n,dispose:()=>i.dispose()})}return s.service}async getInstalled(e){const s=e||this.r.defaultProfile.mcpResource;return this.u(s).getInstalled()}async install(e,s){const i=s?.mcpResource||this.r.defaultProfile.mcpResource;return this.u(i).install(e,s)}async uninstall(e,s){const i=s?.mcpResource||this.r.defaultProfile.mcpResource;return this.u(i).uninstall(e,s)}async installFromGallery(e,s){const i=s?.mcpResource||this.r.defaultProfile.mcpResource;return this.u(i).installFromGallery(e,s)}async updateMetadata(e,s,i){return this.u(i||this.r.defaultProfile.mcpResource).updateMetadata(e,s)}dispose(){this.n.forEach(e=>e.dispose()),this.n.clear(),super.dispose()}w(e){return this.t.createInstance(dc,e)}};Kf=__decorate([__param(0,uc),__param(1,je),__param(2,is)],Kf);var Qf=class extends dc{constructor(e,s,i,n,r,o,a){super(e,s,i,n,r,o,a)}async installFromGallery(e,s){this.C.trace("MCP Management Service: installGallery",e.url),this.h.fire({name:e.name,mcpResource:this.t});try{const i=await this.O(e),n=s?.packageType??i.packages?.[0]?.registry_type??"remote",{config:r,inputs:o}=this.getMcpServerConfigurationFromManifest(i,n),a={name:e.name,config:{...r,gallery:e.url??!0,version:e.version},inputs:o};await this.D.addMcpServers([a],this.t,this.u),await this.I();const c=(await this.getInstalled()).find(l=>l.name===e.name);if(!c)throw new Error(`Failed to install MCP server: ${e.name}`);return c}catch(i){throw this.j.fire([{name:e.name,source:e,error:i,mcpResource:this.t}]),i}}};Qf=__decorate([__param(1,hc),__param(2,K),__param(3,he),__param(4,Y),__param(5,Kr),__param(6,ae)],Qf);var G3=class extends Kf{w(t){return this.t.createInstance(Qf,t)}},jw;(function(t){t.McpQueryService="McpQueryService",t.McpServerManifestUri="McpServerManifestUriTemplate"})(jw||(jw={}));var Tw;(function(t){t.Available="available",t.Unavailable="unavailable"})(Tw||(Tw={}));var Mw=W("IMcpGalleryManifestService");function Fw(t,e){const[s,i]=e.split("/");for(const n of t.resources){const[r,o]=n.type.split("/");if(r===s){if(!i||o===i)return n.id;break}}}function J3(t){return{firstPage:t,total:t.length,pageSize:t.length,getPage:(e,s)=>Promise.resolve(t)}}var K3=class{constructor(t){this.a=[],this.d=!1,this.f=new Map,this.b=t,this.firstPage=[...t.elements],this.pageSize=t.elements.length||1,this.a[0]=this.firstPage,this.d=!t.hasNextPage,this.total=t.total}async getPage(t,e){if(e.isCancellationRequested)throw new Ve;if(t<this.a.length)return this.a[t];if(this.d)throw new Error(`Page ${t} is out of bounds. Total pages: ${this.a.length}`);let s;for(const[i,n]of this.f)if(i>=t){s=n;break}s||(s=this.g(t,e),this.f.set(t,s));try{if(await s,t>=this.a.length)throw new Error(`Page ${t} is out of bounds. Total pages: ${this.a.length}`);return this.a[t]}finally{this.f.has(t)&&this.f.delete(t)}}async g(t,e){for(;t>=this.a.length&&this.b.hasNextPage;){if(e.isCancellationRequested)throw new Ve;this.b=await this.b.getNextPage(e),this.a.push([...this.b.elements])}this.b.hasNextPage||(this.d=!0)}};function Q3(t){return t&&Array.isArray(t.servers)&&Uw(t.servers[0])}function Uw(t){return t&&t.server!==void 0}var X3=50,Z3={pageSize:X3},Y3=class ld{constructor(e=Z3){this.a=e}get pageSize(){return this.a.pageSize}get searchText(){return this.a.searchText}withPage(e,s=this.pageSize){return new ld({...this.a,pageSize:s,cursor:e})}withSearchText(e){return new ld({...this.a,searchText:e})}},Xf=class extends T{constructor(e,s,i,n,r){super(),this.a=e,this.b=s,this.c=i,this.f=n,this.g=r}isEnabled(){return this.g.mcpGalleryManifestStatus==="available"}async query(e,s=Q.None){const i=await this.g.getMcpGalleryManifest();if(!i)return J3([]);const n=new Y3,{servers:r,metadata:o}=await this.m(n,i,s),a=o?.total??o?.count??r.length,c=async(l,h)=>{if(h.isCancellationRequested)throw new Ve;const{servers:u,metadata:f}=l?await this.m(n.withPage(l),i,s):{servers:[],metadata:void 0};return{elements:u,total:a,hasNextPage:!!l,getNextPage:p=>c(f?.next_cursor,p)}};return new K3({elements:r,total:a,hasNextPage:!!o?.next_cursor,getNextPage:l=>c(o?.next_cursor,l)})}async getMcpServersFromGallery(e){const s=await this.g.getMcpGalleryManifest();if(!s)return[];const i=[];return await Promise.allSettled(e.map(async n=>{const r=this.u(Ct(n),s);if(r!==n)return;const o=await this.getMcpServer(r);o&&i.push(o)})),i}async getMcpServersFromVSCodeGallery(e){return(await this.t()).filter(i=>e.includes(i.name))}async getMcpServerConfiguration(e,s){if(e.configuration)return e.configuration;if(!e.url)throw new Error(`No manifest URL found for ${e.name}`);const i=await this.a.request({type:"GET",url:e.url},s),n=await ps(i);if(!n)throw new Error(`Failed to fetch configuration from ${e.url}`);const r=this.r(n),o=this.j(r.packages,r.remotes);if(!o)throw new Error(`Failed to fetch configuration for ${e.url}`);return o}async getReadme(e,s){const i=e.readmeUrl;if(!i)return Promise.resolve(v(2153,null));const n=k.parse(i);if(n.scheme===oe.file)try{return(await this.b.readFile(n)).value.toString()}catch(a){this.f.error(`Failed to read file from ${n}: ${a}`)}if(n.authority!=="raw.githubusercontent.com")return new Cs(v(2154,null,i)).value;const r=await this.a.request({type:"GET",url:i},s),o=await eh(r);if(!o)throw new Error(`Failed to fetch README from ${i}`);return o}h(e,s){const i=e._meta?.["x-io.modelcontextprotocol.registry"],n=e._meta?.github??e._meta?.["x-github"];let r="",o="";if(n?.name)o=n.name.split("-").map(c=>Gc(c)).join(" "),r=n.name_with_owner.split("/")[0];else{const c=e.name.split("/");if(c.length>0){const l=c[0].split(".");l.length>0&&(r=l[l.length-1])}o=c[c.length-1].split("-").map(l=>Gc(l)).join(" ")}const a=n?.owner_avatar_url?{light:n.owner_avatar_url,dark:n.owner_avatar_url}:void 0;return{id:e.id,name:e.name,displayName:o,url:s,description:e.description,status:e.status??"active",version:e.version_detail.version,isLatest:e.version_detail.is_latest,releaseDate:Date.parse(e.version_detail.release_date),publishDate:i?Date.parse(i.published_at):void 0,lastUpdated:i?Date.parse(i.updated_at):void 0,repositoryUrl:e.repository?.url,readme:e.repository?.readme,icon:a,publisher:r,license:n?.license,starsCount:n?.stargazer_count,topics:n?.topics,configuration:this.j(e.packages,e.remotes)}}j(e,s){if(!(!e&&!s))return{packages:e?.map(i=>({...i,identifier:i.identifier??i.name,registry_type:i.registry_type??i.registry_name})),remotes:s}}async m(e,s,i){if(s.url===this.c.extensionsGallery?.mcpUrl)return{servers:await this.t()};const{servers:n,metadata:r}=await this.n(e,s,i);return{servers:n.map(o=>this.h(o,this.u(o.id,s))),metadata:r}}async n(e,s,i){const n=this.w(s);if(!n)return{servers:[]};const r=k.parse(n);if(r.scheme===oe.file)try{const h=(await this.b.readFile(r)).value.toString();return JSON.parse(h)}catch(l){this.f.error(`Failed to read file from ${r}: ${l}`)}const o=`${n}?limit=${e.pageSize}`,a=await this.a.request({type:"GET",url:o},i),c=await ps(a);return c?Q3(c)?{servers:c.servers.map(l=>this.r(l)),metadata:c.metadata}:c:{servers:[]}}async getMcpServer(e){const s=await this.a.request({type:"GET",url:e},Q.None);if(s.res.statusCode&&s.res.statusCode>=400&&s.res.statusCode<500)return;const i=await ps(s);if(i)return this.h(this.r(i),e)}r(e){return Uw(e)?{...e.server,_meta:{"x-io.modelcontextprotocol.registry":e["x-io.modelcontextprotocol.registry"],github:e["x-github"],"x-publisher":e["x-publisher"]}}:e}async t(){const e=this.c.extensionsGallery?.mcpUrl;if(!e)return[];const s=await this.a.request({type:"GET",url:e},Q.None),i=await ps(s);return i?i.servers.map(n=>({id:n.name,name:n.name,displayName:n.displayName,description:n.description,version:"0.0.1",isLatest:!0,status:"active",repositoryUrl:n.repository?.url,codicon:n.codicon,publisher:"",publisherDisplayName:n.publisher?.displayName,publisherDomain:n.publisher?{link:n.publisher.url,verified:n.publisher.is_verified}:void 0,readmeUrl:n.readmeUrl,configuration:this.j(n.manifest.packages,n.manifest.remotes)})):[]}u(e,s){const i=Fw(s,"McpServerManifestUriTemplate");if(i)return Zs(i,{id:e})}w(e){return Fw(e,"McpQueryService")}};Xf=__decorate([__param(0,oi),__param(1,K),__param(2,pe),__param(3,Y),__param(4,Mw)],Xf);function Qi(t,e){return t?k.revive(e?e.transformIncoming(t):t):void 0}function mi(t,e){e=e||ga;const s=t.manifest;return{...ma({...t,manifest:void 0},e),manifest:s}}function Zf(t,e){return t?.mcpResource?ma(t,e??ga):t}function Yf(t,e){return e?ql(t,s=>s instanceof k?e.transformOutgoingURI(s):void 0):t}function Qr(t,e){return e?e.transformOutgoingURI(t):t}var eS=class{constructor(t,e){this.a=t,this.b=e,this.onInstallMcpServer=L.buffer(t.onInstallMcpServer,!0),this.onDidInstallMcpServers=L.buffer(t.onDidInstallMcpServers,!0),this.onDidUpdateMcpServers=L.buffer(t.onDidUpdateMcpServers,!0),this.onUninstallMcpServer=L.buffer(t.onUninstallMcpServer,!0),this.onDidUninstallMcpServer=L.buffer(t.onDidUninstallMcpServer,!0)}listen(t,e){const s=this.b(t);switch(e){case"onInstallMcpServer":return L.map(this.onInstallMcpServer,i=>({...i,mcpResource:Qr(i.mcpResource,s)}));case"onDidInstallMcpServers":return L.map(this.onDidInstallMcpServers,i=>i.map(n=>({...n,local:n.local?Yf(n.local,s):n.local,mcpResource:Qr(n.mcpResource,s)})));case"onDidUpdateMcpServers":return L.map(this.onDidUpdateMcpServers,i=>i.map(n=>({...n,local:n.local?Yf(n.local,s):n.local,mcpResource:Qr(n.mcpResource,s)})));case"onUninstallMcpServer":return L.map(this.onUninstallMcpServer,i=>({...i,mcpResource:Qr(i.mcpResource,s)}));case"onDidUninstallMcpServer":return L.map(this.onDidUninstallMcpServer,i=>({...i,mcpResource:Qr(i.mcpResource,s)}))}throw new Error("Invalid listen")}async call(t,e,s){const i=this.b(t);switch(e){case"getInstalled":return(await this.a.getInstalled(Qi(s[0],i))).map(r=>Yf(r,i));case"install":return this.a.install(s[0],Zf(s[1],i));case"installFromGallery":return this.a.installFromGallery(s[0],Zf(s[1],i));case"uninstall":return this.a.uninstall(mi(s[0],i),Zf(s[1],i));case"updateMetadata":return this.a.updateMetadata(mi(s[0],i),s[1],Qi(s[2],i))}throw new Error("Invalid call")}},Bw=class extends pc{get onInstallMcpServer(){return this.f.event}get onDidInstallMcpServers(){return this.g.event}get onUninstallMcpServer(){return this.h.event}get onDidUninstallMcpServer(){return this.j.event}get onDidUpdateMcpServers(){return this.m.event}constructor(e,s){super(s),this.n=e,this.f=this.B(new R),this.g=this.B(new R),this.h=this.B(new R),this.j=this.B(new R),this.m=this.B(new R),this.B(this.n.listen("onInstallMcpServer")(i=>this.f.fire({...i,mcpResource:Qi(i.mcpResource,null)}))),this.B(this.n.listen("onDidInstallMcpServers")(i=>this.g.fire(i.map(n=>({...n,local:n.local?mi(n.local,null):n.local,mcpResource:Qi(n.mcpResource,null)}))))),this.B(this.n.listen("onDidUpdateMcpServers")(i=>this.m.fire(i.map(n=>({...n,local:n.local?mi(n.local,null):n.local,mcpResource:Qi(n.mcpResource,null)}))))),this.B(this.n.listen("onUninstallMcpServer")(i=>this.h.fire({...i,mcpResource:Qi(i.mcpResource,null)}))),this.B(this.n.listen("onDidUninstallMcpServer")(i=>this.j.fire({...i,mcpResource:Qi(i.mcpResource,null)})))}install(e,s){return Promise.resolve(this.n.call("install",[e,s])).then(i=>mi(i,null))}installFromGallery(e,s){return Promise.resolve(this.n.call("installFromGallery",[e,s])).then(i=>mi(i,null))}uninstall(e,s){return Promise.resolve(this.n.call("uninstall",[e,s]))}getInstalled(e){return Promise.resolve(this.n.call("getInstalled",[e])).then(s=>s.map(i=>mi(i,null)))}updateMetadata(e,s,i){return Promise.resolve(this.n.call("updateMetadata",[e,s,i])).then(n=>mi(n,null))}};Bw=__decorate([__param(1,uc)],Bw);var ed=class extends T{constructor(e){super(),this.b=e,this.a=this.B(new R),this.onDidChangeAllowedMcpServers=this.a.event,this.B(this.b.onDidChangeConfiguration(s=>{s.affectsConfiguration(Gf)&&this.a.fire()}))}isAllowed(e){if(this.b.getValue(Gf)!=="none")return!0;const s=k.parse(`command:workbench.action.openSettings?${encodeURIComponent(JSON.stringify({query:`@id:${Gf}`}))}`).toString();return new Cs(v(2152,null,s))}};ed=__decorate([__param(0,ge)],ed);var tS=class extends T{get mcpGalleryManifestStatus(){return this.c?"available":"unavailable"}constructor(t){super(),this.a=this.B(new R),this.onDidChangeMcpGalleryManifest=this.a.event,this.b=this.B(new R),this.onDidChangeMcpGalleryManifestStatus=this.b.event,this.f=new sr,t.registerChannel("mcpGalleryManifest",{listen:()=>L.None,call:async(e,s,i)=>{switch(s){case"setMcpGalleryManifest":return Promise.resolve(this.g(i[0]))}throw new Error("Invalid call")}})}async getMcpGalleryManifest(){return await this.f.wait(),this.c??null}g(t){this.c=t,this.a.fire(t),this.b.fire(this.mcpGalleryManifestStatus),this.f.open()}},sS=class extends T{constructor(t){super(),this.f=t,this.a=this.B(new sb(this)),this.b=void 0,this.c=this.B(new R),this.g()}g(){let t=!1;const e=()=>{t||(t=!0,this.b?.fireOnWillShutdown(),this.dispose())};process.once("exit",e),ib(process.parentPort,jf.exit,e)}async init(){const t=await this.h();H7(),t.invokeFunction(e=>{const s=e.get(Y),i=e.get(ke);s.trace("sharedProcess configuration",JSON.stringify(this.f)),this.j(e),this.m(s),this.n(i,s)}),this.B(Bc(t.createInstance(vl,this.f.codeCachePath),t.createInstance(yl),t.createInstance(Ol),t.createInstance(Il),t.createInstance(Dl),t.createInstance(bf),t.createInstance(vf),t.createInstance(Vf)))}async h(){const t=new Jh,e={_serviceBrand:void 0,...ci};t.set(pe,e);const s=new z1(j=>j==="main"),i=new D2(this.a,s);t.set(Jo,i);const n=this.f.policiesData?new $8(this.f.policiesData,i.getChannel("policy")):new lg;t.set(cg,n);const r=new n3(this.f.args,e);t.set(_t,r);const o=new F7(void 0,this.f.logLevel,r.logsHome,this.f.loggers.map(j=>({...j,resource:k.revive(j.resource)})),i.getChannel("logger"));t.set(dr,o);const a={id:"shared",name:v(165,null)},c=this.B(o.createLogger("sharedprocess",{name:v(166,null),group:a})),l=this.B(new Wb(c.getLevel())),h=this.B(new hw(c,[l]));t.set(Y,h),this.b=this.B(new Sf(h)),t.set(uw,this.b);const u=this.B(new qh(h));t.set(K,u);const f=this.B(new O7(h));u.registerProvider(oe.file,f);const p=new ac(u);t.set(he,p);const g=this.B(new x8(this.f.profiles.all,k.revive(this.f.profiles.home).with({scheme:r.userRoamingDataHome.scheme}),i.getChannel("userDataProfiles")));t.set(je,g);const m=this.B(new y8(oe.file,this.B(new S8(i.getChannel(b8),{pathCaseSensitive:wt})),oe.vscodeUserData,g,p,h));u.registerProvider(oe.vscodeUserData,m);const w=this.B(new H2(g.defaultProfile.settingsResource,u,n,h));t.set(ge,w);const b=new W8(void 0,{defaultProfile:g.defaultProfile,currentProfile:g.defaultProfile},i,r);t.set(ne,b),this.B(de(()=>b.flush())),await Promise.all([w.initialize(),b.initialize()]);const S=this.B(o.createLogger("network-shared",{name:v(167,null),group:a})),$=new zf(w,r,this.B(new hw(S)));t.set(oi,$),t.set(zp,new ce(Ul,void 0,!1)),t.set(tw,new ce(E8,void 0,!1));const U=new Pf(-1,i);t.set(Go,U),t.set(bg,new ce(sh,void 0,!0));const q=this.B(new A6(U)),me=new z1(j=>q.getActiveClientId().then(O=>j===O));t.set(O0,new _8(this.a.getChannel("extensionRecommendationNotification",me)));let N;const E=[],P=b5(e,w);if(Cg(e,r)){const j=new Ra("",!1,o,r,e);if(E.push(j),!Dg(e,r)&&e.aiConfig?.ariaKey){const O=new N8($,P,"monacoworkbench",null,e.aiConfig.ariaKey);this.B(de(()=>O.flush())),E.push(O)}N=new Ca({appenders:E,commonProperties:p5(Ov(),Iv(),process.arch,e.commit,e.version,this.f.machineId,this.f.sqmId,this.f.devDeviceId,P,e.date),sendErrorTelemetry:!0,piiPaths:S5(r)},w,e)}else{N=w5;const j=y5;E.push(j)}this.a.registerChannel("telemetryAppender",new B7(E)),t.set(ke,N);const z=new Yh(w,N,o,r,e);t.set(gg,z),t.set(ai,new ce(kf,void 0,!0)),t.set(Sa,new ce(mf,void 0,!0)),t.set(s0,new ce(vh,void 0,!0)),t.set(Mi,new ce(qf,void 0,!0)),t.set(Mh,new ce(Uh,void 0,!0)),t.set(uc,new ce(ed,void 0,!0)),t.set(Mw,new tS(this.a)),t.set(hc,new ce(Xf,void 0,!0)),t.set(Kr,new ce(fc,void 0,!0)),t.set(Ow,new ce(G3,void 0,!0)),t.set(Pr,new Hf(this.a,e)),t.set(Es,new ce(wh,void 0,!0)),t.set(Ip,new ce(Nf,void 0,!1)),t.set(Rl,new ce(Qh,void 0,!1)),t.set(hg,new ce(Zl,void 0,!1)),t.set(Aa,new ce(ru,void 0,!0)),t.set(Re,new ce(mu,void 0,!0)),t.set(La,$t.toService(this.a.getChannel("userDataSyncUtil",j=>j.ctx!=="main"))),t.set(Dp,new ce(aa,void 0,!1)),t.set(Da,new ce(tu,void 0,!0)),t.set(eu,new ce(Tr)),t.set(li,new ce(du,void 0,!0)),t.set(nt,new ce(gu,void 0,!0)),t.set(Ta,new ce(vu,void 0,!0)),t.set(xt,new ce(cu,void 0,!1)),t.set(pt,new ce(bu,void 0,!0)),t.set(Oa,new ce(Ku,void 0,!1)),t.set(Br,new ce(Xu,void 0,!0)),t.set(nu,new ce(yf,void 0,!0)),t.set(ic,new ce(T6,void 0,!1));const B=new f8;return t.set(oc,B),B.register(0,J8),t.set(Dm,new ce(ff)),t.set(Qm,new ce(pf)),t.set(rw,new ce(xf)),t.set(Cw,new ce(H3)),new N7(t)}j(t){const e=new x9(t.get(Hs),()=>null);this.a.registerChannel("extensions",e);const s=new eS(t.get(Ow),()=>null);this.a.registerChannel("mcpManagement",s);const i=$t.fromService(t.get(Rl),this.q);this.a.registerChannel("languagePacks",i);const n=$t.fromService(t.get(hg),this.q);this.a.registerChannel("diagnostics",n);const r=new k9(t.get(Ip));this.a.registerChannel("extensionTipsService",r);const o=$t.fromService(t.get(zp),this.q);this.a.registerChannel("checksum",o);const a=$t.fromService(t.get(tw),this.q);this.a.registerChannel("v8InspectProfiling",a);const c=$t.fromService(t.get(Ta),this.q);this.a.registerChannel("userDataSyncMachines",c);const l=$t.fromService(t.get(gg),this.q);this.a.registerChannel("customEndpointTelemetry",l);const h=new t6(t.get(Aa));this.a.registerChannel("userDataSyncAccount",h);const u=new s6(t.get(li));this.a.registerChannel("userDataSyncStoreManagement",u);const f=new O6(t.get(Oa),t.get(je),t.get(Y));this.a.registerChannel("userDataSync",f);const p=this.B(t.get(is).createInstance(Lf));this.a.registerChannel("userDataAutoSync",$t.fromService(p,this.q)),this.a.registerChannel("IUserDataSyncResourceProviderService",$t.fromService(t.get(nu),this.q));const g=$t.fromService(t.get(Qm),this.q);this.a.registerChannel(g8,g);const m=$t.fromService(t.get(rw),this.q);this.a.registerChannel("remoteTunnel",m);const w=$t.fromService(t.get(Cw),this.q);this.a.registerChannel("sharedWebContentExtractor",w)}m(t){process.on("uncaughtException",e=>it(e)),process.on("unhandledRejection",e=>it(e)),Nv(e=>{const s=Qt(e,!0);s&&t.error(`[uncaught exception in sharedProcess]: ${s}`)})}async n(t,e){if(wt){const[s,i]=await Promise.all([l3(e.error.bind(e)),w3(e.error.bind(e))]),n=u3(),r=v3(i,this.f.args["ozone-platform"]);s&&t.publicLog2("clientPlatformInfo",{platformId:s.id,platformVersionId:s.version_id,platformIdLike:s.id_like,desktopEnvironment:n,displayProtocol:i,codeDisplayProtocol:r})}}handledClientConnection(t){if(t.data!==r3.response)return!1;const e=t.ports.at(0);return e?(this.c.fire(e),!0):!1}};async function zw(t){try{const e=new sS(t);process.parentPort.postMessage(jf.ipcReady),await e.init(),process.parentPort.postMessage(jf.initDone)}catch(e){process.parentPort.postMessage({error:e.toString()})}}var iS=setTimeout(()=>{process.parentPort.postMessage({warning:"[SharedProcess] did not receive configuration within 30s..."})},3e4);process.parentPort.once("message",t=>{clearTimeout(iS),zw(t.data)});export{zw as main};

//# sourceMappingURL=https://main.vscode-cdn.net/sourcemaps/385651c938df8a906869babee516bffd0ddb9829/core/vs/code/electron-utility/sharedProcess/sharedProcessMain.js.map
